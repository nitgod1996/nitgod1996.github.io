



<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#FFF">
  <link rel="apple-touch-icon" sizes="180x180" href="../images/apple-touch-icon.png">

<link rel="icon" type="image/ico" sizes="32x32" href="../images/favicon.ico">
  <meta http-equiv="Cache-Control" content="no-transform">
  <meta http-equiv="Cache-Control" content="no-siteapp">


<link rel="alternate" type="application/rss+xml" title="宁理大神1996" href="https://nitgod1996.com/rss.xml" />
<link rel="alternate" type="application/atom+xml" title="宁理大神1996" href="https://nitgod1996.com/atom.xml" />
<link rel="alternate" type="application/json" title="宁理大神1996" href="https://nitgod1996.com/feed.json" />



<link rel="stylesheet" href="../css/app.css?v=0.2.5">

  

<link rel="canonical" href="https://nitgod1996.com/2022/01/14/note/%E5%89%8D%E7%AB%AF/js%E9%AB%98%E7%BA%A7%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1/">



  <title>
JavaScript 高级程序设计 |
nitgod1996 = 宁理大神 1996</title>
<meta name="generator" content="Hexo 5.4.0"><link rel="stylesheet" href="/css/prism.css" type="text/css"></head>
<body itemscope itemtype="http://schema.org/WebPage">
  <div id="loading">
    <div class="cat">
      <div class="body"></div>
      <div class="head">
        <div class="face"></div>
      </div>
      <div class="foot">
        <div class="tummy-end"></div>
        <div class="bottom"></div>
        <div class="legs left"></div>
        <div class="legs right"></div>
      </div>
      <div class="paw">
        <div class="hands left"></div>
        <div class="hands right"></div>
      </div>
    </div>
  </div>
  <div id="container">
    <header id="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="inner">
        <div id="brand">
          <div class="pjax">
          
  <h1 itemprop="name headline">JavaScript 高级程序设计
  </h1>
  
<div class="meta">
  <span class="item" title="创建时间：2022-01-14 17:03:50">
    <span class="icon">
      <i class="ic i-calendar"></i>
    </span>
    <span class="text">发表于</span>
    <time itemprop="dateCreated datePublished" datetime="2022-01-14T17:03:50+08:00">2022-01-14</time>
  </span>
  <span class="item" title="本文字数">
    <span class="icon">
      <i class="ic i-pen"></i>
    </span>
    <span class="text">本文字数</span>
    <span>131k</span>
    <span class="text">字</span>
  </span>
  <span class="item" title="阅读时长">
    <span class="icon">
      <i class="ic i-clock"></i>
    </span>
    <span class="text">阅读时长</span>
    <span>1:59</span>
  </span>
</div>


          </div>
        </div>
        <nav id="nav">
  <div class="inner">
    <div class="toggle">
      <div class="lines" aria-label="切换导航栏">
        <span class="line"></span>
        <span class="line"></span>
        <span class="line"></span>
      </div>
    </div>
    <ul class="menu">
      <li class="item title"><a href="/" rel="start">nitgod1996</a></li>
    </ul>
    <ul class="right">
      <li class="item theme">
        <i class="ic i-sun"></i>
      </li>
      <li class="item search">
        <i class="ic i-search"></i>
      </li>
    </ul>
  </div>
</nav>

      </div>
      <div id="imgs" class="pjax">
        <ul>
          <li class="item" data-background-image="https://tva3.sinaimg.cn/large/6833939bly1gipexj2jgzj20zk0m8b09.jpg"></li>
          <li class="item" data-background-image="https://tva3.sinaimg.cn/large/6833939bly1gipevarprfj20zk0m8npd.jpg"></li>
          <li class="item" data-background-image="https://tva3.sinaimg.cn/large/6833939bly1gicli9lfebj20zk0m84qp.jpg"></li>
          <li class="item" data-background-image="https://tva3.sinaimg.cn/large/6833939bly1giciub8ja1j20zk0m81ky.jpg"></li>
          <li class="item" data-background-image="https://tva3.sinaimg.cn/large/6833939bly1gipevuctzzj20zk0m84qp.jpg"></li>
          <li class="item" data-background-image="https://tva3.sinaimg.cn/large/6833939bly1gipev1x5e4j20zk0m8b29.jpg"></li>
        </ul>
      </div>
    </header>
    <div id="waves">
      <svg class="waves" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto">
        <defs>
          <path id="gentle-wave" d="M-160 44c30 0 58-18 88-18s 58 18 88 18 58-18 88-18 58 18 88 18 v44h-352z" />
        </defs>
        <g class="parallax">
          <use xlink:href="#gentle-wave" x="48" y="0" />
          <use xlink:href="#gentle-wave" x="48" y="3" />
          <use xlink:href="#gentle-wave" x="48" y="5" />
          <use xlink:href="#gentle-wave" x="48" y="7" />
        </g>
      </svg>
    </div>
    <main>
      <div class="inner">
        <div id="main" class="pjax">
          
  <div class="article wrap">
    
<div class="breadcrumb" itemscope itemtype="https://schema.org/BreadcrumbList">
<i class="ic i-home"></i>
<span><a href="../../../../../../index.html">首页</a></span>
</div>

    <article itemscope itemtype="http://schema.org/Article" class="post block" lang="zh-CN">
  <link itemprop="mainEntityOfPage" href="https://nitgod1996.com/2022/01/14/note/%E5%89%8D%E7%AB%AF/js%E9%AB%98%E7%BA%A7%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1/">

  <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="image" content="../../../../../../images/avatar.jpg">
    <meta itemprop="name" content="宁理大神1996">
    <meta itemprop="description" content=", 宁理大神的个人博客">
  </span>

  <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="宁理大神 1996">
  </span>

  <div class="body md" itemprop="articleBody">
    

    <h1 id="一-什么是-javascript"><a class="anchor" href="#一-什么是javascript">#</a> 一、 什么是 JavaScript</h1>
<h2 id="1-javascript-的构成"><a class="anchor" href="#1-javascript的构成">#</a> 1. JavaScript 的构成</h2>
<p>完整的 JavaScript 实现包含以下 3 个部分</p>
<ul>
<li>核心（ECMAScript）：提供脚本的核心功能</li>
<li>文档对象模型（DOM）：提供与网页（HTML 页面）内容交互的方法和接口</li>
<li>浏览器对象模型（BOM）：提供与浏览器交互的方法和接口</li>
</ul>
<p><img data-src="/2022/01/14/note/%E5%89%8D%E7%AB%AF/js%E9%AB%98%E7%BA%A7%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1/image-20220114172758293.png" alt="image-20220114172758293"></p>
<h3 id="11-ecmascript"><a class="anchor" href="#11-ecmascript">#</a> 1.1 ECMAScript</h3>
<p><strong>ECMAScript</strong> 即 ECMA-262 定义的语言，并不局限于 Web 浏览器。</p>
<blockquote>
<p>ECMA-262 是一个名叫 ECMA（欧洲计算机制造商协会）的组织发布的标准。在这个标准之下呢，又定义了 ECMAScript。而在遵循 ECMAScript 的基础上，又有了 JavaScript。可以说，JavaScript 是根据 ECMAScript 的一个实现，所以 ECMAScript 又被称为 ECMAScript 规范。</p>
</blockquote>
<p>ECMAScript 是众多脚本语言的一个<strong>基准</strong>，JavaScript 是其中一种，属于浏览器脚本。</p>
<p>ECMA-262 定义了：</p>
<ol>
<li>语法</li>
<li>类型</li>
<li>语句</li>
<li>关键字</li>
<li>保留字</li>
<li>操作符</li>
<li>全局对象</li>
</ol>
<h3 id="12-dom"><a class="anchor" href="#12-dom">#</a> 1.2 DOM</h3>
<p>DOM（Document Object Model）是一个应用编程接口（API），用于在 HTML 中使用扩展的 XML。（ <code>document.</code>  调用的均是 DOM 的范畴）</p>
<p>DOM 把整个页面（HTML）抽象为一组分层节点（类似<strong>树</strong>），如下：</p>
<figure class="highlight html"><figcaption data-lang="HTML"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="3"></td><td><pre>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span>Sample Page<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="6"></td><td><pre>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span> Hello World! <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="7"></td><td><pre>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span> 无样式标签 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span></pre></td></tr></table></figure><p>可以构建成如下的节点树：</p>
<p><img data-src="/2022/01/14/note/%E5%89%8D%E7%AB%AF/js%E9%AB%98%E7%BA%A7%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1/image-20220114174348004.png" alt="image-20220114174348004"></p>
<p>（椭圆代表的不是叶节点，而是该节点的内容）</p>
<p>使用 DOM API 可以随心所欲地删除、添加、替换、修改节点</p>
<p>DOM 主要有以下功能模块：</p>
<ul>
<li>level1：
<ul>
<li>映射文档结构</li>
</ul>
</li>
<li>level2：
<ul>
<li>DOM 视图：追踪文档不同视图的接口。（可以把视图看作 1 个 HTML 页面）</li>
<li>DOM 事件：事件处理的接口</li>
<li>DOM 样式：处理元素 CSS 样式的接口</li>
<li>DOM 遍历和范围：遍历和操作 DOM 树的接口</li>
</ul>
</li>
<li>level3：
<ul>
<li>加载和保存文档的方法</li>
<li>验证文档的方法</li>
</ul>
</li>
</ul>
<h3 id="13-bom"><a class="anchor" href="#13-bom">#</a> 1.3 BOM</h3>
<p>BOM（Browser Object Model）用于支持访问和操作浏览器的<strong>窗口</strong>的 API。（ <code>window.</code>  调用的即是 BOM 的 API，不写默认是 <code>window.</code>  如 <code>alter</code> 。实际上 <code>document</code>  也是 <code>window.document</code> ）</p>
<p>BOM 主要针对浏览器的<strong>窗口</strong>和<strong>子窗口</strong>，主要有以下功能：</p>
<ul>
<li>弹出浏览器窗口</li>
<li>移动、缩放和关闭浏览器窗口</li>
<li><code>navigator</code>  对象提供<strong>浏览器</strong>的详细信息（版本、型号等）</li>
<li><code>location</code>  对象提供浏览器<strong>加载页面</strong>（用于渲染浏览器的文档.html、.css、.js 等）的详细信息</li>
<li><code>screen</code>  对象提供关于用户<strong>屏幕</strong>分辨率等信息</li>
<li><code>performance</code>  对象提供浏览器<strong>内存占用</strong>、<strong>导航</strong>行为和<strong>时间统计</strong>等信息</li>
<li>对<strong> cookie</strong> 的支持</li>
<li>其他自定义对象如 <code>XMLHttpRequest</code></li>
</ul>
<h1 id="二-html-中的-javascript"><a class="anchor" href="#二-html中的javascript">#</a> 二、 HTML 中的 JavaScript</h1>
<p>本章概要：</p>
<ul>
<li>JavaScript 脚本的引入（内部写法，外部引入）</li>
<li>JavaScript 脚本的加载时间（&lt;script&gt; 放在 body 最后、defer 滞后执行、aysnc 异步执行）</li>
<li>&lt;noscript&gt; 标签，当浏览器不支持脚本时显示</li>
</ul>
<h2 id="1-ltscriptgt-元素静态加载脚本"><a class="anchor" href="#1-script元素静态加载脚本">#</a> 1. &lt;script&gt; 元素（静态加载脚本）</h2>
<p>JavaScript 插入 HTML 的主要方法是使用 &lt;script&gt; 元素。内部脚本和外部脚本的插入有细微区别。</p>
<figure class="highlight html"><figcaption data-lang="HTML"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>example.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><span class="token comment">&lt;!-- 外部 js 插入方法，中间不允许有代码 --></span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>example.js<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span><span class="token script"><span class="token language-javascript"> <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span>在<span class="token constant">XHTML</span>中也可以这么写，但在<span class="token constant">HTML</span>中不行<span class="token operator">--</span><span class="token operator">></span></span></span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token operator">&lt;</span>script<span class="token operator">></span></pre></td></tr><tr><td data-num="4"></td><td><pre>	<span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span>内部js插入方法，代码写在这<span class="token operator">--</span><span class="token operator">></span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span></pre></td></tr></table></figure><p>&lt;script&gt; 标签有以下属性：</p>
<ul>
<li>async：可选。表示<strong>立即开始</strong>下载脚本，但不能阻止其他页面动作（js 没加载好也不能阻断页面加载）</li>
<li>defer：可选。文档解析和显示<strong>完成后</strong>，再执行脚本</li>
<li>src：可选。要引入的外部 js 的地址。如果不是本地的 js，则浏览器会发送 <code>GET</code>  请求</li>
</ul>
<p>其他的不怎么常用，以上 3 个属性均是<strong>外部导入</strong> js 的用法</p>
<p><strong>注意点</strong>：</p>
<ol>
<li>
<p>代码中不能出现 <code>&lt;/script&gt;</code>  的字符串，否则会报错。如下：</p>
<figure class="highlight html"><figcaption data-lang="HTML"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript"></span></span></pre></td></tr><tr><td data-num="2"></td><td><pre>	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>"<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>")</pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span></pre></td></tr></table></figure><p>因为 js 是<strong>解释型</strong>语言，代码会被从上到下解释。当解释器识别到 <code>&lt;/script&gt;</code>  时，会以为是结束标签。</p>
<p>此时，在 <code>/</code>  前面加个转义符 <code>\</code>  即可，如下：</p>
<figure class="highlight html"><figcaption data-lang="HTML"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript"></span></span></pre></td></tr><tr><td data-num="2"></td><td><pre>	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"&lt;\/script>"</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span></pre></td></tr></table></figure></li>
<li>
<p>使用了 <code>src</code>  属性的 &lt;/script&gt; 标签（引入外部 js），不能再写 js 代码，如下</p>
<figure class="highlight html"><figcaption data-lang="HTML"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>example.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"这样写是错误的"</span><span class="token punctuation">)</span></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span></pre></td></tr></table></figure><p>如果硬要这样写，那么中间的代码会被<strong>忽略</strong>，但下载外部 js 可以正常执行</p>
</li>
<li>
<p>浏览器按照 &lt;script&gt; 在页面中的<strong>顺序</strong>解释脚本（前提是没用 <code>defer</code>  和 <code>async</code>  属性）</p>
</li>
</ol>
<h3 id="11-脚本加载时机"><a class="anchor" href="#11-脚本加载时机">#</a> 1.1 脚本加载时机</h3>
<p>有些地方 <code>&lt;script&gt;</code>  被放在 <code>&lt;head&gt;</code>  标签内，如下</p>
<figure class="highlight html"><figcaption data-lang="HTML"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>en<span class="token punctuation">"</span></span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span>Title<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>example.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token comment">&lt;!-- 页面内容 --></span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span></pre></td></tr></table></figure><p>但这样会先加载 js 脚本，此时页面会有<strong>空白期</strong>，再渲染页面，就可能页面加载感觉会有<strong>延迟</strong>。</p>
<p>我们希望一点开浏览器就立马加载页面，一般由以下 3 种方法：</p>
<ol>
<li>
<p>把 <code>&lt;script&gt;</code>  放在 <code>&lt;body&gt;</code>  的最后，即待页面渲染完毕，再加载外部的脚本，如下：</p>
<figure class="highlight html"><figcaption data-lang="HTML"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>en<span class="token punctuation">"</span></span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span>Title<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token comment">&lt;!-- 页面内容 --></span></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript"></span></span></pre></td></tr><tr><td data-num="9"></td><td><pre>    	<span class="token comment">// 如果这里有 jQuery 代码，则需要把引入 jQuery 的代码放在此标签下面</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="11"></td><td><pre>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>jQuery.min.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span></pre></td></tr></table></figure></li>
<li>
<p>使用 <code>defer</code>  属性。即<strong>延迟执行脚本</strong>属性。文档解析和显示<strong>完成后</strong>，再执行脚本</p>
<figure class="highlight html"><figcaption data-lang="HTML"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>en<span class="token punctuation">"</span></span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span>Title<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">defer</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>example.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token comment">&lt;!-- 页面内容 --></span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span></pre></td></tr></table></figure></li>
<li>
<p>使用 <code>async</code>  属性（不推荐）。即<strong>异步执行脚本</strong>。加载脚本和页面渲染<strong>互不干扰</strong></p>
<figure class="highlight html"><figcaption data-lang="HTML"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>en<span class="token punctuation">"</span></span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span>Title<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">async</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>example.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token comment">&lt;!-- 页面内容 --></span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span></pre></td></tr></table></figure><p>使用异步脚本则脚本有可能先于页面加载，那么该脚本 &lt;font color=red&gt; 不应该有修改 DOM 的操作 &lt;/font&gt;</p>
</li>
</ol>
<h3 id="12-多个-ltscriptgt"><a class="anchor" href="#12-多个script">#</a> 1.2 多个 &lt;script&gt;</h3>
<p>当 html 页面中出现多个 &lt;script&gt; 标签时，JavaScript 引擎会多个 &lt; script &gt; 合并为一个域。</p>
<figure class="highlight html"><figcaption data-lang="HTML"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript"></span></span></pre></td></tr><tr><td data-num="3"></td><td><pre>        <span class="token keyword">var</span> name<span class="token operator">=</span><span class="token string">'meta'</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>        <span class="token keyword">let</span> age<span class="token operator">=</span><span class="token number">26</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript"></span></span></pre></td></tr><tr><td data-num="7"></td><td><pre>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//'meta'</span></pre></td></tr><tr><td data-num="8"></td><td><pre>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>age<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//26</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span></pre></td></tr></table></figure><h2 id="2-动态加载脚本"><a class="anchor" href="#2-动态加载脚本">#</a> 2. 动态加载脚本</h2>
<p>除了 <code>&lt;script&gt;</code>  标签，js 也可以通过 DOM API 添加 <code>script</code>  元素加载指定的脚本（外部脚本）。</p>
<p>如下：</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">let</span> script<span class="token operator">=</span>document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'script'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>script<span class="token punctuation">.</span>src<span class="token operator">=</span><span class="token string">'gibberish.js'</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>document<span class="token punctuation">.</span>head<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>script<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p>当然也可以通过 <code>jQuery</code>  或 <code>vue</code>  添加</p>
<p>这种方法以<strong>异步</strong>加载，但不是所有浏览器都支持 <code>async</code> ，因此可以将其设置为同步加载</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre>script<span class="token punctuation">.</span>async<span class="token operator">=</span><span class="token boolean">false</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p>但是这种方法获取的资源对浏览器加载器<strong>不可见</strong>，因此会影响优先级，可能会<strong>严重影响性能</strong>。如果优先级高可以在文档头部显式的声明，让预加载器知道。</p>
<figure class="highlight html"><figcaption data-lang="HTML"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>preload<span class="token punctuation">"</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>gibberish.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span></pre></td></tr></table></figure><h2 id="3-xhtml"><a class="anchor" href="#3-xhtml">#</a> 3. XHTML</h2>
<p>XHTML 是 HTML 的严格版本（已退出历史舞台，但有些地方还有残留）</p>
<h2 id="4-行内代码-or-外部引入"><a class="anchor" href="#4-行内代码or外部引入">#</a> 4. 行内代码 or 外部引入</h2>
<p>虽然可以直接在 HTML 中嵌入 JavaScript 代码，但通常认为将 JavaScript 代码放在文件<strong>外部最佳</strong></p>
<p>理由如下：</p>
<ul>
<li>可维护性：JavaScript 如果分散在很多 HTML 页面，对导致维护困难。用一个目录保存 js 文件比较容易维护</li>
<li>缓存：如果 2 个页面用到同一个文件，则该文件只需下载一次</li>
<li>适应未来：</li>
</ul>
<h2 id="5-ltnoscriptgt-元素"><a class="anchor" href="#5-noscript元素">#</a> 5. &lt;noscript&gt; 元素</h2>
<p>禁用 JavaScript 的元素，针对早期有些浏览器不支持 JavaScript（现在 100% 浏览器支持 JavaScript）</p>
<p>在以下情况下，浏览器显示 &lt;noscript&gt;&lt;/noscript &gt; 包裹的代码：</p>
<ul>
<li>浏览器不支持脚本</li>
<li>浏览器对脚本的支持<strong>关闭</strong></li>
</ul>
<p>例：</p>
<figure class="highlight html"><figcaption data-lang="HTML"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="4"></td><td><pre>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span>例子<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="5"></td><td><pre>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">defer</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span>example.js<span class="token punctuation">'</span></span><span class="token punctuation">></span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="8"></td><td><pre>        <span class="token comment">&lt;!-- 当浏览器不支持脚本时显示下面内容 --></span></pre></td></tr><tr><td data-num="9"></td><td><pre>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>noscript</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="10"></td><td><pre>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="11"></td><td><pre>                这个页面不支持JavaScript脚本</pre></td></tr><tr><td data-num="12"></td><td><pre>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="13"></td><td><pre>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>noscript</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="14"></td><td><pre>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span></pre></td></tr></table></figure><h1 id="三-语法基础"><a class="anchor" href="#三-语法基础">#</a> 三、 语法基础</h1>
<h2 id="1-语法"><a class="anchor" href="#1-语法">#</a> 1. 语法</h2>
<h3 id="11-区分大小写"><a class="anchor" href="#11-区分大小写">#</a> 1.1 区分大小写</h3>
<p>JavaScript 严格区分大小写</p>
<h3 id="12-标识符变量-函数的名称"><a class="anchor" href="#12-标识符变量-函数的名称">#</a> 1.2 标识符：（变量、函数的名称）</h3>
<ul>
<li>
<p>第一个字符必须是<strong>字母</strong>、<strong>下划线</strong>、或 **$**</p>
</li>
<li>
<p>其他字符可以是<strong>字母</strong>、<strong>下划线</strong>、<strong>$<strong> 或</strong>数字</strong></p>
</li>
<li>
<p>驼峰式命名</p>
<ul>
<li>一般<strong>变量</strong>、<strong>函数</strong>、<strong>对象实例</strong>首字母<strong>小</strong>写</li>
<li><strong>类</strong>、<strong>对象构造器</strong>首字母<strong>大</strong>写</li>
</ul>
</li>
</ul>
<h3 id="13-注释"><a class="anchor" href="#13-注释">#</a> 1.3 注释</h3>
<p>和 <code>C</code> 、 <code>JAVA</code>  等一样</p>
<ul>
<li>单行：//</li>
<li>多行：/**/</li>
</ul>
<h3 id="14-严格模式"><a class="anchor" href="#14-严格模式">#</a> 1.4 严格模式</h3>
<p>处理 ES3 的不规范写法，对不安全的活动进行<strong>抛出错误</strong>。</p>
<blockquote>
<p>语法：在脚本开头加上</p>
<p><code>&quot;use strict&quot;;</code></p>
</blockquote>
<p>严格模式会影响 JavaScript 执行的很多方面。</p>
<h3 id="15-语句"><a class="anchor" href="#15-语句">#</a> 1.5 语句</h3>
<ul>
<li>
<p>一行语句以分号 <code>;</code>  结尾</p>
<ul>
<li>不写分号也能编译，但不推荐</li>
<li>加分号有助于（删除空行）压缩代码</li>
<li>加分号可以提升性能。不写分号解析器需要在合适的位置补上分号</li>
</ul>
</li>
<li>
<p>多个语句可以合并。以 <code>&#123;&#125;</code>  包裹，形成代码块。</p>
<ul>
<li>
<p><code>if</code> 、 <code>for</code>  等，即使只有<strong>一行代码</strong>，也建议用 <code>&#123;&#125;</code>  包裹</p>
</li>
<li>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">if</span><span class="token punctuation">(</span>test<span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"推荐"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">if</span><span class="token punctuation">(</span>test<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"不推荐"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
<h2 id="2-关键字与保留字"><a class="anchor" href="#2-关键字与保留字">#</a> 2. 关键字与保留字</h2>
<ul>
<li>
<p><strong>关键字</strong>：JavaScript 中有专门用途，不能用作识符或变量名</p>
<p>break、do、in、typeof、case、else、instanceof、var、catch、export、new、void、class、extends、return、while、const、finally、super、with、continue、for、switch、yield、debugger、function、this、default、if、throw、delete、import、try</p>
</li>
<li>
<p><strong>保留字</strong>：以后可能会成为关键字，不建议用作标识符或变量名</p>
<ul>
<li>始终保留：enum</li>
<li>严格模式保留：implements、package、public、interface、protected、static、let、private</li>
<li>模块代码保留：await</li>
</ul>
</li>
</ul>
<h2 id="3-变量"><a class="anchor" href="#3-变量">#</a> 3. 变量</h2>
<p>JavaScript 的变量是松散类型（弱类型）的，变量可以保存<strong>任何类型</strong>的数据。</p>
<p>通过 <code>var</code> 、 <code>let</code> 、 <code>const</code>  关键字声明变量。其中， <code>let</code>  和 <code>const</code>  只能在 ES6 及之后版本可用</p>
<h3 id="31-var-关键字"><a class="anchor" href="#31-var关键字">#</a> 3.1 var 关键字</h3>
<ul>
<li>
<p><strong>改变变量类型</strong></p>
<p>可以在后序的代码中改变变量的类型，但<strong>不推荐</strong></p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">var</span> message<span class="token operator">=</span><span class="token string">'hi'</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>message<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">;</span><span class="token comment">// 合法，但不推荐</span></pre></td></tr></table></figure></li>
<li>
<p><strong>作用域</strong></p>
<p>在函数内部以 <code>var</code>  定义的变量是<strong>局部变量</strong>，出函数体便被销毁</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">function</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token keyword">var</span> message<span class="token operator">=</span><span class="token string">'hi'</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 报错</span></pre></td></tr></table></figure></li>
<li>
<p><strong>合并语句</strong></p>
<p>定义多个变量可以写在一行，以 <code>,</code>  分隔即可。（因为是弱类型）</p>
<p><code>var message=hi,age=29;</code></p>
</li>
<li>
<p><strong>var 声明提升★</strong></p>
<p><code>var</code>  关键字声明的变量<strong>自动提升到函数域顶部</strong></p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>age<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token keyword">var</span> age<span class="token operator">=</span><span class="token number">26</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token punctuation">&#125;</span><span class="token comment">// 等价于</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token keyword">var</span> age<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>age<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    age<span class="token operator">=</span><span class="token number">26</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 所以此处输出 undefined</span></pre></td></tr></table></figure></li>
</ul>
<h3 id="32-let-关键字"><a class="anchor" href="#32-let关键字">#</a> 3.2 let 关键字</h3>
<p><code>let</code>  和 <code>var</code>  用法基本一样，主要区别如下：</p>
<ol>
<li>
<p><code>let</code>  声明的范围是<strong>块作用域</strong>， <code>var</code>  是<strong>函数作用域</strong>。&lt;font color=red&gt; 即 <code>if</code>  块内 <code>var</code>  声明的变量可以带出去 &lt;/font&gt;</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token keyword">var</span> name<span class="token operator">=</span><span class="token string">'nihao'</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token keyword">let</span> age<span class="token operator">=</span><span class="token number">12</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//nihao</span></pre></td></tr><tr><td data-num="6"></td><td><pre>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>age<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 报错 ReferenceError: age is not defined</span></pre></td></tr></table></figure></li>
<li>
<p><code>var</code>  可以重复声明， <code>let</code>  不行</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">var</span> a<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">var</span> a<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">;</span><span class="token comment">// 合法，但不推荐</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">let</span> b<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">let</span> b<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">;</span><span class="token comment">// 报错 SyntaxError: Identifier 'b' has already been declared</span></pre></td></tr></table></figure><p>此外， <code>var</code>  也不能和 <code>let</code>  混用重复声明</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">var</span> name<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">let</span> name<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span><span class="token comment">//SyntaxError</span></pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">let</span> age<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">var</span> age<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">;</span><span class="token comment">//SyntaxError</span></pre></td></tr></table></figure><p>但是嵌套声明可以，如</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">let</span> b<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token keyword">let</span> b<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//2</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//1</span></pre></td></tr></table></figure></li>
<li>
<p><code>let</code>  的声明不会提升到作用域顶部（ <code>let</code>  声明前的区域被称为<strong>暂时性死区</strong>）</p>
</li>
<li>
<p><strong>全局声明</strong></p>
<ol>
<li>
<p><code>var</code>  在全局作用域中声明的变量会变为 <code>window</code>  对象的属性</p>
</li>
<li>
<p><code>let</code>  不会，但仍是全局变量，相应变量会在页面的<strong>生命周期</strong>中<strong>存续</strong></p>
<figure class="highlight html"><figcaption data-lang="HTML"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>en<span class="token punctuation">"</span></span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span>Title<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript"></span></span></pre></td></tr><tr><td data-num="8"></td><td><pre>        <span class="token keyword">var</span> name<span class="token operator">=</span><span class="token string">'meta'</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>        <span class="token keyword">let</span> age<span class="token operator">=</span><span class="token number">26</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>window<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//'meta'</span></pre></td></tr><tr><td data-num="11"></td><td><pre>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>window<span class="token punctuation">.</span>age<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//undefined</span></pre></td></tr><tr><td data-num="12"></td><td><pre>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span></pre></td></tr></table></figure><p><img data-src="/2022/01/14/note/%E5%89%8D%E7%AB%AF/js%E9%AB%98%E7%BA%A7%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1/image-20220116195713707.png" alt="image-20220116195713707"></p>
</li>
</ol>
</li>
<li>
<p>for 循环的迭代变量</p>
<p>for 循环中用 <code>var</code>  声明的迭代变量会渗透到循环体外，而 <code>let</code>  不会。</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">var</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span>n<span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token comment">// 因为 var 只在函数域中是局部变量，条件域和循环域都不能限制 var</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token keyword">var</span> j<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span><span class="token comment">//j 也会渗透出域</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">let</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span>n<span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    </pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token punctuation">&#125;</span><span class="token comment">// 循环结束 i 销毁</span></pre></td></tr></table></figure></li>
</ol>
<h3 id="33-const-关键字"><a class="anchor" href="#33-const关键字">#</a> 3.3 const 关键字</h3>
<p>用法和<strong> let</strong> 基本相同。最大的区别是<strong> const 声明的变量不能修改值</strong>。</p>
<ul>
<li>const 只限制对指向变量的<strong>引用</strong>。即如果引用的是个引用类型，如对象、数组，修改其内部的值是合法的。</li>
<li>const 也不许重复声明</li>
<li>const 作用域也是块（所有块，和 let 一样）</li>
</ul>
<h3 id="34-最佳声明规则"><a class="anchor" href="#34-最佳声明规则">#</a> 3.4 最佳声明规则</h3>
<ul>
<li>尽量不用 <code>var</code></li>
<li><code>const</code>  优先， <code>let</code>  次之：既可以保证不该更改的值不被修改，又可以让读代码的知道这个值不会变</li>
</ul>
<h2 id="4-数据类型"><a class="anchor" href="#4-数据类型">#</a> 4. 数据类型</h2>
<p>ECMScript 有 6 种<strong>简单数据类型</strong>：Undefined、Null、Boolean、Number、String、Symbol。（symbol 是 EMS6 新增）</p>
<p>和 1 种<strong>复杂数据类型</strong>：Object。（对象、数组、map、set 等都是 Object 类型，也是引用数据类型）</p>
<table>
<thead>
<tr>
<th>类型</th>
<th>解释</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>number</code></td>
<td>整数 / 小数 / NaN（not a number）  &lt;br&gt;   <code>true为1，false为0。数字string等值转换</code></td>
</tr>
<tr>
<td><code>string</code></td>
<td>字符串。&quot;&quot; 和 '' 都表示字符串，和 Python 一样</td>
</tr>
<tr>
<td><code>boolean</code></td>
<td>true/false  &lt;br&gt;   <code>0/NaN/null/undefined/&quot;&quot;均为false</code> ，其他为 <code>true</code></td>
</tr>
<tr>
<td><code>null</code></td>
<td></td>
</tr>
<tr>
<td><code>undefined</code></td>
<td></td>
</tr>
<tr>
<td><code>symbol</code></td>
<td>符号</td>
</tr>
</tbody>
</table>
<h3 id="41-typeof-操作符"><a class="anchor" href="#41-typeof操作符">#</a> 4.1 typeof 操作符</h3>
<p>因为 JavaScript 是弱类型，可以通过 <code>typeof</code>  返回变量的类型。</p>
<p><code>typeof</code>  可以返回以下类型：以<strong>字符串</strong>形式</p>
<ul>
<li><code>undefined</code> ：表示值未定义</li>
<li><code>boolean</code> ：布尔值</li>
<li><code>string</code> ：字符串</li>
<li><code>number</code> ：数值</li>
<li><code>object</code> ：对象（不是函数）或 null</li>
<li><code>function</code> ：函数</li>
<li><code>symbol</code> ：符号</li>
</ul>
<blockquote>
<p>语法：</p>
<ol>
<li><code>typeof+空格+变量/常量</code></li>
<li><code>typeof(变量/常量)</code></li>
</ol>
</blockquote>
<p>例：</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">let</span> message<span class="token operator">=</span><span class="token string">'haha'</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> message<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//'string'</span></pre></td></tr><tr><td data-num="3"></td><td><pre>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">typeof</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//'string'</span></pre></td></tr><tr><td data-num="4"></td><td><pre>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> <span class="token number">95</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//'number'</span></pre></td></tr></table></figure><h3 id="42-undefined-类型"><a class="anchor" href="#42-undefined类型">#</a> 4.2 Undefined 类型</h3>
<p>未定义值的变量。</p>
<ol>
<li>未声明的变量也算 <code>undefined</code></li>
<li><code>undefined</code>  在布尔判定时算<strong>假值</strong>，但不 === <code>false</code></li>
</ol>
<h3 id="43-null-类型"><a class="anchor" href="#43-null类型">#</a> 4.3 Null 类型</h3>
<p>空值。逻辑上讲， <code>null</code>  是一个<strong>空对象</strong>指针，这也是 <code>typeof</code>  返回 <code>object</code>  的原因</p>
<ol>
<li><code>null</code>  由 <code>undefined</code>  派生而来，2 者表面上相等（ <code>==</code>  相等， <code>===</code>  不等）</li>
<li>布尔判定为<strong>假</strong></li>
</ol>
<h3 id="44-boolean-类型"><a class="anchor" href="#44-boolean类型">#</a> 4.4 Boolean 类型</h3>
<p>注：JavaScript 严格区分大小写， <code>True</code>  和 <code>False</code>  只能是标识符，不是布尔值</p>
<p><strong>布尔转换规则：</strong></p>
<table>
<thead>
<tr>
<th>数据类型</th>
<th>转换为 true 的值</th>
<th>转换为 false 的值</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>number</code></td>
<td>非零数</td>
<td><code>0</code> 、 <code>NaN</code></td>
</tr>
</tbody>
</table>
<p>&lt;font color=red&gt; 以上虽然在布尔判定时转换为 <code>true</code>  或 <code>false</code> ，但并不代表其就是 <code>true</code>  或 <code>false</code> 。如 <code>1</code>  并不等于 <code>true</code> ， <code>0</code>  也不等于 <code>fasle</code> &lt;/font&gt;</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">let</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">if</span> <span class="token punctuation">(</span>i<span class="token operator">===</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token comment">// 不会进入块</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h3 id="45-number-类型"><a class="anchor" href="#45-number类型">#</a> 4.5 Number 类型</h3>
<p>number 正常创建是<strong>十进制</strong>整数 / 浮点数，但也可以创建<strong>八进制</strong>和<strong>十六进制</strong></p>
<ul>
<li>
<p>八进制：在最前面 + 0（严格模式无效，抛出语法错误）</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">let</span> num1<span class="token operator">=</span><span class="token number">070</span><span class="token punctuation">;</span><span class="token comment">// 十进制为 56</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">let</span> num2<span class="token operator">=</span><span class="token number">079</span><span class="token punctuation">;</span><span class="token comment">// 无效八进制，当成十进制 79</span></pre></td></tr></table></figure></li>
<li>
<p>十六进制：加前缀 0x。（不区分大小写）</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">let</span> num1<span class="token operator">=</span><span class="token number">0xA</span><span class="token punctuation">;</span><span class="token comment">//10</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">let</span> num2<span class="token operator">=</span><span class="token number">0X1f</span><span class="token punctuation">;</span><span class="token comment">//31</span></pre></td></tr></table></figure></li>
</ul>
<p>但在数学运算中都视为十进制数</p>
<h4 id="451-浮点数"><a class="anchor" href="#451-浮点数">#</a> 4.5.1 浮点数</h4>
<ul>
<li>
<p>写法：正常按小数写即可。</p>
<ul>
<li><code>.1</code>  视作 <code>0.1</code> ，但不推荐。</li>
</ul>
</li>
<li>
<p>小数点后为 <code>0</code> <strong> 自动转为整数</strong>。因为浮点消耗内存是整数的 2 倍。</p>
<ul>
<li><code>1.</code>  视作 <code>1.0</code> ，同时转换成整数 <code>1</code></li>
</ul>
</li>
<li>
<p><strong>科学计数法</strong>：</p>
<ul>
<li><code>3.125e7</code>  等于 <code>31250000</code> ， <code>e7</code>  表示 10 的 7 次幂</li>
<li><code>3e-17</code>  等于 <code>0.00000000000000003</code> 。（包括小数点前，一共 17 个 0）</li>
</ul>
</li>
<li>
<p><strong>精确度</strong>：浮点数的精度远不如整数。如 0.1+0.2!==0.3，而是 0.30000000000000004</p>
<p><strong>十进制整数转二进制方法：除 2 取余；十进制小数转二进制方法：乘 2 除整</strong></p>
<p>十进制 0.1 转换成二进制，乘 2 取整过程：</p>
<pre class=" language-language-tap"><code class="language-language-tap">0.1 * 2 = 0.2 # 0
0.2 * 2 = 0.4 # 0
0.4 * 2 = 0.8 # 0
0.8 * 2 = 1.6 # 1
0.6 * 2 = 1.2 # 1
0.2 * 2 = 0.4 # 0
.....
</code></pre>
<p>从上面可以看出，0.1 的二进制格式是：0.0001100011....。这是一个<strong>二进制无限循环小数</strong></p>
</li>
</ul>
<h4 id="452-取值范围"><a class="anchor" href="#452-取值范围">#</a> 4.5.2 取值范围</h4>
<p>最小数： <code>Number.MIN_VALUE</code> ，视浏览器而定，大多数浏览器是 <code>5e-324</code> 。（正数的最小数，大于 0）<br>
最大数： <code>Number.MAX_VALUE</code> ，大多数浏览器是 <code>1.7976931348623157e+308</code></p>
<p>超出最值以 <code>Infinity</code> （正无穷）/ <code>-Infinity</code> （负无穷）表示，并且不能继续任何计算</p>
<p>通过 <code>isFinite()</code>  判断一个值是不是<strong>有限</strong>大</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">let</span> result<span class="token operator">=</span>Number<span class="token punctuation">.</span><span class="token constant">MAX_VALUE</span><span class="token operator">+</span>Number<span class="token punctuation">.</span><span class="token constant">MAX_VALUE</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">isFinite</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//fasle</span></pre></td></tr></table></figure><h4 id="453-nan"><a class="anchor" href="#453-nan">#</a> 4.5.3 NaN</h4>
<p>不是数值，即本来要返回数值的操作失败了，如 0 除以 0。（5/0 返回 <code>Infinity</code> ）</p>
<p>NaN 有一些独特的性质：</p>
<ul>
<li>NaN 与任何数运算均为 NaN</li>
<li>NaN 不等于任何数（包括 NaN）</li>
</ul>
<p>通过 <code>isNaN</code>  判断<strong>任何参数</strong>是否<strong>是数值</strong>或者是否可以<strong>转换成数值</strong>。例：</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">isNaN</span><span class="token punctuation">(</span><span class="token number">NaN</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//true</span></pre></td></tr><tr><td data-num="2"></td><td><pre>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">isNaN</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//false</span></pre></td></tr><tr><td data-num="3"></td><td><pre>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">isNaN</span><span class="token punctuation">(</span><span class="token string">"10"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//false, 可以转为 10</span></pre></td></tr><tr><td data-num="4"></td><td><pre>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">isNaN</span><span class="token punctuation">(</span><span class="token string">"abc"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//true</span></pre></td></tr><tr><td data-num="5"></td><td><pre>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">isNaN</span><span class="token punctuation">(</span><span class="token string">"10abc"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//true</span></pre></td></tr><tr><td data-num="6"></td><td><pre>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">isNaN</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//false, 可以转为 1</span></pre></td></tr></table></figure><h4 id="454-数值转换"><a class="anchor" href="#454-数值转换">#</a> 4.5.4 数值转换</h4>
<p><code>Number</code>  转换规则如下：</p>
<ul>
<li>
<p><strong> <code>Number()</code> </strong></p>
<ul>
<li>
<p>布尔值：true→1，false→0；</p>
</li>
<li>
<p>数值：直接返回；</p>
</li>
<li>
<p>null：0；</p>
</li>
<li>
<p>undefined：NaN</p>
</li>
<li>
<p>字符串：</p>
<ul>
<li><code>&quot;1&quot;</code> 、 <code>&quot;01&quot;</code> 、 <code>&quot;0.1&quot;</code> 、 <code>&quot;+1&quot;</code> 、 <code>&quot;-1&quot;</code>  等按正常转。 <code>Number(&quot;1&quot;)</code></li>
<li>十六进制数转为十进制整数： <code>Number(&quot;0xf&quot;)</code>  转为 15</li>
<li>空字符串 <code>&quot;&quot;</code> ，转为 0</li>
<li>除去以上情况，转为 NaN</li>
</ul>
</li>
<li>
<p>对象：调用 <code>valueof()</code>  方法，并按上述规则转换返回的值。</p>
</li>
</ul>
</li>
<li>
<p><strong> <code>parseInt()</code> </strong>：当转换<strong>字符串</strong>时，使用 <code>parseInt()</code>  更合适，其与 <code>Number()</code>  有以下不同、</p>
<ul>
<li>
<p><code>&quot;123abc&quot;</code>  转为 123：如果第一个字符是 <code>+</code> / <code>-</code> / <code>数值</code> ，会一次检测每个字符，直到末尾或非数值字符。</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">parseInt</span><span class="token punctuation">(</span><span class="token string">"123abc"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//123</span></pre></td></tr></table></figure></li>
<li>
<p>第二个参数设置进制数：</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">parseInt</span><span class="token punctuation">(</span><span class="token string">"0xA"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//10</span></pre></td></tr><tr><td data-num="2"></td><td><pre>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">parseInt</span><span class="token punctuation">(</span><span class="token string">"0xA"</span><span class="token punctuation">,</span><span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//10</span></pre></td></tr><tr><td data-num="3"></td><td><pre>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">parseInt</span><span class="token punctuation">(</span><span class="token string">"A"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//NaN</span></pre></td></tr><tr><td data-num="4"></td><td><pre>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">parseInt</span><span class="token punctuation">(</span><span class="token string">"A"</span><span class="token punctuation">,</span><span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//10</span></pre></td></tr></table></figure></li>
</ul>
</li>
<li>
<p><strong> <code>parseFloat()</code> </strong>：和 <code>parseInt()</code>  差不多，有几点不一样。</p>
<ul>
<li>只解析<strong>十进制</strong></li>
<li>会忽略第二次即以后出现的 <code>.</code></li>
</ul>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">parseFloat</span><span class="token punctuation">(</span><span class="token string">"123blue"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//123 按整数解析</span></pre></td></tr><tr><td data-num="2"></td><td><pre>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">parseFloat</span><span class="token punctuation">(</span><span class="token string">"1.2.3.4"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//1.2</span></pre></td></tr><tr><td data-num="3"></td><td><pre>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">parseFloat</span><span class="token punctuation">(</span><span class="token string">"0xA"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//0</span></pre></td></tr></table></figure></li>
</ul>
<h3 id="46-string-类型"><a class="anchor" href="#46-string类型">#</a> 4.6 String 类型</h3>
<p>JavaScript 的字符串可以用双引号 <code>&quot;&quot;</code> 、单引号 <code>''</code>  或反引号 `` 标示，但一对一定要一致</p>
<h4 id="461-特殊字符表示"><a class="anchor" href="#461-特殊字符表示">#</a> 4.6.1 特殊字符表示</h4>
<p>字符串中有时候需要一些特殊的字符或操作表示，一般使用反义符 <code>\</code> + 字符。</p>
<table>
<thead>
<tr>
<th>字符字面量</th>
<th>含义</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>\n</code></td>
<td>换行符</td>
</tr>
<tr>
<td><code>\t</code></td>
<td>制表符（Tab 键）</td>
</tr>
<tr>
<td><code>\b</code></td>
<td>退格符</td>
</tr>
<tr>
<td><code>\r</code></td>
<td>回车</td>
</tr>
<tr>
<td><code>\f</code></td>
<td>换页</td>
</tr>
<tr>
<td><code>\\</code></td>
<td>反斜杠</td>
</tr>
<tr>
<td><code>\'</code></td>
<td>单引号（双引号 / 反引号包裹单引号 <code>&quot;'&quot;</code>  可以不用反义符 <code>\</code> ）</td>
</tr>
<tr>
<td><code>\&quot;</code></td>
<td>双引号（同上）</td>
</tr>
<tr>
<td>\`</td>
<td>反引号（同上）</td>
</tr>
<tr>
<td><code>\xnn</code></td>
<td>十六进制编码 nn 表示的字符，n 是（0~F）。如 <code>\x41</code>  表示 <code>A</code></td>
</tr>
<tr>
<td><code>\unnn</code></td>
<td>十六进制编码 nnn 表示的 Unicode 字符。如 <code>\u03a3</code>  表示 <code>Σ</code></td>
</tr>
</tbody>
</table>
<p>例：</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"\u03a3"</span><span class="token punctuation">)</span><span class="token comment">//Σ</span></pre></td></tr></table></figure><p>以上字符字面量可以出现在字符串<strong>任意位置</strong>，且作为<strong>单个字符</strong>被解释。</p>
<h4 id="462-字符串不可变"><a class="anchor" href="#462-字符串不可变">#</a> 4.6.2 字符串不可变</h4>
<p>ECMAScript 中的字符串一旦被创建，就<strong>不可变</strong>。一切字符串操作实际上均是<strong>新建再销毁</strong>的过程。</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">let</span> lang<span class="token operator">=</span><span class="token string">'Java'</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>lang<span class="token operator">=</span>lang<span class="token operator">+</span><span class="token string">'Script'</span><span class="token punctuation">;</span><span class="token comment">// 先申请 10 字符空间，填充上 JavaScript，再销毁 Java 和 Script。</span></pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre>lang<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token string">'A'</span><span class="token punctuation">;</span><span class="token comment">// 无效代码，lang 仍是 JavaScript</span></pre></td></tr></table></figure><h4 id="463-其他值转为字符串"><a class="anchor" href="#463-其他值转为字符串">#</a> 4.6.3 其他值转为字符串</h4>
<ul>
<li>
<p><strong> <code>toString()</code> </strong>：toString 方法所有值都有，和 java 类似，<strong>控制台打印</strong>也是打印的 toString 函数。</p>
<ul>
<li>
<p>因此， <code>toString()</code>  转换结果和控制台打印结果一致。</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">let</span> a<span class="token operator">=</span><span class="token boolean">true</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//true;</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">let</span> b<span class="token operator">=</span><span class="token number">11</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>b<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//"11"</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">let</span> c<span class="token operator">=</span><span class="token string">"abc"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>c<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//"abc", 返回的是 c 的一个副本</span></pre></td></tr></table></figure></li>
<li>
<p>数值按指定<strong>进制</strong>转换</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">let</span> num<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>num<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//"10"</span></pre></td></tr><tr><td data-num="3"></td><td><pre>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>num<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//"1010"</span></pre></td></tr><tr><td data-num="4"></td><td><pre>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>num<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//"12"</span></pre></td></tr></table></figure></li>
</ul>
</li>
<li>
<p><strong> <code>String()</code> </strong>：当值为 <code>null</code>  或 <code>undefined</code>  时，不能调用函数，因此 <code>toString()</code>  会<strong>报错</strong>，此时可以使用 <code>String()</code>  函数（包裹了 <code>toString()</code>  的函数）</p>
<p>逻辑如下：</p>
<ul>
<li>如果值存在，则调用 <code>toString()</code></li>
<li>如果为 <code>null</code>  或 <code>undefined</code> ，则返回对应字符串</li>
</ul>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">let</span> d<span class="token operator">=</span><span class="token keyword">null</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>d<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//"null"</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">let</span> e<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//"undefined"</span></pre></td></tr></table></figure></li>
</ul>
<h4 id="464-模板字面量es6-新增"><a class="anchor" href="#464-模板字面量es6新增">#</a> 4.6.4 模板字面量（ES6 新增）</h4>
<h5 id="4641-保留换行"><a class="anchor" href="#4641-保留换行">#</a> 4.6.4.1 保留换行</h5>
<p>ES6 新增，反引号 `` 定义的字符串可以保留<strong>换行</strong>字符。</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">let</span> modString<span class="token operator">=</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">first line</span></span></pre></td></tr><tr><td data-num="2"></td><td><pre>second line<span class="token template-punctuation string">`</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token comment">// 等价于</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">let</span> modString<span class="token operator">=</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">first line\nsecond line</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>modString<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p><img data-src="/2022/01/14/note/%E5%89%8D%E7%AB%AF/js%E9%AB%98%E7%BA%A7%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1/image-20220117145828412.png" alt="image-20220117145828412"></p>
<p>但<strong>空格</strong>和<strong>换行符</strong>也会保存</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">let</span> modString<span class="token operator">=</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">first line</span></span></pre></td></tr><tr><td data-num="2"></td><td><pre>                second line<span class="token template-punctuation string">`</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>modString<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p><img data-src="/2022/01/14/note/%E5%89%8D%E7%AB%AF/js%E9%AB%98%E7%BA%A7%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1/image-20220117145901952.png" alt="image-20220117145901952"></p>
<p>模板字面量在有些时候特别有用，比如 HTML 模板：</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">let</span> modString<span class="token operator">=</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string"></span></span></pre></td></tr><tr><td data-num="2"></td><td><pre>&lt;div id="v_show"></pre></td></tr><tr><td data-num="3"></td><td><pre>    &lt;p v-show="true">&lt;/p></pre></td></tr><tr><td data-num="4"></td><td><pre>    &lt;p v-show="age>=18">&lt;/p></pre></td></tr><tr><td data-num="5"></td><td><pre>    &lt;button @click="up">&lt;/button></pre></td></tr><tr><td data-num="6"></td><td><pre>&lt;/div><span class="token template-punctuation string">`</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>modString<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p><img data-src="/2022/01/14/note/%E5%89%8D%E7%AB%AF/js%E9%AB%98%E7%BA%A7%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1/image-20220117150032360.png" alt="image-20220117150032360"></p>
<h5 id="4642-字符串插值"><a class="anchor" href="#4642-字符串插值">#</a> 4.6.4.2 字符串插值</h5>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">let</span> value<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">let</span> exponent<span class="token operator">=</span><span class="token string">'second'</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p>之前的字符串拼接：</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">let</span> join_s<span class="token operator">=</span>value<span class="token operator">+</span><span class="token string">'to the '</span><span class="token operator">+</span>exponent<span class="token operator">+</span><span class="token string">' power is '</span><span class="token operator">+</span><span class="token punctuation">(</span>value<span class="token operator">*</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p><strong>模板字面量</strong>（要用反义符 ``）</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">let</span> join_s<span class="token operator">=</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>value<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string"> to the </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>exponent<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string"> power if </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>value<span class="token operator">*</span>value<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span></pre></td></tr></table></figure><p>&lt;font color=red&gt; 模板字面量对所有 <code>$&#123;&#125;</code>  插入的值使用 <code>toString()</code>  强制转换为字符串 &lt;/font&gt;</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">// 对象插入</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">let</span> foo<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token function-variable function">toString</span><span class="token operator">:</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=></span><span class="token string">'World!'</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Hello </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>foo<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//Hello World!</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token comment">// 函数表达式插入</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">function</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token parameter">s</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token keyword">return</span> s<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Hello </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span><span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'World!'</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//Hello World!</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token comment">// 也可以对自己进行覆盖</span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token keyword">let</span> value<span class="token operator">=</span><span class="token string">'ab'</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>value<span class="token operator">=</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>value<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">ab</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span><span class="token comment">//abab</span></pre></td></tr></table></figure><h5 id="4643-标签函数"><a class="anchor" href="#4643-标签函数">#</a> 4.6.4.3 标签函数</h5>
<p>模板字面量也支持定义<strong>标签函数</strong>，通过标签函数自定义插值行为</p>
<blockquote>
<p>语法：自定义函数名 +`模板字面量`。</p>
</blockquote>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">let</span> a<span class="token operator">=</span><span class="token number">6</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">let</span> b<span class="token operator">=</span><span class="token number">9</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">function</span> <span class="token function">simpleTag</span><span class="token punctuation">(</span><span class="token parameter">string<span class="token punctuation">,</span>aVal<span class="token punctuation">,</span>bVal<span class="token punctuation">,</span>sumVal</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>aVal<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>bVal<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>sumVal<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token keyword">return</span> <span class="token string">'foobar'</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token keyword">let</span> untag<span class="token operator">=</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>a<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">+</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>b<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>a<span class="token operator">+</span>b<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token keyword">let</span> tagged<span class="token operator">=</span>simpleTag<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>a<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">+</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>b<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>a<span class="token operator">+</span>b<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="12"></td><td><pre>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>untag<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="13"></td><td><pre>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>tagged<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p><img data-src="/2022/01/14/note/%E5%89%8D%E7%AB%AF/js%E9%AB%98%E7%BA%A7%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1/image-20220117155429561.png" alt="image-20220117155429561"></p>
<p>如上：</p>
<ul>
<li>函数的第一个参数接收模板字面量的<strong>字符串数组</strong></li>
<li>之后的参数接收 <code>$&#123;&#125;</code>  定义的变量（typeof aVal=number）</li>
</ul>
<h5 id="4644-原始字符串stringraw"><a class="anchor" href="#4644-原始字符串stringraw">#</a> 4.6.4.4 原始字符串（String.raw）</h5>
<p>前面提到，有些特殊的字符如 <code>\n</code>  在字符串中有特殊含义，如果要显示原本的字符 <code>\n</code>  需要在前面 + 转义字符 <code>\</code> 。</p>
<p>在模板字面量中，可以直接用 <code>String.raw</code>  标签函数，直接返回原始字符串，不需要用转义字符</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>String<span class="token punctuation">.</span>raw<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">first\nsecond</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//first\nsecond</span></pre></td></tr></table></figure><p>可作用于标签函数接收的第一个参数（字符串数组）</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">let</span> a<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">function</span> <span class="token function">simpleTag</span><span class="token punctuation">(</span><span class="token parameter">string</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">const</span> s <span class="token keyword">of</span> string<span class="token punctuation">.</span>raw<span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>simpleTag<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">\n</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>a<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">\u00A9</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span></pre></td></tr></table></figure><p>输出：<img data-src="/2022/01/14/note/%E5%89%8D%E7%AB%AF/js%E9%AB%98%E7%BA%A7%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1/image-20220117161432968.png" alt="image-20220117161432968"></p>
<p>但仅限于<strong>标签函数</strong>接收的字符串数组，自定义的字符串数组<strong>不行</strong>。</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">let</span> strings<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">''</span><span class="token punctuation">,</span><span class="token string">'first\nsecond'</span><span class="token punctuation">,</span><span class="token string">''</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">const</span> s <span class="token keyword">of</span> strings<span class="token punctuation">.</span>raw<span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token comment">// 报错</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h3 id="47-symbol-类型es6-新增暂缓"><a class="anchor" href="#47-symbol类型es6新增暂缓">#</a> 4.7 Symbol 类型（ES6 新增）（暂缓）</h3>
<h3 id="48-object-类型"><a class="anchor" href="#48-object类型">#</a> 4.8 Object 类型</h3>
<p>没什么好说的，JavaScript 中所有（非基本类型）对象的基类，包括但不限于数组、map、对象、set。</p>
<p>通过 <code>new</code>  关键字创建 <code>Object</code>  类型的实例对象。</p>
<ul>
<li>
<p>创建</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">let</span> ob<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">let</span> ob<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">;</span><span class="token comment">// 合法，但不推荐</span></pre></td></tr></table></figure></li>
<li>
<p>每个 <code>Object</code>  实例均有一下属性和方法：</p>
<ul>
<li><code>constructor</code> ：创建当前对象的函数；</li>
<li><code>hasOwnProperty(propertyName)</code> ：判断是否存在指定<strong>属性</strong>；</li>
<li><code>isPrototypeof(object)</code> ：判断当前对象是否是另一个对象的<strong>原型</strong></li>
<li><code>propertyIsEnumerable(propertyName)</code> ：判断指定属性是否可以用 <code>for-in</code>  枚举，（属性名是<strong>字符串</strong>）</li>
<li><code>toLocaleString()</code> ：返回对象字符串表示（反映对象在本地化执行环境）</li>
<li><code>toString()</code> ：返回对象的字符串表示</li>
<li><code>valueOf()</code> ：返回对象，通常与 <code>toString</code>  返回一致。</li>
</ul>
</li>
</ul>
<p>&lt;font color=red&gt; 宿主对象不受 ECMA-262 约束，不一定继承 Object，如 DOM、BOM&lt;/font&gt;</p>
<h2 id="5-操作符"><a class="anchor" href="#5-操作符">#</a> 5. 操作符</h2>
<h3 id="51-一元操作符"><a class="anchor" href="#51-一元操作符">#</a> 5.1 一元操作符</h3>
<p>只操作<strong>一个值</strong>的操作符</p>
<h4 id="511-递增-递减"><a class="anchor" href="#511-递增递减">#</a> 5.1.1 递增 / 递减</h4>
<p>即 <code>i++</code> 、 <code>i--</code> 、 <code>++i</code> 、 <code>--i</code> ，和其他语言差不多，不再赘述。</p>
<p>对于其他类型，均<strong>转为数值</strong>后进行递增 / 减，不能转为数值的，返回<strong> NaN</strong></p>
<p>按 <code>Number()</code>  转</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">let</span> s1<span class="token operator">=</span><span class="token string">"2"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">let</span> s2<span class="token operator">=</span><span class="token string">"z"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">let</span> b<span class="token operator">=</span><span class="token boolean">false</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">let</span> f1<span class="token punctuation">.</span><span class="token number">1</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>s1<span class="token operator">++</span><span class="token punctuation">;</span><span class="token comment">//3</span></pre></td></tr><tr><td data-num="6"></td><td><pre>s2<span class="token operator">++</span><span class="token punctuation">;</span><span class="token comment">//NaN</span></pre></td></tr><tr><td data-num="7"></td><td><pre>b<span class="token operator">++</span><span class="token punctuation">;</span><span class="token comment">//1</span></pre></td></tr><tr><td data-num="8"></td><td><pre>f<span class="token operator">--</span><span class="token punctuation">;</span><span class="token comment">//0.100000000000000009 (浮点数不精确)</span></pre></td></tr></table></figure><p>对于对象，调用 <code>valueOf()</code>  取得可操作的值，再递增 / 减</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">let</span> o<span class="token operator">=</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token function">valueOf</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>        <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>o<span class="token operator">--</span><span class="token punctuation">;</span><span class="token comment">//-2</span></pre></td></tr></table></figure><h4 id="512-一元加减"><a class="anchor" href="#512-一元加减">#</a> 5.1.2 一元加减</h4>
<p>即在变量前写 <code>+</code> / <code>-</code> 。</p>
<p>把变量<strong>转为数值</strong>，然后附上 <code>+</code> / <code>-</code>  操作。不能转为数值的，返回 NaN</p>
<p>按 <code>Number()</code>  转</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">let</span> s1<span class="token operator">=</span><span class="token string">"2"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">let</span> s2<span class="token operator">=</span><span class="token string">"z"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">let</span> b<span class="token operator">=</span><span class="token boolean">false</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">let</span> <span class="token number">1.1</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">let</span> o<span class="token operator">=</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token function">valueOf</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>        <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token operator">+</span>s1<span class="token punctuation">;</span><span class="token comment">//2 number</span></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token operator">+</span>s2<span class="token punctuation">;</span><span class="token comment">//NaN</span></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token operator">+</span>b<span class="token punctuation">;</span><span class="token comment">//0</span></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token operator">+</span>f<span class="token punctuation">;</span><span class="token comment">//1.1</span></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token operator">-</span>o<span class="token punctuation">;</span><span class="token comment">//1</span></pre></td></tr></table></figure><h3 id="52-位操作符"><a class="anchor" href="#52-位操作符">#</a> 5.2 位操作符</h3>
<p>位操作符用于数值的底层操作，即 bit。</p>
<p><code>~</code> 、 <code>&amp;</code> 、 <code>|</code> 、 <code>^</code> 、 <code>&lt;&lt;</code> 、 <code>&gt;&gt;</code> 、 <code>&gt;&gt;&gt;</code></p>
<h4 id="521-按位非-~"><a class="anchor" href="#521-按位非~">#</a> 5.2.1 按位非 <code>~</code></h4>
<p>即数值的每个位取反。</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">let</span> num1<span class="token operator">=</span><span class="token number">25</span><span class="token punctuation">;</span><span class="token comment">//</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">let</span> num2<span class="token operator">=</span><span class="token operator">~</span>num1<span class="token punctuation">;</span><span class="token comment">//-26</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">let</span> num3<span class="token operator">=</span><span class="token operator">-</span>num1<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span><span class="token comment">//-26，虽然 2 者结果相同，但位操作符快得多</span></pre></td></tr></table></figure><blockquote>
<p>在计组中，负数用对应正数的<strong>补码</strong>来表示。</p>
<p>-8 对应的正数为 8</p>
<p>8 的原码 ：0000 1000</p>
<p>其反码是 ：1111 0111</p>
<p>补码为反码进 1： 1111 1000</p>
</blockquote>
<h4 id="522-按位与-amp"><a class="anchor" href="#522-按位与">#</a> 5.2.2 按位与 <code>&amp;</code></h4>
<p>和别的语言一样</p>
<h4 id="523-按位或"><a class="anchor" href="#523-按位或">#</a> 5.2.3 按位或 <code>|</code></h4>
<p>和别的语言一样</p>
<h4 id="524-按位异或"><a class="anchor" href="#524-按位异或">#</a> 5.2.4 按位异或 <code>^</code></h4>
<p>和别的语言一样</p>
<p>1 1 0</p>
<p>1 0 1</p>
<p>0 1 1</p>
<p>0 0 0</p>
<h4 id="525-左移-ltlt"><a class="anchor" href="#525-左移">#</a> 5.2.5 左移 <code>&lt;&lt;</code></h4>
<p>和别的语言一样。</p>
<p>整体向左移，<strong>保留符号位</strong>，空位（符号位外）补 0。相当于 X2</p>
<h4 id="526-有符号右移-gtgt"><a class="anchor" href="#526-有符号右移">#</a> 5.2.6 有符号右移 <code>&gt;&gt;</code></h4>
<p>整体向右移，<strong>保留符号位</strong>，空位（符号位外）补 0。相当于 / 2。（向下取整）</p>
<h4 id="527-无符号右移-gtgtgt"><a class="anchor" href="#527-无符号右移">#</a> 5.2.7 无符号右移 <code>&gt;&gt;&gt;</code></h4>
<p>整体向右移，<strong>不保留符号位</strong>（符号位跟着一起移），空位补 0。（负数会变正数，正数还是相当于 / 2）</p>
<h3 id="53-布尔操作符"><a class="anchor" href="#53-布尔操作符">#</a> 5.3 布尔操作符</h3>
<p><code>&amp;&amp;</code> 、 <code>||</code> 、 <code>!</code></p>
<h4 id="531-逻辑非"><a class="anchor" href="#531-逻辑非">#</a> 5.3.1 逻辑非 <code>!</code></h4>
<p>即对条件<strong>取反</strong></p>
<p>同时使用 2 个叹号（ <code>!!</code> ）相当于调用 <code>Boolean()</code></p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token operator">!</span><span class="token string">"blue"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//true</span></pre></td></tr></table></figure><h4 id="532-逻辑与-ampamp"><a class="anchor" href="#532-逻辑与">#</a> 5.3.2 逻辑与 <code>&amp;&amp;</code></h4>
<p>如 <code>a&amp;&amp;b</code></p>
<ul>
<li>如果 <code>a</code> （的布尔转换）为 <code>true</code> ，返回 <code>b</code></li>
<li>如果 <code>a</code>  为 <code>false</code> ，返回 <code>a</code> 。（不再对后面求值）</li>
</ul>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token operator">&amp;&amp;</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//false</span></pre></td></tr><tr><td data-num="2"></td><td><pre>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token operator">&amp;&amp;</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//false</span></pre></td></tr><tr><td data-num="3"></td><td><pre>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">&amp;&amp;</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//2</span></pre></td></tr><tr><td data-num="4"></td><td><pre>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token operator">&amp;&amp;</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//0</span></pre></td></tr></table></figure><h4 id="533-逻辑或"><a class="anchor" href="#533-逻辑或">#</a> 5.3.3 逻辑或 <code>||</code></h4>
<p>如 <code>a||b</code></p>
<ul>
<li>如果 <code>a</code>  为 <code>true</code> ，返回 <code>a</code> 。（不再对后面求值）</li>
<li>如果 <code>a</code>  为 <code>false</code> ，返回 <code>b</code> 。</li>
</ul>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token operator">||</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//true</span></pre></td></tr><tr><td data-num="2"></td><td><pre>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token operator">||</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//true</span></pre></td></tr><tr><td data-num="3"></td><td><pre>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">||</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//1</span></pre></td></tr><tr><td data-num="4"></td><td><pre>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token operator">||</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//2</span></pre></td></tr></table></figure><h3 id="54-乘除操作符"><a class="anchor" href="#54-乘除操作符">#</a> 5.4 乘除操作符</h3>
<p><code>*</code> 、 <code>/</code> 、 <code>%</code></p>
<h4 id="541-乘法操作符"><a class="anchor" href="#541-乘法操作符">#</a> 5.4.1 乘法操作符 <code>*</code></h4>
<ul>
<li>对于能<strong>转为数值</strong>的，转为数值后按正常乘法计算。不能转为数值的，返回 NaN</li>
<li>任意数与 <code>NaN</code>  相乘返回 NaN</li>
<li><code>Infinity</code> :
<ul>
<li>*0=NaN</li>
<li>* 非 0 有限数 = <code>Infinity</code> / <code>-Infinity</code></li>
<li>* <code>Infinity</code> = <code>Infinity</code></li>
</ul>
</li>
</ul>
<h4 id="542-除法操作符"><a class="anchor" href="#542-除法操作符">#</a> 5.4.2 除法操作符 <code>/</code></h4>
<ul>
<li>前 2 条和 <code>*</code>  一样</li>
<li>0/0=NaN</li>
<li>非 0 有限数 / 0= <code>Infinity</code> / <code>-Infinity</code></li>
<li><code>Infinity</code> :
<ul>
<li>/ 任何有限数 = <code>Infinity</code></li>
<li>/ <code>Infinity</code> = <code>NaN</code></li>
</ul>
</li>
</ul>
<h4 id="543-取模操作符"><a class="anchor" href="#543-取模操作符">#</a> 5.4.3 取模操作符 <code>%</code></h4>
<p>即取余</p>
<ul>
<li>懒得写</li>
</ul>
<h3 id="55-指数操作符-es6-新增"><a class="anchor" href="#55-指数操作符es6新增">#</a> 5.5 指数操作符 <code>**</code> （ES6 新增）</h3>
<p>等效于 <code>Math.pow()</code></p>
<h3 id="56-加减操作符"><a class="anchor" href="#56-加减操作符">#</a> 5.6 加减操作符</h3>
<p><code>+</code> 、 <code>-</code></p>
<h4 id="561-加法操作符"><a class="anchor" href="#561-加法操作符">#</a> 5.6.1 加法操作符 <code>+</code></h4>
<ul>
<li>
<p><code>NaN</code>  和 <code>Infinity</code>  的懒得写，反正不会等于正常数</p>
</li>
<li>
<p>如果有<strong>字符串</strong>，则变为<strong>连接</strong>字符串</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">+</span><span class="token string">"2"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//"12"</span></pre></td></tr></table></figure></li>
</ul>
<h4 id="562-减法操作符-"><a class="anchor" href="#562-减法操作符-">#</a> 5.6.2 减法操作符 <code>-</code></h4>
<ul>
<li>对于非数值，转换为数值，再减法操作</li>
</ul>
<p>&lt;font color=red&gt; 减法不会字符串拼接 / 裁剪，而是转为算术运算 &lt;/font&gt;</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token operator">-</span><span class="token string">"1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//1</span></pre></td></tr><tr><td data-num="2"></td><td><pre>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"2"</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//1</span></pre></td></tr></table></figure><h3 id="57-关系比较操作符-gt"><a class="anchor" href="#57-关系比较操作符">#</a> 5.7 关系（比较）操作符 <code>&gt;</code></h3>
<p><code>&gt;</code> 、 <code>&lt;</code> 、 <code>&lt;=</code> 、 <code>&gt;=</code></p>
<p>常规用法没什么好多说的，主要讲一下<strong>非数值</strong>的比较</p>
<ul>
<li>字符串比较：<strong>逐个</strong>比较对应字符的 ASCII 编码</li>
<li>一边是数值：把另一边<strong>转为数值</strong>。
<ul>
<li>一方 NaN（或转数值后是 NaN）返回 false</li>
</ul>
</li>
<li>布尔值也转为数值比较</li>
<li>对于对象，调用 <code>valueOf()</code>  再比较</li>
</ul>
<h3 id="58-相等操作符"><a class="anchor" href="#58-相等操作符">#</a> 5.8 相等操作符</h3>
<p><code>==</code> 、 <code>===</code> 、 <code>!=</code> 、 <code>!==</code></p>
<h4 id="581-不全等"><a class="anchor" href="#581-不全等">#</a> 5.8.1 不全等 <code>==</code></h4>
<p>比较 2 边的值，<strong>不比较类型</strong></p>
<ul>
<li>布尔值转为数值比较</li>
<li>字符串 - 数值：字符串转为数值比较</li>
<li>对象：调用 <code>valueOf()</code>  后比较</li>
</ul>
<h4 id="582-全等"><a class="anchor" href="#582-全等">#</a> 5.8.2 全等 <code>===</code></h4>
<p>比较值，同时<strong>比较类型</strong></p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">let</span> arr1<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">let</span> arr2<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">==</span><span class="token string">"1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//true</span></pre></td></tr><tr><td data-num="4"></td><td><pre>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">===</span><span class="token string">"1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//false</span></pre></td></tr><tr><td data-num="5"></td><td><pre>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>arr1<span class="token operator">==</span>arr2<span class="token punctuation">)</span><span class="token comment">//false</span></pre></td></tr></table></figure><h3 id="59-条件操作符三元运算符"><a class="anchor" href="#59-条件操作符三元运算符">#</a> 5.9 条件操作符（三元运算符）</h3>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre>n<span class="token operator">=</span>a<span class="token operator">></span>b<span class="token operator">?</span>a<span class="token operator">:</span>b<span class="token punctuation">;</span><span class="token comment">//n=（如果 a>b 就为 a, 否则为 b）</span></pre></td></tr><tr><td data-num="2"></td><td><pre>n<span class="token operator">=</span><span class="token punctuation">(</span>a<span class="token operator">></span>b<span class="token punctuation">)</span><span class="token operator">?</span>a<span class="token operator">:</span>b<span class="token punctuation">;</span><span class="token comment">// 条件式加个 () 更清楚</span></pre></td></tr></table></figure><h3 id="510-赋值操作符"><a class="anchor" href="#510-赋值操作符">#</a> 5.10 赋值操作符 <code>+=</code></h3>
<p>即 <code>=</code>  前写运算符，如 <code>a+=1</code> 。</p>
<p>仅仅简写语法，并不能提升性能。</p>
<h3 id="511-逗号操作符"><a class="anchor" href="#511-逗号操作符">#</a> 5.11 逗号操作符 <code>,</code></h3>
<p>用来在一条语句中执行多个操作。一般是<strong>声明</strong>语句</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">let</span> a<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span>b<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span>c<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>a<span class="token operator">++</span><span class="token punctuation">,</span>b<span class="token operator">++</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>a<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span>b<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p>或者</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">let</span> a<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//a 取最后一个，也就是 a=3。</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token comment">// 这种方法基本不用，但确实合法</span></pre></td></tr></table></figure><h2 id="6-语句"><a class="anchor" href="#6-语句">#</a> 6. 语句</h2>
<p>也称<strong>流控制语句</strong></p>
<h3 id="61-if-语句"><a class="anchor" href="#61-if语句">#</a> 6.1 if 语句</h3>
<p><code>if-else</code></p>
<p>无需多言</p>
<h3 id="62-do-while-语句"><a class="anchor" href="#62-do-while语句">#</a> 6.2 do-while 语句</h3>
<p>先 do 一次，再进入循环。<strong>至少执行一次</strong></p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">let</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">do</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    i<span class="token operator">++</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token punctuation">&#125;</span><span class="token keyword">while</span><span class="token punctuation">(</span>i<span class="token operator">&lt;</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><h3 id="63-while-语句"><a class="anchor" href="#63-while语句">#</a> 6.3 while 语句</h3>
<p>无需多言</p>
<h3 id="64-for-语句"><a class="anchor" href="#64-for语句">#</a> 6.4 for 语句</h3>
<p>无需多言</p>
<p>提一句， <code>for(;;)</code>  无穷循环</p>
<p>此外， <code>for(let i=0;i&lt;arr.length;i++)</code>  中， <code>arr</code>  长度会变化，可能会出现死循环</p>
<h3 id="65-for-in-语句"><a class="anchor" href="#65-for-in语句">#</a> 6.5 for-in 语句</h3>
<p>枚举对象的（非符号）<strong>键</strong></p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">let</span> a<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token keyword">in</span> a<span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token comment">//0 1 2</span></pre></td></tr></table></figure><p>性能方面比较差</p>
<h3 id="66-for-of-语句"><a class="anchor" href="#66-for-of语句">#</a> 6.6 for-of 语句</h3>
<p>遍历可迭代对象的<strong>元素</strong>（值），（通过对象的 <code>.next()</code>  方法）</p>
<p>如果对象不支持迭代，则会抛出错误</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">let</span> a<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token keyword">in</span> a<span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token comment">//1 2 3</span></pre></td></tr></table></figure><p>性能比 for-in 高</p>
<p>性能： <code>常规for</code>  &gt;  <code>倒序 for</code>  &gt;  <code>forEach</code>  &gt;  <code>for..of</code>  &gt;  <code>map</code>  &gt;  <code>for..in</code></p>
<h3 id="67-标签语句"><a class="anchor" href="#67-标签语句">#</a> 6.7 标签语句</h3>
<p>给语句加标签。</p>
<blockquote>
<p>语法：label: statement</p>
</blockquote>
<p>例：</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">let</span> count<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>start<span class="token operator">:</span> <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">let</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span>count<span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token punctuation">&#125;</span><span class="token comment">//0 1 2 3 4</span></pre></td></tr></table></figure><p>上述例子中 <code>start</code>  可以在后面通过 <code>break</code>  或 <code>continue</code>  引用，用于嵌套循环等。</p>
<h3 id="68-break-和-continue"><a class="anchor" href="#68-break和continue">#</a> 6.8 break 和 continue</h3>
<p><code>break</code>  跳出循环， <code>continue</code>  跳过当前这层循环（直接进入下一层循环）</p>
<h3 id="69-with-语句暂缓"><a class="anchor" href="#69-with语句暂缓">#</a> 6.9 with 语句（暂缓）</h3>
<blockquote>
<p>with 影响性能且难以调试，不建议在产品中使用</p>
</blockquote>
<p>那就略吧</p>
<h3 id="610-switch-语句条件判断"><a class="anchor" href="#610-switch语句条件判断">#</a> 6.10 switch 语句（条件判断）</h3>
<p><code>switch-case</code></p>
<p>注意一点，每个 <code>case</code>  后要有 <code>break</code> ，否则会一直往下执行</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">switch</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token keyword">case</span> <span class="token number">0</span><span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>使用全等操作符 <span class="token operator">===</span></pre></td></tr><tr><td data-num="3"></td><td><pre>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>        <span class="token keyword">break</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token keyword">case</span> <span class="token number">1</span><span class="token operator">:</span></pre></td></tr><tr><td data-num="6"></td><td><pre>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>        <span class="token keyword">break</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token keyword">case</span> <span class="token number">2</span><span class="token operator">:</span></pre></td></tr><tr><td data-num="9"></td><td><pre>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>        <span class="token keyword">break</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>    <span class="token keyword">default</span><span class="token operator">:</span></pre></td></tr><tr><td data-num="12"></td><td><pre>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="13"></td><td><pre>        <span class="token keyword">break</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>ECMAScript 赋予了一些独有特性</p>
<ul>
<li><code>case</code>  后可以添加<strong>表达式</strong></li>
<li><code>case</code>  后可以添加<strong>变量</strong></li>
</ul>
<h2 id="7-函数浅谈"><a class="anchor" href="#7-函数浅谈">#</a> 7. 函数（浅谈）</h2>
<p>浅谈就无需多言了</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">let</span> <span class="token function-variable function">sum1</span><span class="token operator">=</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span>b</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token keyword">return</span> a<span class="token operator">+</span>b<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">function</span> <span class="token function">sum2</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span>b</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token keyword">return</span> a<span class="token operator">+</span>b<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>严格模式下：</p>
<ul>
<li>函数不能以<em> eval</em> 或<em> arguments</em> 作为名称</li>
<li>函数的参数不能叫<em> eval</em> 或<em> arguments</em></li>
<li>2 个函数的参数不能叫同一个名称</li>
</ul>
<h1 id="四-变量-作用域与内存"><a class="anchor" href="#四-变量-作用域与内存">#</a> 四、 变量、作用域与内存★</h1>
<p>JavaScript 的变量的值和数据类型在脚本的生命周期内可以改变。功能很强大，但也有不少问题</p>
<h2 id="1-原始值与引用值"><a class="anchor" href="#1-原始值与引用值">#</a> 1. 原始值与引用值</h2>
<p>原始值：即简单的数据（简单数据类型）</p>
<p>引用值：多个值构成的数据（引用数据类型，string 不是（C++ 中字符串是引用数据类型，因为字符串是由字符组成的，但 JavaScript 中没有字符））</p>
<p>&lt;font color=red&gt; 引用值是<strong>按引用</strong>访问的（即 C++ 中的传引调用），如，函数如果传参是个数组，在函数体内部可以改变数组的元素内容（但数组地址不会变）&lt;/font&gt;</p>
<h3 id="11-动态属性"><a class="anchor" href="#11-动态属性">#</a> 1.1 动态属性</h3>
<p>引用值可以动态的<strong>添加</strong> /<strong> 删除</strong> /<strong> 修改</strong>属性（成员、元素），原始值不行。</p>
<h3 id="12-复制值"><a class="anchor" href="#12-复制值">#</a> 1.2 复制值</h3>
<p>原始值可以互相复制内容并且互不干扰</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">let</span> num1<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">let</span> num2<span class="token operator">=</span>num1<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>num2<span class="token operator">++</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token comment">//num1=5，num2=6，互不干扰</span></pre></td></tr></table></figure><p>但引用值不行。</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">let</span> num1<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">let</span> num2<span class="token operator">=</span>num1<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>num2<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token comment">//num1=[1,2,3,4],num2=[1,2,3,4]。</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token comment">// 因为 num2 复制了 num1 的头指针（指向 1）</span></pre></td></tr></table></figure><p>因为引用值复制的是地址（指针）。</p>
<p>此时可以这样复制</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">let</span> num3<span class="token operator">=</span><span class="token punctuation">[</span><span class="token operator">...</span>num1<span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">let</span> num4<span class="token operator">=</span>num1<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">let</span> num5<span class="token operator">=</span>Array<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span>num1<span class="token punctuation">.</span><span class="token function">values</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><h3 id="13-传递参数"><a class="anchor" href="#13-传递参数">#</a> 1.3 传递参数</h3>
<p>ECMAScript 中所有函数的参数都是<strong>按值传递</strong>的</p>
<blockquote>
<p>ECMAScript 中函数的参数就是<strong>局部变量</strong></p>
</blockquote>
<h3 id="14-确定类型"><a class="anchor" href="#14-确定类型">#</a> 1.4 确定类型</h3>
<blockquote>
<p><strong>typeof</strong> 对确定简单类型很有用，但对引用类型确用处不大，为此，ECMAScript 提供了<strong> instanceof</strong> 操作符。</p>
<p>语法： <em>result=variable instanceof constructor</em></p>
</blockquote>
<p>例：</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">let</span> person<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>person <span class="token keyword">instanceof</span> <span class="token class-name">Array</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//true</span></pre></td></tr><tr><td data-num="4"></td><td><pre>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>person <span class="token keyword">instanceof</span> <span class="token class-name">Object</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//true</span></pre></td></tr><tr><td data-num="5"></td><td><pre>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>person <span class="token keyword">instanceof</span> <span class="token class-name">Map</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//false</span></pre></td></tr></table></figure><p><code>instanceof</code>  是有种<strong>猜测</strong>的意思。&lt;font color=red&gt; 但 <code>instanceof</code>  不适用于原始值（简单类型），如下 &lt;/font&gt;</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">let</span> s<span class="token operator">=</span><span class="token string">"abc"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">let</span> n<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>s <span class="token keyword">instanceof</span> <span class="token class-name">Object</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//false</span></pre></td></tr><tr><td data-num="4"></td><td><pre>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>s <span class="token keyword">instanceof</span> <span class="token class-name">String</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//fasle</span></pre></td></tr><tr><td data-num="5"></td><td><pre>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>n <span class="token keyword">instanceof</span> <span class="token class-name">Number</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//false</span></pre></td></tr></table></figure><h2 id="2-执行上下文和作用域"><a class="anchor" href="#2-执行上下文和作用域">#</a> 2. 执行上下文和作用域</h2>
<p>在 JavaScript 中上下文非常重要，<strong>变量</strong>和<strong>函数</strong>的<strong>上下文</strong>决定了他们可以访问的数据。</p>
<blockquote>
<p>上下文：应该就是该层级的所有代码。以函数块为一层。</p>
<p>知乎：指当前执行环境中的变量、函数声明，参数（arguments），作用域链，this 等信息</p>
</blockquote>
<p>执行上下文主要有<strong>全局上下文</strong>（window）和<strong>函数上下文</strong>，（eval（）调用内部存在第三种上下文）。</p>
<ul>
<li><strong>函数上下文</strong>在所有代码执行完毕会被销毁。（指的是调用时生成的临时代码，而非定义的代码，定义的代码算是是在全局上下文定义的）</li>
<li><strong>全局上下文</strong>在程序关闭时（网页关闭）销毁</li>
<li>全局执行上下文只有一个，函数执行上下文在每次调用函数时候会创建一个新的函数执行上下文。</li>
</ul>
<p><strong>生命周期</strong></p>
<p>函数调用，当<strong>代码执行流</strong>进入函数时，该函数调用的上下文（保存该层）压入<strong>上下文栈</strong>，调用结束弹出上下文（继续该层的执行）。</p>
<p>代码执行时会创建变量对象的<strong>作用域链</strong>，其决定了访问变量和函数的顺序，代码正在执行的上下文变量对象始终位于作用域链最前端</p>
<ul>
<li>上下文其实就相当于层，或者说函数级作用域</li>
<li>作用域链相当于上下文栈的结构图，最上面的在最前面</li>
</ul>
<p>作用域链：</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">var</span> color <span class="token operator">=</span> <span class="token string">"blue"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">function</span> <span class="token function">changeColor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token keyword">var</span> anotherColor<span class="token operator">=</span><span class="token string">"red"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token keyword">function</span> <span class="token function">swapColors</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>        <span class="token keyword">var</span> tempColor <span class="token operator">=</span> anotherColor<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>        anotherColor <span class="token operator">=</span> color<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>        color <span class="token operator">=</span> tempColor<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>        <span class="token comment">// 这里可以访问 color，anotherColor 和 tempeColor</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    <span class="token function">swapColors</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>    <span class="token comment">// 这里可以访问 color 和 anotherColor，但不能访问 tempeColor</span></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token function">changeColor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token comment">// 只能访问 color（）；</span></pre></td></tr></table></figure><p><img data-src="/2022/01/14/note/%E5%89%8D%E7%AB%AF/js%E9%AB%98%E7%BA%A7%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1/QQ%E6%88%AA%E5%9B%BE20220120205939.jpg" alt="img"></p>
<p>作用域链图。</p>
<p><img data-src="https://pic4.zhimg.com/80/v2-9351d2345a9186cc0dc5aeb2be28e16f_720w.jpg" alt></p>
<p>生命周期图</p>
<h3 id="21-作用域链增强"><a class="anchor" href="#21作用域链增强">#</a> 2.1 作用域链增强</h3>
<p>有些语句会在作用域前端临时添加一个上下文，该上下文在代码执行后被删除。</p>
<ul>
<li><code>try/catch</code>  语句的 <code>catch</code>  块：创建一个新的变量对象，这个对象包含要跑出的错误对象的声明。</li>
<li><code>with</code>  语句：向作用域链前端添加指定的对象。</li>
</ul>
<p>（也就是说，这 2 个块相当于新的函数级块）</p>
<h3 id="22-变量声明"><a class="anchor" href="#22-变量声明">#</a> 2.2 变量声明</h3>
<h4 id="221-使用-var-的函数作用域声明"><a class="anchor" href="#221-使用var的函数作用域声明">#</a> 2.2.1 使用 var 的函数作用域声明</h4>
<p><code>var</code>  会自动添加到最近的<strong>上下文</strong>，但如果变量未经声明就初始化 <code>age=10</code> ，则默认添加到<strong>全局上下文</strong>。</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">function</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span>b</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token keyword">var</span> sum<span class="token operator">=</span>a<span class="token operator">+</span>b<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    sum2<span class="token operator">=</span>a<span class="token operator">+</span>b<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token keyword">return</span> sum<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">test</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//3</span></pre></td></tr><tr><td data-num="7"></td><td><pre>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>sum<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 报错</span></pre></td></tr><tr><td data-num="8"></td><td><pre>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>sum2<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//3。因为 sum2 没声明就初始化了，是全局上下文的变量</span></pre></td></tr></table></figure><p>此外， <code>var</code>  变量声明会<strong>提升</strong>到当前上下文的顶部，（赋值不会）</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token function">consolg</span><span class="token punctuation">(</span>test<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">var</span> test<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p>等价于</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">var</span> test<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token function">consolg</span><span class="token punctuation">(</span>test<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>test<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span></pre></td></tr></table></figure><h4 id="222-使用-let-的块级作用域声明"><a class="anchor" href="#222-使用let的块级作用域声明">#</a> 2.2.2 使用 let 的块级作用域声明</h4>
<ul>
<li><code>let</code>  的作用域是块级（最近的一对 <code>&#123;&#125;</code> ）</li>
<li>不能重复声明，（var 可以）</li>
</ul>
<h4 id="223-使用-const-的常量声明"><a class="anchor" href="#223-使用const的常量声明">#</a> 2.2.3 使用 const 的常量声明</h4>
<ul>
<li>在初始化的同时必须赋值</li>
<li>在其生命周期不能再重新赋值</li>
<li>块级作用域</li>
</ul>
<h4 id="224-标识符查找javascript-引擎"><a class="anchor" href="#224-标识符查找javascript引擎">#</a> 2.2.4 标识符查找（JavaScript 引擎）</h4>
<p>当读取或写入一个标识符（变量）时，必须搜索确定这个标识符（找到定义的地方）。搜索开始于作用域链前端（上下文栈顶端、当前上下文、当前作用域），如果没有找到，则继续沿着作用域链搜索。，如下</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">var</span> color<span class="token operator">=</span><span class="token string">'red'</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">function</span> <span class="token function">getColor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token keyword">return</span> color<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>getColor<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//red</span></pre></td></tr></table></figure><p><code>getColor</code>  首先找函数体内有没有定义 <code>color</code> ，发现没有，然后找全局上下文，发现定义了 <code>color</code> ，然后 <code>return color</code> 。</p>
<p>因此，&lt;font color=red&gt; 访问局部变量比访问全局变量快得多。&lt;/font&gt;</p>
<p>此外，在局部变量生成后，任何方法都无法访问同名的外部变量，如下</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">var</span> color<span class="token operator">=</span><span class="token string">'red'</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">function</span> <span class="token function">getColor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token keyword">let</span> color<span class="token operator">=</span><span class="token string">'blue'</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token comment">// 在局部变量生成后，任何方法都无法访问同名的外部变量（此例是全局变量 color='red'）</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token keyword">return</span> color<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>getColor<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//blue</span></pre></td></tr></table></figure><h2 id="3-垃圾回收"><a class="anchor" href="#3-垃圾回收">#</a> 3. 垃圾回收</h2>
<p>JavaScript 是使用垃圾回收的语言，也就是说<strong>执行环境负责管理内存</strong>，和 Java 一样</p>
<blockquote>
<p>基本思路：确定哪个变量不会再使用，释放它占的内存。（周期性，也就是每个一段时间回收一次）</p>
</blockquote>
<p>但是某块内存是否还有用不太好判定，需要对变量进行跟踪记录，关于如何标记变量主要有以下 2 中方式：<strong>标记清理</strong>和<strong>引用计数</strong></p>
<h3 id="31-标记清理最常用"><a class="anchor" href="#31-标记清理最常用">#</a> 3.1 标记清理（最常用）</h3>
<p>当变量进入上下文（在该作用域被声明）时，该变量会被加上 “存在于该上下文” 的标记（标记 called 存在于上下文），然后离开时也会被加上 “离开上下文” 的标记。</p>
<p><strong>垃圾回收</strong>程序运行时：</p>
<ol>
<li>先标记内存中所有变量（认为所有变量都是待删除的）</li>
<li>遍历所有变量</li>
<li>找出在上下文中的变量（集合<strong> A</strong>）（正在使用的变量）</li>
<li>找出所有被<strong> A</strong> 引用的变量（集合<strong> B</strong>）</li>
<li>去除<strong> A</strong> 和<strong> B</strong> 的标记</li>
<li>剩下的带标记的都清理了</li>
</ol>
<p>几乎所有主流浏览器都使用这种方法清理内存。</p>
<p><strong>标记方法</strong>有多种：</p>
<ul>
<li>当变量进入上下文时，反转某一位</li>
<li>维护 “在上下文中” 和 “不在上下文中” 2 个变量列表</li>
<li>等</li>
</ul>
<h3 id="32-引用计数"><a class="anchor" href="#32-引用计数">#</a> 3.2 引用计数</h3>
<blockquote>
<p>思路：对每个值记录它被引用的次数</p>
</blockquote>
<ol>
<li>该值每被一个新的变量引用，引用值 + 1</li>
<li>引用该值的变量被覆盖 / 删除，引用值 - 1</li>
<li>内存回收时， <code>if</code>  该变量引用值 ===0，则回收该值</li>
</ol>
<p>引用计数看上去很简单，但同样问题也很多，比如：</p>
<ol>
<li>a 和 b 互相引用，则 a 和 b 永远不会被删除，但实际上 a 和 b 可能都要被删除</li>
</ol>
<h3 id="33-性能回收周期"><a class="anchor" href="#33-性能回收周期">#</a> 3.3 性能（回收周期）</h3>
<p>垃圾回收程序周期运行，当垃圾累积到一定数量会影响性能，因此回收周期（时间调度）很重要。</p>
<p>回收频率太低会导致<strong>垃圾积压</strong>，频率太高会到处<strong>小内存片泛滥</strong>。</p>
<p>IE7 后，JavaScript 引擎的垃圾回收程序为<strong>动态</strong>改变分配变量、字面量或数组槽位等阈值。</p>
<ul>
<li>
<p>设一个初始阈值。</p>
</li>
<li>
<p>如果有一次回收内存不到已分配的 15%，则阈值会翻倍。</p>
</li>
<li>
<p>如果有一次回收内存达到 85%，则阈值重置为默认值。</p>
</li>
</ul>
<p>（有点像网络拥塞控制的慢开始和快重传）</p>
<h3 id="34-内存管理"><a class="anchor" href="#34-内存管理">#</a> 3.4 内存管理</h3>
<h4 id="341-通过-const-和-let-声明提升性能"><a class="anchor" href="#341-通过const和let声明提升性能">#</a> 3.4.1 通过 const 和 let 声明提升性能</h4>
<p>ES6 增加这 2 个关键字不仅有助于改善代码风格，而且有助于改进<strong>垃圾回收</strong>的过程。</p>
<p>因为 <code>const</code>  和 <code>let</code>  都以<strong>块</strong>为作用域，比 <code>var</code>  能更早被垃圾回收。</p>
<h4 id="342-隐藏类和删除操作"><a class="anchor" href="#342-隐藏类和删除操作">#</a> 3.4.2 隐藏类和删除操作</h4>
<p>算是属于 V8JavaScript 引擎（Chrome 使用这个引擎）的特性。</p>
<p>通过下面这个例子来解释：</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">function</span> <span class="token function">Article</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token keyword">this</span><span class="token punctuation">.</span>title<span class="token operator">=</span><span class="token string">"title"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">let</span> a1<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Article</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">let</span> a2<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Article</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p>这时候 <code>a1</code>  和 <code>a2</code>  同属于一个类（ <code>Article</code> ）</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre>a2<span class="token punctuation">.</span>author<span class="token operator">=</span><span class="token string">'jake'</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p>这时候 <code>a1</code>  和 <code>a2</code>  还是同属于一个类（ <code>Article</code> ），但他们不属于同一个<strong>隐藏类</strong>。其中， <code>a2</code>  的隐藏类比 <code>a1</code>  多了一个 <code>author</code>  属性</p>
<p>再看下例：</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">function</span> <span class="token function">Article</span><span class="token punctuation">(</span><span class="token parameter">author</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token keyword">this</span><span class="token punctuation">.</span>title<span class="token operator">=</span><span class="token string">"title"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token keyword">this</span><span class="token punctuation">.</span>author<span class="token operator">=</span>author<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">let</span> a1<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Article</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token keyword">let</span> a2<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Article</span><span class="token punctuation">(</span><span class="token string">"jake"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p>同样的，此时 2 者属于同一个类，也属于同一个隐藏类</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">delete</span> a1<span class="token punctuation">.</span>author<span class="token punctuation">;</span></pre></td></tr></table></figure><p>现在， <code>a1</code>  和 <code>a2</code>  又不属于同一个隐藏类了。</p>
<hr>
<p>&lt;font color=red&gt; 能够共享隐藏类的对象<strong>性能更好</strong>，即尽可能少的制造隐藏类 &lt;/font&gt;</p>
<p>因此，我们可以把 <code>delete a1.author</code>  改成下面这样</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre>a1<span class="token punctuation">.</span>author<span class="token operator">=</span><span class="token keyword">null</span><span class="token punctuation">;</span><span class="token comment">// 用这个代替 delete</span></pre></td></tr></table></figure><h4 id="343-内存泄漏"><a class="anchor" href="#343-内存泄漏">#</a> 3.4.3 内存泄漏</h4>
<ul>
<li>
<p>意外声明<strong>全局变量</strong>是最常见也是最容易修复的内存泄漏</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">function</span> <span class="token function">setName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    name<span class="token operator">=</span><span class="token string">'jake'</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>只要在 <code>name</code>  前面加上 <code>var</code> 、 <code>let</code> 、 <code>const</code>  即可。（最好不要用 <code>var</code> ）</p>
</li>
<li>
<p><strong>闭包</strong>有可能会引起内存泄漏</p>
<p>闭包就是能够读取其他函数内部变量的函数。所以闭包可以理解成 “<em>定义在一个函数内部并且的函数</em> “。</p>
<ul>
<li>
<p>避免全局变量被污染 方便调用上下文的局部变量 加强封装性</p>
</li>
<li>
<p>闭包长期占用内存，内存消耗很大，可能导致内存泄露</p>
</li>
</ul>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">let</span> <span class="token function-variable function">outer</span><span class="token operator">=</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token keyword">let</span> name<span class="token operator">=</span><span class="token string">'joker'</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token keyword">return</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>        <span class="token keyword">return</span> name<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>如上，当 <code>outer</code>  存在时， <code>name</code>  永远不会被释放，因为闭包一直在引用它。假如 <code>name</code>  的内容很大，就会有问题。</p>
<p>可以这样解决：</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">let</span> <span class="token function-variable function">outer</span><span class="token operator">=</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token keyword">let</span> name<span class="token operator">=</span><span class="token string">'joker'</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token keyword">return</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>        <span class="token keyword">return</span> name<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    name<span class="token operator">=</span><span class="token keyword">null</span><span class="token punctuation">;</span><span class="token comment">// 手动释放一下</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>但：<strong>来自知乎的说法：</strong></p>
<p>IE9 之后不会出现这种情况（内存泄漏），因为之前是使用的<strong>引用计数</strong>算法，会有循环引用的问题，而 IE9 之后使用<strong>标记清除</strong>算法，就几乎不会出现闭包内存泄漏了。</p>
</li>
</ul>
<h4 id="344-静态分配与对象池"><a class="anchor" href="#344-静态分配与对象池">#</a> 3.4.4 静态分配与对象池</h4>
<p>开发者无法控制什么时候开始收集垃圾，但可以<strong>间接控制触发垃圾回收的条件</strong>。</p>
<ul>
<li>
<p>** 标准 1：** 对象更替速度。</p>
<p>如果很多对象初始化，然后一下子又都超出了作用域（不再用到），那么浏览器更频繁地垃圾回收</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">function</span> <span class="token function">addVector</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token keyword">let</span> result<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Vector</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    result<span class="token punctuation">.</span>x<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    result<span class="token punctuation">.</span>y<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token keyword">return</span> result<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>如上面这个例子，如果多次调用 <code>addVector()</code> ，那么 <code>Vector</code>  的实例对象被频繁的创建，又很快超出作用域，生命周期很短。垃圾回收程序会发现此处对象更替速度快，则会更频繁地安排垃圾回收。</p>
<p><strong>解决：<strong>不要频繁的创建对象，可以通过</strong>对象池</strong>来实现。</p>
</li>
<li>
<p>** 对象池：** 创建一个对象池，用来管理一组可回收的对象</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">//vectorPool：假设这是一个已经创建好的对象池对象，先不管是怎么实现的</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">let</span> v1<span class="token operator">=</span>vectorPool<span class="token punctuation">.</span><span class="token function">allocate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 从对象池中取一个 vector 对象</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">let</span> v2<span class="token operator">=</span>vectorPool<span class="token punctuation">.</span><span class="token function">allocate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">addVector</span><span class="token punctuation">(</span>v1<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">addVector</span><span class="token punctuation">(</span>v2<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>vectorPool<span class="token punctuation">.</span><span class="token function">free</span><span class="token punctuation">(</span>v1<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>vectorPool<span class="token punctuation">.</span><span class="token function">free</span><span class="token punctuation">(</span>v2<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 用完把 result 对象还给对象池</span></pre></td></tr><tr><td data-num="8"></td><td><pre>v1<span class="token operator">=</span><span class="token keyword">null</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>v2<span class="token operator">=</span><span class="token keyword">null</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token keyword">function</span> <span class="token function">addVector</span><span class="token punctuation">(</span><span class="token parameter">result</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token comment">// 函数改成这样</span></pre></td></tr><tr><td data-num="11"></td><td><pre>    result<span class="token punctuation">.</span>x<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="12"></td><td><pre>    result<span class="token punctuation">.</span>y<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="13"></td><td><pre>    <span class="token keyword">return</span> result<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>这样垃圾回收检测就不会发现有对象更替，也就不会频繁的垃圾回收。</p>
</li>
</ul>
<hr>
<p>一般<strong>对象池</strong>都是用<strong>数组</strong>实现的，JavaScript 的数组大小是动态可变的， <code>Array.push()</code>  操作有可能会导致不必要的垃圾回收，因此最好一开始就初始化创建一个大小够用的数组作为<strong>对象池</strong>。</p>
<p>原话是这样的，但不是很理解。</p>
<blockquote>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">let</span> list<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Array</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">let</span> vector<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Vector</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>list<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>vector<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p>引擎会删除大小为 100 的数组，再创建一个大小为 200 的数组。垃圾回收程序看到这个删除操作，可能会跑过来进行一次垃圾回收。</p>
</blockquote>
<p>不知道这个是不是和 <code>C++</code>  的 capacity 一样，当数组长度超过 <code>capacity</code>  时，加长 <code>capacity</code> ，然后之后的 <code>push</code>  就不需要再花大力气分配新的内存了。但我看 JavaScript 好像并不是这样，所以不是很理解，以下是 CSDN 中说的</p>
<blockquote>
<p>JavaScript 据元素的增加和删除来动态调整存储空间大小，内部是通过扩容和收缩机制实现</p>
</blockquote>
<h1 id="五-基本引用类型"><a class="anchor" href="#五-基本引用类型">#</a> 五、 基本引用类型</h1>
<p>在 JavaScript 中，基本引用类型不算<strong>类</strong>（尽管可以通过 new 创建对象），更像是 <code>C++</code>  中的结构体。不过和类其实也基本大差不差</p>
<h2 id="1-date"><a class="anchor" href="#1-date">#</a> 1. Date</h2>
<p><code>Date</code>  类型将日期保存为<strong>自协调世界时</strong>（1970-01-01-00:00）至今所经历的<strong>毫秒数</strong></p>
<p>通过 <code>let date=new Date()</code>  创建，构造参数不写 date 默认保存当前日期和时间。要指定时间，则需要传入<strong>毫秒数</strong>，ES 提供了 2 个函数转换毫秒数： <code>Date.parse()</code>  和 <code>Date.UTC()</code> 。</p>
<ul>
<li>
<p><code>Date.parse()</code> ：接受一个表示日期的<strong>字符串</strong>，将其转为毫秒数</p>
<ul>
<li>月 / 日 / 年：如 “5/23/2019”</li>
<li>月名 日，年：如 “May 23, 2019”</li>
<li>周名 月名 日 年 时：分: 秒 时区：如 “Tue May 23 2019 00:00:00 GMT-0700”</li>
<li>YYYY-MM-DDTHH:mm:ss.ssZ：如 2019-05-23T00:00:00</li>
</ul>
</li>
<li>
<p><code>Date.UTC()</code> ：参数是 <code>number</code>  类型的 “年，月 (0-11)，日 (1-31)，时 (0-23)，分，秒，毫秒”</p>
<ul>
<li><strong>年</strong>和<strong>月</strong>是必须的，其他的可选</li>
<li>默认取最前面的值（日 = 1，其他 = 0）</li>
</ul>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">let</span> date<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span>Date<span class="token punctuation">.</span><span class="token constant">UTC</span><span class="token punctuation">(</span><span class="token number">2000</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">let</span> date1<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span>Date<span class="token punctuation">.</span><span class="token constant">UTC</span><span class="token punctuation">(</span><span class="token number">2005</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">17</span><span class="token punctuation">,</span><span class="token number">55</span><span class="token punctuation">,</span><span class="token number">55</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure></li>
</ul>
<p>不过 <code>new Date()</code>  接受的参数和 <code>Date.UTC()</code>  是一样的，因此上面的代码可以直接这样写</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">let</span> date<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token number">2000</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">let</span> date1<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token number">2005</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">17</span><span class="token punctuation">,</span><span class="token number">55</span><span class="token punctuation">,</span><span class="token number">55</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><ul>
<li>
<p><code>Date.now()</code> ：返回当前的毫秒数，可用来分析代码的执行效率等</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">let</span> start<span class="token operator">=</span>Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token function">doSomething</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">let</span> stop<span class="token operator">=</span>Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">let</span> result<span class="token operator">=</span>stop<span class="token operator">-</span>start<span class="token punctuation">;</span></pre></td></tr></table></figure></li>
</ul>
<h3 id="11-继承的方法"><a class="anchor" href="#11-继承的方法">#</a> 1.1 继承的方法</h3>
<p><code>Date</code>  类型重写了 <code>toLocaleString()</code> 、 <code>toString()</code>  和 <code>valueOf()</code> .</p>
<ul>
<li>
<p><code>toLocaleString()</code> ：返回如下格式的日期    2/1/2019 12:00:00 AM</p>
</li>
<li>
<p><code>toString()</code> ：返回如下格式的日期    Tue Feb 1 2019 00:00:00 GMT-0800 (Pacific Standard Time)</p>
</li>
<li>
<p><code>valueOf()</code> ：返回毫秒数</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">let</span> date1<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token number">2019</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">let</span> date2<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token number">2019</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>date1<span class="token operator">&lt;</span>date2<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//true</span></pre></td></tr></table></figure></li>
</ul>
<h3 id="12-日期格式化方法"><a class="anchor" href="#12-日期格式化方法">#</a> 1.2 日期格式化方法</h3>
<p>即返回指定格式的日期（<strong>字符串</strong>形式）</p>
<ul>
<li><code>toDateString()</code> ：显示    周几、月、日、年</li>
<li><code>toTimeString()</code> ：显示    时、分、秒、时区</li>
<li><code>toLocaleDateString()</code> ：显示    周几、月、日、年</li>
<li><code>toLocaleTimeString()</code> ：显示    时、分、秒</li>
<li><code>toUTCString()</code> ：显示    完整的 UTC 日期</li>
</ul>
<p>这些方法和 <code>toString()</code>  还有 <code>toLocaleStirng()</code>  一样，具体情况还得视浏览器而定</p>
<h3 id="13-日期-时间组件方法暂缓"><a class="anchor" href="#13-日期时间组件方法暂缓">#</a> 1.3 日期 / 时间组件方法（暂缓）</h3>
<h2 id="2-regexp暂缓"><a class="anchor" href="#2-regexp暂缓">#</a> 2. RegExp（暂缓）</h2>
<p>ES 通过 <code>RegExp</code>  支持<strong>正则表达式</strong>。正则表达式主要是用来<strong>字符串检索</strong>或<strong>字符串匹配</strong>的</p>
<blockquote>
<p>正则表达式语法： <code>let expression=/pattern/flags</code></p>
<ul>
<li>pattern：正则表达式</li>
<li>flags：标记，用于控制正则表达式的行为，可多个标记组合
<ul>
<li>g：查找字符串全部内容，而不是找到第一个就结束</li>
<li>i：不区分大小写</li>
<li>m：查找到一行末尾仍继续查找</li>
<li>y：只查找 lastIndex 及之后的字符串</li>
<li>u：启用 Unicode 匹配</li>
<li>s：表示元字符。匹配任何字符（包括 \n 或 \r）</li>
</ul>
</li>
</ul>
</blockquote>
<p>例：</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">var</span> str <span class="token operator">=</span> <span class="token string">"Visit Runoob!"</span><span class="token punctuation">;</span> <span class="token comment">// 搜索 "Runoob" 字符串，且不区分大小写：</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">var</span> n <span class="token operator">=</span> str<span class="token punctuation">.</span><span class="token function">search</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">Runoob</span><span class="token regex-delimiter">/</span><span class="token regex-flags">i</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p>特殊字符需要 <code>\</code>  转义</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">let</span> pattern1<span class="token operator">=</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">[bc]at</span><span class="token regex-delimiter">/</span><span class="token regex-flags">i</span></span><span class="token punctuation">;</span><span class="token comment">// 匹配第一个 bat 或 cat，忽略大小写</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">let</span> pattern2<span class="token operator">=</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\[bc\]at</span><span class="token regex-delimiter">/</span><span class="token regex-flags">i</span></span><span class="token punctuation">;</span><span class="token comment">// 匹配第一个 [bc] at，忽略大小写</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">let</span> pattern3<span class="token operator">=</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">.at</span><span class="token regex-delimiter">/</span><span class="token regex-flags">gi</span></span><span class="token punctuation">;</span><span class="token comment">// 匹配所有以 at 结尾的三字符组合，忽略大小写</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">let</span> pattern4<span class="token operator">=</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.at</span><span class="token regex-delimiter">/</span><span class="token regex-flags">gi</span></span><span class="token punctuation">;</span><span class="token comment">// 匹配所有.at，忽略大小写</span></pre></td></tr></table></figure><p>以上都属于 RegExp 对象，也可以用 <code>new RegExp()</code>  创建，不过这种方法用的比较少</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">let</span> pattern1<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">RegExp</span><span class="token punctuation">(</span><span class="token string">"[bc]at"</span><span class="token punctuation">,</span><span class="token string">"i"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 匹配第一个 bat 或 cat，忽略大小写</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token comment">// 根据 pattern1 创建 pattern2</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">let</span> pattern1<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">RegExp</span><span class="token punctuation">(</span>pattern1<span class="token punctuation">,</span><span class="token string">"g"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//flag 就变成 g 了</span></pre></td></tr></table></figure><h3 id="21-regexp-实例属性"><a class="anchor" href="#21-regexp实例属性">#</a> 2.1 RegExp 实例属性</h3>
<p>每个 RegExp 实例都有以下属性</p>
<ul>
<li>global：是否设置了 g 标记</li>
<li>ignoreCase：是否设置了 i</li>
<li>unicode：是否设置了 u</li>
<li>sticky：是否设置了 y</li>
<li>multiline：是否设置了 m</li>
<li>dotAll：是否设置了 s</li>
<li>lastIndex：整数，在源字符串下一次搜索开始的位置，始终从 0 开始</li>
<li>source：正则表达式本体的字面量字符串</li>
<li>flags：标记字符串</li>
</ul>
<h3 id="22-regexp-实例方法"><a class="anchor" href="#22-regexp实例方法">#</a> 2.2 RegExp 实例方法</h3>
<h4 id="221-exec-方法"><a class="anchor" href="#221-exec方法">#</a> 2.2.1 exec () 方法</h4>
<h4 id="222-test-方法"><a class="anchor" href="#222-test方法">#</a> 2.2.2 test () 方法</h4>
<h2 id="3-原始值包装类型"><a class="anchor" href="#3-原始值包装类型">#</a> 3. 原始值包装类型</h2>
<p>类似 Java 的包装类，为了方便操作原始值，ECMAScript 提供了 3 种特殊的<strong>引用类型</strong>：Boolean、Number、String</p>
<p>每当用到某个原始值的<strong>方法或属性</strong>时，后台都会<strong>创建</strong>一个相应的原始包装类型的<strong>对象</strong>，从而暴露出操作原始值的方法。</p>
<p>例：</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">let</span> s1<span class="token operator">=</span><span class="token string">"text"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">let</span> s2<span class="token operator">=</span>s1<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p>已知，字符串是原始值，按理原始值不应该有方法，但实际上后台把 s1 的值封装在了引用类型 <code>String</code>  的实例对象汇总。即后台做了一下操作：</p>
<ol>
<li>创建一个 <code>String</code>  类型的实例；</li>
<li>调用实例上的方法；</li>
<li>销毁实例。</li>
</ol>
<p>按代码来看是这样的</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">let</span> s1<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span><span class="token string">"text"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">let</span> s2<span class="token operator">=</span>s1<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span>s1<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>s1<span class="token operator">=</span><span class="token keyword">null</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p>与引用类型的<strong>区别</strong>：</p>
<ul>
<li><strong>引用类型</strong>：new 出来的实例在<strong>离开作用域</strong>时被销毁</li>
<li><strong>原始值包装类型</strong>：的实例在<strong>访问结束</strong>即销毁。</li>
</ul>
<p>因此原始值包装类型不能进行各种操作（如加一个属性之类），例：</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">let</span> s1<span class="token operator">=</span><span class="token string">"text"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>s1<span class="token punctuation">.</span>color<span class="token operator">=</span><span class="token string">"red"</span><span class="token punctuation">;</span><span class="token comment">// 此时 new 了一个 String 实例对象，color="red"</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token comment">// 但结束即销毁，这里 s1.color 现在已经没了</span></pre></td></tr><tr><td data-num="4"></td><td><pre>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>s1<span class="token punctuation">.</span>color<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//undefined。这一行，又重新 new 了一个一个 String 实例对象，其没有 color 属性。或者说 color 属性是 undefined</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token comment">// 然后这一行结束该包装类也被销毁</span></pre></td></tr></table></figure><p>此外，可以<strong>显式</strong>地创建原始值包装对象，如 <code>let s1=new String(&quot;text&quot;);</code> ，但这样就不是原始值了，用 <code>typeof</code>  返回的是 <code>object</code></p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">let</span> value<span class="token operator">=</span><span class="token string">"25"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> <span class="token function">Number</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//number</span></pre></td></tr><tr><td data-num="3"></td><td><pre>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> <span class="token keyword">new</span> <span class="token class-name">Number</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//object</span></pre></td></tr></table></figure><p>&lt;font color=red&gt; 一般来说并不推荐直接创建包装类使用，但要明白原始值调用方法的逻辑 &lt;/font&gt;</p>
<h3 id="31-boolean不推荐使用"><a class="anchor" href="#31-boolean不推荐使用">#</a> 3.1 Boolean（不推荐使用）</h3>
<p>对应布尔值的包装类</p>
<p><code>Boolean</code>  类型构造时以 <code>true/false</code>  作为参数，如</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">let</span> bool<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Boolean</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><ul>
<li><code>valueOf()</code> ：返回原始值 <code>true/false</code></li>
<li><code>toString()</code> ：返回字符串 <code>true/false</code></li>
</ul>
<p>使用 <code>Boolean</code>  容易<strong>引起误会</strong>，如</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">let</span> f<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Boolean</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">let</span> result<span class="token operator">=</span>f <span class="token operator">&amp;&amp;</span> <span class="token boolean">true</span><span class="token punctuation">;</span><span class="token comment">//true</span></pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">let</span> f1<span class="token operator">=</span><span class="token boolean">false</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">let</span> result1<span class="token operator">=</span>f1 <span class="token operator">&amp;&amp;</span> <span class="token boolean">true</span><span class="token punctuation">;</span><span class="token comment">//false</span></pre></td></tr></table></figure><p>在 <code>f &amp;&amp; true</code>  中，本来应该是 <code>false</code> ，但由于 <code>f</code>  是个 <code>object</code>  对象，只要不为空（ <code>null</code> ），就判定为 <code>true</code> ，这就导致了虽然 <code>f</code>  的值为 <code>false</code> ，但在布尔判断时却为 <code>true</code> 。</p>
<h3 id="32-number"><a class="anchor" href="#32-number">#</a> 3.2 Number</h3>
<p>数值的包装类</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">let</span> num<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Number</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><ul>
<li>
<p><code>valueOf()</code> ：返回原始值</p>
</li>
<li>
<p><code>toString()</code> ：返回字符串。可接受参数，返回<strong>对应进制</strong>的字符串数值</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">let</span> num<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>num<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//"1010"</span></pre></td></tr></table></figure></li>
<li>
<p><code>toFixed()</code> ：返回包含指定小数点位数的数值字符串（精确到小数点后 n 位，四舍五入）</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre>num<span class="token punctuation">.</span><span class="token function">toFixed</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//"10.00"</span></pre></td></tr></table></figure></li>
<li>
<p><code>toExponential()</code> ：返回科学记数法，参数表示保留几位<strong>有效数字</strong></p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre>num<span class="token punctuation">.</span><span class="token function">toExponential</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//"1.0e+1"。</span></pre></td></tr></table></figure></li>
<li>
<p><code>toPrecision()</code> ：自动判断使用科学计数法还是...</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">let</span> num<span class="token operator">=</span><span class="token number">99</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>num<span class="token punctuation">.</span><span class="token function">toPrecision</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//"1e+2"</span></pre></td></tr><tr><td data-num="3"></td><td><pre>num<span class="token punctuation">.</span><span class="token function">toPrecision</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token operator">/</span><span class="token string">"99"</span></pre></td></tr><tr><td data-num="4"></td><td><pre>num<span class="token punctuation">.</span><span class="token function">toPrecision</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token operator">/</span><span class="token string">"99.0"</span></pre></td></tr></table></figure></li>
<li>
<p><code>Number.isInteger()</code> （ES6 新增）：判断是否为<strong>整数</strong>（1.0 也算）</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre>Number<span class="token punctuation">.</span><span class="token function">isInteger</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//true</span></pre></td></tr><tr><td data-num="2"></td><td><pre>Number<span class="token punctuation">.</span><span class="token function">isInteger</span><span class="token punctuation">(</span><span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//true</span></pre></td></tr><tr><td data-num="3"></td><td><pre>Number<span class="token punctuation">.</span><span class="token function">isInteger</span><span class="token punctuation">(</span><span class="token number">1.01</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//false</span></pre></td></tr></table></figure></li>
<li>
<p><code>Number.isSafeInteger()</code> ：判断整数是否在正常范围（保存的整数如果超出范围会变成别的数）</p>
<p>一般正常范围是（ <code>Number.MAX_SAFE_INTEGER</code> -2<sup>53+1~`Number.MIN_SAFE_INTEGER`2</sup>53-1）</p>
<p><code>Number.MAX_SAFE_INTEGER</code>  是小于 <code>Number.MAX_VALUE</code>  的，前者是正常保存显示的范围，后者是上限</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre>Number<span class="token punctuation">.</span><span class="token function">isSafeInteger</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token operator">*</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token operator">**</span><span class="token number">53</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//false</span></pre></td></tr></table></figure></li>
</ul>
<h3 id="33-string"><a class="anchor" href="#33-string">#</a> 3.3 String</h3>
<p>字符串的包装类</p>
<p><code>String</code>  对象的方法可以在所有字符串原始值上调用</p>
<p><code>valueOf()</code> 、 <code>toLocaleString()</code> 、 <code>toString()</code>  都返回对象的原始字符串</p>
<h4 id="331-javascript-字符"><a class="anchor" href="#331-javascript字符">#</a> 3.3.1 JavaScript 字符</h4>
<p>每个字符由 16 个码元（code unit）组成，（其实就是 16bit）。</p>
<ul>
<li>
<p><code>charAt()</code> ：获取对应索引的字符。效果上基本等同 <code>[]</code></p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">let</span> s1<span class="token operator">=</span><span class="token string">"text"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>s1<span class="token punctuation">.</span><span class="token function">charAt</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//'e'</span></pre></td></tr></table></figure></li>
<li>
<p><code>charCodeAt()</code> ：返回字符串<strong>对应索引</strong>的字符的<strong> ASCII 码</strong></p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">let</span> s2<span class="token operator">=</span><span class="token string">"abcd"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>s2<span class="token punctuation">.</span><span class="token function">charCodeAt</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//99</span></pre></td></tr></table></figure></li>
<li>
<p><code>String.fromCharCode()</code> ：通过给定 ASCII 码创建字符 / 字符串</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">let</span> s<span class="token operator">=</span>String<span class="token punctuation">.</span><span class="token function">fromCharCode</span><span class="token punctuation">(</span><span class="token number">97</span><span class="token punctuation">,</span><span class="token number">98</span><span class="token punctuation">,</span><span class="token number">99</span><span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//"abcd"</span></pre></td></tr></table></figure></li>
</ul>
<p>** 代理对表示：** 使用 2 刚刚符号位（32 个 bit）表示一个符号</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>String<span class="token punctuation">.</span><span class="token function">fromCharCode</span><span class="token punctuation">(</span><span class="token number">55357</span><span class="token punctuation">,</span><span class="token number">56842</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//😊</span></pre></td></tr><tr><td data-num="2"></td><td><pre>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>String<span class="token punctuation">.</span><span class="token function">fromCodePoint</span><span class="token punctuation">(</span><span class="token number">55357</span><span class="token punctuation">,</span><span class="token number">56842</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//😊</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token comment">// 其实😊也可以直接用一个符号表示</span></pre></td></tr><tr><td data-num="4"></td><td><pre>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>String<span class="token punctuation">.</span><span class="token function">fromCharCode</span><span class="token punctuation">(</span><span class="token number">9786</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//😊</span></pre></td></tr></table></figure><h4 id="332-normalize-方法看不懂"><a class="anchor" href="#332-normalize方法看不懂">#</a> 3.3.2 normalize () 方法（看不懂）</h4>
<h4 id="333-字符串操作方法"><a class="anchor" href="#333-字符串操作方法">#</a> 3.3.3 字符串操作方法</h4>
<ul>
<li>
<p><code>concat()</code> ：拼接字符串</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">let</span> s1<span class="token operator">=</span><span class="token string">"hello"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">let</span> s2<span class="token operator">=</span>s1<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span><span class="token string">" world"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">let</span> s3<span class="token operator">=</span>s1<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span><span class="token string">" world"</span><span class="token punctuation">,</span><span class="token string">"！"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>s2<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//"hello world"</span></pre></td></tr><tr><td data-num="5"></td><td><pre>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>s3<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//"hello world！"</span></pre></td></tr></table></figure><p>&lt;font color=red&gt; 但一般使用 “<strong>+</strong>” 号即可，也更方便 &lt;/font&gt;</p>
</li>
<li>
<p><code>slice()</code> ：提取字符串。参数<strong>负数</strong>代表<strong>倒数</strong></p>
<ul>
<li><code>start</code> ：可选，起始索引。
<ul>
<li>不写默认从 0 开始。</li>
<li>超出 <code>length</code> ，返回<strong>空</strong></li>
</ul>
</li>
<li><code>end</code> ：可选，结束索引（左闭右开）。
<ul>
<li>不写默认到结尾</li>
<li>超出 <code>length</code> ，直接到结尾</li>
<li><strong>小于</strong> <code>start</code> ，返回<strong>空</strong></li>
</ul>
</li>
</ul>
</li>
<li>
<p><code>substring()</code> ：提取字符串。参数<strong>负数</strong>视作<strong> 0</strong></p>
<ul>
<li><code>start</code> ：可选，起始索引。
<ul>
<li>不写默认从 0 开始</li>
<li>超出 <code>length</code> ，返回<strong>空</strong></li>
</ul>
</li>
<li><code>end</code> ：可选，结束索引（左闭右开）
<ul>
<li><strong>不写</strong>视作 start+1</li>
<li>超出 <code>length</code> ，直接到结尾</li>
<li><strong>小于</strong> <code>start</code> ，<strong>往回截取</strong>（但不反转字符串）</li>
</ul>
</li>
</ul>
</li>
<li>
<p><code>substr()</code> ：提取字符串。</p>
<ul>
<li><code>start</code> ：可选，起始索引。
<ul>
<li>不写默认从 0 开始</li>
<li>超出 <code>length</code> ，返回<strong>空</strong></li>
<li><strong>负数</strong>代表倒数</li>
</ul>
</li>
<li><code>len</code> ：可选，截取长度。
<ul>
<li>不写默认到结尾</li>
<li><strong>负数</strong>视作 0</li>
</ul>
</li>
</ul>
</li>
</ul>
<h4 id="334-字符串位置方法"><a class="anchor" href="#334-字符串位置方法">#</a> 3.3.4 字符串位置方法</h4>
<ul>
<li>
<p><code>indexOf()</code> ：从字符串<strong>开头</strong>查找字符串，返回<strong>第一次</strong>匹配的索引</p>
<ul>
<li><code>s</code> ：待搜索的子串</li>
<li><code>bgnIndex</code> ：开始查找的位置</li>
</ul>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">let</span> s<span class="token operator">=</span><span class="token string">"hello"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>s<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">"l"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//2</span></pre></td></tr></table></figure></li>
<li>
<p><code>lastIndexOf()</code> ：从结尾开始找</p>
<ul>
<li><code>s</code> ：待搜索的子串</li>
<li><code>bgnIndex</code> ：开始查找的位置</li>
</ul>
</li>
</ul>
<p>这 2 个方法比 <code>search()</code>  快得多</p>
<ul>
<li><code>search()</code> ：查找是否包含指定字符串，是的话返回第一次匹配的索引</li>
</ul>
<h4 id="335-字符串包含方法"><a class="anchor" href="#335-字符串包含方法">#</a> 3.3.5 字符串包含方法</h4>
<ul>
<li>
<p><code>startsWith()</code> ：查看字符串是否以指定的子字符串<strong>开头</strong>。</p>
<ul>
<li><code>s</code> ：指定子串</li>
<li><code>idx</code> ：开始位置（重新定义开头）</li>
</ul>
</li>
<li>
<p><code>endsWith()</code> ：查看字符串是否以指定的子字符串<strong>结尾</strong>。</p>
<ul>
<li><code>s</code> ：指定子串</li>
<li><code>idx</code> ：结尾位置</li>
</ul>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">let</span> s<span class="token operator">=</span><span class="token string">"ab☺c"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>s<span class="token punctuation">.</span><span class="token function">endsWith</span><span class="token punctuation">(</span><span class="token string">"b"</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr></table></figure></li>
<li>
<p><code>includes()</code> ：检查字符串是否包含指定子串</p>
<ul>
<li><code>s</code> ：指定子串</li>
<li><code>idx</code> ：开始查找的索引</li>
</ul>
</li>
</ul>
<h4 id="336-trim-方法"><a class="anchor" href="#336-trim方法">#</a> 3.3.6 trim () 方法</h4>
<ul>
<li>
<p><code>trim()</code> ：删除字符串<strong>前后</strong>空格，中间的不删</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">let</span> s<span class="token operator">=</span><span class="token string">" hello world  "</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">let</span> s1<span class="token operator">=</span>s<span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>s1<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//"hello world"</span></pre></td></tr></table></figure></li>
<li>
<p><code>trimeLeft()</code> ：删除左边所有空格</p>
</li>
<li>
<p><code>trimeRight()</code> ：删除右边所有空格</p>
</li>
</ul>
<h4 id="337-repeat-方法"><a class="anchor" href="#337-repeat方法">#</a> 3.3.7 repeat () 方法</h4>
<ul>
<li>
<p><code>repeat()</code> ：复制字符串，用法相当于 <code>python</code>  的 <code>*</code> 。</p>
<ul>
<li><code>n</code> ：复制次数</li>
</ul>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">let</span> s<span class="token operator">=</span><span class="token string">"ab"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">let</span> s2<span class="token operator">=</span>s<span class="token punctuation">.</span><span class="token function">repeat</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//"ab"</span></pre></td></tr><tr><td data-num="4"></td><td><pre>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>s2<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//"ababab"</span></pre></td></tr></table></figure></li>
</ul>
<p>​		&lt;font color=red&gt; 注： <code>repeat</code>  还需创建个新的变量去接受复制后的值 &lt;/font&gt;</p>
<h4 id="338-padstart-和-padend-方法"><a class="anchor" href="#338-padstart和padend方法">#</a> 3.3.8 padStart () 和 padEnd () 方法</h4>
<ul>
<li><code>padStart()</code> ：如果小于指定长度 <code>l</code> ，则在<strong>左边</strong>填充指定字符串 <code>s</code> ，直到满足要求
<ul>
<li><code>n</code> ：必选，长度</li>
<li><code>s</code> ：可选，填充字符串。不写默认空格 <code>&quot; &quot;</code></li>
</ul>
</li>
<li><code>padEnd()</code> ：如果小于指定长度 <code>l</code> ，则在<strong>右边</strong>填充指定字符串 <code>s</code> ，直到满足要求
<ul>
<li><code>n</code> ：必选，长度</li>
<li><code>s</code> ：可选，填充字符串。不写默认空格 <code>&quot; &quot;</code></li>
</ul>
</li>
</ul>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">let</span> s<span class="token operator">=</span><span class="token string">"hello"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">let</span> s1<span class="token operator">=</span>s<span class="token punctuation">.</span><span class="token function">padStart</span><span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//"    hello"</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">let</span> s2<span class="token operator">=</span>s<span class="token punctuation">.</span><span class="token function">padStart</span><span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">,</span><span class="token string">"."</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//"....hello"</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">let</span> s3<span class="token operator">=</span>s<span class="token punctuation">.</span><span class="token function">padStart</span><span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">,</span><span class="token string">"abc"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//"abcahello"</span></pre></td></tr></table></figure><p>如果字符串不能刚好填充，那就会<strong>自动裁剪</strong>一下</p>
<h4 id="339-字符串迭代与解构迭代器的用法"><a class="anchor" href="#339-字符串迭代与解构迭代器的用法">#</a> 3.3.9 字符串迭代与解构（迭代器的用法）</h4>
<p>先看一下示例</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">let</span> message<span class="token operator">=</span><span class="token string">"abc"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">let</span> messageIterator<span class="token operator">=</span>message<span class="token punctuation">[</span>Symbol<span class="token punctuation">.</span>iterator<span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>messageIterator<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//&#123; value: 'a', done: false &#125;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>messageIterator<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//&#123; value: 'b', done: false &#125;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>messageIterator<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//&#123; value: 'c', done: false &#125;</span></pre></td></tr></table></figure><p>像 <code>for-of</code>  和 <code>[...arr]</code>  都是通过<strong>迭代器</strong>实现的</p>
<h4 id="3310-字符串大小写转换"><a class="anchor" href="#3310-字符串大小写转换">#</a> 3.3.10 字符串大小写转换</h4>
<ul>
<li><code>toLowerCase()</code> ：全部转为小写</li>
<li><code>toLocaleLowerCase()</code> ：全部转为小写（根据对应地区环境）</li>
<li><code>toUpperCase()</code> ：全部转为大写</li>
<li><code>toLocaleUpperCase()</code> ：全部转为大写（根据对应地区环境）</li>
</ul>
<p>一般建议使用 <code>Locale</code>  的</p>
<h4 id="3311-字符串模式匹配方法暂缓"><a class="anchor" href="#3311-字符串模式匹配方法暂缓">#</a> 3.3.11 字符串模式匹配方法（暂缓）</h4>
<p>这里主要是讲了一些适配<strong>正则表达式</strong>的方法</p>
<ul>
<li><code>match()</code> ：</li>
<li><code>search()</code> ：</li>
</ul>
<h4 id="3312-localecompare-方法"><a class="anchor" href="#3312-localecompare方法">#</a> 3.3.12 localeCompare () 方法</h4>
<ul>
<li>
<p><code>localeCompare()</code> ：比较 2 个字符串</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">let</span> s<span class="token operator">=</span><span class="token string">"yellow"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>s<span class="token punctuation">.</span><span class="token function">localeCompare</span><span class="token punctuation">(</span><span class="token string">"black"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//1</span></pre></td></tr><tr><td data-num="3"></td><td><pre>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>s<span class="token punctuation">.</span><span class="token function">localeCompare</span><span class="token punctuation">(</span><span class="token string">"yellow"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//0</span></pre></td></tr><tr><td data-num="4"></td><td><pre>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>s<span class="token punctuation">.</span><span class="token function">localeCompare</span><span class="token punctuation">(</span><span class="token string">"zoo"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//-1</span></pre></td></tr><tr><td data-num="5"></td><td><pre>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>s<span class="token punctuation">.</span><span class="token function">localeCompare</span><span class="token punctuation">(</span><span class="token string">"yello"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//1</span></pre></td></tr></table></figure><ol>
<li>按照字典序<strong>逐个</strong>比较</li>
<li>如果<strong>大于</strong>，则返回<strong> 1</strong></li>
<li>如果<strong>等于</strong>，则返回<strong> 0</strong></li>
<li>如果<strong>小于</strong>，则返回 **-1**</li>
</ol>
</li>
</ul>
<h2 id="4-单例内置对象"><a class="anchor" href="#4-单例内置对象">#</a> 4. 单例内置对象</h2>
<blockquote>
<p>内置对象：任何由 ECMAScript 实现提供，与宿主环境无关在程序开始执行时就已存在的对象</p>
</blockquote>
<p>前面讲的 <code>Object</code> 、 <code>Number</code> 、 <code>String</code>  等都是内置对象，本章主要讲一下 <code>Global</code>  和 <code>Math</code></p>
<h3 id="41-global"><a class="anchor" href="#41-global">#</a> 4.1 Global</h3>
<p>相当于 DOM 的 window，所有在全局作用域定义的变量和函数都会变成 Global 的属性和方法。此外，诸如 <code>isNaN()</code> 、 <code>parseInt()</code>  等方法实际上都是 <code>Global</code>  对象的方法。&lt;font color=red&gt; 也就是说， <code>Global</code>  的方法不需要写 <code>Global.isNaN()</code> ，直接写 <code>isNaN()</code>  即可 &lt;/font&gt;</p>
<h4 id="411-url-编码方法"><a class="anchor" href="#411-url编码方法">#</a> 4.1.1 URL 编码方法</h4>
<ul>
<li>
<p><code>encodeURI()</code> ：对整个 URI 编码，<strong>不会对特殊字符如 <code>#</code> 、 <code>:</code> 、 <code>/</code>  等进行编码</strong></p>
</li>
<li>
<p><code>encodeURIComponent()</code> ：对<strong>所有符号</strong>编码</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">let</span> uri<span class="token operator">=</span><span class="token string">"http:// www.wrox.com/illegal value.js#start"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">encodeURI</span><span class="token punctuation">(</span>uri<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//http://%20www.wrox.com/illegal%20value.js#start</span></pre></td></tr><tr><td data-num="3"></td><td><pre>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">encodeURIComponent</span><span class="token punctuation">(</span>uri<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//http%3A%2F%2F%20www.wrox.com%2Fillegal%20value.js%23start</span></pre></td></tr></table></figure><p>一般 <code>encodeURIComponent()</code>  的使用频率比较高</p>
</li>
<li>
<p><code>decodeURI()</code> ：对应解码</p>
</li>
<li>
<p><code>decodeURIComponent()</code> ：对应解码</p>
</li>
</ul>
<h4 id="412-eval-方法"><a class="anchor" href="#412-eval方法">#</a> 4.1.2 eval () 方法</h4>
<p>接收一个参数，即一个要执行的 JavaScript 字符串</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token function">eval</span><span class="token punctuation">(</span><span class="token string">"console.log('hello')"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token comment">// 等效于</span></pre></td></tr><tr><td data-num="3"></td><td><pre>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'hello'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p><code>eval()</code>  有 2 个重要的特点：</p>
<ul>
<li>
<p><code>eval</code>  调用的代码和 <code>eval</code>  属于同一个作用域</p>
<p>例：通过 <code>ajax</code>  请求获取了一段 <code>js</code>  代码，需要在<strong>全局作用域</strong>中执行，可代码却是在函数中获得的</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">function</span> <span class="token function">fun</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token keyword">var</span> s<span class="token operator">=</span><span class="token string">'function test()&#123;return 1;&#125;'</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    window<span class="token punctuation">.</span><span class="token function">eval</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 通过 window.eval 使 s 在全局作用域运行</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token function">fun</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token function">alert</span><span class="token punctuation">(</span><span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure></li>
<li>
<p><code>eval</code>  定义的任何变量和函数都<strong>不会被提升</strong></p>
</li>
</ul>
<h4 id="413-global-对象属性"><a class="anchor" href="#413-global对象属性">#</a> 4.1.3 Global 对象属性</h4>
<ul>
<li><code>undefined</code> ：特殊值</li>
<li><code>NaN</code> ：特殊值</li>
<li><code>Infinity</code> ：特殊值</li>
<li><code>Object</code> ： <code>Object</code>  的构造函数</li>
<li><code>Array</code> ：构造函数（一下均是）</li>
<li><code>Function</code></li>
<li><code>Boolean</code></li>
<li><code>String</code></li>
<li><code>Number</code></li>
<li><code>Date</code></li>
<li><code>RegExp</code></li>
<li><code>Symbol</code></li>
<li><code>Error</code></li>
<li><code>EvalError</code></li>
<li><code>RangeError</code></li>
<li><code>ReferenceError</code></li>
<li><code>SyntaxError</code></li>
<li><code>TypeError</code></li>
<li><code>URIError</code></li>
</ul>
<h4 id="414-window-对象"><a class="anchor" href="#414-window对象">#</a> 4.1.4 window 对象</h4>
<p>浏览器的全局对象</p>
<h3 id="42-math"><a class="anchor" href="#42-math">#</a> 4.2 Math</h3>
<p>数学方法</p>
<h4 id="421-math-对象属性"><a class="anchor" href="#421-math对象属性">#</a> 4.2.1 Math 对象属性</h4>
<ul>
<li><code>Math.E</code> ：e</li>
<li><code>Math.LN10</code> ：ln10</li>
<li><code>Math.LN2</code> ：ln2</li>
<li><code>Math.LOG2E</code> ：log_2^e</li>
<li><code>Math.LOG10E</code> ：lge</li>
<li><code>Math.PI</code> ：π</li>
<li><code>Math.SQRT1_2</code> ：根号（1/2）</li>
<li><code>Math.SQRT2</code> ：根号 2</li>
</ul>
<h4 id="422-min-和-max-方法"><a class="anchor" href="#422-min和max方法">#</a> 4.2.2 min () 和 max () 方法</h4>
<ul>
<li>
<p><code>Math.min()</code> ：取一串数字的最小值</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token function">min</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//1</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">let</span> a<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token function">min</span><span class="token punctuation">(</span><span class="token operator">...</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//3</span></pre></td></tr></table></figure></li>
<li>
<p><code>Math.max()</code> ：取一串数字的最大值</p>
</li>
</ul>
<h4 id="423-舍入方法"><a class="anchor" href="#423-舍入方法">#</a> 4.2.3 舍入方法</h4>
<ul>
<li><code>Math.ceil()</code> ：向上取整</li>
<li><code>Math.floor()</code> ：向下取整</li>
<li><code>Math.round()</code> ：四舍五入</li>
<li><code>Math.fround()</code> ：返回数值最接近的单精度<strong>浮点</strong></li>
</ul>
<h4 id="424-random-方法"><a class="anchor" href="#424-random方法">#</a> 4.2.4 random () 方法</h4>
<ul>
<li><code>Math.random()</code> ：返回 0-1 的随机数</li>
</ul>
<h4 id="425-其他方法"><a class="anchor" href="#425-其他方法">#</a> 4.2.5 其他方法</h4>
<p>略</p>
<h1 id="六-集合引用类型"><a class="anchor" href="#六-集合引用类型">#</a> 六、 集合引用类型</h1>
<h2 id="1-object"><a class="anchor" href="#1-object">#</a> 1. Object</h2>
<p>虽然 Object 的实例没多少功能，但很适合<strong>存储</strong>和在应用程序间<strong>交换数据</strong></p>
<p>创建方法：</p>
<ul>
<li>
<p>显示创建</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">let</span> person<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>person<span class="token punctuation">.</span>name<span class="token operator">=</span><span class="token string">"jake"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>person<span class="token punctuation">.</span>age<span class="token operator">=</span><span class="token number">26</span><span class="token punctuation">;</span></pre></td></tr></table></figure></li>
<li>
<p>对象字面量</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">let</span> person<span class="token operator">=</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    name<span class="token operator">:</span><span class="token string">"jake"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    age<span class="token operator">:</span><span class="token number">26</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token number">5</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token string">"name2"</span><span class="token operator">:</span><span class="token string">"joker"</span>	</pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token comment">// 属性名可以是数字或字符串</span></pre></td></tr></table></figure><p>实际上<strong>属性</strong>会自动转为字符串</p>
</li>
<li>
<p>也可以直接这样创建</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">let</span> person<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token comment">// 等效于 let person=new Object ();</span></pre></td></tr><tr><td data-num="2"></td><td><pre>person<span class="token punctuation">.</span>name<span class="token operator">=</span><span class="token string">"jake"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>person<span class="token punctuation">.</span>age<span class="token operator">=</span><span class="token number">26</span><span class="token punctuation">;</span></pre></td></tr></table></figure></li>
</ul>
<p><strong>调用属性</strong>： <code>person.name</code>  或 <code>person[&quot;name&quot;]</code> 。</p>
<p>例：</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">let</span> person<span class="token operator">=</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    name<span class="token operator">:</span><span class="token string">"jake"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    age<span class="token operator">:</span><span class="token number">26</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token number">5</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token string">"name2"</span><span class="token operator">:</span><span class="token string">"joker"</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token comment">// 属性名可以是数字或字符串</span></pre></td></tr><tr><td data-num="7"></td><td><pre>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>person<span class="token punctuation">.</span>name<span class="token punctuation">,</span>person<span class="token punctuation">.</span>name2<span class="token punctuation">,</span>person<span class="token punctuation">[</span><span class="token string">"5"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>person<span class="token punctuation">[</span><span class="token string">"age"</span><span class="token punctuation">]</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token comment">//jake joker true 26</span></pre></td></tr></table></figure><ul>
<li><strong>数值属性</strong>只能用中括号 <code>[]</code>  如 <code>person[&quot;5&quot;]</code></li>
<li>如果属性字符串有<strong>空格</strong>，也只能用中括号 <code>[]</code></li>
<li>通常用<strong>点语法</strong> <code>person.name</code>  比较多，但中括号 <code>person[&quot;name&quot;]</code>  适用性更广</li>
</ul>
<h2 id="2-array"><a class="anchor" href="#2-array">#</a> 2. Array</h2>
<p>JavaScript 的数组可以存储不同类型的数据</p>
<h3 id="21-创建数组from-of"><a class="anchor" href="#21-创建数组from-of">#</a> 2.1 创建数组：from、of</h3>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">var</span> cars<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Array</span><span class="token punctuation">(</span><span class="token string">"Saab"</span><span class="token punctuation">,</span><span class="token string">"Volvo"</span><span class="token punctuation">,</span><span class="token string">"BMW"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 指定初始值的数组</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">var</span> cars<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Array</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 初始长度为 3 的数组</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">var</span> cars<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">"Saab"</span><span class="token punctuation">,</span><span class="token string">"Volvo"</span><span class="token punctuation">,</span><span class="token string">"BMW"</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">var</span> cars<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token comment">// 这样写也是合法的</span></pre></td></tr></table></figure><p>在使用 <code>Array</code>  构造数组时， <code>new</code>  也可以省略，如下</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">var</span> cars<span class="token operator">=</span><span class="token function">Array</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p>&lt;font color=red&gt; 使用<strong>数组字面量</strong>创建数组不会调用 <code>Array</code>  构造函数 &lt;/font&gt;</p>
<p>Array 还有 ES6 新增的用于创建数组的静态方法 <code>from()</code>  和 <code>of()</code></p>
<h4 id="211-arrayfrom"><a class="anchor" href="#211-arrayfrom">#</a> 2.1.1 Array.from()</h4>
<p>将<strong>类数组结构</strong>转为数组实例</p>
<ul>
<li>
<p>转换字符串</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">let</span> sArr<span class="token operator">=</span>Array<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"matt"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//["m","a","t","t"]</span></pre></td></tr></table></figure></li>
<li>
<p>转换 <code>map</code></p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">let</span> map<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Map<span class="token punctuation">.</span>set</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//[[1,2],[3,4]]</span></pre></td></tr></table></figure></li>
<li>
<p>转换 <code>set</code></p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">let</span> set<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Set</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//[1,2,3]</span></pre></td></tr></table></figure></li>
<li>
<p>复制数组</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">let</span> arr<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">let</span> arr2<span class="token operator">=</span>Array<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>arr<span class="token operator">===</span>arr2<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//false</span></pre></td></tr></table></figure></li>
<li>
<p>也可以转对象，但条件比较苛刻</p>
<ul>
<li>属性要对应索引</li>
<li>得有 <code>length</code>  属性</li>
</ul>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">let</span> a1<span class="token operator">=</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token number">0</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token number">1</span><span class="token operator">:</span><span class="token number">2</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token number">2</span><span class="token operator">:</span><span class="token number">3</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    length<span class="token operator">:</span><span class="token number">3</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>Array<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span>a1<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//[1,2,3]</span></pre></td></tr></table></figure></li>
</ul>
<p>此外， <code>Array.from()</code>  还有<strong>第二个参数</strong>，作用类似 <code>Array.from().map()</code></p>
<p>例：</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">const</span> a1<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>Array<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span>a1<span class="token punctuation">,</span><span class="token parameter">x</span><span class="token operator">=></span>x<span class="token operator">*</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//[ 2, 4, 6 ]</span></pre></td></tr><tr><td data-num="3"></td><td><pre>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>Array<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span>a1<span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">x</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token keyword">return</span> x<span class="token operator">*</span><span class="token number">3</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//[ 3, 6, 9 ]</span></pre></td></tr></table></figure><h4 id="212-arrayof"><a class="anchor" href="#212-arrayof">#</a> 2.1.2 Array.of()</h4>
<p>将<strong>一组参数</strong>转换为数组实例</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">let</span> a<span class="token operator">=</span>Array<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//[1,2,3]</span></pre></td></tr></table></figure><h3 id="22-数组空位"><a class="anchor" href="#22-数组空位">#</a> 2.2 数组空位</h3>
<p>使用<strong>数组字面量</strong>初始化数组时，可以用一串逗号来创建<strong>空位</strong>，如下</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">const</span> arr<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">,</span><span class="token punctuation">,</span><span class="token punctuation">,</span><span class="token punctuation">,</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token comment">// 创建包含 5 个元素的数组 3</span></pre></td></tr><tr><td data-num="2"></td><td><pre>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>arr<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//5</span></pre></td></tr></table></figure><p>ES6 把逗号所占空位值为 <code>undefined</code></p>
<p>ES6 之前的方法会忽略这个空位，如 <code>map</code>  会跳过这些空位</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">const</span> arr<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token punctuation">,</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>arr<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=></span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//[1,undefined,undefined,undefined,5]</span></pre></td></tr></table></figure><p>（所以是不是尽量别用吧）</p>
<h3 id="23-数组索引"><a class="anchor" href="#23-数组索引">#</a> 2.3 数组索引</h3>
<p>提几点：</p>
<ul>
<li>
<p>通过修改数组的 <code>length</code>  属性，可以从数组末尾<strong>删除</strong>或<strong>添加</strong>元素</p>
<ul>
<li>
<p>删除：</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">const</span> arr<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>arr<span class="token punctuation">.</span>length<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>arr<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//undefined</span></pre></td></tr><tr><td data-num="4"></td><td><pre>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//[1,2]</span></pre></td></tr></table></figure></li>
<li>
<p>添加：</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">const</span> arr<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>arr<span class="token punctuation">[</span>arr<span class="token punctuation">.</span>length<span class="token punctuation">]</span><span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>arr<span class="token punctuation">[</span>arr<span class="token punctuation">.</span>length<span class="token punctuation">]</span><span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//[1,2,3,4,5]</span></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
<h3 id="24-检测数组isarray"><a class="anchor" href="#24-检测数组isarray">#</a> 2.4 检测数组：isArray</h3>
<p>2 种方法： <code>instanceof</code>  和 <code>Array.isArray()</code></p>
<ul>
<li><code>arr instanceof Array</code> ：有局限。多个框架有多个全局上下文，可能有多个<strong>不同版本的 <code>Array</code> </strong>。即可能别人的框架<strong>重写</strong>过 <code>Array</code> ，这样就不灵了</li>
<li><code>Array.isArray(arr)</code> ：不管哪个全局上下文创建的，就是确定是不是数组</li>
</ul>
<p>&lt;font color=red&gt; 推荐使用 <code>Array.isArray()</code> &lt;/font&gt;</p>
<h3 id="25-迭代器方法keys-value-entries"><a class="anchor" href="#25-迭代器方法keys-value-entries">#</a> 2.5 迭代器方法：keys、value、entries</h3>
<p>设 <code>list</code>  是 <code>Array</code>  的实例</p>
<ul>
<li><code>list.keys()</code> ：返回数组索引</li>
<li><code>list.values()</code> ：返回数组所有值</li>
<li><code>list.entries()</code> ：返回数组 <code>[index,value]</code>  的数组（二维数组）</li>
</ul>
<h3 id="26-复制和填充方法fill-copywithin"><a class="anchor" href="#26-复制和填充方法fill-copywithin">#</a> 2.6 复制和填充方法：fill、copyWithin</h3>
<p>设 <code>list</code>  是 <code>Array</code>  的实例</p>
<ul>
<li>
<p><code>list.fill()</code> ：以固定值批量填充数组元素</p>
<ul>
<li>参数 1：value，用于填充的值</li>
<li>参数 2-3：开始索引，结束索引，允许接收负数</li>
</ul>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">let</span> list<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Array</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">fill</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//[0,0,0,0,0]</span></pre></td></tr><tr><td data-num="2"></td><td><pre>list<span class="token punctuation">.</span><span class="token function">fill</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//[5,5,5,5,5]</span></pre></td></tr><tr><td data-num="3"></td><td><pre>list<span class="token punctuation">.</span><span class="token function">fill</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//[5,5,0,0,5]</span></pre></td></tr></table></figure></li>
<li>
<p><code>list.copyWithin(index1,index2,index3)</code> ：复制 <code>index2-index3</code>  的内容<strong>拷贝覆盖</strong>到 <code>index1</code>  的位置，数组长度不变（怎么会有这么无聊的函数）</p>
<ul>
<li>参数 1：index1，必选，填充的位置</li>
<li>参数 2：index2，可选，默认为 0。复制 index2 开始的内容</li>
<li>参数 3：index3，可选，默认为 length-1。复制 index2 开始 index3 结束的内容</li>
</ul>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">let</span> list<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">,</span><span class="token number">9</span><span class="token punctuation">]</span></pre></td></tr><tr><td data-num="2"></td><td><pre>list<span class="token punctuation">.</span><span class="token function">copyWithin</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//[0,1,2,3,4,0,1,2,3,4] 把 0 开始的内容填充到 index=5 处</span></pre></td></tr><tr><td data-num="3"></td><td><pre>list<span class="token punctuation">.</span><span class="token function">copyWithin</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//[5,6,7,8,9,5,6,7,8,9] 把 5 开始的内容填充到 index=0 处</span></pre></td></tr><tr><td data-num="4"></td><td><pre>list<span class="token punctuation">.</span><span class="token function">copyWithin</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//[0,1,2,0,1,2,7,8,9] 把 index=0-3 的内容拷贝到 index=4 处</span></pre></td></tr></table></figure></li>
</ul>
<h3 id="27-转换方法tolocalestring-tostring-valueof-join"><a class="anchor" href="#27-转换方法tolocalestring-tostring-valueof-join">#</a> 2.7 转换方法：toLocaleString、toString、valueOf、join</h3>
<p>设 <code>list</code>  是 <code>Array</code>  的实例</p>
<ul>
<li>
<p><code>list.toString()</code> ：返回数组的字符串表示（以逗号分隔）。其实是对数组的每个值调用 <code>toString</code> （对于 null 和 undefined 则是直接返回<strong>空字符串</strong>）</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//1,2,3,4,5</span></pre></td></tr></table></figure></li>
<li>
<p><code>list.valueOf()</code> ：以数组形式返回所有值（其实和 values 差不多吧，实践出来和书上描述的不一样）</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//[1,2,3,4,5] 并且值也都是 number</span></pre></td></tr></table></figure></li>
<li>
<p><code>list.toLocaleString()</code> ：和 <code>toString</code>  差不多，但 <code>console.log</code>  和 <code>alert</code>  输出 <code>object</code>  对象是输出的 <code>toString</code>  值，而非 <code>toLocaleString</code></p>
</li>
<li>
<p><code>list.join(str)</code> ：以 <code>str</code>  为分隔符拼接数组为字符串，不填默认为 <code>','</code>  分隔</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//1,2,3</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//123</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token punctuation">.</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">'-'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//1-2-3</span></pre></td></tr></table></figure></li>
</ul>
<h3 id="28-栈方法push-pop"><a class="anchor" href="#28-栈方法push-pop">#</a> 2.8 栈方法：push、pop</h3>
<p>设 <code>list</code>  是 <code>Array</code>  的实例</p>
<ul>
<li><code>list.push(item)</code> ：尾部插入一个元素</li>
<li><code>list.pop()</code> ：删除尾部元素。返回该元素</li>
</ul>
<h3 id="29-队列方法shift-unshift"><a class="anchor" href="#29-队列方法shift-unshift">#</a> 2.9 队列方法：shift、unshift</h3>
<p>设 <code>list</code>  是 <code>Array</code>  的实例</p>
<ul>
<li><code>list.unshift(item)</code> ：头部插入一个元素</li>
<li><code>list.shift()</code> ：头部删除一个元素。返回该元素</li>
</ul>
<h3 id="210-排序方法sort-reverse"><a class="anchor" href="#210-排序方法sort-reverse">#</a> 2.10 排序方法：sort、reverse</h3>
<p>设 <code>list</code>  是 <code>Array</code>  的实例</p>
<ul>
<li>
<p><code>list.reverse()</code> ：反转数组</p>
</li>
<li>
<p><code>list.sort()</code> ：对数组排序</p>
<ul>
<li>
<p>参数 1：回调函数，可选。不写默认按<strong>字典序</strong>排序</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">// 如下是个升序函数</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">function</span> <span class="token function">compare</span><span class="token punctuation">(</span><span class="token parameter">value1<span class="token punctuation">,</span>value2</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token keyword">if</span><span class="token punctuation">(</span>value1<span class="token operator">&lt;</span>value2<span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>        <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span><span class="token comment">// 不一定是 - 1，负数即可</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token punctuation">&#125;</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>value1<span class="token operator">></span>value2<span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>        <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>        <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token comment">// 简化版</span></pre></td></tr><tr><td data-num="12"></td><td><pre>list<span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span>b</span><span class="token punctuation">)</span><span class="token operator">=></span>a<span class="token operator">-</span>b<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
<h3 id="211-操作方法concat-slice-splice"><a class="anchor" href="#211-操作方法concat-slice-splice">#</a> 2.11 操作方法：concat、slice、splice</h3>
<p>设 <code>list</code>  是 <code>Array</code>  的实例</p>
<ul>
<li>
<p><code>list.concat(...args)</code> ：拼接多个数组，但不会改变原数组，而是把新数组作为返回内容</p>
<ul>
<li>
<p>arg：被拼接的数组 / 元素。数组会自动调用 <code>...</code>  转为多个 <code>item</code></p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">let</span> color<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">let</span> newColor<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>color<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//[ 1, 2, 3 ]</span></pre></td></tr><tr><td data-num="4"></td><td><pre>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>color<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span>newColor<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//[ 1, 2, 3, 4, 5, 6 ]</span></pre></td></tr></table></figure></li>
<li>
<p>数组打平由一个标签属性 <code>[Symbol.isConcatSpreadable]</code>  控制， <code>true</code>  时 <code>concat</code>  会强制打平， <code>false</code>  则不会</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">let</span> color<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">let</span> newColor<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>newColor<span class="token punctuation">[</span>Symbol<span class="token punctuation">.</span>isConcatSpreadable<span class="token punctuation">]</span><span class="token operator">=</span><span class="token boolean">false</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>color<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span>newColor<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//[ 1, 2, 3, 4, [ 5, 6, [Symbol(Symbol.isConcatSpreadable)]: false ] ]</span></pre></td></tr></table></figure><p>感觉好像稀奇古怪的，不知道为什么会这样，和书上结果不一样</p>
</li>
</ul>
</li>
<li>
<p><code>list.slice()</code> ：按索引截取<strong>拷贝</strong>数组（左闭右开），不会修改原数组。</p>
<ul>
<li>参数 1：可选，开始索引，默认为 0。可以是负数</li>
<li>参数 2：可选，结束索引，默认为 length。可以是负数</li>
</ul>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">let</span> list<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">]</span></pre></td></tr><tr><td data-num="2"></td><td><pre>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>list<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//[ 1, 2, 3, 4, 5 ]</span></pre></td></tr><tr><td data-num="3"></td><td><pre>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>list<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//[ 2, 3 ]</span></pre></td></tr><tr><td data-num="4"></td><td><pre>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>list<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//[ 5 ]</span></pre></td></tr><tr><td data-num="5"></td><td><pre>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>list<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//[ 2, 3, 4 ]</span></pre></td></tr></table></figure></li>
<li>
<p><code>list.splice(idx,deleteCount,items)</code> ：删除、插入、替换数组内容</p>
<ul>
<li>
<p>插入</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">var</span> fruits <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"Banana"</span><span class="token punctuation">,</span> <span class="token string">"Orange"</span><span class="token punctuation">,</span> <span class="token string">"Apple"</span><span class="token punctuation">,</span> <span class="token string">"Mango"</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>fruits<span class="token punctuation">.</span><span class="token function">splice</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token string">"Lemon"</span><span class="token punctuation">,</span><span class="token string">"Kiwi"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//Banana,Orange,Lemon,Kiwi,Apple,Mango</span></pre></td></tr></table></figure></li>
<li>
<p>删除</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre>fruits<span class="token punctuation">.</span><span class="token function">splice</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//Banana,Orange,Mango</span></pre></td></tr></table></figure></li>
<li>
<p>替换</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre>fruits<span class="token punctuation">.</span><span class="token function">splice</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"Kiwi"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//Banana,Orange,Kiwi,Mango</span></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
<h3 id="212-搜索和位置方法indexof-lastindexof-includesfind-findindex"><a class="anchor" href="#212-搜索和位置方法indexof-lastindexof-includesfind-findindex">#</a> 2.12 搜索和位置方法：indexOf、lastIndexOf、includes|find、findIndex</h3>
<p>设 <code>list</code>  是 <code>Array</code>  的实例</p>
<p><strong>严格相等</strong>：indexOf、lastIndexOf、includes 均是严格相等的搜索方法，也就是 <code>===</code>  号比较的</p>
<ul>
<li>
<p><code>list.indexOf(item,startIdx)</code> ：查找 <code>item</code>  在数组中<strong>第一次</strong>出现的位置，没有则返回 - 1</p>
<ul>
<li><code>item</code> ：待查找元素</li>
<li><code>startIdx</code> ：开始查找的位置</li>
</ul>
</li>
<li>
<p><code>list.lastIndexOf(item,startIdx)</code> ：查找 <code>item</code>  在数组中<strong>最后一次</strong>出现的位置，没有则返回 - 1</p>
</li>
<li>
<p><code>list.includes(item,startIdx)</code> ：从头开始查找，如果数组中有 <code>item</code> ，则返回 <code>true</code> 。</p>
<p><code>includes</code>  效率比 <code>indexOf</code>  高很多</p>
</li>
</ul>
<p><strong>断言函数</strong>：find、findIndex。断言函数指的是返回值为<strong>布尔类型</strong>的函数</p>
<ul>
<li><code>list.find(func)</code> ：接收个函数，返回满足函数要求的<strong>第一个元素</strong>
<ul>
<li><code>func</code> ：函数接收 3 个参数，element、index、array
<ul>
<li><code>element</code> ：元素</li>
<li><code>index</code> ：索引</li>
<li><code>array</code> ：该数组</li>
</ul>
</li>
</ul>
</li>
<li><code>list.findIndex(func)</code> ：接收个函数，返回满足函数要求的<strong>第一个元素的索引</strong></li>
</ul>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">const</span> people<span class="token operator">=</span><span class="token punctuation">[</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>        name<span class="token operator">:</span> <span class="token string">'Matt'</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="4"></td><td><pre>        age<span class="token operator">:</span> <span class="token number">27</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>        name<span class="token operator">:</span> <span class="token string">'Nicho'</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="8"></td><td><pre>        age<span class="token operator">:</span><span class="token number">29</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token punctuation">]</span></pre></td></tr><tr><td data-num="11"></td><td><pre></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token keyword">let</span> person<span class="token operator">=</span>people<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">element<span class="token punctuation">,</span>index<span class="token punctuation">,</span>array</span><span class="token punctuation">)</span><span class="token operator">=></span>element<span class="token punctuation">.</span>age<span class="token operator">&lt;</span><span class="token number">28</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//&#123;name:"Matt",age:27&#125;</span></pre></td></tr></table></figure><p>再一个例子</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">const</span> events<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre>events<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">element<span class="token punctuation">,</span>index<span class="token punctuation">,</span>array</span><span class="token punctuation">)</span><span class="token operator">=></span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>element<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>array<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token keyword">return</span> element<span class="token operator">===</span><span class="token number">4</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//`find` 会遍历数组，在找到目标后就停下</span></pre></td></tr></table></figure><p>控制台输出：<img data-src="/2022/01/14/note/%E5%89%8D%E7%AB%AF/js%E9%AB%98%E7%BA%A7%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1/image-20220420194352718.png" alt="image-20220420194352718"></p>
<h3 id="213-迭代方法every-filter-foreach-map-some"><a class="anchor" href="#213-迭代方法every-filter-foreach-map-some">#</a> 2.13 迭代方法：every、filter、forEach、map、some</h3>
<p>设 <code>list</code>  是 <code>Array</code>  的实例</p>
<p>这几个迭代方法有一些共同的特性：</p>
<ul>
<li>
<p>每个方法接收 2 个参数</p>
<ul>
<li>
<p>参数 1：定义遍历方法的函数。该函数有 3 个参数，，element、index、array</p>
<ul>
<li><code>element</code> ：元素</li>
<li><code>index</code> ：索引</li>
<li><code>array</code> ：该数组</li>
</ul>
<p>可见，这一块和 <code>.find()</code>  差不多</p>
</li>
<li>
<p>参数 2（可选）：该函数运行上下文的作用域（影响函数的 <code>this</code> ）</p>
</li>
</ul>
</li>
<li>
<p><code>list.every(func)</code> ：对数组每一项都执行 <code>func</code> ，如果<strong>全都</strong>返回 <code>true</code> ，则该方法返回 <code>true</code></p>
</li>
<li>
<p><code>list.some(func)</code> ：对数组每一项都执行 <code>func</code> ，如果<strong>有一项</strong>返回 <code>true</code> ，则该方法返回 <code>true</code></p>
</li>
<li>
<p><code>list.filter(func)</code> ：过滤器。对每一项执行 <code>func</code> ，把返回 <code>true</code>  那几项过滤出来形成新数组返回。<strong>不改变原数组</strong></p>
</li>
<li>
<p><code>list.forEach(func)</code> ：对每一项都运行 <code>func</code> ，没有返回值。（可以用来批量处理数组元素）</p>
</li>
<li>
<p><code>list.map(func)</code> ：对每一项都运行 <code>func</code> ，返回由 <code>func</code>  返回值组成的数组。（和 <code>forEach</code>  的区别是有返回值）</p>
</li>
</ul>
<h3 id="214-归并方法reduce-reduceright"><a class="anchor" href="#214-归并方法reduce-reduceright">#</a> 2.14 归并方法：reduce、reduceRight</h3>
<p>设 <code>list</code>  是 <code>Array</code>  的实例</p>
<p>这 2 个方法都会迭代数组所有项，并在此基础上构建返回一个最终值</p>
<ul>
<li><code>list.reduce(mergeFun)</code> ：从数组第一项开始遍历到最后一项，
<ul>
<li><code>mergeFun</code> ：归并函数
<ul>
<li><code>prev</code> ：上一个归并值</li>
<li><code>cur</code> ：当前项</li>
<li><code>index</code> ：当前索引</li>
<li><code>array</code> ：数组本身</li>
</ul>
</li>
<li><code>return</code> ： <code>mergeFun</code>  的最终返回值</li>
</ul>
</li>
<li><code>list.reduceRight(mergeFun)</code> ：从数组最后一项开始遍历到第一项，</li>
</ul>
<p>如下，可以用来做一个求和函数</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">let</span> list<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">,</span><span class="token number">9</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">let</span> sum<span class="token operator">=</span>list<span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">prev<span class="token punctuation">,</span>cur</span><span class="token punctuation">)</span><span class="token operator">=></span>prev<span class="token operator">+</span>cur<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//45</span></pre></td></tr></table></figure><p>这是一个<strong>链式</strong>函数，不仅可以用来累加，也可以实现别的串联相关的方法</p>
<h2 id="3-定型数组暂缓"><a class="anchor" href="#3-定型数组暂缓">#</a> 3. 定型数组（暂缓）</h2>
<p>这章挺复杂的，暂时好像也用不太到，先缓缓以后再看</p>
<h3 id="31-arraybuffer"><a class="anchor" href="#31-arraybuffer">#</a> 3.1 ArrayBuffer</h3>
<p>差不多就是个不能改变长度的数组</p>
<h2 id="4-map"><a class="anchor" href="#4-map">#</a> 4. Map</h2>
<p>终于到这一章了</p>
<h3 id="41-基本用法及-api"><a class="anchor" href="#41-基本用法及api">#</a> 4.1 基本用法及 API</h3>
<ul>
<li>
<p>创建： <code>new Map()</code></p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">let</span> map<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Map</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token comment">// 或者</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">let</span> map<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Map</span><span class="token punctuation">(</span><span class="token punctuation">[</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token punctuation">[</span><span class="token string">'key1'</span><span class="token punctuation">,</span><span class="token string">'val1'</span><span class="token punctuation">]</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token punctuation">[</span><span class="token string">'key2'</span><span class="token punctuation">,</span><span class="token string">'val2'</span><span class="token punctuation">]</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token punctuation">[</span><span class="token string">'key3'</span><span class="token punctuation">,</span><span class="token string">'val3'</span><span class="token punctuation">]</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token punctuation">]</span><span class="token punctuation">)</span></pre></td></tr></table></figure></li>
<li>
<p>添加： <code>map.set(key,value)</code></p>
<p><code>set</code>  可以串联，如 <code>map.set(k1,vl).set(k2,v2)</code> ；</p>
<p>也可以在初始化时插入，如 <code>new Map().set(k,v)</code></p>
</li>
<li>
<p>是否存在： <code>map.has(key)</code></p>
</li>
<li>
<p>查找： <code>map.get(key)</code></p>
</li>
<li>
<p>删除： <code>map.delete(key)</code></p>
</li>
<li>
<p>清空： <code>map.clear()</code></p>
</li>
<li>
<p>返回长度： <code>map.size</code></p>
</li>
</ul>
<h3 id="42-顺序与迭代keys-values-entries"><a class="anchor" href="#42-顺序与迭代keys-values-entries">#</a> 4.2 顺序与迭代：keys、values、entries</h3>
<p>迭代顺序和插入顺序一致</p>
<ul>
<li>遍历键： <code>map.keys()</code></li>
<li>遍历值： <code>map.values()</code></li>
<li>遍历键值对： <code>map.entries()</code></li>
</ul>
<h3 id="43-与-object-的区别"><a class="anchor" href="#43-与object的区别">#</a> 4.3 与 Object 的区别</h3>
<ul>
<li>
<p>功能方面：语法那些就不过多赘述了</p>
<ul>
<li>关于键的类型：
<ul>
<li><code>Object</code>  的键以字符串存储，所有变量都会转成字符串，因此不能同时以 <code>'1'和1</code>  作为键，会被覆盖</li>
<li><code>Map</code>  则可以存<strong>任何类型</strong>的键，且按严格模式 <code>===</code>  匹配键值对</li>
</ul>
</li>
<li>关于迭代顺序：
<ul>
<li><code>Object</code> ：按键的字典序</li>
<li><code>Map</code> ：按插入顺序</li>
</ul>
</li>
</ul>
</li>
<li>
<p>性能方面：</p>
<ul>
<li>
<p>内存占用： <code>Map</code>  优。相同内存，map 大约可以比 object 多存储 50% 键值对</p>
</li>
<li>
<p>插入性能： <code>Map</code>  优。</p>
</li>
<li>
<p>查找速度： <code>Object</code>  稍优。特别是连续整数为属性，浏览器会对其进行优化</p>
</li>
<li>
<p>删除性能： <code>Map</code>  优。且更优雅</p>
</li>
</ul>
</li>
</ul>
<p>综上，如果用来做表，还是选用 <code>Map</code>  更合适</p>
<h2 id="5-weakmap-暂缓"><a class="anchor" href="#5-weakmap暂缓">#</a> 5. WeakMap (暂缓)</h2>
<p>弱化版 Map，也没看懂这东西有啥用</p>
<h2 id="6-set"><a class="anchor" href="#6-set">#</a> 6. Set</h2>
<p>应该是 Map 改的，底层应该和 Map 差不多</p>
<h3 id="61-基本用法及-api"><a class="anchor" href="#61-基本用法及api">#</a> 6.1 基本用法及 API</h3>
<ul>
<li>
<p>创建： <code>new Set()</code></p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">let</span> set<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Set</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token comment">// 或者</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">let</span> set<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Set</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4.4</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure></li>
<li>
<p>添加： <code>set.add(key)</code></p>
<p><code>add</code>  可以串联，如 <code>set.add(k1).add(k2)</code> ；</p>
<p>也可以在初始化时插入，如 <code>new Set().add(k)</code></p>
</li>
<li>
<p>是否存在： <code>set.has(key)</code></p>
</li>
<li>
<p>删除： <code>set.delete(key)</code></p>
</li>
<li>
<p>清空： <code>set.clear()</code></p>
</li>
<li>
<p>返回长度： <code>set.size</code></p>
</li>
</ul>
<h3 id="62-顺序与迭代keys-values-entries"><a class="anchor" href="#62-顺序与迭代keys-values-entries">#</a> 6.2 顺序与迭代：keys、values、entries</h3>
<p>迭代顺序和插入顺序一致</p>
<ul>
<li>遍历键： <code>map.keys()</code></li>
<li>遍历值： <code>map.values()</code></li>
<li>遍历键值对： <code>map.entries()</code></li>
</ul>
<p>不过 set 中的值和键是一样的</p>
<h3 id="63-定义类-set-类型暂缓"><a class="anchor" href="#63-定义类set类型暂缓">#</a> 6.3 定义类 Set 类型（暂缓）</h3>
<p>...</p>
<h2 id="7-weakset暂缓"><a class="anchor" href="#7-weakset暂缓">#</a> 7. WeakSet（暂缓）</h2>
<p>和 WeakMap 一样，是个弱化的 Set，也是不知道有什么用</p>
<h1 id="八-对象-类与面向对象编程"><a class="anchor" href="#八-对象-类与面向对象编程">#</a> 八、 对象、类与面向对象编程</h1>
<p>ECMA-262 把对象定义为一组属性的无序集合。即可以把 ECMAScript 的对象想象成一张<strong>散列表</strong>，其中的内容就是一组键值对，值可以是<strong>数据</strong>或<strong>函数</strong>。</p>
<h2 id="1-理解对象实例"><a class="anchor" href="#1-理解对象实例">#</a> 1. 理解对象（实例）</h2>
<p>创建自定义通常是先创建一个 <code>Object</code>  对象，然后添加属性和方法，如下</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">let</span> person<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>person<span class="token punctuation">.</span>name<span class="token operator">=</span><span class="token string">"joker"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>person<span class="token punctuation">.</span>age<span class="token operator">=</span><span class="token number">29</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>person<span class="token punctuation">.</span><span class="token function-variable function">sayName</span><span class="token operator">=</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p>但现在更流行直接使用<strong>对象字面量</strong>的形式，即大括号 <code>&#123;&#125;</code></p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">let</span> person<span class="token operator">=</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    name<span class="token operator">:</span><span class="token string">"joker"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    age<span class="token operator">:</span><span class="token number">29</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token function-variable function">sayName</span><span class="token operator">:</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token comment">// 函数也可以直接像这样定义</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token function">sayAge</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>age<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr></table></figure><h3 id="11-属性的类型"><a class="anchor" href="#11-属性的类型">#</a> 1.1 属性的类型</h3>
<p>属性分类 2 种：<strong>数据属性</strong>和<strong>访问器属性</strong></p>
<h4 id="111-数据属性"><a class="anchor" href="#111-数据属性">#</a> 1.1.1 数据属性</h4>
<p>数据属性包含一个<strong>保存数据值</strong>的位置。</p>
<p>数据属性的 4 个<strong>特性</strong>：</p>
<ul>
<li><code>[[configurable]]</code> ：表示属性是否可通过 <code>delete</code>  删除并重定义，是否可修改特性，以及是否可改为<strong>访问器属性</strong>。默认为 <code>true</code> ， <code>false</code>  表示<strong>不可删除</strong>
<ul>
<li>在把 <code>configurable</code>  设为 <code>false</code>  后，再次调用 <code>Object.defineProperty</code>  修改非 <code>writable</code>  特性会报错</li>
</ul>
</li>
<li><code>[[enumberable]]</code> ：表示属性是否可以通过 <code>for-in</code>  循环返回。默认为 <code>true</code></li>
<li><code>[[writable]]</code> ：表示属性的值是否可被修改。默认为 <code>true</code> ， <code>false</code>  表示<strong>只读</strong></li>
<li><code>[[value]]</code> ：包含属性实际的值。默认为 <code>undefined</code></li>
</ul>
<p>当属性被显式地添加到对象后，Configurable、Enumberable、Writable 都被设为 <code>true</code> ，Value 被设为指定的值</p>
<p><strong>默认特性</strong>通过 <code>Object.defineProperty()</code>  修改。</p>
<ul>
<li><code>Object.defineProperty()</code> ：修改对象的属性特性
<ul>
<li><code>object</code> ：待修改对象</li>
<li><code>propertyName</code> ：属性名（字符串）。</li>
<li>``：修改特性</li>
</ul>
</li>
</ul>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">let</span> person<span class="token operator">=</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    name<span class="token operator">:</span><span class="token string">"joker"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    age<span class="token operator">:</span><span class="token number">29</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token function">sayName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token comment">// 定义好了一个对象</span></pre></td></tr><tr><td data-num="8"></td><td><pre>Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>person<span class="token punctuation">,</span><span class="token string">"name"</span><span class="token punctuation">,</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    writable<span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token comment">// 表示只读</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    value<span class="token operator">:</span><span class="token string">"jake"</span></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 修改默认特性</span></pre></td></tr></table></figure><h4 id="112-访问器属性"><a class="anchor" href="#112-访问器属性">#</a> 1.1.2 访问器属性</h4>
<p>访问器属性不包含数据值，而是包含一个 get 函数和一个 set 函数（但不是必须的）</p>
<p>访问器属性也有 4 个<strong>特性</strong>：</p>
<ul>
<li><code>[[configurable]]</code> ：同<strong>数据属性</strong></li>
<li><code>[[enumberable]]</code> ：同<strong>数据属性</strong></li>
<li><code>[[get]]</code> ：获取函数，读取属性时调用。默认为 <code>undefined</code></li>
<li><code>[[set]]</code> ：设置函数，写入属性时调用。默认为 <code>undefined</code></li>
</ul>
<p>&lt;font color=red&gt; <code>get/set</code>  函数也可以直接在<strong>对象字面量</strong>定义，看 1.6.3&lt;/font&gt;</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">let</span> book<span class="token operator">=</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    year_<span class="token operator">:</span><span class="token number">2021</span><span class="token punctuation">,</span><span class="token comment">// 后面加下划线 "_" 表示不希望被直接访问（伪私有变量）</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    author<span class="token operator">:</span><span class="token string">"joker"</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>book<span class="token punctuation">.</span>year_<span class="token operator">=</span><span class="token number">2019</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>book<span class="token punctuation">.</span>year_<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//2019</span></pre></td></tr><tr><td data-num="7"></td><td><pre>Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>book<span class="token punctuation">,</span><span class="token string">"year_"</span><span class="token punctuation">,</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>year_<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="11"></td><td><pre>    <span class="token function">set</span><span class="token punctuation">(</span>newYear<span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="12"></td><td><pre>        <span class="token keyword">this</span><span class="token punctuation">.</span>year_<span class="token operator">=</span>newYear<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="13"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="15"></td><td><pre>book<span class="token punctuation">.</span>year<span class="token operator">=</span><span class="token number">2022</span></pre></td></tr><tr><td data-num="16"></td><td><pre>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>book<span class="token punctuation">.</span>year<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//2022</span></pre></td></tr><tr><td data-num="17"></td><td><pre>book<span class="token punctuation">.</span>year_<span class="token operator">=</span><span class="token number">2023</span><span class="token punctuation">;</span><span class="token comment">// 报错，RangeError: Maximum call stack size exceeded</span></pre></td></tr><tr><td data-num="18"></td><td><pre>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>book<span class="token punctuation">.</span>year_<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 报错，RangeError: Maximum call stack size exceeded</span></pre></td></tr></table></figure><p><strong>重点来了</strong></p>
<ol>
<li>本例中， <code>year_</code> 属性表示该变量不希望直接被外部访问
<ol>
<li>但实际上还是可以直接访问的，如第 5、6 行</li>
<li>在 <code>Object.defineProperty()</code>  设置 <code>get/set</code>  函数后，该属性就无法访问了（真正被封装变为<strong>私有变量</strong>了）</li>
</ol>
</li>
<li><code>Object.defineProperty()</code>  设置 <code>get/set</code>  函数后，生成了一个对应的 <code>year</code>  属性，即 <code>year_</code> 对应的<strong>访问器属性</strong>，可以被调用和设置值。
<ol>
<li><code>year</code>  属性相当于 <code>public</code>  的 <code>get/set</code>  函数</li>
<li><code>get</code>  函数： <code>book.year;</code> 。相当于 Java 的 <code>book.getYear();</code></li>
<li><code>set</code>  函数： <code>book.year=2022;</code> 。相当于 Java 的 <code>book.setYear(2022);</code></li>
<li>但实际上 <code>year</code>  不保存值，保存值的是 <code>year_</code> 这个数值属性</li>
</ol>
</li>
</ol>
<h3 id="12-定义多个属性"><a class="anchor" href="#12-定义多个属性">#</a> 1.2 定义多个属性</h3>
<ul>
<li><code>Object.defineProperties()</code>  可以同时定义 / 修改多个属性。</li>
</ul>
<p>如</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">let</span> book<span class="token operator">=</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    year_<span class="token operator">:</span><span class="token number">2021</span><span class="token punctuation">,</span><span class="token comment">// 后面加下划线 "_" 表示不希望被直接访问（伪私有变量）</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    author<span class="token operator">:</span><span class="token string">"joker"</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>book<span class="token punctuation">,</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    year_<span class="token operator">:</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>        value<span class="token operator">:</span><span class="token number">2017</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    author<span class="token operator">:</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>        value<span class="token operator">:</span><span class="token string">"king"</span></pre></td></tr><tr><td data-num="11"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><h3 id="13-读取属性的特性"><a class="anchor" href="#13-读取属性的特性">#</a> 1.3 读取属性的特性</h3>
<ul>
<li><code>Object.getOwnPropertyDescriptor()</code> ：获取对象属性的特性
<ul>
<li><code>object</code> ：对应的对象</li>
<li><code>propertyName</code> ：对象的属性名（字符串）</li>
</ul>
</li>
</ul>
<p>例</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">let</span> book<span class="token operator">=</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    year_<span class="token operator">:</span><span class="token number">2021</span><span class="token punctuation">,</span><span class="token comment">// 后面加下划线 "_" 表示不希望被直接访问（伪私有变量）</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    author<span class="token operator">:</span><span class="token string">"joker"</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">let</span> descriptor<span class="token operator">=</span>Object<span class="token punctuation">.</span><span class="token function">getOwnPropertyDescriptor</span><span class="token punctuation">(</span>book<span class="token punctuation">,</span><span class="token string">"year_"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>descriptor<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//2021</span></pre></td></tr><tr><td data-num="7"></td><td><pre>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>descriptor<span class="token punctuation">.</span>get<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//undefined</span></pre></td></tr></table></figure><p>ECMAScript 2017 新增了 <code>Object.getOwnPropertyDescriptors()</code> ，如下</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">let</span> descriptors<span class="token operator">=</span>Object<span class="token punctuation">.</span><span class="token function">getOwnPropertyDescriptors</span><span class="token punctuation">(</span>book<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>descriptors<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p><img data-src="/2022/01/14/note/%E5%89%8D%E7%AB%AF/js%E9%AB%98%E7%BA%A7%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1/image-20220124164024765.png" alt="image-20220124164024765"></p>
<h3 id="14-合并对象"><a class="anchor" href="#14-合并对象">#</a> 1.4 合并对象</h3>
<p>ES6 提供了 <code>Object.assign()</code>  方法。可以合并多个对象的属性。</p>
<ul>
<li>
<p><code>Object.assign()</code> ：将源对象（参数）的属性复制到目标对象（返回值）。</p>
<p>属性有以下要求：</p>
<ul>
<li>
<p>可枚举的。 <code>Object.propertyIsEnumerable()</code>  返回 <code>true</code></p>
</li>
<li>
<p>自由属性。 <code>Object.hasOwnProperty()</code>  返回 <code>true</code></p>
</li>
</ul>
</li>
</ul>
<p>其通过<strong>源对象</strong>的 <code>get</code>  取得属性的值，然后通过<strong>目标对象</strong>的 <code>set</code>  设置属性的值</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">let</span> dest<span class="token operator">=</span><span class="token punctuation">&#123;</span>cls<span class="token operator">:</span><span class="token string">"dest"</span><span class="token punctuation">,</span><span class="token function">idx</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"haha"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">let</span> src<span class="token operator">=</span><span class="token punctuation">&#123;</span>id<span class="token operator">:</span><span class="token string">"src"</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">let</span> s2<span class="token operator">=</span><span class="token punctuation">&#123;</span>aa<span class="token operator">:</span><span class="token string">'aaa'</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token keyword">let</span> result<span class="token operator">=</span>Object<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span>dest<span class="token punctuation">,</span>src<span class="token punctuation">,</span>s2<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//&#123; cls: 'dest', idx: [Function: idx], id: 'src', aa: 'aaa' &#125;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>dest<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//&#123; cls: 'dest', idx: [Function: idx], id: 'src', aa: 'aaa' &#125;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>src<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//&#123; id: 'src' &#125;</span></pre></td></tr></table></figure><p>另外， <code>Object.assign()</code>  有几点需要注意的：</p>
<ul>
<li>
<p>相同属性会被覆盖（按最后一个参数）</p>
</li>
<li>
<p>合并到<strong>第一个对象</strong>，也可以通过一个<strong>标识符</strong>来接收</p>
</li>
<li>
<p>不能回滚</p>
<p>解释一下，比如 <code>Object.assign(a1,a2,a3)</code>  在 <code>a2</code>  处发生了<strong>异常</strong>，抛出错误，那么已经完成的合并不会恢复， <code>a1</code>  已经是合并后的样子了</p>
</li>
</ul>
<h3 id="15-对象标识及相等判定"><a class="anchor" href="#15-对象标识及相等判定">#</a> 1.5 对象标识及相等判定</h3>
<p>ES6 新增了一个 <code>Object.is()</code>  判断 2 个对象是否相等。</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>Object<span class="token punctuation">.</span><span class="token function">is</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//false</span></pre></td></tr><tr><td data-num="2"></td><td><pre>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>Object<span class="token punctuation">.</span><span class="token function">is</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//false</span></pre></td></tr><tr><td data-num="3"></td><td><pre>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>Object<span class="token punctuation">.</span><span class="token function">is</span><span class="token punctuation">(</span><span class="token string">"2"</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//false</span></pre></td></tr><tr><td data-num="4"></td><td><pre>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>Object<span class="token punctuation">.</span><span class="token function">is</span><span class="token punctuation">(</span><span class="token operator">+</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//false</span></pre></td></tr><tr><td data-num="5"></td><td><pre>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>Object<span class="token punctuation">.</span><span class="token function">is</span><span class="token punctuation">(</span><span class="token operator">+</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//true</span></pre></td></tr><tr><td data-num="6"></td><td><pre>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>Object<span class="token punctuation">.</span><span class="token function">is</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//false</span></pre></td></tr><tr><td data-num="7"></td><td><pre>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>Object<span class="token punctuation">.</span><span class="token function">is</span><span class="token punctuation">(</span><span class="token number">NaN</span><span class="token punctuation">,</span><span class="token number">NaN</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//true</span></pre></td></tr></table></figure><p>这和 <code>===</code>  在一些判断规则上有些许不同</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token operator">===</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//false</span></pre></td></tr><tr><td data-num="2"></td><td><pre>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token operator">===</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//false</span></pre></td></tr><tr><td data-num="3"></td><td><pre>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"2"</span><span class="token operator">===</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//false</span></pre></td></tr><tr><td data-num="4"></td><td><pre>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token operator">+</span><span class="token number">0</span><span class="token operator">===</span><span class="token operator">-</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//true</span></pre></td></tr><tr><td data-num="5"></td><td><pre>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token operator">+</span><span class="token number">0</span><span class="token operator">===</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//true</span></pre></td></tr><tr><td data-num="6"></td><td><pre>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">0</span><span class="token operator">===</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//true</span></pre></td></tr><tr><td data-num="7"></td><td><pre>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">NaN</span><span class="token operator">===</span><span class="token number">NaN</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//false</span></pre></td></tr><tr><td data-num="8"></td><td><pre>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">isNaN</span><span class="token punctuation">(</span><span class="token number">NaN</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//false</span></pre></td></tr></table></figure><p>可以看出，</p>
<ul>
<li><code>===</code>  中正负 0 是一样的；但 <code>Object.is()</code>  只有 + 0 和 0 是相等的</li>
<li><code>===</code>  中 <code>NaN</code>  之间是不等的，只能用 <code>isNaN()</code> ；而 <code>Object.is()</code>  可以判等</li>
</ul>
<h3 id="16-增强的对象语法"><a class="anchor" href="#16-增强的对象语法">#</a> 1.6 增强的对象语法</h3>
<h4 id="161-属性值简写"><a class="anchor" href="#161-属性值简写">#</a> 1.6.1 属性值简写</h4>
<p>给对象添加变量时，可能会有属性名和变量名是一样的，如</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">let</span> name<span class="token operator">=</span><span class="token string">"joker"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">let</span> person<span class="token operator">=</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    name<span class="token operator">:</span>name</pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p>这时候可以直接简写为</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">let</span> name<span class="token operator">=</span><span class="token string">"joker"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">let</span> person<span class="token operator">=</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    name</pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p><code>name</code>  会被自动解释为同名的属性键，如果找不到同名变量，则会抛出 ReferenceError</p>
<hr>
<p>此外，对象会在不同作用域<strong>保留属性</strong>，以防找不到。如下</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">function</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token parameter">a1<span class="token punctuation">,</span>a2</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token keyword">let</span> ans<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span><span class="token comment">// 但最终局部临时变量不会被保存</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token keyword">return</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>        name<span class="token operator">:</span>a1<span class="token punctuation">,</span><span class="token comment">// 像这种属性会被保存</span></pre></td></tr><tr><td data-num="5"></td><td><pre>        a2</pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token keyword">let</span> t<span class="token operator">=</span><span class="token function">test</span><span class="token punctuation">(</span><span class="token string">"joker"</span><span class="token punctuation">,</span><span class="token string">"jake"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>t<span class="token punctuation">.</span>ans<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//undefined</span></pre></td></tr><tr><td data-num="11"></td><td><pre>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>t<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//joker</span></pre></td></tr><tr><td data-num="12"></td><td><pre>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>t<span class="token punctuation">.</span>a2<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//jake</span></pre></td></tr></table></figure><h4 id="162-可计算属性"><a class="anchor" href="#162-可计算属性">#</a> 1.6.2 可计算属性</h4>
<p><strong>可计算属性</strong>支持在对象字面量中使用<strong>变量</strong>定义属性，如下</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">let</span> nameKey<span class="token operator">=</span><span class="token string">"name"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">let</span> ageKey<span class="token operator">=</span><span class="token string">"age"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">function</span> <span class="token function">get</span><span class="token punctuation">(</span><span class="token parameter">arg</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token keyword">return</span> arg<span class="token operator">+</span><span class="token string">""</span><span class="token operator">+</span><span class="token string">"123"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token keyword">let</span> person<span class="token operator">=</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token punctuation">[</span>nameKey<span class="token punctuation">]</span><span class="token operator">:</span><span class="token string">"joker"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token punctuation">[</span>ageKey<span class="token punctuation">]</span><span class="token operator">:</span><span class="token number">16</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token punctuation">[</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"key"</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token operator">:</span><span class="token number">123</span><span class="token comment">// 函数表达式也行</span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>person<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//&#123; name: 'joker', age: 16, key123: 123 &#125;</span></pre></td></tr></table></figure><p>通过中括号 <code>[]</code>  即可用<strong>变量</strong>或<strong>表达式</strong>定义属性名。</p>
<p>如果不用 <code>[]</code> （可计算属性）的话就是这样</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">let</span> nameKey<span class="token operator">=</span><span class="token string">"name"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">let</span> ageKey<span class="token operator">=</span><span class="token string">"age"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">function</span> <span class="token function">get</span><span class="token punctuation">(</span><span class="token parameter">arg</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token keyword">return</span> arg<span class="token operator">+</span><span class="token string">""</span><span class="token operator">+</span><span class="token string">"123"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token keyword">let</span> person<span class="token operator">=</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    nameKey<span class="token operator">:</span><span class="token string">"joker"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    ageKey<span class="token operator">:</span><span class="token number">16</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token comment">//    get ("key"):123   // 这行会报错</span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>person<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//&#123; nameKey: 'joker', ageKey: 16 &#125;</span></pre></td></tr></table></figure><h4 id="163-简写方法名"><a class="anchor" href="#163-简写方法名">#</a> 1.6.3 简写方法名</h4>
<p>一般定义方法的属性，如下</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">let</span> person<span class="token operator">=</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token function-variable function">id</span><span class="token operator">:</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>        <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p>简写如下</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">let</span> person<span class="token operator">=</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token function">id</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>        <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p>也可以对<strong>获取函数</strong>和<strong>设置函数</strong>（ <code>get/set</code> ）使用</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">let</span> person<span class="token operator">=</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    name_<span class="token operator">:</span><span class="token string">""</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token keyword">get</span> <span class="token function">name</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>name_<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token keyword">set</span> <span class="token function">name</span><span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>        <span class="token keyword">this</span><span class="token punctuation">.</span>name_<span class="token operator">=</span>name<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>person<span class="token punctuation">.</span>name<span class="token operator">=</span><span class="token string">"joker"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>person<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//"joker"</span></pre></td></tr></table></figure><p>使用<strong>可计算属性</strong>的简写</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">let</span> key<span class="token operator">=</span><span class="token string">"method"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">let</span> person<span class="token operator">=</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>        <span class="token keyword">return</span> <span class="token string">"haha"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>person<span class="token punctuation">.</span><span class="token function">method</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//"haha"</span></pre></td></tr></table></figure><h3 id="17-对象解构"><a class="anchor" href="#17-对象解构">#</a> 1.7 对象解构</h3>
<p>通俗点讲，就是<strong>通过对象初始化变量</strong>，和 <code>let [a,b]=[b,a]</code>  有异曲同工之妙</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">let</span> person<span class="token operator">=</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    name<span class="token operator">:</span><span class="token string">"joker"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    age<span class="token operator">:</span><span class="token number">16</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">let</span> <span class="token punctuation">&#123;</span>name<span class="token operator">:</span>personName<span class="token punctuation">,</span>age<span class="token operator">:</span>personAge<span class="token punctuation">&#125;</span><span class="token operator">=</span>person<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>personName<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//"joker"</span></pre></td></tr><tr><td data-num="7"></td><td><pre>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>personAge<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//16</span></pre></td></tr></table></figure><ul>
<li>也可以使用<strong>简写</strong>（让变量直接用属性的名称）</li>
</ul>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">let</span> <span class="token punctuation">&#123;</span>name<span class="token punctuation">,</span>age<span class="token punctuation">&#125;</span><span class="token operator">=</span>person<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//"joker"</span></pre></td></tr><tr><td data-num="3"></td><td><pre>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>age<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//16</span></pre></td></tr></table></figure><ul>
<li>如果引用的属性<strong>不存在</strong>，则为 <code>undefined</code></li>
</ul>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">let</span> <span class="token punctuation">&#123;</span>name<span class="token punctuation">,</span>job<span class="token punctuation">&#125;</span><span class="token operator">=</span>person<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//"joker"</span></pre></td></tr><tr><td data-num="3"></td><td><pre>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>job<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//undefined</span></pre></td></tr></table></figure><ul>
<li>也可以先使用个<strong>默认值</strong></li>
</ul>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">let</span> <span class="token punctuation">&#123;</span>name<span class="token punctuation">,</span>job<span class="token operator">=</span><span class="token string">"driver"</span><span class="token punctuation">&#125;</span><span class="token operator">=</span>person<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//"joker"</span></pre></td></tr><tr><td data-num="3"></td><td><pre>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>job<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//"driver"</span></pre></td></tr></table></figure><ul>
<li>&lt;font color=red&gt;<strong> 原始值</strong>会被当成对象（通过调用 <code>toObject()</code> ）结构，但， <code>null</code>  和 <code>undefined</code>  无法被解构 &lt;/font&gt;</li>
</ul>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">let</span> <span class="token punctuation">&#123;</span>length<span class="token punctuation">&#125;</span><span class="token operator">=</span><span class="token string">"footer"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//6</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">let</span> <span class="token punctuation">&#123;</span>constructor<span class="token operator">:</span>c<span class="token punctuation">&#125;</span><span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>c<span class="token operator">===</span>Number<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//true</span></pre></td></tr></table></figure><ul>
<li>解构可以不用 <code>let</code>  等关键字声明，但这样的话需要用 <code>()</code>  包裹</li>
</ul>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>name<span class="token punctuation">,</span>job<span class="token punctuation">&#125;</span><span class="token operator">=</span>person<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 不用 () 包裹会报错</span></pre></td></tr></table></figure><h4 id="171-嵌套解构"><a class="anchor" href="#171-嵌套解构">#</a> 1.7.1 嵌套解构</h4>
<p>如下</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">let</span> person<span class="token operator">=</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    job<span class="token operator">:</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>        title<span class="token operator">:</span><span class="token string">'software'</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token keyword">let</span> <span class="token punctuation">&#123;</span> job<span class="token operator">:</span> newJob<span class="token punctuation">&#125;</span><span class="token operator">=</span>person<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>newJob<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//&#123; title: 'software' &#125;</span></pre></td></tr></table></figure><p>实际上， <code>newJob</code>  复制的还是 <code>&#123; title: 'software' &#125;</code>  的地址，当 <code>person.job.title</code>  改动时， <code>newJob</code>  也会改动</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">let</span> <span class="token punctuation">&#123;</span>job<span class="token operator">:</span><span class="token punctuation">&#123;</span>title<span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token operator">=</span>person</pre></td></tr><tr><td data-num="2"></td><td><pre>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>title<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//'software'</span></pre></td></tr></table></figure><p>这样嵌套复制 <code>title</code>  就是复制 <code>&quot;software&quot;</code>  这个值了</p>
<h4 id="172-部分解构"><a class="anchor" href="#172-部分解构">#</a> 1.7.2 部分解构</h4>
<p>如果一个<strong>解构表达式</strong>涉及多个赋值，开始的赋值成功而后面的赋值出错，那么赋值会完成一部分。（不会回滚）</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">let</span> person<span class="token operator">=</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    name<span class="token operator">:</span><span class="token string">"joker"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    age<span class="token operator">:</span><span class="token number">10</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">let</span> personName<span class="token punctuation">,</span>personFoo<span class="token punctuation">,</span>personAge<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token keyword">try</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token comment">//person 没有 foo，所以为 undefined。而 undefined 没有属性值 bar，会抛出错误</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token punctuation">(</span><span class="token punctuation">&#123;</span>name<span class="token operator">:</span>personName<span class="token punctuation">,</span>foo<span class="token operator">:</span><span class="token punctuation">&#123;</span>bar<span class="token operator">:</span>personFoo<span class="token punctuation">&#125;</span><span class="token punctuation">,</span>age<span class="token operator">:</span>personAge<span class="token punctuation">&#125;</span><span class="token operator">=</span>person<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token punctuation">&#125;</span><span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//TypeError: Cannot read properties of undefined (reading 'bar')</span></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="12"></td><td><pre>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>personName<span class="token punctuation">,</span>personFoo<span class="token punctuation">,</span>personAge<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//joker undefined undefined</span></pre></td></tr></table></figure><p>此例中只有 <code>personName</code>  成功赋值了</p>
<h4 id="173-参数上下文匹配"><a class="anchor" href="#173-参数上下文匹配">#</a> 1.7.3 参数上下文匹配</h4>
<p>在<strong>参数列表</strong>也可以进行解构赋值</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">let</span> person<span class="token operator">=</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    name<span class="token operator">:</span><span class="token string">"joker"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    age<span class="token operator">:</span><span class="token number">10</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token comment">//&#123;name,age&#125; 正好接收 person 的值</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token keyword">function</span> <span class="token function">printPerson</span><span class="token punctuation">(</span><span class="token parameter">foo<span class="token punctuation">,</span><span class="token punctuation">&#123;</span>name<span class="token punctuation">,</span>age<span class="token punctuation">&#125;</span><span class="token punctuation">,</span>bar</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>arguments<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span>age<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token function">printPerson</span><span class="token punctuation">(</span><span class="token string">'1st'</span><span class="token punctuation">,</span>person<span class="token punctuation">,</span><span class="token string">'2nd'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token comment">//[Arguments] &#123; '0': '1st', '1': &#123; name: 'joker', age: 10 &#125;, '2': '2nd' &#125;</span></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token comment">// joker 10</span></pre></td></tr></table></figure><p>但实际上发现这个功能挺<strong>鸡肋</strong>的，可以直接传 <code>person</code>  为参数</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">let</span> person<span class="token operator">=</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    name<span class="token operator">:</span><span class="token string">"joker"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    age<span class="token operator">:</span><span class="token number">10</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">function</span> <span class="token function">printPerson1</span><span class="token punctuation">(</span><span class="token parameter">foo<span class="token punctuation">,</span>person<span class="token punctuation">,</span>bar</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>arguments<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>person<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token function">printPerson1</span><span class="token punctuation">(</span><span class="token string">'1st'</span><span class="token punctuation">,</span>person<span class="token punctuation">,</span><span class="token string">'2nd'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token comment">//[Arguments] &#123; '0': '1st', '1': &#123; name: 'joker', age: 10 &#125;, '2': '2nd' &#125;</span></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token comment">// &#123; name: 'joker', age: 10 &#125;</span></pre></td></tr></table></figure><h2 id="2-创建对象伪类"><a class="anchor" href="#2-创建对象伪类">#</a> 2. 创建对象（伪类）</h2>
<p>之前使用<strong>对象字面量</strong>创建对象其实相当于直接创建<strong>对象实例</strong>，即一次性对象，更多时候 <code>&#123;&#125;</code>  是当做 <code>map/字典</code> 用的</p>
<p>当需要<strong>同样的接口</strong>的多个不同对象实例时，需要用 <code>function</code>  创建（此时还不是 <code>class</code>  类）</p>
<h3 id="21-概述"><a class="anchor" href="#21-概述">#</a> 2.1 概述</h3>
<p>ES5.1 还没有正式支持面向对象的结构，如类或继承。但可以通过原型式继承可以实现同样的功能。</p>
<p>ES6 正式支持类和继承，不过实际上是封装了 ES5.1 构造函数 + 原型继承的语法糖而已</p>
<h3 id="22-工厂模式"><a class="anchor" href="#22-工厂模式">#</a> 2.2 工厂模式</h3>
<blockquote>
<p>工厂模式：用于抽象创建特定对象的过程。</p>
</blockquote>
<p>例：</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">// 创建一个工厂函数</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">function</span> <span class="token function">createPerson</span><span class="token punctuation">(</span><span class="token parameter">name<span class="token punctuation">,</span>age<span class="token punctuation">,</span>job</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token keyword">let</span> o<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    o<span class="token punctuation">.</span>name<span class="token operator">=</span>name<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    o<span class="token punctuation">.</span>age<span class="token operator">=</span>age<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    o<span class="token punctuation">.</span><span class="token function-variable function">sayName</span><span class="token operator">=</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token keyword">return</span> o<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="11"></td><td><pre></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token keyword">let</span> person1<span class="token operator">=</span><span class="token function">createPerson</span><span class="token punctuation">(</span><span class="token string">"Nicholas"</span><span class="token punctuation">,</span><span class="token number">29</span><span class="token punctuation">,</span><span class="token string">"software"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token keyword">let</span> person2<span class="token operator">=</span><span class="token function">createPerson</span><span class="token punctuation">(</span><span class="token string">"Joker"</span><span class="token punctuation">,</span><span class="token number">30</span><span class="token punctuation">,</span><span class="token string">"doctor"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p>可以用不同的参数多次调用这个函数</p>
<h3 id="23-构造函数模式"><a class="anchor" href="#23-构造函数模式">#</a> 2.3 构造函数模式</h3>
<p>前面的例子可以写成构造函数，创建一个类</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">// 通过 function 设置构造函数。</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">function</span> <span class="token function">Person</span><span class="token punctuation">(</span><span class="token parameter">name<span class="token punctuation">,</span>age<span class="token punctuation">,</span>job</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token operator">=</span>name<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token keyword">this</span><span class="token punctuation">.</span>age<span class="token operator">=</span>age<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token keyword">this</span><span class="token punctuation">.</span>job<span class="token operator">=</span>job<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function-variable function">sayName</span><span class="token operator">=</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token comment">// 不建议在构造函数内定义函数</span></pre></td></tr><tr><td data-num="7"></td><td><pre>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token comment">// 一个 Person 类就创建好了，此时只有一个构造函数</span></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token comment">// 不过这个按理不应该叫类，但是和类功能大差不差</span></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token keyword">let</span> person1<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token string">"Nicholas"</span><span class="token punctuation">,</span><span class="token number">29</span><span class="token punctuation">,</span><span class="token string">"software"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token keyword">let</span> person2<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token string">"Joker"</span><span class="token punctuation">,</span><span class="token number">30</span><span class="token punctuation">,</span><span class="token string">"doctor"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="14"></td><td><pre>person1<span class="token punctuation">.</span><span class="token function">sayName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//Nicholas</span></pre></td></tr><tr><td data-num="15"></td><td><pre>person2<span class="token punctuation">.</span><span class="token function">sayName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//Joker</span></pre></td></tr></table></figure><p>这里 <code>function</code>  的函数功能起到<strong>构造函数</strong>的作用，后面可以通过 <code>prototype</code>  添加成员变量 / 方法</p>
<p><code>Person</code>  和 <code>createPerson</code>  主要有以下几点区别：</p>
<ul>
<li>没有显式地创建对象；</li>
<li>属性和方法直接赋予的 <code>this</code> ；</li>
<li>没有 <code>return</code> ；</li>
<li>创建 <code>Person</code>  的实例要用 <code>new</code>  关键字。</li>
</ul>
<p>通过 ** <code>new</code> ** 调用构造函数会执行如下操作：</p>
<ol>
<li>在内存中新建一个对象</li>
<li>新对象内部的 <code>[[prototype]]</code>  特性被赋值为构造函数的 <code>prototype</code>  属性</li>
<li>构造函数内部的 <code>this</code>  被赋值给这个新对象</li>
<li>执行构造函数内部的代码（给这个新对象添加初始属性）</li>
<li>如果构造函数返回<strong>非空</strong>对象，则返回该对象；否则，返回刚创建的新对象</li>
</ol>
<p>以上 <code>person1</code>  和 <code>person2</code>  都有一个 <code>constructor</code>  属性指向 <code>Person</code> 。即</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>person1<span class="token punctuation">.</span>constructor<span class="token operator">===</span>Person<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//true</span></pre></td></tr><tr><td data-num="2"></td><td><pre>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>person2<span class="token punctuation">.</span>constructor<span class="token operator">===</span>Person<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//true</span></pre></td></tr></table></figure><ul>
<li>
<p><code>constructor</code> ：用于标识对象类型</p>
</li>
<li>
<p>构造函数也可以用 <code>let Person=function()&#123;&#125;</code>  这种形式写，都一样。</p>
</li>
<li>
<p>如果空参，也可以不写 <code>()</code> 。</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">let</span> person1<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">let</span> person2<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">;</span><span class="token comment">//2 个等效</span></pre></td></tr></table></figure></li>
</ul>
<h4 id="231-构造函数也是函数"><a class="anchor" href="#231-构造函数也是函数">#</a> 2.3.1 构造函数也是函数</h4>
<p>构造函数和普通函数唯一区别是调用方式不同。</p>
<ul>
<li>
<p>作为构造函数使用</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">let</span> person<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token string">"joker"</span><span class="token punctuation">,</span><span class="token number">29</span><span class="token punctuation">,</span><span class="token string">"soft"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>person<span class="token punctuation">.</span><span class="token function">sayName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//"joker"</span></pre></td></tr></table></figure></li>
<li>
<p>作为普通函数调用</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">let</span> person<span class="token operator">=</span><span class="token function">Person</span><span class="token punctuation">(</span><span class="token string">"jack"</span><span class="token punctuation">,</span><span class="token number">26</span><span class="token punctuation">,</span><span class="token string">"doctor"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>person<span class="token punctuation">.</span><span class="token function">sayName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//"jack"</span></pre></td></tr></table></figure><p>&lt;font color=red&gt;<strong> 注：此处没有 <code>new</code>  新建实例，则 &quot;jack&quot; 等属性会被保存到 Global 对象（浏览器中是 window 对象）</strong>&lt;/font&gt;</p>
<p>即 <code>this</code>  指向全局对象</p>
</li>
</ul>
<h4 id="232-构造函数的问题"><a class="anchor" href="#232-构造函数的问题">#</a> 2.3.2 构造函数的问题</h4>
<p>构造函数是<em>每创建一个实例便调用一次</em>。因此，在构造函数中定义的函数也会在每个实例上<strong>重新定义一遍</strong>。</p>
<p>同一个功能的方法反复定义当然不合适，<strong>有一种方法</strong>是把函数定义在全局作用域，但这样会搞乱全局作用域（变得很杂）</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">// 这样有用，但也不推荐</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">function</span> <span class="token function">Person</span><span class="token punctuation">(</span><span class="token parameter">name<span class="token punctuation">,</span>age<span class="token punctuation">,</span>job</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token operator">=</span>name<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token keyword">this</span><span class="token punctuation">.</span>age<span class="token operator">=</span>age<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token keyword">this</span><span class="token punctuation">.</span>job<span class="token operator">=</span>job<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token keyword">this</span><span class="token punctuation">.</span>sayName<span class="token operator">=</span>sayName<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token keyword">function</span> <span class="token function">sayName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p>如上，函数便只会定义一次，但会把全局作用域搞得很乱很杂。</p>
<p>这个问题可以通过 &lt;font size=6&gt;<strong> 原型</strong> &lt;/font&gt; 来解决</p>
<h3 id="24-原型模式"><a class="anchor" href="#24-原型模式">#</a> 2.4 原型模式</h3>
<p>每个函数都会创建一个 <code>prototype</code>  属性，这个属性其实是个对象，即<strong>原型对象</strong>。使用<strong>原型对象</strong>，在它上面定义的属性和方法可以被对象的所有实例共享。</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">function</span> <span class="token function">Person</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token class-name">Person</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>name<span class="token operator">=</span><span class="token string">"joker"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token class-name">Person</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>age<span class="token operator">=</span><span class="token number">26</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token class-name">Person</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>job<span class="token operator">=</span><span class="token string">"driver"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token class-name">Person</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">sayName</span><span class="token operator">=</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token comment">// 或者</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token class-name">Person</span><span class="token punctuation">.</span>prototype<span class="token operator">=</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    name<span class="token operator">:</span><span class="token string">"joker"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="11"></td><td><pre>    age<span class="token operator">:</span><span class="token number">26</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="12"></td><td><pre>    job<span class="token operator">:</span><span class="token string">"driver"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="13"></td><td><pre>    <span class="token function-variable function">sayName</span><span class="token operator">:</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="14"></td><td><pre>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="15"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="16"></td><td><pre><span class="token punctuation">&#125;</span><span class="token comment">// 但是这样 constructor 属性就不指向 Person 了，详细看 2.5.1 解释</span></pre></td></tr></table></figure><p>这样定义的变量是跟随 “类” 的，相当于 Java 的静态变量。但又不能直接通过 <code>Person.name</code>  调取</p>
<p>通过原型，完美解决了之前的问题：</p>
<ul>
<li>对象函数只定义一次</li>
<li>函数定义不会弄乱全局作用域</li>
</ul>
<p>&lt;font color=red&gt; 需要注意一点，原型并不是说保存了对象（伪类）的所有属性，比如<strong>构造函数</strong>初始化的属性就不在原型里 &lt;/font&gt;</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">function</span> <span class="token function">Father</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token keyword">this</span><span class="token punctuation">.</span>property<span class="token operator">=</span><span class="token boolean">true</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token class-name">Father</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>name<span class="token operator">=</span><span class="token string">"ha"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token class-name">Father</span><span class="token punctuation">.</span>prototype<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//&#123;"ha"&#125;</span></pre></td></tr></table></figure><p>因为构造函数的属性算是<strong>实例</strong>创建后定义的，这个属性属于实例，而不属于原型（或者说实例的父类）</p>
<h4 id="241-理解原型"><a class="anchor" href="#241-理解原型">#</a> 2.4.1 理解原型</h4>
<p>只要创建一个<strong>函数</strong>，这个函数就会生成一个 <code>prototype</code>  属性（指向<strong>原型对象</strong>）。且所有<strong>原型对象</strong>都有一个 <code>constructor</code>  属性（指向对应的构造函数，即相当于返回类名）。</p>
<ul>
<li>
<p><code>prototype.constructor</code> ：返回构造函数。</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">let</span> <span class="token function-variable function">Person</span><span class="token operator">=</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">let</span> person1<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token class-name">Person</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>constructor<span class="token operator">===</span>Person<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//true</span></pre></td></tr><tr><td data-num="4"></td><td><pre>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token class-name">Person</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>constructor<span class="token operator">===</span>Object<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//false</span></pre></td></tr></table></figure></li>
<li>
<p><code>prototype.__proto__</code> ：返回原对象（构造函数 / 父类）的原型对象。</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">let</span> person2<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>person2<span class="token punctuation">.</span>__proto__<span class="token operator">===</span><span class="token class-name">Person</span><span class="token punctuation">.</span>prototype<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//true</span></pre></td></tr><tr><td data-num="3"></td><td><pre>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token class-name">Person</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>__proto__<span class="token operator">===</span><span class="token class-name">Object</span><span class="token punctuation">.</span>prototype<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//true</span></pre></td></tr></table></figure><p>当访问一个对象的属性时，如果该对象内部不存在这个属性，那么就会去它的__proto__属性所指向的那个对象（可以理解为父对象）里找，如果父对象也不存在这个属性，则继续往父对象的__proto__属性所指向的那个对象（可以理解为爷爷对象）里找，直到原型链顶端 null，null 为<strong>原型链</strong>的终点</p>
</li>
<li>
<p><code>prototype</code> ：原型对象，** 函数（伪类）** 所独有的属性。</p>
</li>
</ul>
<p>深入理解 <code>prototype</code> 、 <code>__proto__</code> 、 <code>constructor</code>  的关系还是得上网看一下</p>
<ul>
<li>
<p><code>prototype.isPrototypeof()</code> ：判断 <code>person1</code>  是否是 <code>Person</code>  的实例对象</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token class-name">Person</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function">isPrototypeof</span><span class="token punctuation">(</span>person1<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//true</span></pre></td></tr></table></figure></li>
<li>
<p><code>Object.getPrototype()</code> ：获取实例对象的原型（构造函数、父类）的原型对象。和 <code>__proto__</code> 的作用差不多</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>Object<span class="token punctuation">.</span><span class="token function">getPrototypeof</span><span class="token punctuation">(</span>person1<span class="token punctuation">)</span><span class="token operator">===</span><span class="token class-name">Person</span><span class="token punctuation">.</span>prototype<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//true</span></pre></td></tr></table></figure></li>
</ul>
<p>&lt;font color=red&gt; 这里有个需要注意的地方，如果 <code>prototype</code>  是以 <code>&#123;&#125;</code>  定义的，那么 <code>constructor</code>  的返回结果会有所出路 &lt;/font&gt;</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">let</span> <span class="token function-variable function">Person</span><span class="token operator">=</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token class-name">Person</span><span class="token punctuation">.</span>prototype<span class="token operator">=</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    name<span class="token operator">:</span><span class="token string">"joker"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    age<span class="token operator">:</span><span class="token number">26</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    job<span class="token operator">:</span><span class="token string">"driver"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token function-variable function">sayName</span><span class="token operator">:</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token keyword">let</span> person1<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token class-name">Person</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>constructor<span class="token operator">===</span>Person<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//false</span></pre></td></tr><tr><td data-num="12"></td><td><pre>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token class-name">Person</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>constructor<span class="token operator">===</span>Object<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//true</span></pre></td></tr></table></figure><p>&lt;font color=red&gt; 发现与之前的例子结果<strong>相反</strong>， <code>Person.prototype.constructor</code>  的返回结果是 <code>[Function: Object]</code> （之前是 <code>[Function: Person]</code> ）&lt;/font&gt;</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>person1<span class="token punctuation">.</span>constructor<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//[Function: Object]</span></pre></td></tr><tr><td data-num="2"></td><td><pre>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token class-name">Person</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>constructor<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//[Function: Object]</span></pre></td></tr></table></figure><p>但 <code>__proto__</code> 是不受影响的</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">let</span> person2<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>person2<span class="token punctuation">.</span>__proto__<span class="token operator">===</span><span class="token class-name">Person</span><span class="token punctuation">.</span>prototype<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//true</span></pre></td></tr><tr><td data-num="3"></td><td><pre>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token class-name">Person</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>__proto__<span class="token operator">===</span><span class="token class-name">Object</span><span class="token punctuation">.</span>prototype<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//true</span></pre></td></tr></table></figure><h4 id="242-原型层级"><a class="anchor" href="#242-原型层级">#</a> 2.4.2 原型层级</h4>
<p>即此前讲过的<strong>原型链</strong>。</p>
<p>当访问实例对象的属性时，先在该实例找，找不到原型（构造函数 / 父类）找；再找不到一直往上找。</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">let</span> <span class="token function-variable function">Person</span><span class="token operator">=</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token class-name">Person</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>name<span class="token operator">=</span><span class="token string">"joker"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token class-name">Person</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>age<span class="token operator">=</span><span class="token number">26</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token class-name">Person</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>job<span class="token operator">=</span><span class="token string">"driver"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token class-name">Person</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">sayName</span><span class="token operator">=</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token keyword">let</span> person1<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token keyword">let</span> person2<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>person1<span class="token punctuation">.</span>name<span class="token operator">=</span><span class="token string">"mack"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>person1<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//"mack"，来自实例</span></pre></td></tr><tr><td data-num="12"></td><td><pre>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>person2<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//"joker"，来自原型</span></pre></td></tr></table></figure><p>只要给对象<strong>实例</strong>添加属性，这个属性就会<strong>遮蔽</strong>原型对象上的<strong>同名属性</strong>（屏蔽对他的访问）。</p>
<p>可以通过 <code>delete</code>  删除实例上的属性，对原型该属性的访问又可以恢复</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">delete</span> person1<span class="token punctuation">.</span>name<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>person1<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//"joker"，来自原型</span></pre></td></tr></table></figure><ul>
<li>
<p><code>hasOwnPrototype()</code> ：判断属性是在实例上还是原型对象上</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre>person1<span class="token punctuation">.</span><span class="token function">hasOwnPrototype</span><span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 来自实例返回 true，来自原型（父辈）返回 false</span></pre></td></tr></table></figure></li>
</ul>
<h4 id="243-原型和-in-操作符"><a class="anchor" href="#243-原型和in操作符">#</a> 2.4.3 原型和 in 操作符</h4>
<p><code>in</code>  操作符单独使用时，可以判断属性是否是该对象的属性，（通过构造函数或父类）继承的也算。</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">let</span> <span class="token function-variable function">Person</span><span class="token operator">=</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token class-name">Person</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>name<span class="token operator">=</span><span class="token string">"joker"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token class-name">Person</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>age<span class="token operator">=</span><span class="token number">26</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token class-name">Person</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>job<span class="token operator">=</span><span class="token string">"driver"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token class-name">Person</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">sayName</span><span class="token operator">=</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token keyword">let</span> person1<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token keyword">let</span> person2<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>person1<span class="token punctuation">.</span>name<span class="token operator">=</span><span class="token string">"mack"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"name"</span> <span class="token keyword">in</span> person1<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//ture</span></pre></td></tr><tr><td data-num="12"></td><td><pre>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>person1<span class="token punctuation">.</span><span class="token function">hasOwnPrototype</span><span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//true 来自实例</span></pre></td></tr><tr><td data-num="13"></td><td><pre>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"name"</span> <span class="token keyword">in</span> person2<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//ture</span></pre></td></tr><tr><td data-num="14"></td><td><pre>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>person2<span class="token punctuation">.</span><span class="token function">hasOwnPrototype</span><span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//false 来自原型</span></pre></td></tr></table></figure><p>只要对象可以（通过原型链）访问到该属性， <code>in</code>  操作符就返回 <code>true</code> 。</p>
<p>因此，只要 <code>in</code>  操作符返回 <code>true</code> ；且 <code>hasOwnPrototype()</code>  方法返回 <code>false</code> ，就说明该属性是<strong>原型属性</strong>（也就是（通过构造函数、父类）继承下来的）</p>
<ul>
<li>
<p><code>hasPrototypeProperty()</code> ：属性是否来自对象的<strong>原型</strong></p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token function">hasOwnPrototype</span><span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">,</span>person1<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 来自原型（父辈）返回 true，来自实例返回 false</span></pre></td></tr></table></figure></li>
</ul>
<hr>
<p>此外，当<strong>对象</strong>用作 <code>map</code>  时用得最多</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">let</span> hashmap<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token string">"key1"</span><span class="token operator">:</span><span class="token string">"value1"</span><span class="token punctuation">,</span><span class="token string">"key2"</span><span class="token operator">:</span><span class="token string">"value2"</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"key1"</span> <span class="token keyword">in</span> hashmap<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//true</span></pre></td></tr></table></figure><p>对应于 ES6 新增的 <code>Map</code>  类的 <code>.has()</code>  方法</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">let</span> hashmap<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Map</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>hashmap<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">"key1"</span><span class="token punctuation">,</span><span class="token string">"value1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>hashmap<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">"key2"</span><span class="token punctuation">,</span><span class="token string">"value2"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>hashmap<span class="token punctuation">.</span><span class="token function">has</span><span class="token punctuation">(</span><span class="token string">"key1"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//true</span></pre></td></tr></table></figure><p>其实同样的， <code>delete</code>  操作符类似 <code>Map</code>  的 <code>.delete()</code>  方法</p>
<h4 id="244-属性枚举"><a class="anchor" href="#244-属性枚举">#</a> 2.4.4 属性枚举</h4>
<p>对象的枚举一般通过 <code>for-in</code> 、 <code>Object.keys()</code> 、 <code>Object.getOwnPropertyNames()</code> 、 <code>Object.getOwnPropertySymbols()</code>  以及 <code>Object.assign()</code>  等 5 种方法。</p>
<p>以此例子说明</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">let</span> <span class="token function-variable function">Person</span><span class="token operator">=</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token class-name">Person</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>name<span class="token operator">=</span><span class="token string">"joker"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token class-name">Person</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>age<span class="token operator">=</span><span class="token number">26</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token class-name">Person</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>job<span class="token operator">=</span><span class="token string">"driver"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token class-name">Person</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">sayName</span><span class="token operator">=</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr></table></figure><ul>
<li>
<p><code>for-in</code> ：遍历对象实例的<strong>可访问</strong>且<strong>可枚举</strong>的属性（可来自原型）</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">let</span> person1<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>person1<span class="token punctuation">.</span>name<span class="token operator">=</span><span class="token string">"mack"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> p <span class="token keyword">in</span> person1<span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token punctuation">&#125;</span><span class="token comment">//name age job sayName</span></pre></td></tr></table></figure><ul>
<li>限制：
<ul>
<li><strong>可枚举</strong></li>
<li><strong>可访问</strong>（能在<strong>原型链</strong>上找到的所有属性）</li>
</ul>
</li>
<li>遍历顺序：<strong>无序</strong></li>
</ul>
</li>
<li>
<p><code>Object.keys()</code> ：（数组形式）返回对象实例<strong>自身</strong>的属性（可枚举的）。</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">let</span> person2<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>person2<span class="token punctuation">.</span>name<span class="token operator">=</span><span class="token string">"jack"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>person2<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//["name"]</span></pre></td></tr><tr><td data-num="4"></td><td><pre>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span><span class="token class-name">Person</span><span class="token punctuation">.</span>prototype<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//[ 'name', 'age', 'job', 'sayName' ]</span></pre></td></tr></table></figure><ul>
<li>限制：
<ul>
<li><strong>可枚举</strong></li>
<li>对象实例<strong>自身属性</strong>（不需要遍历原型链即可直接访问到的属性）</li>
</ul>
</li>
<li>遍历顺序：<strong>无序</strong></li>
</ul>
</li>
<li>
<p><code>Object.getOwnPropertyNames()</code> ：返回<strong>对象实例</strong>所有属性（包括不可枚举的）</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>Object<span class="token punctuation">.</span><span class="token function">getOwnPropertyNames</span><span class="token punctuation">(</span>person2<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//["name"]</span></pre></td></tr><tr><td data-num="2"></td><td><pre>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>Object<span class="token punctuation">.</span><span class="token function">getOwnPropertyNames</span><span class="token punctuation">(</span><span class="token class-name">Person</span><span class="token punctuation">.</span>prototype<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//[ 'constructor', 'name', 'age', 'job', 'sayName' ]</span></pre></td></tr></table></figure><p>如上， <code>constructor</code>  本身不可枚举的类型，但还是通过 <code>getOwnPropertyNames()</code>  枚举了</p>
<ul>
<li>限制：
<ul>
<li><strong>无论是否可枚举都遍历</strong></li>
<li>对象实例<strong>自身属性</strong></li>
</ul>
</li>
<li>遍历顺序：
<ol>
<li>先以<strong>数值键升序</strong></li>
<li>再按插入顺序升序</li>
</ol>
</li>
</ul>
</li>
<li>
<p><code>Object.getOwnPropertySymbols()</code> ：返回实例对象的<strong>符号属性</strong>。（ES6 之前没有 <code>symbol</code>  类型，此为 ES6 新增）</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">let</span> person3<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">[</span><span class="token function">Symbol</span><span class="token punctuation">(</span><span class="token string">'k1'</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token operator">:</span><span class="token string">'k1'</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token function">Symbol</span><span class="token punctuation">(</span><span class="token string">'k2'</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token operator">:</span><span class="token string">'k2'</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>Object<span class="token punctuation">.</span><span class="token function">getOwnPropertySymbols</span><span class="token punctuation">(</span>person3<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//[ Symbol(k1), Symbol(k2) ]</span></pre></td></tr></table></figure><ul>
<li>限制：
<ul>
<li><strong>可枚举</strong></li>
<li>对象实例<strong>自身属性</strong>。（其实符号属性基本也不会用在伪类上，因此也没有继承符号属性的）</li>
<li>仅限<strong> Symbol 属性</strong></li>
</ul>
</li>
<li>遍历顺序：
<ul>
<li>先以<strong>数值键升序</strong></li>
<li>再按插入顺序升序</li>
</ul>
</li>
</ul>
</li>
<li>
<p><code>Object.assign()</code> ：返回<strong>对象实例</strong>的所有<strong>可枚举</strong>属性和值</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>Object<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span>person2<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//Person &#123; name: 'jack' &#125;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>Object<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span><span class="token class-name">Person</span><span class="token punctuation">.</span>prototype<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token comment">/*&#123;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>	name: 'joker',</pre></td></tr><tr><td data-num="5"></td><td><pre>    age: 26,</pre></td></tr><tr><td data-num="6"></td><td><pre>    job: 'driver',</pre></td></tr><tr><td data-num="7"></td><td><pre>    sayName: [Function (anonymous)]</pre></td></tr><tr><td data-num="8"></td><td><pre>&#125;*/</pre></td></tr></table></figure><ul>
<li>限制：
<ul>
<li><strong>可枚举</strong></li>
<li>对象实例<strong>自身属性</strong>。</li>
</ul>
</li>
<li>遍历顺序：
<ul>
<li>先以<strong>数值键升序</strong></li>
<li>再按插入顺序升序</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="25-对象迭代"><a class="anchor" href="#25-对象迭代">#</a> 2.5 对象迭代</h3>
<p>首先介绍 2 个函数</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">let</span> <span class="token function-variable function">Person</span><span class="token operator">=</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token class-name">Person</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>name<span class="token operator">=</span><span class="token string">"joker"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token class-name">Person</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>age<span class="token operator">=</span><span class="token number">26</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token class-name">Person</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>job<span class="token operator">=</span><span class="token string">"driver"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token class-name">Person</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">sayName</span><span class="token operator">=</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token keyword">let</span> person1<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>person1<span class="token punctuation">.</span>name<span class="token operator">=</span><span class="token string">"jack"</span><span class="token punctuation">;</span></pre></td></tr></table></figure><ul>
<li>
<p><code>Object.values()</code> ：返回对象的<strong>值</strong>的数组（对象实例<strong>自身</strong>）</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>Object<span class="token punctuation">.</span><span class="token function">values</span><span class="token punctuation">(</span>person1<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//[ 'jack' ]</span></pre></td></tr><tr><td data-num="2"></td><td><pre>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>Object<span class="token punctuation">.</span><span class="token function">values</span><span class="token punctuation">(</span><span class="token class-name">Person</span><span class="token punctuation">.</span>prototype<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//[ 'joker', 26, 'driver', [Function (anonymous)] ]</span></pre></td></tr></table></figure></li>
<li>
<p><code>Object.entries()</code> ：返回对象<strong>键值对</strong>的数组（对象实例<strong>自身</strong>）</p>
</li>
</ul>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>Object<span class="token punctuation">.</span><span class="token function">entries</span><span class="token punctuation">(</span>person1<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//[ [ 'name', 'jack' ] ]</span></pre></td></tr><tr><td data-num="2"></td><td><pre>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>Object<span class="token punctuation">.</span><span class="token function">entries</span><span class="token punctuation">(</span><span class="token class-name">Person</span><span class="token punctuation">.</span>prototype<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token comment">/*</span></pre></td></tr><tr><td data-num="4"></td><td><pre>[</pre></td></tr><tr><td data-num="5"></td><td><pre>  [ 'name', 'joker' ],</pre></td></tr><tr><td data-num="6"></td><td><pre>  [ 'age', 26 ],</pre></td></tr><tr><td data-num="7"></td><td><pre>  [ 'job', 'driver' ],</pre></td></tr><tr><td data-num="8"></td><td><pre>  [ 'sayName', [Function (anonymous)] ]</pre></td></tr><tr><td data-num="9"></td><td><pre>]</pre></td></tr><tr><td data-num="10"></td><td><pre>*/</pre></td></tr></table></figure><p>和 <code>Object.keys()</code>  属于同源方法，仅限<strong>可枚举</strong>、<strong>对象实例自身</strong>、<strong>非符号属性</strong></p>
<h4 id="251-其他原型语法"><a class="anchor" href="#251-其他原型语法">#</a> 2.5.1 其他原型语法</h4>
<p>上面说过，对象的原型可以按以下方法定义</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">function</span> <span class="token function">Person</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token class-name">Person</span><span class="token punctuation">.</span>prototype<span class="token operator">=</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    name<span class="token operator">:</span><span class="token string">"joker"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    age<span class="token operator">:</span><span class="token number">26</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    job<span class="token operator">:</span><span class="token string">"driver"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token function-variable function">sayName</span><span class="token operator">:</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>但是这样 <code>constructor</code>  属性就不指向 <code>Person</code>  了，因为这样默认是给 <code>Person.prototype</code>  定义了一个新对象（ <code>Object</code> ），虽然 <code>instanceof</code>  仍然可靠，但 <code>constructor</code>  已经不能正确使用了</p>
<p>此时可以<strong>手动设置</strong> <code>constructor</code>  属性</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">function</span> <span class="token function">Person</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token class-name">Person</span><span class="token punctuation">.</span>prototype<span class="token operator">=</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    constructor<span class="token operator">:</span> Person<span class="token punctuation">,</span><span class="token comment">// 像这样，但这种方法 constructor 的 [[Enumerable]] 属性是 true（正常应该是 false）</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    name<span class="token operator">:</span><span class="token string">"joker"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    age<span class="token operator">:</span><span class="token number">26</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    job<span class="token operator">:</span><span class="token string">"driver"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token function-variable function">sayName</span><span class="token operator">:</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>想要设置 <code>constructor</code>  属性为 <code>false</code> ，可以用 <code>Object.defineProperty()</code>  方法</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">function</span> <span class="token function">Person</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token class-name">Person</span><span class="token punctuation">.</span>prototype<span class="token operator">=</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    name<span class="token operator">:</span><span class="token string">"joker"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    age<span class="token operator">:</span><span class="token number">26</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    job<span class="token operator">:</span><span class="token string">"driver"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token function-variable function">sayName</span><span class="token operator">:</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token comment">// 像这样</span></pre></td></tr><tr><td data-num="11"></td><td><pre>Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span><span class="token class-name">Person</span><span class="token punctuation">.</span>prototype<span class="token punctuation">,</span><span class="token string">"constructor"</span><span class="token punctuation">,</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="12"></td><td><pre>    enumerable<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="13"></td><td><pre>    value<span class="token operator">:</span> Person</pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">)</span></pre></td></tr></table></figure><h4 id="252-原型的动态性"><a class="anchor" href="#252-原型的动态性">#</a> 2.5.2 原型的动态性</h4>
<p>从原型上的搜索值的过程是<strong>动态</strong>的，即使实例在<strong>修改原型之前</strong>已存在，修改后还是会在实例上反映出来，如下</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">let</span> friend<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 此时实例创建好</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token class-name">Person</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">sayHi</span><span class="token operator">=</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token comment">// 修改原型</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"hi!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>friend<span class="token punctuation">.</span><span class="token function">sayHi</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//"hi", 正常输出</span></pre></td></tr></table></figure><p>这是因为<strong>实例和原型之间是松散的联系</strong>。当在实例中找不到 <code>sayHi</code>  属性，便会去原型中找。</p>
<p>&lt;font color=red&gt; 简单的修改没事，但<strong>重写</strong>原型就不行了 &lt;/font&gt;</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">let</span> friend<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 此时实例创建好</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token class-name">Person</span><span class="token punctuation">.</span>prototype<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token comment">// 重新定义原型</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token function-variable function">sayHi</span><span class="token operator">:</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"hi!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>friend<span class="token punctuation">.</span><span class="token function">sayHi</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 错误</span></pre></td></tr></table></figure><p>因为 <code>friend</code>  指向的原型<strong>不再是之前的原型</strong>了，而是最初的原型。而最初的原型上没有 <code>sayHi</code>  这个属性</p>
<h4 id="253-原生对象原型"><a class="anchor" href="#253-原生对象原型">#</a> 2.5.3 原生对象原型</h4>
<p>原生对象：即本来就有的对象，如 <code>Object</code> 、 <code>Array</code> 、 <code>String</code>  等。</p>
<p>这些对象都在<strong>原型上</strong>定义了实例方法。如 <code>arr.sort()</code>  便是定义在 <code>Array.prototype</code>  上的。</p>
<p>特别的，像基础数据类型，调用实例方法时，如 <code>s.startsWith()</code> ，先是创建一个包装类 <code>String</code>  将 <code>s</code>  设为包装类对象的<strong>值</strong>，然后调用 ** 包装类 <code>String</code> ** 的方法</p>
<h4 id="254-原型的问题"><a class="anchor" href="#254-原型的问题">#</a> 2.5.4 原型的问题</h4>
<ol>
<li>
<p>原型<strong>弱化了</strong>构造函数传递初始化参数的能力</p>
</li>
<li>
<p>原型上的属性由所有实例<strong>共享</strong></p>
<p>如果在原型上定义了一个<strong>引用属性</strong>，如数组。那么会出现如下问题。</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token class-name">Person</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>arr<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">let</span> person1<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">let</span> person2<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>person1<span class="token punctuation">.</span>arr<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>person2<span class="token punctuation">.</span>arr<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//[0,1,2]</span></pre></td></tr></table></figure><p>没错， <code>person1</code>  修改数组， <code>person2</code>  调用的数组也随之改变</p>
</li>
</ol>
<h2 id="3-继承"><a class="anchor" href="#3-继承">#</a> 3. 继承</h2>
<p>JavaScript 的继承通过原型来实现，如下</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">function</span> <span class="token function">Father</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token keyword">this</span><span class="token punctuation">.</span>property<span class="token operator">=</span><span class="token boolean">true</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token class-name">Father</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>name<span class="token operator">=</span><span class="token string">"ha"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">function</span> <span class="token function">Child</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token keyword">this</span><span class="token punctuation">.</span>cpro<span class="token operator">=</span><span class="token boolean">false</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token class-name">Child</span><span class="token punctuation">.</span>prototype<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Father</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p><code>Child</code>  通过创建 <code>Father</code>  的实例赋值给自己的原型实现继承。 <code>constructor</code>  属性也指向了 <code>Father</code></p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token class-name">Child</span><span class="token punctuation">.</span>prototype<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//Father &#123; property: true &#125;</span></pre></td></tr></table></figure><p>这里发现，原型属性只有 <code>property</code>  没有 <code>cpro</code>  和 <code>name</code>  和 <code>age</code> ，因为：</p>
<ul>
<li>
<p><code>Child.prototype</code>  实际上就是个 <code>Father</code>  的实例，上述代码和如下代码实际是等价的</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Father</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//Father &#123; property: true &#125;</span></pre></td></tr></table></figure></li>
<li>
<p><code>cpro</code>  是因为本来就不是 <code>Child</code>  的原型属性，而是构造函数初始化的属性（实例的属性）</p>
</li>
<li>
<p><code>age</code>  是因为<strong>原型</strong>被覆盖了</p>
</li>
<li>
<p>通过这种方法最多继承 <code>Father</code>  的<strong>构造函数</strong>，无法继承 <code>Father</code>  的原型。可以看出， <code>property</code>  并不是原型的属性， <code>name</code>  才是，却没有被继承到 <code>Child.prototype</code>  上</p>
</li>
</ul>
<p>&lt;font color=red&gt; 但是， <code>let c=new Child()</code>  则可以访问到除了 <code>age</code>  的<strong>所有属性</strong> &lt;/font&gt;</p>
<h3 id="31-原型链"><a class="anchor" href="#31-原型链">#</a> 3.1 原型链</h3>
<p>上面已经说过，原型链就是对实例的属性的访问链。对 <code>person</code>  的 <code>property</code>  属性进行访问时，先查找实例有没有该属性（如果创建时 / 后定义修改的就是）；如果没有，像上级（原型，其实是父类）找；找到为止 / 到 null 为止</p>
<p>此外，如果用<strong>对象字面量</strong>的方法修改原型，会<strong>破坏</strong>之前的原型链</p>
<h4 id="311-默认原型"><a class="anchor" href="#311-默认原型">#</a> 3.1.1 默认原型</h4>
<p>任何函数的默认原型都是 <code>Object</code>  的<strong>实例</strong>。</p>
<p>因此实例必有一个内部指针指向 <code>Object</code> 。</p>
<p>所以所有自定义类型都能使用 <code>toString()</code>  等方法。</p>
<p>如上例子，</p>
<ol>
<li><code>Child</code>  的 <code>prototype</code>  指向 <code>Father</code>  的实例；</li>
<li><code>Father</code>  的实例通过原型链找到 <code>Father</code>  原型；</li>
<li><code>Father</code>  的<strong>默认原型</strong>指向 <code>Object</code>  的实例；</li>
<li><code>Object</code>  的实例可以通过原型链访问到这些方法如 <code>String</code> 。</li>
</ol>
<h4 id="312-原型与继承关系"><a class="anchor" href="#312-原型与继承关系">#</a> 3.1.2 原型与继承关系</h4>
<ul>
<li>
<p><code>instanceof</code> ：如果实例的原型链中出现过，则返回 <code>true</code> 。自下往上</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>c <span class="token keyword">instanceof</span> <span class="token class-name">Object</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//true</span></pre></td></tr><tr><td data-num="2"></td><td><pre>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>c <span class="token keyword">instanceof</span> <span class="token class-name">Father</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//true</span></pre></td></tr><tr><td data-num="3"></td><td><pre>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>c <span class="token keyword">instanceof</span> <span class="token class-name">Child</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//true</span></pre></td></tr></table></figure></li>
<li>
<p><code>isPrototype</code> ：原型调用，只要原型链出现过，返回 <code>true</code> 。自上往下</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token class-name">Object</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function">isPrototypeOf</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//true</span></pre></td></tr><tr><td data-num="2"></td><td><pre>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token class-name">Father</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function">isPrototypeOf</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//true</span></pre></td></tr><tr><td data-num="3"></td><td><pre>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token class-name">Child</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function">isPrototypeOf</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//true</span></pre></td></tr><tr><td data-num="4"></td><td><pre>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token class-name">Child</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function">isPrototypeOf</span><span class="token punctuation">(</span>f<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//false</span></pre></td></tr></table></figure></li>
</ul>
<h4 id="313-关于方法"><a class="anchor" href="#313-关于方法">#</a> 3.1.3 关于方法</h4>
<p>继承后可以添加新的方法和覆盖原来的旧方法。</p>
<h4 id="314-原型链的问题"><a class="anchor" href="#314-原型链的问题">#</a> 3.1.4 原型链的问题</h4>
<ul>
<li>
<p>第一个问题：包含的<strong>引用值</strong>所有实例共享，这也是为什么属性通常都在构造函数定义的原因。</p>
<p>当使用原型继承时，如果被继承的构造函数初始化了引用值（如数组），那么子类的原型也有数组，那么子类的所有对象共享一个数组</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">function</span> <span class="token function">Father</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token keyword">this</span><span class="token punctuation">.</span>arr<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">]</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">function</span> <span class="token function">Child</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token class-name">Child</span><span class="token punctuation">.</span>prototype<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Father</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token keyword">let</span> c1<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Child</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token keyword">let</span> c2<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Child</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>c1<span class="token punctuation">.</span>arr<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>c2<span class="token punctuation">.</span>arr<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//[1,2,3]</span></pre></td></tr></table></figure></li>
<li>
<p>第二个问题：子类在实例化时不能给父类的构造函数传参。即，不能有效利用父类的<strong>构造函数</strong>。</p>
</li>
</ul>
<h3 id="32-盗用构造函数"><a class="anchor" href="#32-盗用构造函数">#</a> 3.2 盗用构造函数</h3>
<p>也叫 “对象伪装” 和 “经典继承”。是为了解决原型包含<strong>引用值</strong>的继承问题。</p>
<blockquote>
<p>基本思路：在子类构造函数中调用父类构造函数。</p>
</blockquote>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">function</span> <span class="token function">Father</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token keyword">this</span><span class="token punctuation">.</span>arr<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">function</span> <span class="token function">Child</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token comment">// 继承 Father</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token function">Father</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="8"></td><td><pre></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token keyword">let</span> c1<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Child</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token keyword">let</span> c2<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Child</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>c1<span class="token punctuation">.</span>arr<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="12"></td><td><pre>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>c2<span class="token punctuation">.</span>arr<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//[1,2]</span></pre></td></tr></table></figure><p>这里就和 Python 有点像了，类似 Python 的 <code>self(this)</code></p>
<h4 id="321-传递参数"><a class="anchor" href="#321-传递参数">#</a> 3.2.1 传递参数</h4>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">function</span> <span class="token function">Father</span><span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token operator">=</span>name<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">function</span> <span class="token function">Child</span><span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token function">Father</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token keyword">this</span><span class="token punctuation">.</span>age<span class="token operator">=</span><span class="token number">26</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token keyword">let</span> c<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Child</span><span class="token punctuation">(</span><span class="token string">"joker"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre></pre></td></tr><tr><td data-num="10"></td><td><pre>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>c<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//"joker"</span></pre></td></tr></table></figure><h4 id="322-盗用构造函数的问题"><a class="anchor" href="#322-盗用构造函数的问题">#</a> 3.2.2 盗用构造函数的问题</h4>
<p>此方法的<strong>缺点</strong>是：</p>
<ol>
<li>必须在构造函数中定义方法，因此函数不能重用</li>
<li>子类不能访问在父类<strong>原型</strong>上定义的方法。（即只继承构造函数，不继承原型）</li>
</ol>
<p>因此<strong>盗用构造函数</strong>也不能单独使用</p>
<h3 id="33-组合继承"><a class="anchor" href="#33-组合继承">#</a> 3.3 组合继承</h3>
<p>也叫伪经典继承。结合了以上两种方法（原型链和盗用构造函数）</p>
<blockquote>
<p>基本思路：使用原型链继承原型上的属性和方法，使用盗用构造函数继承实例属性（构造函数）</p>
</blockquote>
<ul>
<li>在<strong>构造函数</strong>上定义<strong>属性</strong>（尤其像引用类型），这样就不会导致数组在原型上所有实例共享的情况了</li>
<li>在<strong>原型</strong>上定义<strong>方法</strong>，这样方法可以被<strong>重载</strong></li>
</ul>
<p>以上述例子为例，这时候其实实例和原型都有 <code>name</code>  属性，但根据原型链，访问到的是实例中的 <code>name</code>  属性，原型中的 <code>name</code>  属性被隐蔽。</p>
<h3 id="34-原型式继承"><a class="anchor" href="#34-原型式继承">#</a> 3.4 原型式继承</h3>
<p>如下</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">function</span> <span class="token function">object</span><span class="token punctuation">(</span><span class="token parameter">o</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token keyword">function</span> <span class="token constant">F</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token class-name">F</span><span class="token punctuation">.</span>prototype<span class="token operator">=</span>o<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">F</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>相当于对 <code>o</code>  的<strong>浅拷贝</strong>。即复制基础对象和引用对象的地址，引用对象实际上还是共享的。</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">let</span> person<span class="token operator">=</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    name<span class="token operator">:</span><span class="token string">"joker"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    friends<span class="token operator">:</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">]</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">let</span> p1<span class="token operator">=</span><span class="token function">object</span><span class="token punctuation">(</span>person<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>p1<span class="token punctuation">.</span>name<span class="token operator">=</span><span class="token string">"jack"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>p1<span class="token punctuation">.</span>friends<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>person<span class="token punctuation">.</span>friends<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//[1,2,3]</span></pre></td></tr></table></figure><p>在 ES5 后将此方法封装在了 <code>Object.create()</code>  内</p>
<ul>
<li>
<p><code>Object.create()</code> ：拷贝一个对象创建新对象</p>
<ul>
<li><code>obj</code> ：被复制的对象</li>
<li><code>k-v</code> ：可选。新增的属性。属性一样会覆盖</li>
</ul>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">let</span> p2<span class="token operator">=</span>Object<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>person<span class="token punctuation">,</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    name<span class="token operator">:</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>        value<span class="token operator">:</span><span class="token string">"mark"</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>p2<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//mark [ 1, 2 ]</span></pre></td></tr></table></figure></li>
</ul>
<p>这种方法<strong>适用于</strong>不需要单独构建函数的对象共享信息。</p>
<p>即 <code>&#123;&#125;</code>  这种像 <code>map</code>  一样的对象的信息共享（引用信息不行，是同一个）</p>
<h3 id="35-寄生式继承"><a class="anchor" href="#35-寄生式继承">#</a> 3.5 寄生式继承</h3>
<p>和原型式继承类似，不过是多添加了一个函数</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">function</span> <span class="token function">createAnthor</span><span class="token punctuation">(</span><span class="token parameter">o</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token keyword">let</span> clone<span class="token operator">=</span><span class="token function">object</span><span class="token punctuation">(</span>o<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    clone<span class="token punctuation">.</span><span class="token function-variable function">sayHi</span><span class="token operator">=</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"hi"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token keyword">return</span> <span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>寄生式继承添加函数会导致难以重载，和构造函数模式一样</p>
<h3 id="36-寄生式组合继承"><a class="anchor" href="#36-寄生式组合继承">#</a> 3.6 寄生式组合继承</h3>
<p>组合继承的问题：</p>
<ul>
<li>
<p>效率：父类构造函数始终会被<strong>调用 2 次</strong></p>
<ol>
<li>
<p>创建子类原型时 1 次（原型链继承）</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token class-name">Child</span><span class="token punctuation">.</span>prototype<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Father</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure></li>
<li>
<p>创建子类实例时 1 次（盗用构造函数继承）</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token function">Father</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span></pre></td></tr></table></figure></li>
</ol>
</li>
</ul>
<p>因此会有 2 组属性（父类构造器的属性），1 组在子类实例上，1 组在子类原型上。</p>
<p><strong>解决方法</strong>：原型的继承 用寄生式继承代替原型链继承</p>
<p>寄生式实现：直接<strong>拷贝</strong>原型</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">function</span> <span class="token function">inheritPrototype</span><span class="token punctuation">(</span><span class="token parameter">Child<span class="token punctuation">,</span>Father</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token keyword">let</span> prototype<span class="token operator">=</span><span class="token function">object</span><span class="token punctuation">(</span><span class="token class-name">Father</span><span class="token punctuation">.</span>prototype<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 或者用 Object.create ()</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    prototype<span class="token punctuation">.</span>constructor<span class="token operator">=</span>Child<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token class-name">Child</span><span class="token punctuation">.</span>prototype<span class="token operator">=</span>prototype<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>继承示例：</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">function</span> <span class="token function">Father</span><span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token operator">=</span>name<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token keyword">this</span><span class="token punctuation">.</span>arr<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">]</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token class-name">Father</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">sayName</span><span class="token operator">=</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token keyword">function</span> <span class="token function">Child</span><span class="token punctuation">(</span><span class="token parameter">name<span class="token punctuation">,</span>age</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token comment">// 继承实例属性</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    <span class="token function">Father</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>    <span class="token keyword">this</span><span class="token punctuation">.</span>age<span class="token operator">=</span><span class="token number">26</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token comment">// 继承方法</span></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token function">inheritPrototype</span><span class="token punctuation">(</span>Child<span class="token punctuation">,</span>Father<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token keyword">let</span> c<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Child</span><span class="token punctuation">(</span><span class="token string">"joker"</span><span class="token punctuation">,</span><span class="token number">26</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="16"></td><td><pre>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>c<span class="token punctuation">.</span>arr<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//[1,2]</span></pre></td></tr></table></figure><p>&lt;font color=red&gt; 不能用 <code>Child.prototype=Father.prototype</code> ，因为 <code>prototype</code>  是对象，是引用值，如果子类重写方法，那么父类的方法也会变化。所以方法不能重写。&lt;/font&gt;</p>
<p>而用 <code>inheritPrototype(Child,Father);</code> ，其 <code>prototype</code>  拷贝逻辑是</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">function</span> <span class="token function">object</span><span class="token punctuation">(</span><span class="token parameter">o</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token keyword">function</span> <span class="token constant">F</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token class-name">F</span><span class="token punctuation">.</span>prototype<span class="token operator">=</span>o<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">F</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>返回的是一个 <code>new</code>  出来的实例，这个实例作为 <code>Child</code>  的原型，也就是说， <code>Child</code>  的原型是 <code>new</code>  出来的，所以不会操作关联。</p>
<p>（可能关联的是 <code>Child</code>  的原型的原型，即 <code>Child.prototype.prototype</code> ，但对象是没有 <code>prototype</code>  属性的，所以不需要担心）</p>
<h2 id="4-类"><a class="anchor" href="#4-类">#</a> 4. 类</h2>
<blockquote>
<p>终于到类了，之前说的类都是伪类</p>
</blockquote>
<p>实际上 ES6 的类还是通过原型和构造函数实现的，不过把这些方法进行了封装。</p>
<h3 id="41-类定义"><a class="anchor" href="#41-类定义">#</a> 4.1 类定义</h3>
<p>类声明</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">class</span> <span class="token class-name">Person</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>类表达式</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">const</span> Person<span class="token operator">=</span><span class="token keyword">class</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>类的构成</p>
<ul>
<li>构造函数（可选）： <code>constructor()&#123;&#125;</code></li>
<li>get/set（可选）： <code>get name()&#123;&#125;</code></li>
<li>静态方法（可选）： <code>static method()&#123;&#125;</code></li>
</ul>
<h3 id="42-类构造函数"><a class="anchor" href="#42-类构造函数">#</a> 4.2 类构造函数</h3>
<p>构造函数，即使用 <code>new</code>  创建对象实例时调用的函数。</p>
<p>&lt;font color=red&gt;Javascript 不支持定义多个构造函数 &lt;/font&gt;</p>
<h4 id="421-实例化"><a class="anchor" href="#421-实例化">#</a> 4.2.1 实例化</h4>
<p>使用 <code>new</code>  调用类的构造器会执行如下操作：</p>
<ol>
<li>在内存中创建一个新的对象</li>
<li>新对象内部的 <code>[[Prototype]]</code>  指针被赋值为构造函数的 <code>prototype</code>  属性</li>
<li>构造函数内部的 <code>this</code>  被赋值为这个新对象</li>
<li>执行构造函数内部的代码</li>
<li>如果构造函数返回非空对象，则返回该对象；否则，返回刚创建的新对象
<ol>
<li>这里也就是说 JavaScript 的构造函数是可以 <code>return</code>  返回对象的</li>
<li>如果构造函数有返回
<ol>
<li>返回的对象会被用作实例化的对象。</li>
<li><code>this</code>  不指向返回的对象。</li>
<li>如果之后没有引用 <code>this</code>  指向的新创建的对象，那么该对象会被销毁</li>
<li><code>instanceof</code>  和类判别返回 <code>fasle</code> （ <code>per instanceof Per === false</code> ）</li>
</ol>
</li>
</ol>
</li>
</ol>
<p><strong>与 function 构造函数的区别</strong>：</p>
<ul>
<li><code>function</code>  如果不用 <code>new</code> ，则以全局（ <code>window</code> ）作为 <code>this</code></li>
<li><code>class</code>  如果不用 <code>new</code>  则会报错</li>
</ul>
<h4 id="422-把类当成特殊的函数"><a class="anchor" href="#422-把类当成特殊的函数">#</a> 4.2.2 把类当成特殊的函数</h4>
<p>JavaScript 本来没有类，ES6 的类是通过函数实现的。</p>
<ul>
<li>
<p>用 <code>typeof</code>  返回也是 <code>function</code></p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">class</span> <span class="token class-name">Person</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> Person<span class="token punctuation">)</span><span class="token comment">//function</span></pre></td></tr></table></figure></li>
<li>
<p>类标签符也有 <code>prototype</code>  属性，且 <code>prototype</code>  也有 <code>constructor</code>  属性指向自身</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token class-name">Person</span><span class="token punctuation">.</span>prototype<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//&#123;&#125;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token class-name">Person</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>constructor<span class="token operator">===</span>Person<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//true</span></pre></td></tr></table></figure></li>
<li>
<p>和 <code>function</code>  一样可以用 <code>instanceof</code>  检测实例是否存在于原型链</p>
</li>
<li>
<p>类可以像函数一样作为<strong>参数</strong>传递</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">class</span> <span class="token class-name">Person</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span>b</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token operator">+</span>b<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token keyword">function</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token parameter">add<span class="token punctuation">,</span>a<span class="token punctuation">,</span>b</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token function">test</span><span class="token punctuation">(</span>Person<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//3</span></pre></td></tr></table></figure><p>下面是函数当参数传递的例子</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">function</span> <span class="token function">sum</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span>b</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token keyword">return</span> a<span class="token operator">+</span>b<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">function</span> <span class="token function">test1</span><span class="token punctuation">(</span><span class="token parameter">add<span class="token punctuation">,</span>a<span class="token punctuation">,</span>b</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token keyword">return</span> <span class="token function">add</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span>b<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">test1</span><span class="token punctuation">(</span>sum<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//3</span></pre></td></tr></table></figure></li>
<li>
<p>类也可以<strong>立即实例化</strong>（直接创建个对象）</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">let</span> p <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">class</span> <span class="token function">Person</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">x</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">(</span><span class="token string">'bar'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//bar 表示直接以 bar 作为构造函数的传参，所以这里直接就输出 bar</span></pre></td></tr><tr><td data-num="6"></td><td><pre>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//Person &#123;&#125;</span></pre></td></tr></table></figure><p>控制台打印<img data-src="/2022/01/14/note/%E5%89%8D%E7%AB%AF/js%E9%AB%98%E7%BA%A7%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1/image-20220202194557710.png" alt="image-20220202194557710"></p>
<p>下面是函数的<strong>立即实例化</strong></p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">let</span> <span class="token function-variable function">p</span><span class="token operator">=</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">x</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">(</span><span class="token string">'bar'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//bar</span></pre></td></tr></table></figure></li>
</ul>
<h3 id="43-实例-原型和类成员"><a class="anchor" href="#43-实例-原型和类成员">#</a> 4.3 实例、原型和类成员</h3>
<h4 id="431-实例成员"><a class="anchor" href="#431-实例成员">#</a> 4.3.1 实例成员</h4>
<p>每次通过 <code>new</code>  创建新实例对象，都会执行类构造函数，在函数内部为这个实例 <code>this</code>  添加 “自有属性”。</p>
<p>每个实例都对应一个<strong>唯一</strong>的成员对象，不会在原型上共享。</p>
<h4 id="432-原型方法与访问器"><a class="anchor" href="#432-原型方法与访问器">#</a> 4.3.2 原型方法与访问器</h4>
<ul>
<li>
<p>在类块中定义的方法作为<strong>原型方法</strong></p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">class</span> <span class="token class-name">Person</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function-variable function">locate</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=></span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"joker"</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="5"></td><td><pre>        <span class="token punctuation">&#125;</span><span class="token comment">// 这里如果对象实例调用了构造函数，locale 把原型上的 locale 覆盖</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token comment">// 直接在类块里面定义相当于是定义在 prototype 上</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token function">locate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"mark"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="12"></td><td><pre></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token keyword">let</span> person<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="14"></td><td><pre>person<span class="token punctuation">.</span><span class="token function">locate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//joker</span></pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token class-name">Person</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function">locate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//mark</span></pre></td></tr></table></figure><p>其实和 <code>function</code>  对象类似，在构造器上定义的是实例属性 / 方法。在构造器外（类块）定义的是原型属性 / 方法</p>
</li>
<li>
<p>使用 <code>=</code>  定义成员变量</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">class</span> <span class="token class-name">Person</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    name<span class="token operator">:</span><span class="token string">"joker"</span><span class="token punctuation">;</span><span class="token comment">// 报错 SyntaxError: Unexpected identifier</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>不能在类块定义<strong>原型</strong>的属性</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">class</span> <span class="token class-name">Person</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    name<span class="token operator">=</span><span class="token string">"joker"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">let</span> person<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>person<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//joker</span></pre></td></tr><tr><td data-num="6"></td><td><pre>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token class-name">Person</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//undefined</span></pre></td></tr></table></figure></li>
<li>
<p>类方法等同于对象属性，可以使用字符串、符号、或计算的值作为键</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">const</span> symbolKey<span class="token operator">=</span><span class="token function">Symbol</span><span class="token punctuation">(</span><span class="token string">'symbolKey'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">class</span> <span class="token class-name">Person</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token function">stringKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"字符串键"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token punctuation">[</span>symbolKey<span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"符号键"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token punctuation">[</span><span class="token string">'computed'</span><span class="token operator">+</span><span class="token string">'Key'</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>         console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"计算值键"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token keyword">let</span> person<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="14"></td><td><pre>person<span class="token punctuation">.</span><span class="token function">stringKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 字符串键</span></pre></td></tr><tr><td data-num="15"></td><td><pre>person<span class="token punctuation">[</span>symbolKey<span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 符号键</span></pre></td></tr><tr><td data-num="16"></td><td><pre>person<span class="token punctuation">.</span><span class="token function">computedKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 计算值键</span></pre></td></tr></table></figure></li>
<li>
<p>支持 <code>get/set</code>  函数</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">class</span> <span class="token class-name">Person</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token keyword">set</span> <span class="token function">name</span><span class="token punctuation">(</span><span class="token parameter">newName</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>        <span class="token keyword">this</span><span class="token punctuation">.</span>name_<span class="token operator">=</span>newName<span class="token punctuation">;</span><span class="token comment">// 之前说过，_表示变量不想被直接访问到</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token keyword">get</span> <span class="token function">name</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>name_<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token keyword">let</span> person<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>person<span class="token punctuation">.</span>name<span class="token operator">=</span><span class="token string">'joker'</span><span class="token punctuation">;</span><span class="token comment">// 调用 set</span></pre></td></tr><tr><td data-num="11"></td><td><pre>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>person<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 调用 get</span></pre></td></tr></table></figure><p>所以一般变量的定义通过 <code>get/set</code>  函数</p>
</li>
</ul>
<h4 id="433-静态类方法"><a class="anchor" href="#433-静态类方法">#</a> 4.3.3 静态类方法</h4>
<p>这里和 Java 一样</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">class</span> <span class="token class-name">Person</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token comment">// 定义在类本身上</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token keyword">static</span> <span class="token function">sayHi</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'hi!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token keyword">static</span> name1<span class="token operator">=</span><span class="token string">'joker'</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    name2<span class="token operator">=</span><span class="token string">"mark"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token keyword">static</span> <span class="token function">sayName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>name1<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>name2<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//undefined</span></pre></td></tr><tr><td data-num="11"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="13"></td><td><pre>Person<span class="token punctuation">.</span><span class="token function">sayHi</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//hi!</span></pre></td></tr><tr><td data-num="14"></td><td><pre>Person<span class="token punctuation">.</span><span class="token function">sayName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//joker undefined</span></pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token class-name">Person</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function">sayHi</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 报错</span></pre></td></tr></table></figure><ul>
<li>直接通过<strong>类名</strong>调用</li>
<li>和 Java 一样，静态方法只能访问静态属性</li>
<li>静态方法定义在<strong>类本身</strong>上，而不是原型上</li>
</ul>
<h4 id="434-非函数原型和类成员"><a class="anchor" href="#434-非函数原型和类成员">#</a> 4.3.4 非函数原型和类成员</h4>
<p>虽然不支持在类块内添加原型的数据属性，但可以在<strong>外面添加</strong>。</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">class</span> <span class="token class-name">Person</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token class-name">Person</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>name<span class="token operator">=</span><span class="token string">"joker"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token class-name">Person</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//joker</span></pre></td></tr></table></figure><p>为什么不支持在类里显式地添加原型数据属性？</p>
<p>因为原型属性是类所有对象共有的，一般每个对象的数据属性都不同。数据是必然被覆盖的，保存一个必然被覆盖（无用武之地）的数据的值有什么意义呢？</p>
<p>一般来说，对象实例独自拥有通过 <code>this</code>  引用的数据。</p>
<h4 id="435-迭代器与生成器的方法暂缓迭代器和生成器还没看"><a class="anchor" href="#435-迭代器与生成器的方法暂缓迭代器和生成器还没看">#</a> 4.3.5 迭代器与生成器的方法（暂缓，迭代器和生成器还没看）</h4>
<h3 id="44-继承"><a class="anchor" href="#44-继承">#</a> 4.4 继承</h3>
<p>前面讲的是 ES5 的继承，这里是 ES6 class 的继承</p>
<h4 id="441-继承基础"><a class="anchor" href="#441-继承基础">#</a> 4.4.1 继承基础</h4>
<p>ES6 支持<strong>单继承</strong>（不能同时继承多个类），使用 <code>extends</code>  关键字，就可以继承任何拥有 <code>[[Construct]]</code>  的原型和对象（因此也可以继承构造函数）</p>
<ul>
<li>
<p>类继承（静态方法也能继承）</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">class</span> <span class="token class-name">Person</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    name<span class="token operator">=</span><span class="token string">'queen'</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    friend<span class="token operator">=</span><span class="token string">'king'</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token function">getFriend</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>friend<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token comment">// 类继承</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token keyword">class</span> <span class="token class-name">Child</span> <span class="token keyword">extends</span> <span class="token class-name">Person</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    friend<span class="token operator">=</span><span class="token string">'jack'</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token keyword">let</span> cld<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Child</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token keyword">let</span> person<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="14"></td><td><pre>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>cld<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//queen</span></pre></td></tr><tr><td data-num="15"></td><td><pre>cld<span class="token punctuation">.</span><span class="token function">getFriend</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//Jack</span></pre></td></tr><tr><td data-num="16"></td><td><pre>person<span class="token punctuation">.</span><span class="token function">getFriend</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//king</span></pre></td></tr></table></figure></li>
<li>
<p>构造函数继承</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">function</span> <span class="token function">Person</span><span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token operator">=</span>name<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">class</span> <span class="token class-name">Child</span> <span class="token keyword">extends</span> <span class="token class-name">Person</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">let</span> cld<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Child</span><span class="token punctuation">(</span><span class="token string">"jack"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>cld<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//jack</span></pre></td></tr><tr><td data-num="7"></td><td><pre>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>cld <span class="token keyword">instanceof</span> <span class="token class-name">Person</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//true</span></pre></td></tr></table></figure></li>
</ul>
<p>类上定义的方法和变量都会带到派生类上</p>
<h4 id="442-构造函数-homeobject-和-super"><a class="anchor" href="#442-构造函数-homeobject和super">#</a> 4.4.2 构造函数、HomeObject 和 super ()</h4>
<p>派生类方法可以通过 <code>super</code>  关键字引用他们的原型（父类），一般用于重载函数， <code>super</code>  就是调用父类的<strong>对应函数</strong></p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">class</span> <span class="token class-name">Person</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>        <span class="token keyword">this</span><span class="token punctuation">.</span>name_<span class="token operator">=</span>name<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="5"></td><td><pre></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token keyword">static</span> <span class="token function">sayHi</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'hi!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    friend<span class="token operator">=</span><span class="token string">'joker'</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    <span class="token function">sayFriend</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>friend<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="12"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token comment">// 继承</span></pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token keyword">class</span> <span class="token class-name">Child</span> <span class="token keyword">extends</span> <span class="token class-name">Person</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="16"></td><td><pre>    <span class="token comment">// 构造函数使用 super</span></pre></td></tr><tr><td data-num="17"></td><td><pre>    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">name<span class="token punctuation">,</span>age</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="18"></td><td><pre>        <span class="token keyword">super</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="19"></td><td><pre>        <span class="token keyword">this</span><span class="token punctuation">.</span>age_<span class="token operator">=</span>age<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="20"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="21"></td><td><pre>    <span class="token comment">// 静态方法使用 super</span></pre></td></tr><tr><td data-num="22"></td><td><pre>    <span class="token keyword">static</span> <span class="token function">sayHi</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="23"></td><td><pre>        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">sayHi</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="24"></td><td><pre>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'again hi hi'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="25"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="26"></td><td><pre>    <span class="token comment">// 普通原型方法使用 super</span></pre></td></tr><tr><td data-num="27"></td><td><pre>    <span class="token function">sayFriend</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="28"></td><td><pre>        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">sayFriend</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="29"></td><td><pre>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"new frined is king"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="30"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="31"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="32"></td><td><pre></pre></td></tr><tr><td data-num="33"></td><td><pre><span class="token keyword">let</span> cld<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Child</span><span class="token punctuation">(</span><span class="token string">'jack'</span><span class="token punctuation">,</span><span class="token number">26</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="34"></td><td><pre>Child<span class="token punctuation">.</span><span class="token function">sayHi</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="35"></td><td><pre>cld<span class="token punctuation">.</span><span class="token function">sayFriend</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p>控制台输出：<img data-src="/2022/01/14/note/%E5%89%8D%E7%AB%AF/js%E9%AB%98%E7%BA%A7%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1/image-20220202215426211-16438100670181.png" alt="image-20220202215426211"></p>
<ul>
<li>
<p>构造器使用 <code>super</code>  的语法： <code>super(参数)</code></p>
</li>
<li>
<p>方法使用 <code>super</code>  的语法： <code>super.method(...args)</code></p>
</li>
<li>
<p>构造函数不能在 <code>super</code>  之前使用 <code>this</code> ，换言之，重写时一定要用 <code>super</code> 。（方法重新写不需要这样）</p>
<p>或者不写 <code>super</code> ，直接返回一个对象。</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token keyword">return</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure></li>
</ul>
<h4 id="443-抽象基类抽象类-接口"><a class="anchor" href="#443-抽象基类抽象类-接口">#</a> 4.4.3 抽象基类（抽象类、接口）</h4>
<p>即抽象类，抽象类有 2 个特点：</p>
<ol>
<li>可供其他类继承，但本身<strong>不被实例化</strong>。</li>
<li>子类继承一定要实现<strong>抽象函数</strong></li>
</ol>
<h5 id="1-不被实例化"><a class="anchor" href="#1-不被实例化">#</a> 1. 不被实例化</h5>
<p>ES 中没有这种语法，但可以通过 <code>new.target</code>  实现。</p>
<p><strong>通过 <code>new.target</code>  阻止抽象类实例化，如下：</strong></p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">// 抽象类</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">class</span> <span class="token class-name">Vehicle</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">new</span><span class="token punctuation">.</span>target<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">new</span><span class="token punctuation">.</span>target<span class="token operator">===</span>Vehicle<span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'Vehicle不能被实例化'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token comment">// 派生类</span></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token keyword">class</span> <span class="token class-name">Bus</span> <span class="token keyword">extends</span> <span class="token class-name">Vehicle</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="12"></td><td><pre></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token keyword">new</span> <span class="token class-name">Bus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//[class Bus extends Vehicle]</span></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token keyword">try</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="15"></td><td><pre>    <span class="token keyword">new</span> <span class="token class-name">Vehicle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//[class Vehicle]</span></pre></td></tr><tr><td data-num="16"></td><td><pre><span class="token punctuation">&#125;</span><span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="17"></td><td><pre>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//Error: Vehicle 不能被实例化</span></pre></td></tr><tr><td data-num="18"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>以上可知， <code>new.target</code>  返回当前对象直属的类。检验 <code>Vehicle</code>  类就报错。</p>
<p><strong>但是为什么不直接在构造函数输出错误呢？</strong></p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'Vehicle不能被实例化'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>因为 <code>Vehicle</code>  的构造函数会<strong>继承</strong>给子类，这样的话子类也不能实例化了</p>
<h5 id="2-一定要被实现的抽象函数"><a class="anchor" href="#2-一定要被实现的抽象函数">#</a> 2. 一定要被实现的抽象函数</h5>
<p>JavaScript 也没有抽象函数，但可以通过 <code>this.method()</code>  是否存在来限制函数的实现。如下</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">class</span> <span class="token class-name">Vehicle</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">new</span><span class="token punctuation">.</span>target<span class="token operator">===</span>Vehicle<span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'Vehicle不能被实例化'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>        <span class="token comment">// 抽象函数</span></pre></td></tr><tr><td data-num="7"></td><td><pre>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>foo<span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'foo方法没被实现'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>通过判断 <code>foo</code>  函数有没有被定义（如果未定义就是 <code>undefined</code> ，布尔判断为假）</p>
<hr>
<p>&lt;font color=red&gt; 虽然 JavaScript 可以实现抽象类的功能，但编写失误时（继承抽象类却没实现抽象函数）编译器不会报警，较之 Java 等语言容易出错 &lt;/font&gt;</p>
<h4 id="444-继承内置类型"><a class="anchor" href="#444-继承内置类型">#</a> 4.4.4 继承内置类型</h4>
<p>也就是继承 <code>Array</code> 、 <code>Math</code>  这些原本就有的内置类型。相当于对其再次封装，基于他们添加自己想要的功能</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">class</span> <span class="token class-name">SuperArray</span> <span class="token keyword">extends</span> <span class="token class-name">Array</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    </pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token punctuation">&#125;</span><span class="token comment">// 如此这般</span></pre></td></tr></table></figure><h4 id="445-类混入多继承"><a class="anchor" href="#445-类混入多继承">#</a> 4.4.5 类混入（多继承）</h4>
<p>JavaScript 没有多继承的功能，但同样可以通过其他方法实现。</p>
<p>如果只是需要合并多个对象的<strong>属性</strong>，使用 <code>Object.assign</code>  便足够</p>
<p><strong>混入模式</strong>：B 继承 A，C 继承 B，D 继承 C。这样就相当于 D 继承了 A、B、C。</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">class</span> <span class="token class-name">Aaa</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">let</span> <span class="token function-variable function">Bbb</span><span class="token operator">=</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">SuperClass</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token comment">// 继承方法，返回一个继承 Super 且定义了 foo 方法的类</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token keyword">return</span> <span class="token keyword">class</span> <span class="token class-name">extends</span> SuperClass<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>        <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'foo'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token punctuation">&#125;</span> </pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token keyword">let</span> <span class="token function-variable function">Ccc</span><span class="token operator">=</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">SuperClass</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="12"></td><td><pre>    <span class="token keyword">return</span> <span class="token keyword">class</span> <span class="token class-name">extends</span> SuperClass<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="13"></td><td><pre>        <span class="token function">bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="14"></td><td><pre>            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'bar'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="15"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="16"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="18"></td><td><pre><span class="token keyword">class</span> <span class="token class-name">Ddd</span> <span class="token keyword">extends</span> <span class="token class-name">Ccc</span><span class="token punctuation">(</span><span class="token function">Bbb</span><span class="token punctuation">(</span>Aaa<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token comment">// 现在 D 就继承了 ABC</span></pre></td></tr><tr><td data-num="19"></td><td><pre><span class="token comment">//Bbb (Aaa) 返回继承了 Aaa 的 Bbb 类</span></pre></td></tr></table></figure><p>简化</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">class</span> <span class="token class-name">Aaa</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">let</span> <span class="token function-variable function">Bbb</span><span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">SuperClass</span><span class="token punctuation">)</span><span class="token operator">=></span><span class="token keyword">class</span> <span class="token class-name">extends</span> SuperClass<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>        <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'foo'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token keyword">let</span> <span class="token function-variable function">Ccc</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token parameter">SuperClass</span><span class="token punctuation">)</span><span class="token operator">=></span><span class="token keyword">class</span> <span class="token class-name">extends</span> SuperClass<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>        <span class="token function">bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'bar'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>通过辅助函数把<strong>嵌套调用展开</strong></p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">function</span> <span class="token function">mix</span><span class="token punctuation">(</span><span class="token parameter">BaseClass<span class="token punctuation">,</span><span class="token operator">...</span>Mixins</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token keyword">return</span> Mixins<span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">accumulator<span class="token punctuation">,</span>current</span><span class="token punctuation">)</span><span class="token operator">=></span><span class="token function">current</span><span class="token punctuation">(</span>accumulator<span class="token punctuation">)</span><span class="token punctuation">,</span>BaseClass<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">class</span> <span class="token class-name">Ddd</span> <span class="token keyword">extends</span> <span class="token class-name">mix</span><span class="token punctuation">(</span>Aaa<span class="token punctuation">,</span>Bbb<span class="token punctuation">,</span>Ccc<span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token comment">// 现在 D 就继承了 ABC</span></pre></td></tr></table></figure><p>&lt;font color=red&gt; 不过这种方法不能同时继承已定义好的类，如同时继承 <code>Array</code>  和 <code>String</code> 。而且被继承的类都是自己一步步实现的（感觉好像直接写在一个类上也差不多）&lt;/font&gt;</p>
<p>因为这是<strong>串行</strong>的多继承，一个继承一个，而不是<strong>并行</strong>的多继承。</p>
<p>并行多继承需要解决以下问题：</p>
<ol>
<li>当 2 个父类有同名函数，用哪个</li>
<li>等...</li>
</ol>
<p>不过好像网上<strong>不太建议</strong>使用多继承</p>
<h1 id="九-反射与代理"><a class="anchor" href="#九-反射与代理">#</a> 九、 反射与代理</h1>
<h1 id="十-函数"><a class="anchor" href="#十-函数">#</a> 十、 函数</h1>
<p>JavaScript 中函数实际上是<strong>对象</strong>，每个函数都是 <code>Function</code>  类型的实例</p>
<p>函数有多种定义方法：</p>
<ul>
<li>
<p>函数声明定义：这种方法会<strong>自动提升</strong>，即调用函数的代码可以写在定义函数的代码上面</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">function</span> <span class="token function">sum</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span>b</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token keyword">return</span> a<span class="token operator">+</span>b<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure></li>
<li>
<p>函数表达式</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">let</span> <span class="token function-variable function">sum</span><span class="token operator">=</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span>b</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token keyword">return</span> a<span class="token operator">+</span>b<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>函数表达式可以简化为<strong>箭头函数</strong>，如下</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">let</span> <span class="token function-variable function">sum</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span>b</span><span class="token punctuation">)</span><span class="token operator">=></span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token keyword">return</span> a<span class="token operator">+</span>b<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure></li>
<li>
<p>利用 <code>Function</code>  构造函数（不推荐）</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">let</span> sum<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Function</span><span class="token punctuation">(</span><span class="token string">"a"</span><span class="token punctuation">,</span><span class="token string">"b"</span><span class="token punctuation">,</span><span class="token string">"return a+b"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 不推荐</span></pre></td></tr></table></figure><p>这种方法不常用，也影响性能（代码会被解释 2 次）</p>
</li>
</ul>
<h2 id="1-箭头函数es6-新增"><a class="anchor" href="#1-箭头函数es6新增">#</a> 1. 箭头函数（ES6 新增）</h2>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">// 定义函数</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">let</span> <span class="token function-variable function">sum</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span>b</span><span class="token punctuation">)</span><span class="token operator">=></span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token keyword">return</span> a<span class="token operator">+</span>b<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token comment">// 嵌入</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token keyword">let</span> arr<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>arr<span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span>b</span><span class="token punctuation">)</span><span class="token operator">=></span>a<span class="token operator">-</span>b<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p>和 Java 的 lambda 表达式一样，主要注意以下几点</p>
<ul>
<li>
<p><strong>有且仅有</strong>一个参数，可以不写括号</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">let</span> <span class="token function-variable function">double</span><span class="token operator">=</span><span class="token parameter">x</span><span class="token operator">=></span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token keyword">return</span> <span class="token number">2</span><span class="token operator">*</span>x<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure></li>
<li>
<p>只有一行代码可以不写大括号（会返回值）</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">let</span> <span class="token function-variable function">sayName</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token parameter">x</span><span class="token punctuation">)</span><span class="token operator">=></span>x<span class="token punctuation">.</span>name<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token comment">// 等效于</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">let</span> <span class="token function-variable function">sayName</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token parameter">x</span><span class="token punctuation">)</span><span class="token operator">=></span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token keyword">return</span> x<span class="token punctuation">.</span>name<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure></li>
<li>
<p>箭头函数的<strong>限制</strong></p>
<ul>
<li>不能使用 <code>arguments</code> 、 <code>super</code> 、和 <code>new.target</code></li>
<li>不能用作构造函数</li>
<li>没有 <code>prototype</code>  属性</li>
</ul>
</li>
</ul>
<p>可以认为箭头函数只能做函数，不能做对象用</p>
<h2 id="2-函数名"><a class="anchor" href="#2-函数名">#</a> 2. 函数名</h2>
<ul>
<li>
<p>函数名就是指向函数的<strong>指针</strong>，可以赋值给别的标识符。</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">let</span> <span class="token function-variable function">sum</span><span class="token operator">=</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span>b</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token keyword">return</span> a<span class="token operator">+</span>b<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">let</span> copySum<span class="token operator">=</span>sum<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">copySum</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//3</span></pre></td></tr></table></figure></li>
<li>
<p>ES6 中所有函数对象都有一个 <code>name</code>  属性，保存函数名</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>sum<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//sum</span></pre></td></tr><tr><td data-num="2"></td><td><pre>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=></span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//'', 空字符串</span></pre></td></tr></table></figure></li>
</ul>
<h2 id="3-理解参数"><a class="anchor" href="#3-理解参数">#</a> 3. 理解参数</h2>
<p>ECMAScript 函数既不关心传入的参数个数，也不关心这些参数的数据类型。定义时要接受 2 个参数，但调用时只传 1 个也没事</p>
<p>&lt;font color=red&gt; 因为在 ECMAScript 的参数内部表现为一个<strong>数组</strong> &lt;/font&gt;</p>
<ul>
<li>
<p><code>arguments</code> ：函数内属性，是个<strong>类数组</strong>对象。返回接受的参数的数组</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">let</span> <span class="token function-variable function">test</span><span class="token operator">=</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>arguments<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//[Arguments] &#123; '0': 1, '1': 2, '2': 3 &#125;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>arguments<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//1</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token function">test</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p>这样一来，开发者想传多少参数就传多少，相当于弥补了 JavaScript 函数不能重载的缺失</p>
</li>
<li>
<p><strong>函数域</strong>内修改 <code>arguments</code>  会自动同步对应的参数，使之同步更改</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">let</span> <span class="token function-variable function">test1</span><span class="token operator">=</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">num</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    arguments<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>num<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//10</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">let</span> num<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token function">test1</span><span class="token punctuation">(</span>num<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>num<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//1，只是函数域内的 num 变了，外部的是不能改变的</span></pre></td></tr></table></figure></li>
</ul>
<p><strong>箭头函数中的参数</strong></p>
<p>箭头语法没有 <code>arguments</code>  属性，不过如果是被包裹在函数内部，可以调用外部函数的 <code>arguments</code> 。（好像是句废话）</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">let</span> <span class="token function-variable function">test2</span><span class="token operator">=</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token keyword">let</span> <span class="token function-variable function">bar</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=></span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>arguments<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//5</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token function">bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token function">test2</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><h2 id="4-没有重载"><a class="anchor" href="#4-没有重载">#</a> 4. 没有重载</h2>
<p>因为 ECMAScript 函数没有签名（接收参数的类型和数量），因为参数直接由数组表示，自然也就没有重载</p>
<p>如果 2 个函数同名，那就直接<strong>重定义</strong>了</p>
<h2 id="5-默认参数值"><a class="anchor" href="#5-默认参数值">#</a> 5. 默认参数值</h2>
<p>如果函数定义了参数，但没有调用时接收到，那么可以预先设置一个默认值（通过 <code>=</code> ，ES6 新增）</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">let</span> <span class="token function-variable function">makeKing</span><span class="token operator">=</span><span class="token keyword">function</span> <span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">'King'</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token function">makeKing</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//King</span></pre></td></tr></table></figure><p>但是没 Python 那么强大，比如看下面例子</p>
<p><img data-src="/2022/01/14/note/%E5%89%8D%E7%AB%AF/js%E9%AB%98%E7%BA%A7%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1/image-20220205195028124.png" alt="image-20220205195028124"></p>
<p>调用时没有按参数名传参的功能，因此只能所有参数都输进去。如果前一个参数想直接用默认值，那么可以用 <code>undefined</code>  填充代替，如<img data-src="/2022/01/14/note/%E5%89%8D%E7%AB%AF/js%E9%AB%98%E7%BA%A7%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1/image-20220205195237716.png" alt="image-20220205195237716"></p>
<p>此外，默认参数还有一些特性：</p>
<ul>
<li>
<p>可以用函数作为默认参数（当然调用时也可以以函数传参）</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">function</span> <span class="token function">getN</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token keyword">return</span> <span class="token number">26</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">function</span> <span class="token function">makeKing</span><span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">'King'</span><span class="token punctuation">,</span>age<span class="token operator">=</span><span class="token function">getN</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span>age<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//King 26</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure></li>
<li>
<p>后面的默认值可以<strong>引用前面</strong>定义的参数</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">function</span> <span class="token function">makeKing</span><span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">'King'</span><span class="token punctuation">,</span>name2<span class="token operator">=</span>name<span class="token operator">+</span><span class="token number">26</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span>name2<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//King King26</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>但前面的不能引用后面的</p>
</li>
</ul>
<h2 id="6-参数扩展与收集"><a class="anchor" href="#6-参数扩展与收集">#</a> 6. 参数扩展与收集</h2>
<h3 id="61-扩展参数"><a class="anchor" href="#61-扩展参数">#</a> 6.1 扩展参数</h3>
<p>即扩展操作符 <code>...</code>  的用法</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">let</span> arr<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">let</span> <span class="token function-variable function">getSum</span><span class="token operator">=</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token keyword">let</span> sum<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token keyword">of</span> arguments<span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>        sum<span class="token operator">+=</span>i<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token keyword">return</span> sum<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">getSum</span><span class="token punctuation">(</span><span class="token operator">...</span>arr<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//6</span></pre></td></tr></table></figure><h3 id="62-收集参数"><a class="anchor" href="#62-收集参数">#</a> 6.2 收集参数</h3>
<p>可以用 <code>...</code>  作为定义函数时的参数，如下</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">let</span> <span class="token function-variable function">getSum</span><span class="token operator">=</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">value1<span class="token punctuation">,</span>value2<span class="token punctuation">,</span><span class="token operator">...</span>values</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token keyword">return</span> values<span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">x<span class="token punctuation">,</span>y</span><span class="token punctuation">)</span><span class="token operator">=></span>x<span class="token operator">+</span>y<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token operator">+</span>value1<span class="token operator">+</span>value2<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">getSum</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token operator">...</span>arr<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//9</span></pre></td></tr></table></figure><blockquote>
<p>values.reduce ((x,y)=&gt;x+y,0) 是数组求和的代码，reduce 函数之后再介绍</p>
</blockquote>
<p>但是只能做为<strong>最后一个</strong>参数，像下面这样是<strong>不行</strong>的</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">let</span> <span class="token function-variable function">getSum</span><span class="token operator">=</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>values<span class="token punctuation">,</span>value2</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token comment">// 报错 No parameter is allowed after rest parameter</span></pre></td></tr></table></figure><h2 id="7-函数声明与函数表达式"><a class="anchor" href="#7-函数声明与函数表达式">#</a> 7. 函数声明与函数表达式</h2>
<p>函数声明： <code>function method()&#123;&#125;</code></p>
<p>函数表达式： <code>let method=function()&#123;&#125;</code></p>
<p>前面已经说过，可以在函数声明前调用函数，但不能在函数表达式前调用该函数。因为在执行代码前，JavaScript 引擎会<strong>先扫描一遍</strong>，发现函数声明就将其<strong>提升</strong>到源代码树顶部，即<strong>函数声明提升</strong>。</p>
<p>除此之外，两者是等价的</p>
<h2 id="8-函数作为值"><a class="anchor" href="#8-函数作为值">#</a> 8. 函数作为值</h2>
<p>因为函数名在 ECMAScript 中就是变量，因此函数可以用在任何可以使用变量的地方。&lt;font color=red&gt; 包括作为函数的参数 &lt;/font&gt;</p>
<ul>
<li>
<p>函数作为参数</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">function</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span>b</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token keyword">return</span> a<span class="token operator">+</span>b<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">function</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span>b<span class="token punctuation">,</span>func</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token keyword">return</span> <span class="token function">func</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span>b<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">test</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span>add<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//3</span></pre></td></tr></table></figure><p>&lt;font color=red&gt; 注：这里的<strong>函数名做参数</strong>和前面的<strong>调用函数做默认值</strong>还是有区别的 &lt;/font&gt;，如果是访问函数而不是调用函数，那么必须不带括号。</p>
</li>
<li>
<p>函数作为返回值</p>
<p><strong>可以用这个功能定义 <code>sort</code>  的多种排序方法</strong>，如下</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">// 根据参数 1 升序，参数 2 降序</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">function</span> <span class="token function">nameList</span><span class="token punctuation">(</span><span class="token parameter">arg1<span class="token punctuation">,</span>arg2</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">obj1<span class="token punctuation">,</span>obj2</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>        <span class="token keyword">if</span> <span class="token punctuation">(</span>obj1<span class="token punctuation">[</span>arg1<span class="token punctuation">]</span><span class="token operator">&lt;</span>obj2<span class="token punctuation">[</span>arg1<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>            <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>        <span class="token punctuation">&#125;</span><span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>obj1<span class="token punctuation">[</span>arg1<span class="token punctuation">]</span><span class="token operator">></span>obj2<span class="token punctuation">[</span>arg1<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>            <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>        <span class="token punctuation">&#125;</span><span class="token keyword">else</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>            <span class="token keyword">return</span> obj2<span class="token punctuation">[</span>arg2<span class="token punctuation">]</span><span class="token operator">-</span>obj1<span class="token punctuation">[</span>arg2<span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token keyword">let</span> list<span class="token operator">=</span><span class="token punctuation">[</span></pre></td></tr><tr><td data-num="14"></td><td><pre>    <span class="token punctuation">&#123;</span>name<span class="token operator">:</span><span class="token string">'joker'</span><span class="token punctuation">,</span>age<span class="token operator">:</span><span class="token number">28</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="15"></td><td><pre>    <span class="token punctuation">&#123;</span>name<span class="token operator">:</span><span class="token string">'joker'</span><span class="token punctuation">,</span>age<span class="token operator">:</span><span class="token number">26</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="16"></td><td><pre>    <span class="token punctuation">&#123;</span>name<span class="token operator">:</span><span class="token string">'mark'</span><span class="token punctuation">,</span>age<span class="token operator">:</span><span class="token number">21</span><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token punctuation">]</span></pre></td></tr><tr><td data-num="18"></td><td><pre><span class="token comment">// 根据姓名升序，根据年龄降序</span></pre></td></tr><tr><td data-num="19"></td><td><pre>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>list<span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span><span class="token function">nameList</span><span class="token punctuation">(</span><span class="token string">'name'</span><span class="token punctuation">,</span><span class="token string">'age'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="20"></td><td><pre><span class="token comment">/*[</span></pre></td></tr><tr><td data-num="21"></td><td><pre>  &#123; name: 'joker', age: 28 &#125;,</pre></td></tr><tr><td data-num="22"></td><td><pre>  &#123; name: 'joker', age: 26 &#125;,</pre></td></tr><tr><td data-num="23"></td><td><pre>  &#123; name: 'mark', age: 21 &#125;</pre></td></tr><tr><td data-num="24"></td><td><pre>]*/</pre></td></tr></table></figure></li>
</ul>
<h2 id="9-函数内部"><a class="anchor" href="#9-函数内部">#</a> 9. 函数内部</h2>
<p>ES5 中函数内部有 2 个特殊的对象 <code>arguments</code>  和 <code>this</code> ，在 ES6 中又新增了 <code>new.target</code>  属性</p>
<h3 id="91-arguments"><a class="anchor" href="#91-arguments">#</a> 9.1 arguments</h3>
<p>前面说过了，是个类数组对象，保存所有传进来的参数。 <code>arguments</code>  还有一个 <code>callee</code>  属性，是<strong>指向该函数的指针</strong>。</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">// 阶乘函数，递归实现</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">function</span> <span class="token function">fact</span><span class="token punctuation">(</span><span class="token parameter">num</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token keyword">if</span> <span class="token punctuation">(</span>num<span class="token operator">&lt;=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>        <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token punctuation">&#125;</span><span class="token keyword">else</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>        <span class="token keyword">return</span> <span class="token function">fact</span><span class="token punctuation">(</span>num<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">*</span>num<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>这种方法递归有一个<strong>问题</strong>，如果之后函数指针被拷贝并且<strong>重定义</strong>了，那么拷贝函数的逻辑会发生错误</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">let</span> f1<span class="token operator">=</span>fact<span class="token punctuation">;</span><span class="token comment">//f1 拷贝了 fact 函数</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token function-variable function">fact</span><span class="token operator">=</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">f1</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//0，预期是 120</span></pre></td></tr></table></figure><p>因为 <code>f1</code>  中有一行代码是 <code> return fact(num-1)*num;</code>  但因为 <code>fact()</code>  已经重定义了，因此 <code>f1</code>  不再是递归函数</p>
<hr>
<p>** 解决：** 可以用 <code>arguments.callee</code>  让递归与函数名解耦（就是不直接输入函数名）</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">let</span> <span class="token function-variable function">order</span><span class="token operator">=</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">root</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    arguments<span class="token punctuation">.</span><span class="token function">callee</span><span class="token punctuation">(</span>root<span class="token punctuation">.</span>left<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>root<span class="token punctuation">.</span>val<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    arguments<span class="token punctuation">.</span><span class="token function">callee</span><span class="token punctuation">(</span>root<span class="token punctuation">.</span>right<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token punctuation">&#125;</span><span class="token comment">// 使用 callee 属性递归</span></pre></td></tr></table></figure><p>这样就不会出现上面的问题了</p>
<h3 id="92-this"><a class="anchor" href="#92-this">#</a> 9.2 this</h3>
<ul>
<li><strong>标准函数</strong>： <code>this</code>  返回的是<strong>调用</strong>该函数的对象的域</li>
<li><strong>箭头函数</strong>： <code>this</code>  返回的是<strong>定义</strong>该函数的域</li>
</ul>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre>window<span class="token punctuation">.</span>color<span class="token operator">=</span><span class="token string">'red'</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">function</span> <span class="token function">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>color<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">let</span> <span class="token function-variable function">lambda</span><span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=></span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>color<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token keyword">function</span> <span class="token function">Test</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token keyword">this</span><span class="token punctuation">.</span>color<span class="token operator">=</span><span class="token string">'blue'</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    <span class="token keyword">this</span><span class="token punctuation">.</span>func<span class="token operator">=</span>func<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>    <span class="token keyword">this</span><span class="token punctuation">.</span>lambda<span class="token operator">=</span>lambda<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="12"></td><td><pre>    <span class="token function">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//red，实际上是 window.func ()，window.color=red，因此是 red</span></pre></td></tr><tr><td data-num="13"></td><td><pre>    <span class="token function">lambda</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//red</span></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token keyword">let</span> t<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Test</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="16"></td><td><pre>t<span class="token punctuation">.</span><span class="token function">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//blue</span></pre></td></tr><tr><td data-num="17"></td><td><pre>t<span class="token punctuation">.</span><span class="token function">lambda</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//red</span></pre></td></tr></table></figure><p>总之，箭头函数在定义好后 <code>this</code>  返回就已经定死了，赋值给别的函数也不行</p>
<h3 id="93-caller"><a class="anchor" href="#93-caller">#</a> 9.3 caller</h3>
<p>回调：<strong>引用调用当前函数的函数</strong>。</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">function</span> <span class="token function">outer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token function">inner</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">function</span> <span class="token function">inner</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>inner<span class="token punctuation">.</span>caller<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//outer</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token function">outer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//[Function: outer]</span></pre></td></tr></table></figure><p><code>arguments.callee</code>  是返回该函数， <code>caller</code>  是返回父函数</p>
<h3 id="94-newtarget"><a class="anchor" href="#94-newtarget">#</a> 9.4 new.target</h3>
<p>ECMAScript 中的函数始终可以作为构造函数实例化的新<strong>对象</strong>。</p>
<p>ES6 新增的 <code>new.target</code>  属性：</p>
<ul>
<li>如果函数正常调用（没有用 <code>new</code>  实例化）： <code>new.target</code>  返回 <code>undefined</code></li>
<li>如果 <code>new</code>  实例化了对象： <code>new.target</code>  返回该构造函数</li>
</ul>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">function</span> <span class="token function">King</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">new</span><span class="token punctuation">.</span>target<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">new</span> <span class="token class-name">King</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//[Function: King]</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token function">King</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//undefined</span></pre></td></tr></table></figure><h2 id="10-函数属性与方法"><a class="anchor" href="#10-函数属性与方法">#</a> 10. 函数属性与方法</h2>
<p>属性：length、prototype</p>
<p>方法：call ()、apply ()、bind ()</p>
<ul>
<li>
<p><code>length</code> ：返回函数定义时的参数个数</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">function</span> <span class="token function">sayName</span><span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">function</span> <span class="token function">sum</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span>b</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token keyword">return</span> a<span class="token operator">+</span>b<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="7"></td><td><pre></pre></td></tr><tr><td data-num="8"></td><td><pre>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>sayName<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//1</span></pre></td></tr><tr><td data-num="9"></td><td><pre>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>sum<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//2</span></pre></td></tr></table></figure></li>
<li>
<p><code>prototype</code> ：原型，前面讲了很多了</p>
</li>
</ul>
<p>接下来是方法，这些方法主要是以何种（作用域、参数）调用函数的方法</p>
<ul>
<li>
<p><code>apply()</code> ：以指定的 <code>this</code>  和参数调用函数</p>
<ul>
<li><code>this</code> ：函数运行的指定 this</li>
<li><code>arguments</code> ：函数运行的指定参数</li>
</ul>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre>window<span class="token punctuation">.</span>num<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">function</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token parameter">num1<span class="token punctuation">,</span>num2</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token keyword">return</span> num1<span class="token operator">+</span>num2<span class="token operator">+</span><span class="token keyword">this</span><span class="token punctuation">.</span>num<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">let</span> o<span class="token operator">=</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    num<span class="token operator">:</span><span class="token number">5</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token keyword">function</span> <span class="token function">applySum</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span>b</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">add</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span>arguments<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token function">applySum</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//13</span></pre></td></tr><tr><td data-num="12"></td><td><pre>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">add</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>o<span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//8</span></pre></td></tr></table></figure></li>
<li>
<p><code>call()</code> ：和 <code>apply()</code>  一样，但它不能用 <code>arguments</code> ，只能显式地输入参数</p>
<ul>
<li><code>this</code></li>
<li>... 参数</li>
</ul>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">add</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>o<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//8</span></pre></td></tr></table></figure><p>&lt;font color=red&gt; 注意一下，call 和 apply 输入参数不太一样，apply 需要 <code>[]</code>  包裹，call 不需要 &lt;/font&gt;</p>
<p><code>apply</code>  和 <code>call</code>  最重要的是控制函数调用<strong>指定作用域</strong> <code>this</code>  的能力</p>
</li>
<li>
<p><code>bind()</code> ：创建一个新的<strong>函数实例</strong></p>
<ul>
<li><code>this</code> ：新函数的指定 this</li>
</ul>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">let</span> o<span class="token operator">=</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    color<span class="token operator">=</span><span class="token string">'blue'</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">function</span> <span class="token function">sayColor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>color<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token keyword">let</span> bindTest<span class="token operator">=</span><span class="token function">sayColor</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span>o<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 绑定了 o 的 this</span></pre></td></tr><tr><td data-num="8"></td><td><pre>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">bindTest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//blue</span></pre></td></tr></table></figure></li>
</ul>
<h2 id="11-函数表达式"><a class="anchor" href="#11-函数表达式">#</a> 11. 函数表达式</h2>
<p>这节归根结底一句话，不要把函数定义写在条件表达式内</p>
<p><strong>不要这样做</strong></p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">if</span><span class="token punctuation">(</span>condition<span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token keyword">function</span> <span class="token function">sayHi</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'hi'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token keyword">function</span> <span class="token function">sayHi</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'yo'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p><strong>改成这样</strong></p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">function</span> <span class="token function">sayHi</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token keyword">if</span><span class="token punctuation">(</span>condition<span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'hi'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'yo'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h2 id="12-递归"><a class="anchor" href="#12-递归">#</a> 12. 递归</h2>
<p>前面说过，如果把递归函数赋值给其他变量会出错，要在函数体内用 <code>arguments.callee()</code>  代替函数名。但是在<strong>严格模式</strong>不能访问 <code>arguments.callee</code> ，因此还可以使用<strong>命名函数表达式</strong></p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">const</span> fact<span class="token operator">=</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token function">f</span><span class="token punctuation">(</span><span class="token parameter">num</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token keyword">if</span><span class="token punctuation">(</span>num<span class="token operator">&lt;=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>        <span class="token keyword">return</span> <span class="token number">1</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>        <span class="token keyword">return</span> num<span class="token operator">*</span><span class="token function">f</span><span class="token punctuation">(</span>num<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><h2 id="13-尾调用优化es6-新增"><a class="anchor" href="#13-尾调用优化es6新增">#</a> 13. 尾调用优化（ES6 新增）</h2>
<p><strong>尾调用</strong>：即外部函数的返回值是一个内部函数的返回值</p>
<p>看不懂，需要在<strong>严格模式</strong>下</p>
<h2 id="14-闭包"><a class="anchor" href="#14-闭包">#</a> 14. 闭包</h2>
<p><strong>闭包</strong>：引用了另一个函数作用域中变量的函数，一般是嵌套函数</p>
<p>闭包会把其包含函数的<strong>活动对象</strong>添加到自己的作用域链，因此<strong>比其他函数更占内存</strong>。过度使用闭包可能导致内存过度占用，不建议经常使用闭包。这里详细解释一下：</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">function</span> <span class="token function">outer</span><span class="token punctuation">(</span><span class="token parameter">num</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token keyword">return</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>        <span class="token keyword">return</span> num<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token keyword">let</span> temp<span class="token operator">=</span><span class="token function">outer</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>temp<span class="token operator">=</span><span class="token keyword">null</span><span class="token punctuation">;</span><span class="token comment">// 直到此时内存才被释放</span></pre></td></tr></table></figure><p>闭包会引用外部函数的变量，在外部函数返回匿名函数（闭包）时，内部函数（闭包）会将外部函数的局部活动对象添加到自己的作用域链中，即外部函数被另一个作用域<strong>引用</strong>了，就无法被回收。只有外部引用 temp 解除对函数的引用，才能释放内存。</p>
<hr>
<p>不过以上是因为返回了函数，如果仅仅是返回常量应该不会这样</p>
<h3 id="141-this-对象"><a class="anchor" href="#141-this对象">#</a> 14.1 this 对象</h3>
<p>内部函数会造成 this 指向错误，看下面例子</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre>window<span class="token punctuation">.</span>identity<span class="token operator">=</span><span class="token string">'Window'</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">let</span> obj<span class="token operator">=</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    identity<span class="token operator">:</span><span class="token string">'Obj'</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token function">getIdentity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>        <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>            <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>identity<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>obj<span class="token punctuation">.</span><span class="token function">getIdentity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//Window</span></pre></td></tr></table></figure><p>因为内部函数永远无法获取外部函数的 <code>this</code>  和 <code>arguments</code></p>
<p>可以将 <code>this</code>  保存到其他变量中</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">let</span> obj<span class="token operator">=</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    identity<span class="token operator">:</span><span class="token string">'Obj'</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token function">getIdentity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>        <span class="token keyword">let</span> that<span class="token operator">=</span><span class="token keyword">this</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>        <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>            <span class="token keyword">return</span> that<span class="token punctuation">.</span>identity<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>obj<span class="token punctuation">.</span><span class="token function">getIdentity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//Obj</span></pre></td></tr></table></figure><p>当然这个例子不用闭包也是可以的</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">let</span> obj<span class="token operator">=</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    identity<span class="token operator">:</span><span class="token string">'Obj'</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token function">getIdentity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>identity<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>obj<span class="token punctuation">.</span><span class="token function">getIdentity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//Obj</span></pre></td></tr></table></figure><h3 id="142-内存泄漏"><a class="anchor" href="#142-内存泄漏">#</a> 14.2 内存泄漏</h3>
<p>垃圾回收机制中，被引用的作用域无法被销毁释放内存</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">function</span>  <span class="token function">showId</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token keyword">var</span> el <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">"app"</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    el<span class="token punctuation">.</span><span class="token function-variable function">onclick</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>      <span class="token function">aler</span><span class="token punctuation">(</span>el<span class="token punctuation">.</span>id<span class="token punctuation">)</span>   <span class="token comment">// 这样会导致闭包引用外层的 el，当执行完 showId 后，el 无法释放</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>这里只要匿名函数存在， <code>el</code>  就不会被回收。可以改成下面这样</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">// 改成下面</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">function</span>  <span class="token function">showId</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token keyword">var</span> el <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">"app"</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token keyword">var</span> id  <span class="token operator">=</span> el<span class="token punctuation">.</span>id</pre></td></tr><tr><td data-num="5"></td><td><pre>    el<span class="token punctuation">.</span><span class="token function-variable function">onclick</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>      <span class="token function">aler</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span>   <span class="token comment">// 这样会导致闭包引用外层的 el，当执行完 showId 后，el 无法释放</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    el <span class="token operator">=</span> <span class="token keyword">null</span>    <span class="token comment">// 主动释放 el</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>此处：</p>
<ol>
<li>将 <code>el.id</code>  保存在变量 <code>id</code>  中，消除了循环引用（闭包对 <code>el</code>  的引用）</li>
<li><code>el=null</code>  主动销毁了 <code>el</code> ，成功释放了内存</li>
</ol>
<h2 id="15-立即调用的函数表达式"><a class="anchor" href="#15-立即调用的函数表达式">#</a> 15. 立即调用的函数表达式</h2>
<p>仅使用一次的函数</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token comment">// 代码</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p>例</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">i</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//5</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><h2 id="16-私有变量"><a class="anchor" href="#16-私有变量">#</a> 16. 私有变量</h2>
<p>严格讲，JavaScript 没有<strong>私有成员</strong>的概念，所有对象属性都是公有的，但是却有<strong>私有变量</strong>的概念。</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">function</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token parameter">num1<span class="token punctuation">,</span>num2</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token keyword">let</span> sum<span class="token operator">=</span>num1<span class="token operator">+</span>num2<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token keyword">return</span> sum<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p><code>num1</code> 、 <code>num2</code>  和 <code>sum</code>  就是私有变量，在外部无法访问到。但闭包可以访问这些变量，可以通过闭包创建公有方法</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">function</span> <span class="token function">Person</span><span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function-variable function">getName</span><span class="token operator">=</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>        <span class="token keyword">return</span> name<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function-variable function">setName</span><span class="token operator">=</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>        name<span class="token operator">=</span>value<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token keyword">let</span> person<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token string">'joker'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>person<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//joker</span></pre></td></tr><tr><td data-num="11"></td><td><pre>person<span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span><span class="token string">'mark'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="12"></td><td><pre>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>person<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//mark</span></pre></td></tr></table></figure><p>这种方法是直接将 <code>get/set</code>  写在了<strong>构造函数</strong>。但是这样的<strong>缺点</strong>是每个实例都要重新创造一遍新方法</p>
<h3 id="161-静态私有变量"><a class="anchor" href="#161-静态私有变量">#</a> 16.1 静态私有变量</h3>
<ol>
<li>
<p>创建一个匿名直接函数：创建函数作用域，把<strong>静态变量</strong>存在这个作用域内</p>
</li>
<li>
<p>在作用域内创建<strong>构造函数</strong>，定义<strong>公开方法</strong></p>
</li>
</ol>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token keyword">let</span> name<span class="token operator">=</span><span class="token string">''</span><span class="token punctuation">;</span><span class="token comment">// 把变量保存在此作用域内，只要还有 Person 的引用就不会被释放</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token function-variable function">Person</span><span class="token operator">=</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>        name<span class="token operator">=</span>value<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token class-name">Person</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">getName</span><span class="token operator">=</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>        <span class="token comment">// 可以访问外部域的 name</span></pre></td></tr><tr><td data-num="8"></td><td><pre>        <span class="token keyword">return</span> name<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    <span class="token class-name">Person</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">setName</span><span class="token operator">=</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>        name<span class="token operator">=</span>value<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="12"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token keyword">let</span> person1<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token string">'joker'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="15"></td><td><pre>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>person1<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//joker</span></pre></td></tr><tr><td data-num="16"></td><td><pre>person1<span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span><span class="token string">'mark'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="17"></td><td><pre>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>person1<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//mark</span></pre></td></tr><tr><td data-num="18"></td><td><pre></pre></td></tr><tr><td data-num="19"></td><td><pre><span class="token keyword">let</span> person2<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token string">'jack'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="20"></td><td><pre>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>person1<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//jack</span></pre></td></tr><tr><td data-num="21"></td><td><pre>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>person2<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//jack</span></pre></td></tr></table></figure><p>但这样会把变量变成静态变量，是所有实例共享的</p>
<p>静态变量不用把 <code>get/set</code>  方法放在构造函数，但所有实例共享一个变量。</p>
<blockquote>
<p>使用闭包和私有变量会导致作用域链变长，查找变量的时间变长</p>
</blockquote>
<h3 id="162-模块模式"><a class="anchor" href="#162-模块模式">#</a> 16.2 模块模式</h3>
<p>就是<strong>单例对象</strong>添加私有属性和私有方法，返回公开方法和公开属性，减少全局变量的使用。</p>
<blockquote>
<p>单例对象：只有一个实例的对象</p>
</blockquote>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">let</span> <span class="token function-variable function">singleton</span><span class="token operator">=</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token comment">// 创建私有变量</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token keyword">var</span> privateNum <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token comment">// 创建私有函数</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token keyword">function</span> <span class="token function">privateFunc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>        <span class="token comment">// 实现自己的业务逻辑代码</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token comment">// 返回一个对象包含公有方法和属性</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token keyword">return</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>        publicVariable<span class="token operator">:</span> publicVariable<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="11"></td><td><pre>        publicMethod<span class="token operator">:</span> publicMethod</pre></td></tr><tr><td data-num="12"></td><td><pre>    <span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p>此处， <code>singleton</code>  最终是一个对象 <code>&#123;&#125;</code> （因为 = 直接函数），属性是公开方法和公开属性。</p>
<p>通过模块模式，我们把<strong>私有变量</strong>和<strong>私有方法</strong>定义在直接函数体内，不会被外界访问到（临时变量和方法），对象实例以 <code>&#123;&#125;</code>  形式返回，赋值给 <code>singleton</code> 。</p>
<h3 id="163-模块增强模式"><a class="anchor" href="#163-模块增强模式">#</a> 16.3 模块增强模式</h3>
<p>返回对象之前先对其进行增强。</p>
<p>适用场景：当单例对象需要是某个<strong>特定的类型</strong>，但又必须添加额外的属性或方法时</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">let</span> singleton <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token comment">// 定义私有变量和私有函数</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token keyword">let</span> privateA <span class="token operator">=</span> <span class="token string">"privateA"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token keyword">function</span> <span class="token function">privateMethodA</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>        <span class="token comment">// 函数内容</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token comment">// 特定的类型 CustomType</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token keyword">var</span> object <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CustomType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    <span class="token comment">// 添加方法和属性</span></pre></td></tr><tr><td data-num="11"></td><td><pre>    object<span class="token punctuation">.</span>publicA <span class="token operator">=</span> <span class="token string">"publicA"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="12"></td><td><pre>    object<span class="token punctuation">.</span><span class="token function-variable function">publicB</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="13"></td><td><pre>        <span class="token keyword">return</span> privateA<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="14"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="15"></td><td><pre>    <span class="token comment">// 返回该对象</span></pre></td></tr><tr><td data-num="16"></td><td><pre>    <span class="token keyword">return</span> object<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><h1 id="十一-期约与异步函数promise"><a class="anchor" href="#十一-期约与异步函数promise">#</a> 十一、 期约与异步函数（promise）</h1>
<h2 id="1-异步编程settimeout"><a class="anchor" href="#1-异步编程settimeout">#</a> 1. 异步编程（setTimeout）</h2>
<h3 id="11-同步与异步"><a class="anchor" href="#11-同步与异步">#</a> 1.1 同步与异步</h3>
<ul>
<li><strong>同步</strong>：顺序执行的处理器指令，一条条指令<strong>相继执行</strong></li>
<li><strong>异步</strong>：多条指令同时进行，互不干扰。（记得计组中是这样实现异步的：把时间分成一块块时间片，每条指令执行一个时间片，轮换执行，如 ABCDABCDABCD...）</li>
</ul>
<h3 id="12-settimeout-异步"><a class="anchor" href="#12-settimeout异步">#</a> 1.2 setTimeout 异步</h3>
<p>如下</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=></span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//1000 毫秒后执行函数</span></pre></td></tr><tr><td data-num="3"></td><td><pre>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p>控制台输出：<img data-src="/2022/01/14/note/%E5%89%8D%E7%AB%AF/js%E9%AB%98%E7%BA%A7%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1/image-20220321212349317.png" alt="image-20220321212349317"></p>
<p>此处， <code>console.log(1)</code>  和 <code>console.log(3)</code>  是顺序（同步）执行， <code>setTimeout</code>  是异步执行</p>
<hr>
<blockquote>
<p>下面的我感觉没什么好看的，P324 吧，主要是以往的异步编程及缺点</p>
<p>如：嵌套异步回调很复杂</p>
</blockquote>
<h3 id="13-settimeout-语法"><a class="anchor" href="#13-settimeout语法">#</a> 1.3 setTimeout 语法</h3>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token function">setTimeout</span><span class="token punctuation">(</span>code<span class="token punctuation">,</span> milliseconds<span class="token punctuation">,</span> param1<span class="token punctuation">,</span> param2<span class="token punctuation">,</span> <span class="token operator">...</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">,</span> milliseconds<span class="token punctuation">,</span> param1<span class="token punctuation">,</span> param2<span class="token punctuation">,</span> <span class="token operator">...</span><span class="token punctuation">)</span></pre></td></tr></table></figure><table>
<thead>
<tr>
<th style="text-align:left">参数</th>
<th style="text-align:left">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">code/function</td>
<td style="text-align:left">必需。要调用一个代码串，也可以是一个函数。</td>
</tr>
<tr>
<td style="text-align:left">milliseconds</td>
<td style="text-align:left">可选。执行或调用 code/function 需要等待的时间，以毫秒计。默认为 0。</td>
</tr>
<tr>
<td style="text-align:left">param1, param2, ...</td>
<td style="text-align:left">可选。 传给执行函数的参数</td>
</tr>
</tbody>
</table>
<p>例：</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token function">setTimeout</span><span class="token punctuation">(</span>console<span class="token punctuation">.</span>log<span class="token punctuation">,</span><span class="token number">1000</span><span class="token punctuation">,</span> <span class="token string">'hello'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//1s 后控制台打印 hello</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=></span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'hello'</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">x</span><span class="token punctuation">)</span><span class="token operator">=></span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">1000</span><span class="token punctuation">,</span><span class="token string">'hello'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><h2 id="2-期约promisees6-新增"><a class="anchor" href="#2-期约promisees6新增">#</a> 2. 期约（promise）（ES6 新增）</h2>
<p><span class="exturl" data-url="aHR0cHM6Ly93d3cuY25ibG9ncy5jb20vbHZkYWJhby9wL2VzNi1wcm9taXNlLTEuaHRtbA==">https://www.cnblogs.com/lvdabao/p/es6-promise-1.html</span> 这个比较通俗易懂</p>
<h3 id="21-期约基础"><a class="anchor" href="#21-期约基础">#</a> 2.1 期约基础</h3>
<p>期约 <code>promise</code>  是一个引用类型，以及有一些封装好的方法</p>
<ul>
<li>构造函数内： <code>resolve</code> 、 <code>reject</code> 、 <code>all</code></li>
<li>原型内： <code>then</code> 、 <code>catch</code> ...</li>
</ul>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">let</span> p<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=></span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token function">setTimeout</span><span class="token punctuation">(</span>console<span class="token punctuation">.</span>log<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span>p<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//Promise &lt;pending></span></pre></td></tr></table></figure><h4 id="211-期约的三种状态"><a class="anchor" href="#211-期约的三种状态">#</a> 2.1.1 期约的三种状态</h4>
<ul>
<li>待定（pending）： <code>promise</code>  初始态，等待接受任务</li>
<li>兑现（fulfilled，或者 resolve）：调用 <code>resolve()</code>  方法进入</li>
<li>拒绝（reject）：调用 <code>reject()</code>  进入，一般是当拒绝时（比如出错了）调用</li>
</ul>
<p>期约的状态改变<strong>不可逆</strong>，并且其状态是<strong>私有</strong>的，不能被外界读取（为了不被同步方式处理）。</p>
<blockquote>
<p>期约故意将异步行为封装起来，从而隔离外部的同步代码</p>
</blockquote>
<h4 id="212-promiseresolve"><a class="anchor" href="#212-promiseresolve">#</a> 2.1.2  <code>Promise.resolve()</code></h4>
<p>上面提过， <code>resolve</code>  用来转换 <code>promise</code>  的状态，并且做一个回调函数，在别的地方定义函数内容，一般是成功时执行。</p>
<p>而<strong>静态</strong>的 <code>resolve()</code>  方法则可用来<strong>实例化</strong>期约对象，如下</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">let</span> p1<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span>reject</span><span class="token punctuation">)</span><span class="token operator">=></span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">let</span> p2<span class="token operator">=</span>Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token comment">// 以上 2 种等价</span></pre></td></tr></table></figure><p>此外， <code>p</code>  的值对应<strong>第一个</strong>传给 <code>resolve()</code>  的参数，形如 <code>Promise &#123;参数&#125;</code> ，如下</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">let</span> p1<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span>reject</span><span class="token punctuation">)</span><span class="token operator">=></span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">let</span> p2<span class="token operator">=</span>Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>p1<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//Promise &#123; undefined &#125;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>p2<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//Promise &#123; 3 &#125;</span></pre></td></tr></table></figure><p>如果参数是个<strong>期约</strong>，那么 <code>p=Promise.resolve(p)</code> ，相当于没变，这个称作<strong>幂等性</strong></p>
<h4 id="213-promisereject"><a class="anchor" href="#213-promisereject">#</a> 2.1.3   <code>Promise.reject()</code></h4>
<p>和 <code>resolve</code>  类似。但是 <code>reject</code>  没有<strong>幂等性</strong></p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>Promise<span class="token punctuation">.</span><span class="token function">reject</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment">//Promise &#123;rejected&#125;: Promise &#123;resolve&#125;</span></pre></td></tr></table></figure><p>也就是说，p 会成为新的期约的<strong>拒绝理由</strong></p>
<h4 id="214-new-promise-详解"><a class="anchor" href="#214-new-promise详解">#</a> 2.1.4  <code>new Promise()</code>  详解</h4>
<p>通过 <code>new Promise()</code>  创建期约一般如下</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">let</span> p<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token comment">// 代码块 </span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr></table></figure><ul>
<li>
<p>代码块中的代码会被立即执行，如</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">let</span> p<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'hello promise'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token comment">// 控制台打印 hello promise</span></pre></td></tr></table></figure><p>应该是在构造函数中调用了 <code>apply</code>  函数，向下面这样</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">function</span> <span class="token function">Demo</span><span class="token punctuation">(</span><span class="token parameter">func</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token function">func</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">let</span> d<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Demo</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=></span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">123</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token comment">// 控制台打印 123</span></pre></td></tr></table></figure><p><strong>此时 p 的状态为 pending</strong></p>
</li>
<li>
<p>通过 <code>resolve()</code>  和 <code>reject()</code>  函数<strong>设置状态</strong>，同时两者都写只有前面的有效（状态不可逆）</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">let</span> p<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token function">reject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token function">setTimeout</span><span class="token punctuation">(</span>console<span class="token punctuation">.</span>log<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span>p<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//Promise &#123;undefined&#125;：就是 resolve 状态，resolve 的参数为 undefined</span></pre></td></tr></table></figure><p><strong>此时 p 的状态为 resolve</strong></p>
<p>或者如</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">let</span> p<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token function">reject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token function">setTimeout</span><span class="token punctuation">(</span>console<span class="token punctuation">.</span>log<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span>p<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//Promise &#123; &lt;rejected> undefined &#125;</span></pre></td></tr></table></figure><p><strong>此时 p 的状态为 reject</strong></p>
</li>
<li>
<p>不过因为 <code>resolve</code>  和 <code>reject</code>  是异步代码，且是类似回调函数的待重写函数，因此其只会在 <code>then</code>  或 <code>catch</code>  调用并重写 <code>resolve</code>  和 <code>reject</code>  时才会在同步代码执行完后执行。</p>
</li>
</ul>
<h4 id="215-异步的错误处理"><a class="anchor" href="#215-异步的错误处理">#</a> 2.1.5 异步的错误处理</h4>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">try</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'foo'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token punctuation">&#125;</span><span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//Error: foo</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="6"></td><td><pre></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token keyword">try</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    Promise<span class="token punctuation">.</span><span class="token function">reject</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'bar'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token punctuation">&#125;</span><span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 报错</span></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>这里，第 2 个错误<strong>没有被捕获</strong>，而是中断了进程，控制台报错。</p>
<p>因为：同步代码只能通过<strong>异步模式</strong>捕获期约抛出的错误，<strong>异步模式一旦开始执行，则唯一与之交互的方式就是使用异步结构 ---- 也就是期约的方法</strong></p>
<h3 id="22-期约的实例方法"><a class="anchor" href="#22-期约的实例方法">#</a> 2.2 期约的实例方法</h3>
<blockquote>
<p>期约的实例方法是连接外部同步代码与内部异步代码之间的桥梁。</p>
<p>这些代码可以：</p>
<ul>
<li>访问异步操作返回的数据</li>
<li>处理期约成功和失败的输出</li>
<li>连续对期约求值</li>
<li>添加只有期约进入终止状态时才会执行的代码</li>
</ul>
</blockquote>
<h4 id="221-promiseprototypethen"><a class="anchor" href="#221-promiseprototypethen">#</a> 2.2.1  <code>Promise.prototype.then()</code></h4>
<blockquote>
<p><code>then()</code>  函数是为期约实例<strong>添加处理程序</strong>的主要方法</p>
</blockquote>
<p><code>then</code>  会在 <code>promise</code> <strong> 转变状态</strong>后执行，但<strong>不会阻断</strong>执行函数内接下来的代码。其接收 2 个参数：<strong>响应解决</strong>状态的执行函数和<strong>响应拒绝</strong>状态的执行函数</p>
<ul>
<li><code>Promise.prototype.then((res) =&gt; &#123;&#125;, (rej) =&gt; &#123;&#125;)</code> ：
<ul>
<li><code>(res) =&gt; &#123;&#125;</code> ：（必写）<strong>响应解决</strong>状态的执行函数。在 <code>promise</code>  实例状态转为<strong>解决</strong>时调用。 <code>res</code>  为解决值</li>
<li><code>(rej) =&gt; &#123;&#125;</code> ：（可写）<strong>拒绝解决</strong>状态的执行函数。在 <code>promise</code>  实例状态转为<strong>拒绝</strong>时调用。 <code>rej</code>  为拒绝理由</li>
<li><code>return</code> ：一个新的 <code>promise</code>  实例。下面细说</li>
</ul>
</li>
</ul>
<p>例 1：</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">let</span> p2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token function">reject</span><span class="token punctuation">(</span><span class="token string">'reject'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token comment">// 到这一步 p2 已经是 rejected 了</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'resolve'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 因为 promise 状态只能改变一次，所以还是 rejected</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token operator">=></span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token operator">=></span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token comment">// 输出：</span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token comment">// reject</span></pre></td></tr></table></figure><p>例 2： <code>then</code>  会在 <code>promise</code> <strong> 转变状态</strong>后执行，但<strong>不会阻断</strong>执行函数内接下来的代码</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">let</span> p <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'before resolve'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>        <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'resolved'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'after resolve'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token operator">=></span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token operator">=></span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token comment">// 输出：</span></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token comment">// before resolve</span></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token comment">// after resolve</span></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token comment">// （3 秒后）resolved</span></pre></td></tr></table></figure><hr>
<p><strong>返回 <code>promise</code>  实例</strong></p>
<p>下面主要讲一下 <code>then</code>  返回的 <code>promise</code>  的情况：默认以<strong>返回值</strong>作为<strong>解决值</strong>创建<strong>解决状态</strong>的 <code>promise</code>  实例返回</p>
<p>调用 <code>then</code>  的实例 <code>p1</code>  是 <code>resolve</code></p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">let</span> p1<span class="token operator">=</span>Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'foo'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><ul>
<li>
<p>默认 <code>resolve</code>  状态，并根据 <code>then</code>  的<strong>返回值</strong>确定状态</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">let</span> p2<span class="token operator">=</span>p1<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=></span><span class="token keyword">undefined</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//Promise &#123; undefined &#125;</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">let</span> p3<span class="token operator">=</span>p1<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=></span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//Promise &#123; undefined &#125;</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">let</span> p4<span class="token operator">=</span>p1<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=></span><span class="token string">'resolve'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//Promise &#123; 'resolve' &#125;</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token comment">// 上面几种新实例都是 resolve 状态，根据返回值赋予 resolve 参数</span></pre></td></tr></table></figure></li>
<li>
<p>如果返回 <code>promise</code>  实例，按返回的实例算</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">let</span> p5<span class="token operator">=</span>p1<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=></span>Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'bar'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//Promise &#123; 'bar' &#125;</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">let</span> p6<span class="token operator">=</span>p1<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=></span>Promise<span class="token punctuation">.</span><span class="token function">reject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//Promise &#123; &lt;rejected> undefined &#125;</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">let</span> p7<span class="token operator">=</span>p1<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=></span><span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=></span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//Promise &#123; &lt;pending> &#125;</span></pre></td></tr></table></figure></li>
<li>
<p>抛出<strong>异常</strong>，按 <code>reject</code>  状态</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">let</span> p8<span class="token operator">=</span>p1<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=></span><span class="token punctuation">&#123;</span><span class="token keyword">throw</span> <span class="token string">'baz'</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//Promise &#123; &lt;rejected> 'baz' &#125;</span></pre></td></tr></table></figure></li>
<li>
<p>返回<strong>错误</strong>，也按 <code>resolve</code> 。（其实就是第一条）</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">let</span> p9<span class="token operator">=</span>p1<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=></span><span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'err'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token comment">/*</span></pre></td></tr><tr><td data-num="3"></td><td><pre>Promise &#123;</pre></td></tr><tr><td data-num="4"></td><td><pre>  Error: err</pre></td></tr><tr><td data-num="5"></td><td><pre>      at F:\JavaProject\jsdemo\practice\ 期约.js:32:20</pre></td></tr><tr><td data-num="6"></td><td><pre>      at processTicksAndRejections (internal/process/task_queues.js:93:5)</pre></td></tr><tr><td data-num="7"></td><td><pre>&#125;</pre></td></tr><tr><td data-num="8"></td><td><pre>*/</pre></td></tr></table></figure></li>
<li>
<p>只有 <code>then()</code> ，和调用 <code>then</code>  的实例一致</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">let</span> p2<span class="token operator">=</span>p1<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">////Promise &#123; 'foo' &#125;</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token comment">// 但是 p2!==p1</span></pre></td></tr></table></figure></li>
</ul>
<p>实例 <code>p1</code>  为 <code>reject</code>  或 <code>pending</code> ：和调用 <code>then</code>  的实例一致，<strong>也是创建解决状态的 <code>promise</code>  实例返回</strong></p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">let</span> p <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token function">reject</span><span class="token punctuation">(</span><span class="token string">'rejected'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// Promise &#123;undefined&#125; 以 undefined 为解决值</span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><h4 id="222-promiseprototypecatch"><a class="anchor" href="#222-promiseprototypecatch">#</a> 2.2.2  <code>Promise.prototype.catch()</code></h4>
<blockquote>
<p>用于给期约添加<strong>拒绝处理程序</strong>。调用他就相当于调用 <code>Promise.prototype.then(null,代码块)</code></p>
</blockquote>
<p><code>then</code>  和 <code>catch</code>  实际上是<strong>根据期约的状态来调用函数</strong>，类似同步代码 <code>try-catch</code></p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">let</span> p<span class="token operator">=</span>Promise<span class="token punctuation">.</span><span class="token function">reject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">let</span> <span class="token function-variable function">onRejected</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=></span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token function">setTimeout</span><span class="token punctuation">(</span>console<span class="token punctuation">.</span>log<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token string">'rejected'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="6"></td><td><pre></pre></td></tr><tr><td data-num="7"></td><td><pre>p<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span>onRejected<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//rejected</span></pre></td></tr><tr><td data-num="8"></td><td><pre>p<span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span>onRejected<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//rejected</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token comment">// 以上 2 者等价</span></pre></td></tr></table></figure><p>另外，再举个例子来说明 <code>then</code>  和 <code>catch</code> <strong> 根据实例状态调用</strong></p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">let</span> p1<span class="token operator">=</span>Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">let</span> p2<span class="token operator">=</span>Promise<span class="token punctuation">.</span><span class="token function">reject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">let</span> <span class="token function-variable function">onResolved</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=></span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token function">setTimeout</span><span class="token punctuation">(</span>console<span class="token punctuation">.</span>log<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token string">'resolved'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token keyword">let</span> <span class="token function-variable function">onRejected</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=></span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token function">setTimeout</span><span class="token punctuation">(</span>console<span class="token punctuation">.</span>log<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token string">'rejected'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="10"></td><td><pre></pre></td></tr><tr><td data-num="11"></td><td><pre>p1<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>onResolved<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span>onRejected<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//resolved</span></pre></td></tr><tr><td data-num="12"></td><td><pre>p2<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>onResolved<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span>onRejected<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//rejected</span></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token comment">// 因为 p1 的状态是 resolve, 而 p2 的状态是 reject</span></pre></td></tr></table></figure><p>此外， <code>catch</code>  返回的期约实例状态规则和 <code>then</code>  差不多（&lt;font color=red&gt; 也是默认 <code>resolve</code> &lt;/font&gt;）</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">let</span> p1<span class="token operator">=</span>Promise<span class="token punctuation">.</span><span class="token function">reject</span><span class="token punctuation">(</span><span class="token string">'foo'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">let</span> p2<span class="token operator">=</span>p1<span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//Promise &#123; &lt;rejected> 'foo' &#125;</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">let</span> p3<span class="token operator">=</span>p1<span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=></span><span class="token keyword">undefined</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//Promise &#123;undefined&#125;, 包括一些 void 类型的函数调用，如 console.log</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">let</span> p4<span class="token operator">=</span>p1<span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=></span><span class="token string">'resolve'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//Promise &#123; 'resolve' &#125;</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">let</span> p5<span class="token operator">=</span>p1<span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=></span>Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'bar'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//Promise &#123; 'bar' &#125;</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token keyword">let</span> p6<span class="token operator">=</span>p1<span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=></span>Promise<span class="token punctuation">.</span><span class="token function">reject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//Promise &#123; &lt;rejected> undefined &#125;</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token keyword">let</span> p7<span class="token operator">=</span>p1<span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=></span><span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=></span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//Promise &#123; &lt;pending> &#125;</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token keyword">let</span> p8<span class="token operator">=</span>p1<span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=></span><span class="token punctuation">&#123;</span><span class="token keyword">throw</span> <span class="token string">'baz'</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//Promise &#123; &lt;rejected> 'baz' &#125;</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token keyword">let</span> p9<span class="token operator">=</span>p1<span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=></span><span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'err'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token comment">/*</span></pre></td></tr><tr><td data-num="11"></td><td><pre>Promise &#123;</pre></td></tr><tr><td data-num="12"></td><td><pre>  Error: err</pre></td></tr><tr><td data-num="13"></td><td><pre>      at F:\JavaProject\jsdemo\demo\ 期约 \catch.js:23:21</pre></td></tr><tr><td data-num="14"></td><td><pre>&#125;</pre></td></tr><tr><td data-num="15"></td><td><pre>*/</pre></td></tr></table></figure><h4 id="223-promiseprototypefinally"><a class="anchor" href="#223-promiseprototypefinally">#</a> 2.2.3  <code>Promise.prototype.finally()</code></h4>
<blockquote>
<p>为期约添加一个 <code>onFinally</code>  处理程序，即在转换为 resolve 或 reject 状态时都会执行</p>
</blockquote>
<p><strong>用处</strong>：和 <code>try-catch</code>  中的 <code>finally</code>  类似，用来避免 <code>then</code>  和 <code>catch</code>  的代码冗余</p>
<p><strong>返回实例</strong>：原样往后传，即新实例和调用实例<strong>保持一致</strong>，除了 3 种情况</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">let</span> p1<span class="token operator">=</span>Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'foo'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 对于 Promise.reject 也是一样的情况</span></pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">let</span> p2<span class="token operator">=</span>p1<span class="token punctuation">.</span><span class="token function">finally</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//Promise &#123; 'foo' &#125;</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">let</span> p3<span class="token operator">=</span>p1<span class="token punctuation">.</span><span class="token function">finally</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=></span><span class="token keyword">undefined</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//Promise &#123; 'foo' &#125;</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">let</span> p4<span class="token operator">=</span>p1<span class="token punctuation">.</span><span class="token function">finally</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=></span><span class="token string">'resolve'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//Promise &#123; 'foo' &#125;</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token keyword">let</span> p5<span class="token operator">=</span>p1<span class="token punctuation">.</span><span class="token function">finally</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=></span>Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'bar'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//Promise &#123; 'foo' &#125;</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token keyword">let</span> p9<span class="token operator">=</span>p1<span class="token punctuation">.</span><span class="token function">finally</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=></span><span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'err'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//Promise &#123; 'foo' &#125;</span></pre></td></tr><tr><td data-num="8"></td><td><pre></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token keyword">let</span> p6<span class="token operator">=</span>p1<span class="token punctuation">.</span><span class="token function">finally</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=></span>Promise<span class="token punctuation">.</span><span class="token function">reject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//Promise &#123; &lt;rejected> undefined &#125;</span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token keyword">let</span> p7<span class="token operator">=</span>p1<span class="token punctuation">.</span><span class="token function">finally</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=></span><span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=></span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//Promise &#123; &lt;pending> &#125;</span></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token keyword">let</span> p8<span class="token operator">=</span>p1<span class="token punctuation">.</span><span class="token function">finally</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=></span><span class="token punctuation">&#123;</span><span class="token keyword">throw</span> <span class="token string">'baz'</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//Promise &#123; &lt;rejected> 'baz' &#125;</span></pre></td></tr></table></figure><ul>
<li>当返回的是拒绝 <code>reject</code>  或待定 <code>pending</code> ，则新实例按照返回的算</li>
<li>当抛出异常时，新实例为 <code>reject</code></li>
</ul>
<p><strong>使用场景</strong>：</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">let</span> p1<span class="token operator">=</span>Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">let</span> p2<span class="token operator">=</span>Promise<span class="token punctuation">.</span><span class="token function">reject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">let</span> <span class="token function-variable function">onResolved</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=></span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token function">setTimeout</span><span class="token punctuation">(</span>console<span class="token punctuation">.</span>log<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token string">'resolved'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token keyword">return</span> <span class="token string">'resolve'</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token keyword">let</span> <span class="token function-variable function">onRejected</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=></span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token function">setTimeout</span><span class="token punctuation">(</span>console<span class="token punctuation">.</span>log<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token string">'rejected'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    <span class="token keyword">return</span> <span class="token string">'reject'</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token keyword">let</span> <span class="token function-variable function">onFinally</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=></span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="13"></td><td><pre>    <span class="token function">setTimeout</span><span class="token punctuation">(</span>console<span class="token punctuation">.</span>log<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token string">'finally'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="14"></td><td><pre>    <span class="token keyword">return</span> <span class="token string">'finally'</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="16"></td><td><pre></pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token keyword">let</span> p3<span class="token operator">=</span>p1<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>onResolved<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span>onRejected<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">finally</span><span class="token punctuation">(</span>onFinally<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="18"></td><td><pre><span class="token keyword">let</span> p4<span class="token operator">=</span>p2<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>onResolved<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span>onRejected<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">finally</span><span class="token punctuation">(</span>onFinally<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p>最后输出是这样的<img data-src="/2022/01/14/note/%E5%89%8D%E7%AB%AF/js%E9%AB%98%E7%BA%A7%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1/image-20220330212934061.png" alt="image-20220330212934061">，原因很简单，因为 <code>finally</code>  也是异步，并不会像同步那样按顺序来。</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token function">setTimeout</span><span class="token punctuation">(</span>console<span class="token punctuation">.</span>log<span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">,</span>p3<span class="token punctuation">,</span>p4<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//Promise &#123; 'resolve' &#125; Promise &#123; 'reject' &#125;</span></pre></td></tr></table></figure><h4 id="224-非重入期约方法执行顺序"><a class="anchor" href="#224-非重入期约方法执行顺序">#</a> 2.2.4 非重入期约方法（执行顺序）</h4>
<ul>
<li>
<p>期约的处理程序一定在<strong>同步代码</strong>执行之后才执行</p>
</li>
<li>
<p><s> <code>then</code> 、 <code>catch</code>  函数会定义对应的 <code>resolve</code> 、 <code>reject</code>  执行方法，且将其推进<strong>消息队列</strong></s></p>
</li>
<li>
<p><s>在 <code>resolve</code> 、 <code>reject</code>  执行<strong>且</strong> <code>then</code> 、 <code>catch</code>  将其推进后，执行异步函数</s></p>
</li>
<li>
<p>上面 2 点总结一下，就是 <code>resolve</code>  异步函数执行需要满足 2 个条件</p>
<ol>
<li><code>then</code>  对其定义，并推入消息队列</li>
<li>期约转为 <code>resolve</code>  状态
<ol>
<li>如期约以 <code>Promies.resolve()</code>  创建</li>
<li>在  <code>new Promise()</code>  中调用 <code>resolve()</code></li>
</ol>
</li>
</ol>
</li>
</ul>
<p>看下面例子：</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">let</span> syn<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">let</span> p<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token function-variable function">syn</span><span class="token operator">=</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 同步</span></pre></td></tr><tr><td data-num="5"></td><td><pre>        <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 异步</span></pre></td></tr><tr><td data-num="6"></td><td><pre>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 同步</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="9"></td><td><pre></pre></td></tr><tr><td data-num="10"></td><td><pre>p<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=></span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//then 添加处理程序（resolve 的实现），把处理程序推进消息队列（在 p 的状态变为 resolve 后异步执行）</span></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token function">syn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 执行同步代码，并且改变期约状态</span></pre></td></tr><tr><td data-num="12"></td><td><pre>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 同步</span></pre></td></tr></table></figure><p>控制台输出：<img data-src="/2022/01/14/note/%E5%89%8D%E7%AB%AF/js%E9%AB%98%E7%BA%A7%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1/image-20220331150158027.png" alt="image-20220331150158027"></p>
<p>解析：</p>
<ol>
<li><code>syn</code>  是同步代码，且内部的 <code>console.log</code>  也是，因此和 <code>console.log(3)</code>  相继先行输出</li>
<li><code>p</code>  在 <code>syn</code>  调用后转为 <code>resolve</code>  状态，准备执行 <code>console.log(4)</code> （在所有同步代码执行完后）</li>
</ol>
<h4 id="225-邻近处理程序的执行顺序执行顺序-2"><a class="anchor" href="#225-邻近处理程序的执行顺序执行顺序2">#</a> 2.2.5 邻近处理程序的执行顺序（执行顺序 2）</h4>
<ul>
<li>
<p>对应同一个期约，按照<strong>添加顺序</strong>执行</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">let</span> method1<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">let</span> p1<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve</span><span class="token punctuation">)</span><span class="token operator">=></span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token function-variable function">method1</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=></span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>        <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="8"></td><td><pre></pre></td></tr><tr><td data-num="9"></td><td><pre>p1<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=></span><span class="token function">setTimeout</span><span class="token punctuation">(</span>console<span class="token punctuation">.</span>log<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>p1<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=></span><span class="token function">setTimeout</span><span class="token punctuation">(</span>console<span class="token punctuation">.</span>log<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="11"></td><td><pre></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token function">method1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p>控制台输出：<img data-src="/2022/01/14/note/%E5%89%8D%E7%AB%AF/js%E9%AB%98%E7%BA%A7%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1/image-20220331153554905.png" alt="image-20220331153554905"></p>
</li>
<li>
<p>对于不同期约，按照<strong>状态更新顺序</strong>执行</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">let</span> method1<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">let</span> method2<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">let</span> p1<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve</span><span class="token punctuation">)</span><span class="token operator">=></span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token function-variable function">method1</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=></span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>        <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token keyword">let</span> p2<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve</span><span class="token punctuation">)</span><span class="token operator">=></span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token function-variable function">method2</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=></span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>        <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="13"></td><td><pre></pre></td></tr><tr><td data-num="14"></td><td><pre>p1<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=></span><span class="token function">setTimeout</span><span class="token punctuation">(</span>console<span class="token punctuation">.</span>log<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="15"></td><td><pre>p1<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=></span><span class="token function">setTimeout</span><span class="token punctuation">(</span>console<span class="token punctuation">.</span>log<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="16"></td><td><pre></pre></td></tr><tr><td data-num="17"></td><td><pre>p2<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=></span><span class="token function">setTimeout</span><span class="token punctuation">(</span>console<span class="token punctuation">.</span>log<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="18"></td><td><pre>p2<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=></span><span class="token function">setTimeout</span><span class="token punctuation">(</span>console<span class="token punctuation">.</span>log<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="19"></td><td><pre></pre></td></tr><tr><td data-num="20"></td><td><pre><span class="token function">method2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 先执行 p2</span></pre></td></tr><tr><td data-num="21"></td><td><pre><span class="token function">method1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p>控制台输出：<img data-src="/2022/01/14/note/%E5%89%8D%E7%AB%AF/js%E9%AB%98%E7%BA%A7%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1/image-20220331153703014.png" alt="image-20220331153703014"></p>
</li>
</ul>
<h4 id="226-传递解决值和拒绝理由"><a class="anchor" href="#226-传递解决值和拒绝理由">#</a> 2.2.6 传递解决值和拒绝理由</h4>
<p>如，第一次网络请求返回的 JSON 是发送第二次请求必须的数据，那么第一次请求返回的值就应该传给 <code>onResolved</code>  处理程序；失败的网络请求也应该把 HTTP 状态码传给 <code>onRejected</code>  处理程序</p>
<ul>
<li>
<p>解决值： <code>resolve()</code>  的第一个参数，可以传给 <code>then</code></p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">let</span> p1<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span>reject</span><span class="token punctuation">)</span><span class="token operator">=></span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'foo'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>p1<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span><span class="token operator">=></span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//foo</span></pre></td></tr></table></figure></li>
<li>
<p>拒绝理由： <code>reject()</code>  的第一个参数，可以传给 <code>catch</code>  或 <code>then</code>  的第二个参数</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">let</span> p2<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span>reject</span><span class="token punctuation">)</span><span class="token operator">=></span><span class="token function">reject</span><span class="token punctuation">(</span><span class="token string">'bar'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>p2<span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">reason</span><span class="token punctuation">)</span><span class="token operator">=></span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>reason<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//bar</span></pre></td></tr></table></figure></li>
</ul>
<h4 id="227-拒绝期约与拒绝错误处理"><a class="anchor" href="#227-拒绝期约与拒绝错误处理">#</a> 2.2.7 拒绝期约与拒绝错误处理</h4>
<ul>
<li>
<p>在期约的执行函数中<strong>抛出错误</strong>会被拒绝</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">let</span> p1<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">reject</span><span class="token punctuation">(</span><span class="token function">Error</span><span class="token punctuation">(</span><span class="token string">'foo'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">let</span> p2<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span><span class="token keyword">throw</span> <span class="token function">Error</span><span class="token punctuation">(</span><span class="token string">'foo'</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">let</span> p3<span class="token operator">=</span>Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=></span><span class="token punctuation">&#123;</span><span class="token keyword">throw</span> <span class="token function">Error</span><span class="token punctuation">(</span><span class="token string">'foo'</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">let</span> p4<span class="token operator">=</span>Promise<span class="token punctuation">.</span><span class="token function">reject</span><span class="token punctuation">(</span><span class="token function">Error</span><span class="token punctuation">(</span><span class="token string">'foo'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token function">setTimeout</span><span class="token punctuation">(</span>console<span class="token punctuation">.</span>log<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span>p1<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//  &lt;rejected> Error: foo</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token function">setTimeout</span><span class="token punctuation">(</span>console<span class="token punctuation">.</span>log<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span>p2<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//  &lt;rejected> Error: foo</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token function">setTimeout</span><span class="token punctuation">(</span>console<span class="token punctuation">.</span>log<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span>p3<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//  &lt;rejected> Error: foo</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token function">setTimeout</span><span class="token punctuation">(</span>console<span class="token punctuation">.</span>log<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span>p4<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//  &lt;rejected> Error: foo</span></pre></td></tr></table></figure><p>&lt;font color =red&gt; 此外，程序还会抛出 4 个错误。但是因为是异步错误，因此不会中断同步进程。&lt;/font&gt;</p>
</li>
<li>
<p>异步错误无法通过同步代码内的 <code>try-catch</code>  捕获，但可以在同个异步下的 <code>try-catch</code>  捕获</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">let</span> p2<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">try</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    p2<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span><span class="token keyword">throw</span> <span class="token function">Error</span><span class="token punctuation">(</span><span class="token string">'foo'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token punctuation">&#125;</span><span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token punctuation">&#125;</span><span class="token comment">// 抛出错误，无法捕获，此时 p2 为 & lt;rejected> Error: foo</span></pre></td></tr></table></figure><p>可以在同个异步下的 <code>try-catch</code>  捕获</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">let</span> p2<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token keyword">try</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>        <span class="token keyword">throw</span> <span class="token function">Error</span><span class="token punctuation">(</span><span class="token string">'foo'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token punctuation">&#125;</span><span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 可以捕获，此时 p2 为 pending 状态</span></pre></td></tr></table></figure><p>或者</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">let</span> <span class="token function-variable function">onResolved</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=></span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token keyword">throw</span> <span class="token function">Error</span><span class="token punctuation">(</span><span class="token string">'foo'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">try</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>onResolved<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token punctuation">&#125;</span><span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token punctuation">&#125;</span><span class="token comment">// 无法捕获</span></pre></td></tr></table></figure><p>但这样可以</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">let</span> <span class="token function-variable function">onResolved</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=></span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token keyword">try</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>        <span class="token keyword">throw</span> <span class="token function">Error</span><span class="token punctuation">(</span><span class="token string">'foo'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token punctuation">&#125;</span><span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>onResolved<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure></li>
<li>
<p>使用 <code>catch</code>  捕获异步错误并隔离。</p>
<blockquote>
<p>then/catch 和 try-catch 在语义上一致，出发点都是捕获错误之后将其隔离，同时不影响正常逻辑执行</p>
</blockquote>
<p>可以在创建期约时，同时通过 <code>catch</code>  定义如果遇见错误请求被拒绝后的处理</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">let</span> p5<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'解决或拒绝'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token function">reject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=></span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'拒绝函数'</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=></span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'解决函数'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token comment">// 这里 catch 后会生成新实例（Promise &#123;undefined&#125;），然后 then 继续按照 resolve 执行</span></pre></td></tr></table></figure><p>控制台打印<img data-src="/2022/01/14/note/%E5%89%8D%E7%AB%AF/js%E9%AB%98%E7%BA%A7%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1/image-20220331163831765.png" alt="image-20220331163831765"></p>
</li>
<li>
<p>也可以通过 <code>then</code>  捕获</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">let</span> p6<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'解决或拒绝'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token function">reject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=></span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'解决函数'</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=></span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'拒绝函数'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token comment">// 这种就是每次 `then` 调用，择其一执行（根据 resolve 或 reject 状态）</span></pre></td></tr></table></figure><p>控制台打印<img data-src="/2022/01/14/note/%E5%89%8D%E7%AB%AF/js%E9%AB%98%E7%BA%A7%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1/image-20220331164020571.png" alt="image-20220331164020571"></p>
</li>
</ul>
<h3 id="23-期约连锁与期约合成"><a class="anchor" href="#23-期约连锁与期约合成">#</a> 2.3 期约连锁与期约合成</h3>
<h4 id="231-期约连锁"><a class="anchor" href="#231-期约连锁">#</a> 2.3.1 期约连锁</h4>
<p>因为每个期约实例方法（then、catch、finally）都会返回一个新实例，然后新实例又可以调用实例方法，实现串联，如下</p>
<p><code>p.then().then()....</code></p>
<p><strong>使用场景</strong>：主要用来串行化异步任务，让一串异步任务有序进行，看下面例子</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">let</span> p1<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'p1 executor'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token function">setTimeout</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="5"></td><td><pre></pre></td></tr><tr><td data-num="6"></td><td><pre>p1<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=></span><span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'p2 executor'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token function">setTimeout</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=></span><span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'p3 executor'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>    <span class="token function">setTimeout</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=></span><span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="13"></td><td><pre>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'p4 executor'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="14"></td><td><pre>    <span class="token function">setTimeout</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p>控制台打印：</p>
<pre><code>p1 executor	 （立即）
p2 executor  （1秒后）
p3 executor	 （2秒后）
p4 executor	 （3秒后）
</code></pre>
<p><strong>每个后续的期约都会等待前一个期约解决，然后实例化一个新期约并返回</strong>。也就是说，这是严格按顺序执行的异步任务</p>
<p>用个工厂函数简化一下以上代码</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">function</span> <span class="token function">method</span><span class="token punctuation">(</span><span class="token parameter">str</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>str<span class="token operator">+</span><span class="token string">' executor'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>        <span class="token function">setTimeout</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="7"></td><td><pre></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token function">method</span><span class="token punctuation">(</span><span class="token string">'p1'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=></span><span class="token function">method</span><span class="token punctuation">(</span><span class="token string">'p2'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=></span><span class="token function">method</span><span class="token punctuation">(</span><span class="token string">'p3'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=></span><span class="token function">method</span><span class="token punctuation">(</span><span class="token string">'p4'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><hr>
<p>再看如下</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">function</span> <span class="token function">method</span><span class="token punctuation">(</span><span class="token parameter">str</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>str<span class="token operator">+</span><span class="token string">'executor'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>        <span class="token function">setTimeout</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="7"></td><td><pre></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token function">method</span><span class="token punctuation">(</span><span class="token string">'p1'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=></span><span class="token function">method</span><span class="token punctuation">(</span><span class="token string">'p2'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=></span><span class="token function">method</span><span class="token punctuation">(</span><span class="token string">'p3'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=></span><span class="token function">method</span><span class="token punctuation">(</span><span class="token string">'p4'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token function">method</span><span class="token punctuation">(</span><span class="token string">'p1 another'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=></span><span class="token function">method</span><span class="token punctuation">(</span><span class="token string">'p2 another'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=></span><span class="token function">method</span><span class="token punctuation">(</span><span class="token string">'p3 another'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=></span><span class="token function">method</span><span class="token punctuation">(</span><span class="token string">'p4 another'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p>控制台打印</p>
<pre><code>p1 executor	 		 （立即）
p1 another executor	 （立即）
p2 executor  		 （1秒后）
p2 another executor  （1秒后）
p3 executor  		 （2秒后）
p3 another executor  （2秒后）
p4 executor 		 （3秒后）
p4 another executor  （3秒后）
</code></pre>
<p>可以看出，多个串行期约之间是<strong>并行</strong>的。</p>
<h4 id="232-期约图"><a class="anchor" href="#232-期约图">#</a> 2.3.2 期约图</h4>
<p>其实就是 <code>then</code>  的消息队列的执行顺序，书上用了树的层次遍历来举例</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">//      A</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token comment">//     / \</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token comment">//    B   C</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token comment">//   / \ / \</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token comment">//  D  E F  G</span></pre></td></tr><tr><td data-num="6"></td><td><pre></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token keyword">let</span> <span class="token constant">A</span><span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'A'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="11"></td><td><pre></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token keyword">let</span> <span class="token constant">B</span><span class="token operator">=</span><span class="token constant">A</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=></span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'B'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token keyword">let</span> <span class="token constant">C</span><span class="token operator">=</span><span class="token constant">A</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=></span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'C'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="14"></td><td><pre></pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token constant">B</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=></span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'D'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="16"></td><td><pre><span class="token constant">B</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=></span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'E'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token constant">C</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=></span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'F'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="18"></td><td><pre><span class="token constant">C</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=></span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'G'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p>控制台打印<img data-src="/2022/01/14/note/%E5%89%8D%E7%AB%AF/js%E9%AB%98%E7%BA%A7%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1/image-20220331200539976.png" alt="image-20220331200539976"></p>
<p><strong>解释一下</strong>：</p>
<ol>
<li>B、C 同属于 A 的消息队列，因此先 B 执行完再执行 C</li>
<li>而 B、C 又属于并行队列，因为同属于 A 的下级，因此 B 和 C 的执行是前后关系（C 一定执行在 B 的下级 D、E 前）</li>
</ol>
<p>其实这个和上面我举例的差不多，即</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token function">method</span><span class="token punctuation">(</span><span class="token string">'p1'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=></span><span class="token function">method</span><span class="token punctuation">(</span><span class="token string">'p2'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=></span><span class="token function">method</span><span class="token punctuation">(</span><span class="token string">'p3'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=></span><span class="token function">method</span><span class="token punctuation">(</span><span class="token string">'p4'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token function">method</span><span class="token punctuation">(</span><span class="token string">'p1 another'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=></span><span class="token function">method</span><span class="token punctuation">(</span><span class="token string">'p2 another'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=></span><span class="token function">method</span><span class="token punctuation">(</span><span class="token string">'p3 another'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=></span><span class="token function">method</span><span class="token punctuation">(</span><span class="token string">'p4 another'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token comment">// 这里用树表示就是</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token comment">// p1 	p1 another</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token comment">// |       |</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token comment">// p2	 p2 another</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token comment">// |	   |</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token comment">//    ...</span></pre></td></tr></table></figure><h4 id="233-promiseall-和-promiserace"><a class="anchor" href="#233-promiseall和promiserace">#</a> 2.3.3  <code>Promise.all()</code>  和 <code>Promise.race()</code></h4>
<ul>
<li>
<p><strong> <code>Promise.all()</code> </strong>：创建的期约会在一组期约全部解决之后再解决。</p>
<ul>
<li>
<p>解释下： <code>Promise.all</code>  创建一个期约 <code>p</code> ，参数是一组期约。并且这组期约相继执行，执行完毕后 <code>p</code>  状态改变（待定→解决 / 拒绝）</p>
</li>
<li>
<p><code>p</code>  的状态：</p>
<ul>
<li>如果这组期约全部解决， 则为 <code>resolve</code> ，解决值是所有期约的解决值的<strong>数组</strong>；</li>
<li>如果有一个是待定，则为 <code>pending</code> ；</li>
<li>如果有一个拒绝的，则为 <code>reject</code> ，且拒绝原因和第一个拒绝期约一致。此外，只需要在 <code>p</code>  后面加 <code>catch</code> ，所有拒绝都会被处理</li>
</ul>
</li>
</ul>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">let</span> p1<span class="token operator">=</span>Promise<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=></span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 永远为待定</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token function">setTimeout</span><span class="token punctuation">(</span>console<span class="token punctuation">.</span>log<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span>p1<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//Promise &#123; &lt;pending> &#125;</span></pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">let</span> p2<span class="token operator">=</span>Promise<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token punctuation">[</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    Promise<span class="token punctuation">.</span><span class="token function">reject</span><span class="token punctuation">(</span><span class="token string">'拒绝理由'</span><span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token punctuation">]</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token function">setTimeout</span><span class="token punctuation">(</span>console<span class="token punctuation">.</span>log<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span>p2<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//Promise &#123;&lt;rejected> ' 拒绝理由 ' &#125;</span></pre></td></tr><tr><td data-num="10"></td><td><pre></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token keyword">let</span> p3<span class="token operator">=</span>Promise<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token punctuation">[</span></pre></td></tr><tr><td data-num="12"></td><td><pre>    Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="13"></td><td><pre>    Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="14"></td><td><pre>    Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="15"></td><td><pre>    Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=></span>Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="16"></td><td><pre><span class="token punctuation">]</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token function">setTimeout</span><span class="token punctuation">(</span>console<span class="token punctuation">.</span>log<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span>p3<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//Promise &#123; [ 1, undefined, 3, 5 ] &#125;</span></pre></td></tr></table></figure><ul>
<li>
<p><code>p</code>  只有<strong>第一个</strong>拒绝理由会进入 <code>catch</code> ，但所有拒绝都会别 <code>catch</code> <strong> 静默处理</strong></p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">let</span> p4<span class="token operator">=</span>Promise<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token punctuation">[</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    Promise<span class="token punctuation">.</span><span class="token function">reject</span><span class="token punctuation">(</span><span class="token string">'拒绝5'</span><span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    Promise<span class="token punctuation">.</span><span class="token function">reject</span><span class="token punctuation">(</span><span class="token string">'拒绝6'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">reason</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">setTimeout</span><span class="token punctuation">(</span>console<span class="token punctuation">.</span>log<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span>reason<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 拒绝 5</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token comment">// 虽然原因只有拒绝 5，但拒绝 6 也被捕获处理了，不会出现未处理的错误（不会有报错）</span></pre></td></tr></table></figure></li>
</ul>
</li>
<li>
<p><strong> <code>Promise.race()</code> </strong>：返回一组集合中<strong>最先解决或拒绝</strong>的期约的<strong>镜像</strong></p>
<ul>
<li>参数：可以是一组期约，也可以是一组数据（数据成为期约的解决值，通过 <code>Promise.resolve()</code>  转换）</li>
</ul>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">let</span> p<span class="token operator">=</span>Promise<span class="token punctuation">.</span><span class="token function">race</span><span class="token punctuation">(</span><span class="token punctuation">[</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=></span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    Promise<span class="token punctuation">.</span><span class="token function">reject</span><span class="token punctuation">(</span><span class="token string">'拒绝1'</span><span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'解决1'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token punctuation">]</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="6"></td><td><pre></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token function">setTimeout</span><span class="token punctuation">(</span>console<span class="token punctuation">.</span>log<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span>p<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//Promise &#123;&lt;rejected> ' 拒绝 1' &#125;</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token comment">// 有红字警告</span></pre></td></tr></table></figure><p>组数据按照<strong>迭代顺序</strong></p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">let</span> p<span class="token operator">=</span>Promise<span class="token punctuation">.</span><span class="token function">race</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token function">setTimeout</span><span class="token punctuation">(</span>console<span class="token punctuation">.</span>log<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span>p<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//Promise &#123; 1 &#125;</span></pre></td></tr></table></figure><p><strong>空数组</strong>返回待定期约</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">let</span> p<span class="token operator">=</span>Promise<span class="token punctuation">.</span><span class="token function">race</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token function">setTimeout</span><span class="token punctuation">(</span>console<span class="token punctuation">.</span>log<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span>p<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//Promise &#123; &lt;pending> &#125;</span></pre></td></tr></table></figure><ul>
<li><strong>拒绝处理</strong>：和 <code>all</code>  一样，第一个拒绝理由成为 <code>all</code>  的拒绝理由，别的拒绝会被<strong>静默处理</strong></li>
</ul>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">let</span> p<span class="token operator">=</span>Promise<span class="token punctuation">.</span><span class="token function">race</span><span class="token punctuation">(</span><span class="token punctuation">[</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=></span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    Promise<span class="token punctuation">.</span><span class="token function">reject</span><span class="token punctuation">(</span><span class="token string">'拒绝1'</span><span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'解决1'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">reason</span><span class="token punctuation">)</span><span class="token operator">=></span><span class="token function">setTimeout</span><span class="token punctuation">(</span>console<span class="token punctuation">.</span>log<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span>reason<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 拒绝 1</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token comment">// 无红字警告，错误都已被处理</span></pre></td></tr></table></figure></li>
</ul>
<h4 id="234-串行期约的合成"><a class="anchor" href="#234-串行期约的合成">#</a> 2.3.4 串行期约的合成</h4>
<p>串行期约可以连续传值，如下</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">function</span> <span class="token function">addTwo</span><span class="token punctuation">(</span><span class="token parameter">x</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token keyword">return</span> x<span class="token operator">+</span><span class="token number">2</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">function</span> <span class="token function">addThree</span><span class="token punctuation">(</span><span class="token parameter">x</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token keyword">return</span> x<span class="token operator">+</span><span class="token number">3</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">function</span> <span class="token function">addFive</span><span class="token punctuation">(</span><span class="token parameter">x</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token keyword">return</span> x<span class="token operator">+</span><span class="token number">5</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">function</span> <span class="token function">addTen</span><span class="token punctuation">(</span><span class="token parameter">x</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token keyword">return</span> Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token comment">// 此时 x 是 8</span></pre></td></tr><tr><td data-num="7"></td><td><pre>        <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>addTwo<span class="token punctuation">)</span><span class="token comment">// 此时 (x)=>x+2,x 传入是 8，输出是 10</span></pre></td></tr><tr><td data-num="8"></td><td><pre>        <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>addThree<span class="token punctuation">)</span><span class="token comment">// 此时 (x)=>x+3,x 传入是 10，输出是 13</span></pre></td></tr><tr><td data-num="9"></td><td><pre>        <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>addFive<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 此时 (x)=>x+5,x 传入是 13，输出是 18</span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="11"></td><td><pre></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token function">addTen</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>console<span class="token punctuation">.</span>log<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//18</span></pre></td></tr></table></figure><h3 id="24-期约扩展"><a class="anchor" href="#24-期约扩展">#</a> 2.4 期约扩展</h3>
<h4 id="241-期约取消暂缓"><a class="anchor" href="#241-期约取消暂缓">#</a> 2.4.1 期约取消（暂缓）</h4>
<p>期约<strong>正在处理</strong>，但程序<strong>不再需要</strong>其结果时，其实可以取消这个期约了。</p>
<p>一般用取消令牌（cancel token）</p>
<h4 id="242-期约进度通知暂缓"><a class="anchor" href="#242-期约进度通知暂缓">#</a> 2.4.2 期约进度通知（暂缓）</h4>
<h4 id="es6-不支持取消期约和进度通知"><a class="anchor" href="#es6不支持取消期约和进度通知">#</a> ES6 不支持取消期约和进度通知</h4>
<h2 id="3-异步函数async"><a class="anchor" href="#3-异步函数async">#</a> 3. 异步函数（async）</h2>
<p>在期约中的解决值必须在同个异步队列中处理，这样很不方便，如下</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">let</span> p<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span>reject</span><span class="token punctuation">)</span><span class="token operator">=></span><span class="token function">setTimeout</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span><span class="token number">1000</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 这里后续处理解决值 3 只能通过 then</span></pre></td></tr><tr><td data-num="2"></td><td><pre>p<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">x</span><span class="token punctuation">)</span><span class="token operator">=></span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//3</span></pre></td></tr></table></figure><h3 id="31-异步函数"><a class="anchor" href="#31-异步函数">#</a> 3.1 异步函数</h3>
<h4 id="311-async"><a class="anchor" href="#311-async">#</a> 3.1.1 async</h4>
<p>async 关键字表示这是一个异步函数（类似 java 的 @注解）。其可以让函数具有异步特征，但总体上其代码仍是同步求值的。</p>
<ul>
<li>async 异步函数的代码仍是<strong>同步代码</strong></li>
<li>如果有 <code>return</code>  返回值，则会包装成期约对象（ <code>Promise.resolve()</code> ）</li>
<li>没有 <code>return</code>  其实相当于 <code>return undefined</code> ，也会包装成 <code>Promise&#123; undefined &#125;</code></li>
</ul>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token keyword">return</span> <span class="token number">3</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token comment">// 等效于 return Promise.resolve (3);</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="6"></td><td><pre></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>console<span class="token punctuation">.</span>log<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p>控制台输出：<img data-src="/2022/01/14/note/%E5%89%8D%E7%AB%AF/js%E9%AB%98%E7%BA%A7%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1/image-20220401173943661.png" alt="image-20220401173943661"></p>
<ul>
<li>&lt;font color=red&gt; 没有 <code>return</code>  其实相当于 <code>return undefined</code> &lt;/font&gt;</li>
</ul>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>console<span class="token punctuation">.</span>log<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p>控制台打印：<img data-src="/2022/01/14/note/%E5%89%8D%E7%AB%AF/js%E9%AB%98%E7%BA%A7%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1/image-20220401174228330.png" alt="image-20220401174228330"></p>
<ul>
<li>
<p>抛出错误相当于 <code>return reject</code></p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token keyword">throw</span> <span class="token number">3</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="5"></td><td><pre></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span>console<span class="token punctuation">.</span>log<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p>控制台输出：<img data-src="/2022/01/14/note/%E5%89%8D%E7%AB%AF/js%E9%AB%98%E7%BA%A7%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1/image-20220401173943661.png" alt="image-20220401173943661"></p>
</li>
</ul>
<h4 id="312-await等待"><a class="anchor" href="#312-await等待">#</a> 3.1.2 await（等待）</h4>
<ul>
<li>
<p>await 关键字<strong>只能用在 async 函数内</strong>。可以暂停异步代码的执行，等待期约解决。</p>
</li>
<li>
<p>也就是卡住进程，等 <code>await</code>  后的代码执行完毕（其实是期约解决完毕），再继续执行。</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token keyword">let</span> p<span class="token operator">=</span>Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token keyword">await</span> p<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>console<span class="token punctuation">.</span>log<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 等待 p.then 执行完，才会执行下面的 console.log (2)</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p>控制台打印<img data-src="/2022/01/14/note/%E5%89%8D%E7%AB%AF/js%E9%AB%98%E7%BA%A7%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1/image-20220401193023929.png" alt="image-20220401193023929"></p>
<p>或者</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token keyword">await</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">setTimeout</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr></table></figure><p><strong>1 秒后</strong>，控制台打印<img data-src="/2022/01/14/note/%E5%89%8D%E7%AB%AF/js%E9%AB%98%E7%BA%A7%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1/image-20220401193742334.png" alt="image-20220401193742334"></p>
<p><strong>但， <code>await</code>  后一定得是期约解决 / 拒绝，否则不会等待</strong></p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token keyword">let</span> p<span class="token operator">=</span>Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token keyword">await</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span>console<span class="token punctuation">.</span>log<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span>p<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 此处就不会等待，因为这里仅是输出一个 P 的状态，p 已经是 resolve 了，不需要等待 P 解决或拒绝</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="6"></td><td><pre></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p>控制台打印<img data-src="/2022/01/14/note/%E5%89%8D%E7%AB%AF/js%E9%AB%98%E7%BA%A7%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1/image-20220401193917826.png" alt="image-20220401193917826"></p>
</li>
<li>
<p>如果 <code>await</code>  后面的是 <code>reject</code> ，则后面的都不会执行了。</p>
<p>即被 <code>reject</code>  卡住</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token keyword">await</span> Promise<span class="token punctuation">.</span><span class="token function">reject</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="5"></td><td><pre></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span>console<span class="token punctuation">.</span>log<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p>控制台打印<img data-src="/2022/01/14/note/%E5%89%8D%E7%AB%AF/js%E9%AB%98%E7%BA%A7%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1/image-20220401200619638.png" alt="image-20220401200619638">，2 没有被打印</p>
<p>但如果像这样</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token keyword">await</span> Promise<span class="token punctuation">.</span><span class="token function">reject</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span>console<span class="token punctuation">.</span>log<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 在这里处理错误</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="5"></td><td><pre></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p>控制台打印<img data-src="/2022/01/14/note/%E5%89%8D%E7%AB%AF/js%E9%AB%98%E7%BA%A7%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1/image-20220401200742161.png" alt="image-20220401200742161"></p>
<p>因为这里， <code>Promise.reject(1)</code>  经过 <code>catch</code>  处理后新实例变成了 <code>resolve</code> ，因此 <code>await</code>  等待的是 <code>resolve</code>  的期约解决</p>
</li>
<li>
<p><code>await</code>  仅在作用域内有效，如下</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token keyword">await</span> Promise<span class="token punctuation">.</span><span class="token function">reject</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span>console<span class="token punctuation">.</span>log<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="5"></td><td><pre></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 仍是最优先输出</span></pre></td></tr></table></figure><p>控制台打印<img data-src="/2022/01/14/note/%E5%89%8D%E7%AB%AF/js%E9%AB%98%E7%BA%A7%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1/image-20220401201033691.png" alt="image-20220401201033691"></p>
</li>
</ul>
<h3 id="32-停止和恢复执行"><a class="anchor" href="#32-停止和恢复执行">#</a> 3.2 停止和恢复执行</h3>
<p>利用 <code>await</code>  阻塞作用域，看下面的执行顺序</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token keyword">await</span> <span class="token keyword">null</span><span class="token punctuation">;</span><span class="token comment">// 其实相当于在这里阻塞，同步代码 3 执行，这里继续后 log4 执行</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="6"></td><td><pre></pre></td></tr><tr><td data-num="7"></td><td><pre>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p>控制台输出：<img data-src="/2022/01/14/note/%E5%89%8D%E7%AB%AF/js%E9%AB%98%E7%BA%A7%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1/image-20220402144644261.png" alt="image-20220402144644261"></p>
<p>官方解释： <code>await</code>  暂停执行，为<strong>立即可用</strong>的 <code>null</code>  向消息队列添加<strong>一个</strong>任务；打印完 3，从消息队列取出任务，恢复异步函数执行</p>
<hr>
<p>（下面可以不看）</p>
<p>而如果是<strong>期约</strong>，需要向消息队列添加<strong> 2 个</strong>任务。（新版浏览器只需一个，两种执行顺序会有些不同）</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">await</span> Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="6"></td><td><pre></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">await</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="12"></td><td><pre></pre></td></tr><tr><td data-num="13"></td><td><pre>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="15"></td><td><pre>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="16"></td><td><pre><span class="token function">bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="17"></td><td><pre>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><ul>
<li>旧版执行顺序是：123456789。因为 <code>Promise.resolve</code>  需要向消息队列添加 2 个任务</li>
<li>新版执行顺序是：123458967。（node.js 和 Chrome 是这种）</li>
</ul>
<h3 id="33-异步函数策略"><a class="anchor" href="#33-异步函数策略">#</a> 3.3 异步函数策略</h3>
<h4 id="331-sleep"><a class="anchor" href="#331-sleep">#</a> 3.3.1  <code>sleep()</code></h4>
<p>用 <code>setTimeout</code>  实现 <code>sleep</code>  函数。再 <code>await</code>  搭配 <code>sleep</code>  实现非阻塞暂停（仅在域内阻塞）。</p>
<ul>
<li>
<p><code>sleep()</code></p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">sleep</span><span class="token punctuation">(</span><span class="token parameter">delay</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">setTimeout</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span>delay<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure></li>
<li>
<p>使用</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token keyword">const</span> t0<span class="token operator">=</span>Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token keyword">await</span> <span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1500</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span>t0<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="6"></td><td><pre></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">//1502 左右，因为运行时间也需要几毫秒</span></pre></td></tr></table></figure><p>为什么一定要异步函数搭配 <code>await</code> ？</p>
<ol>
<li>因为只有 <code>await</code>  才能等待暂停</li>
<li><code>await</code>  只能在异步函数内</li>
</ol>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">function</span> <span class="token function">sleep</span><span class="token punctuation">(</span><span class="token parameter">delay</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token function">setTimeout</span><span class="token punctuation">(</span>console<span class="token punctuation">.</span>log<span class="token punctuation">,</span>delay<span class="token punctuation">,</span>Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token comment">// 这样就不行，同步函数会直接输出</span></pre></td></tr></table></figure></li>
</ul>
<h4 id="332-利用平行执行"><a class="anchor" href="#332-利用平行执行">#</a> 3.3.2 利用平行执行</h4>
<p>先初始化再 <code>awiat</code>  等待解决，加速执行时间。具体看 P356-359</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">randomDelay</span><span class="token punctuation">(</span><span class="token parameter">id</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token keyword">const</span> delay<span class="token operator">=</span>Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">10000</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=></span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>        <span class="token function">setTimeout</span><span class="token punctuation">(</span>console<span class="token punctuation">.</span>log<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>id<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string"> finished,delay=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>delay<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>        <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>delay<span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>有如下 2 种方案</p>
<ul>
<li>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token keyword">const</span> t0<span class="token operator">=</span>Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token keyword">await</span> <span class="token function">randomDelay</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token keyword">await</span> <span class="token function">randomDelay</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token keyword">await</span> <span class="token function">randomDelay</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token keyword">await</span> <span class="token function">randomDelay</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token keyword">await</span> <span class="token function">randomDelay</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre></pre></td></tr><tr><td data-num="10"></td><td><pre>    <span class="token function">setTimeout</span><span class="token punctuation">(</span>console<span class="token punctuation">.</span>log<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span>t0<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">ms elapsed</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="12"></td><td><pre></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p>这种是依次等待，依次执行，总时间是所有加起来</p>
<p>控制台输出<img data-src="/2022/01/14/note/%E5%89%8D%E7%AB%AF/js%E9%AB%98%E7%BA%A7%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1/image-20220402154708767.png" alt="image-20220402154708767"></p>
</li>
<li>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token keyword">const</span> t0<span class="token operator">=</span>Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token keyword">const</span> p0<span class="token operator">=</span><span class="token function">randomDelay</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token keyword">const</span> p1<span class="token operator">=</span><span class="token function">randomDelay</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token keyword">const</span> p2<span class="token operator">=</span><span class="token function">randomDelay</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token keyword">const</span> p3<span class="token operator">=</span><span class="token function">randomDelay</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token keyword">const</span> p4<span class="token operator">=</span><span class="token function">randomDelay</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre></pre></td></tr><tr><td data-num="10"></td><td><pre>    <span class="token keyword">await</span> p0<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>    <span class="token keyword">await</span> p1<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="12"></td><td><pre>    <span class="token keyword">await</span> p2<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="13"></td><td><pre>    <span class="token keyword">await</span> p3<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="14"></td><td><pre>    <span class="token keyword">await</span> p4<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="15"></td><td><pre></pre></td></tr><tr><td data-num="16"></td><td><pre>    <span class="token function">setTimeout</span><span class="token punctuation">(</span>console<span class="token punctuation">.</span>log<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span>t0<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">ms elapsed</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="18"></td><td><pre></pre></td></tr><tr><td data-num="19"></td><td><pre><span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p>这种是全部初始化完后，按时间等待执行，总时间是其中最长的那个</p>
<p>控制台输出<img data-src="/2022/01/14/note/%E5%89%8D%E7%AB%AF/js%E9%AB%98%E7%BA%A7%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1/image-20220402154527035.png" alt="image-20220402154527035"></p>
</li>
<li>
<p>&lt;font color=red&gt;<strong> 解释一下：</strong>&lt;/font&gt;</p>
<ul>
<li>
<p>1 中：因为有 <code>await</code> ，因此只有在前一个期约<strong>计时进入解决状态后，下一个期约才进入计时</strong></p>
</li>
<li>
<p>2 中：在 <code>const p0=randomDelay(0);</code>  处<strong>就开始计时，各自的时间一到就为解决状态，并不会像 1 那样被 <code>await</code>  阻塞</strong>，一解决 <code>await</code>  就马上可以执行。实际上到 <code>await</code>  的不用 <code>await</code>  等待结果也是一样的， <code>await</code>  不过是为了等最后的 <code>    setTimeout</code>  函数，下面是不用 <code>await</code>  的输出结果</p>
<p><img data-src="/2022/01/14/note/%E5%89%8D%E7%AB%AF/js%E9%AB%98%E7%BA%A7%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1/image-20220402155539617.png" alt="image-20220402155539617"></p>
<p>这里 <code>await</code>  最大的用处是阻塞 <code>setTimeout</code>  函数</p>
</li>
</ul>
</li>
</ul>
<h4 id="333-串行执行期约"><a class="anchor" href="#333-串行执行期约">#</a> 3.3.3 串行执行期约</h4>
<p>之前我们使用 <code>then</code>  串行执行期约，但这仍有些复杂（需要手动写很多 <code>then</code> ）。只用 <code>async/await</code>  可以直接通过循环搞定</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">function</span> <span class="token function">addTwo</span><span class="token punctuation">(</span><span class="token parameter">x</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token keyword">return</span> x<span class="token operator">+</span><span class="token number">2</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">function</span> <span class="token function">addThree</span><span class="token punctuation">(</span><span class="token parameter">x</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token keyword">return</span> x<span class="token operator">+</span><span class="token number">3</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">function</span> <span class="token function">addFive</span><span class="token punctuation">(</span><span class="token parameter">x</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token keyword">return</span> x<span class="token operator">+</span><span class="token number">5</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">addTen</span><span class="token punctuation">(</span><span class="token parameter">x</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">const</span> fn <span class="token keyword">of</span> <span class="token punctuation">[</span>addTwo<span class="token punctuation">,</span>addThree<span class="token punctuation">,</span>addFive<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>        x<span class="token operator">=</span><span class="token keyword">await</span> <span class="token function">fn</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token keyword">return</span> x<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="11"></td><td><pre></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token function">addTen</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>console<span class="token punctuation">.</span>log<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//18</span></pre></td></tr></table></figure><h4 id="334-栈追踪与内存管理"><a class="anchor" href="#334-栈追踪与内存管理">#</a> 3.3.4 栈追踪与内存管理</h4>
<p>期约与异步函数在功能上有相当大的重叠，但在内存中的表示则差别很大。</p>
<p>详细看 P359</p>
<p>大概就是性能方面异步稍好点</p>
<h1 id="十二-bom"><a class="anchor" href="#十二-bom">#</a> 十二、 BOM</h1>
<h2 id="1-window-对象"><a class="anchor" href="#1-window对象">#</a> 1. window 对象</h2>
<p>本章概要：</p>
<ul>
<li>
<p><a href="#%E7%AA%97%E5%8F%A3%E5%85%B3%E7%B3%BB">窗口关系</a></p>
<ul>
<li>
<p><code>window.parent</code> ：返回父窗口（当前窗口的上一层窗口）</p>
</li>
<li>
<p><code>window.top</code> ：返回最顶层（最外层）的父窗口。</p>
</li>
<li>
<p><code>window.self</code> ：指向自身窗口，即 <code>window</code></p>
</li>
</ul>
</li>
<li>
<p><a href="#%E7%AA%97%E5%8F%A3%E4%BD%8D%E7%BD%AE%E4%B8%8E%E5%83%8F%E7%B4%A0%E6%AF%94">窗口位置</a></p>
<ul>
<li>
<p><code>window.screenLeft</code> ：窗口距<strong>屏幕左侧</strong>的位置，返回值是 CSS 的像素</p>
</li>
<li>
<p><code>window.screenTop</code> ：窗口距<strong>屏幕顶部</strong>的位置</p>
</li>
</ul>
</li>
<li>
<p><a href="#%E7%AA%97%E5%8F%A3%E4%BD%8D%E7%BD%AE%E4%B8%8E%E5%83%8F%E7%B4%A0%E6%AF%94">移动窗口</a></p>
<ul>
<li>
<p><code>window.moveTo()</code> ：把窗口的左上角移动到一个指定的坐标。</p>
</li>
<li>
<p><code>window.moveBy()</code> ：把窗口挪动指定<strong>像素单位</strong></p>
</li>
</ul>
</li>
<li>
<p><a href="#%E7%AA%97%E5%8F%A3%E5%A4%A7%E5%B0%8F">窗口尺寸</a></p>
<ul>
<li>
<p><code>window.devicePixelRatio</code> ：物理像素（屏幕分辨率）与逻辑像素（CSS 像素 px）之间的<strong>缩放比</strong></p>
</li>
<li>
<p><code>window.outerWidth</code> ：浏览器窗口宽度（包括...）</p>
</li>
<li>
<p><code>window.outerHeight</code> ：高度</p>
</li>
<li>
<p><code>window.innerWidth</code> ：窗口内<strong>可视</strong>页面宽度（不包括浏览器边框和工具栏）</p>
</li>
<li>
<p><code>window.innerHeight</code> ：高度</p>
</li>
</ul>
</li>
<li>
<p><a href="#%E7%AA%97%E5%8F%A3%E5%A4%A7%E5%B0%8F">调整窗口大小</a></p>
<ul>
<li>
<p><code>window.resizeTo()</code> ：调整到指定宽高</p>
</li>
<li>
<p><code>window.resizeBy()</code> ：增加的宽度和高度</p>
</li>
</ul>
</li>
<li>
<p><a href="#%E8%A7%86%E5%8F%A3%E4%BD%8D%E7%BD%AE">滚动页面</a></p>
<ul>
<li><code>scrollTo()</code> ：滚动到指定坐标</li>
<li><code>scrollBy()</code> ：向指定方向滚动指定像素</li>
</ul>
</li>
<li>
<p><a href="#%E5%AF%BC%E8%88%AA%E4%B8%8E%E6%89%93%E5%BC%80%E6%96%B0%E7%AA%97%E5%8F%A3">弹窗</a></p>
<ul>
<li><code>window.open()</code> ：弹窗函数</li>
<li><code>window.opener</code> ：打开弹窗的窗口</li>
<li><code>window.close()</code> ：关闭窗口</li>
</ul>
</li>
<li>
<p><a href="#%E5%AE%9A%E6%97%B6%E5%99%A8">定时器</a></p>
<ul>
<li><code>setTimeout()</code> ：指定一定时间后执行某段代码</li>
<li><code>clearTimeout()</code> ：取消 <code>setTimeout</code>  排期</li>
<li><code>setInterval()</code> ：<strong>每隔</strong>一段时间执行某段代码</li>
<li><code>clearInterval()</code> ：取消 <code>setInterval</code>  任务</li>
</ul>
</li>
<li>
<p><a href="#%E7%B3%BB%E7%BB%9F%E5%AF%B9%E8%AF%9D%E6%A1%86">弹框</a></p>
<ul>
<li><code>alert()</code> ：警告框</li>
<li><code>confirm()</code> ：确认框</li>
<li><code>prompt()</code> ：提示框（输入框）</li>
</ul>
</li>
</ul>
<hr>
<blockquote>
<p>BOM 的核心就是 window 对象，即浏览器的实例。</p>
</blockquote>
<p>window 有 2 重身份：</p>
<ol>
<li>ECMAScript 中的 <code>Global</code>  对象</li>
<li>浏览器窗口的 JavaScript 接口</li>
</ol>
<hr>
<p>下面是一些本章没有讲到的属性。</p>
<table>
<thead>
<tr>
<th style="text-align:left">属性</th>
<th style="text-align:left">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left"><span class="exturl" data-url="aHR0cHM6Ly93d3cucnVub29iLmNvbS9qc3JlZi9wcm9wLXdpbi1jbG9zZWQuaHRtbA==">closed</span></td>
<td style="text-align:left">返回窗口是否已被关闭。</td>
</tr>
<tr>
<td style="text-align:left"><span class="exturl" data-url="aHR0cHM6Ly93d3cucnVub29iLmNvbS9qc3JlZi9wcm9wLXdpbi1uYW1lLmh0bWw=">name</span></td>
<td style="text-align:left">设置或返回窗口的名称。</td>
</tr>
<tr>
<td style="text-align:left"><span class="exturl" data-url="aHR0cHM6Ly93d3cucnVub29iLmNvbS9qc3JlZi9wcm9wLXdpbi1pbm5lcmhlaWdodC5odG1s">innerHeight</span></td>
<td style="text-align:left">返回窗口的文档显示区的高度。</td>
</tr>
<tr>
<td style="text-align:left"><span class="exturl" data-url="aHR0cHM6Ly93d3cucnVub29iLmNvbS9qc3JlZi9wcm9wLXdpbi1pbm5lcmhlaWdodC5odG1s">innerWidth</span></td>
<td style="text-align:left">返回窗口的文档显示区的宽度。</td>
</tr>
<tr>
<td style="text-align:left"><span class="exturl" data-url="aHR0cHM6Ly93d3cucnVub29iLmNvbS9qc3JlZi9wcm9wLXdpbi1vdXRlcmhlaWdodC5odG1s">outerHeight</span></td>
<td style="text-align:left">返回窗口的外部高度，包含工具条与滚动条。</td>
</tr>
<tr>
<td style="text-align:left"><span class="exturl" data-url="aHR0cHM6Ly93d3cucnVub29iLmNvbS9qc3JlZi9wcm9wLXdpbi1vdXRlcmhlaWdodC5odG1s">outerWidth</span></td>
<td style="text-align:left">返回窗口的外部宽度，包含工具条与滚动条。</td>
</tr>
<tr>
<td style="text-align:left"><span class="exturl" data-url="aHR0cHM6Ly93d3cucnVub29iLmNvbS9qc3JlZi9wcm9wLXdpbi1sb2NhbHN0b3JhZ2UuaHRtbA==">localStorage</span></td>
<td style="text-align:left">在浏览器中存储 key/value 对。没有过期时间。<strong>本地存储</strong></td>
</tr>
<tr>
<td style="text-align:left"><span class="exturl" data-url="aHR0cHM6Ly93d3cucnVub29iLmNvbS9qc3JlZi9wcm9wLXdpbi1zZXNzaW9uc3RvcmFnZS5odG1s">sessionStorage</span></td>
<td style="text-align:left">在浏览器中存储 key/value 对。 在关闭窗口或标签页之后将会删除这些数据。<strong>会话存储</strong></td>
</tr>
</tbody>
</table>
<h3 id="11-global-作用域"><a class="anchor" href="#11-global作用域">#</a> 1.1 Global 作用域</h3>
<p>即全局作用域，</p>
<ul>
<li>
<p><strong>通过 <code>var</code>  声明的全局变量和函数都会变为 <code>window</code>  对象的属性和方法</strong>。</p>
<figure class="highlight html"><figcaption data-lang="HTML"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript"></span></span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token keyword">var</span> age<span class="token operator">=</span><span class="token number">29</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token keyword">var</span> <span class="token function-variable function">sayAge</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=></span><span class="token function">alert</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>age<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token function">alert</span><span class="token punctuation">(</span>window<span class="token punctuation">.</span>age<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//29</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token function">sayAge</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//29</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    window<span class="token punctuation">.</span><span class="token function">sayAge</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//29</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span></pre></td></tr></table></figure><p>但 <code>let</code>  和 <code>const</code>  不行。</p>
<figure class="highlight html"><figcaption data-lang="HTML"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript"></span></span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token keyword">let</span> age<span class="token operator">=</span><span class="token number">29</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token keyword">const</span> <span class="token function-variable function">sayAge</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=></span><span class="token function">alert</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>age<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token function">alert</span><span class="token punctuation">(</span>window<span class="token punctuation">.</span>age<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//undefined</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token function">sayAge</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//undefined</span></pre></td></tr><tr><td data-num="7"></td><td><pre>	window<span class="token punctuation">.</span><span class="token function">sayAge</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//undefined	</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span></pre></td></tr></table></figure></li>
<li>
<p>访问未定义的变量会抛出错误，但查询 <code>window</code>  是否存在变量不会</p>
<figure class="highlight html"><figcaption data-lang="HTML"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript"></span></span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token keyword">var</span> newValue<span class="token operator">=</span>value<span class="token punctuation">;</span><span class="token comment">// 报错</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token keyword">var</span> newValue<span class="token operator">=</span>window<span class="token punctuation">.</span>value<span class="token punctuation">;</span><span class="token comment">//undefined</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span></pre></td></tr></table></figure></li>
</ul>
<h3 id="12-ltspan-id-quot窗口关系quotgt-窗口关系-ltspangt"><a class="anchor" href="#12-span-id-窗口关系窗口关系span">#</a> 1.2 &lt;span id = &quot;窗口关系&quot;&gt; 窗口关系 &lt;/span&gt;</h3>
<ul>
<li><code>window.parent</code> ：返回父窗口（当前窗口的上一层窗口）</li>
<li><code>window.top</code> ：返回最顶层（最外层）的父窗口，即浏览器窗口本身。</li>
</ul>
<p>如果当前窗口是最外层窗口，那么 <code>parent</code>  等于 <code>top</code> （都等于 <code>window</code> ）</p>
<ul>
<li><code>window.self</code> ：使用指向 <code>window</code></li>
</ul>
<p>利用这些可以把多个浏览器窗口<strong>串联</strong>起来，比如 <code>window.parent.parent</code></p>
<h3 id="13-ltspan-id-quot窗口位置与像素比quotgt-窗口位置与像素比-ltspangt"><a class="anchor" href="#13-span-id-窗口位置与像素比窗口位置与像素比span">#</a> 1.3 &lt;span id = &quot;窗口位置与像素比&quot;&gt; 窗口位置与像素比 &lt;/span&gt;</h3>
<p>获取位置</p>
<ul>
<li><code>window.screenLeft</code> ：窗口距<strong>屏幕左侧</strong>的位置，返回值是 CSS 的像素</li>
<li><code>window.screenTop</code> ：窗口距<strong>屏幕顶部</strong>的位置</li>
</ul>
<p>挪动窗口</p>
<ul>
<li><code>window.moveTo()</code> ：把窗口的左上角移动到一个指定的坐标。
<ul>
<li>参数 1：横坐标</li>
<li>参数 2：纵坐标</li>
</ul>
</li>
<li><code>window.moveBy()</code> ：把窗口挪动指定<strong>像素单位</strong>
<ul>
<li>参数 1：<strong>右移</strong>的像素数</li>
<li>参数 2：<strong>下移</strong>的像素数</li>
</ul>
</li>
</ul>
<p>像素比</p>
<ul>
<li>
<p><code>window.devicePixelRatio</code> ：物理像素（屏幕分辨率）与逻辑像素（CSS 像素 px）之间的<strong>缩放比</strong></p>
<p>为了让 <code>1920X1080</code>  分辨率屏幕和 <code>640X320</code>  的文字看上去一样大，将 <code>window.devicePixelRatio</code>  设为 3，那么 <code>12像素</code> 的文字实际上用 <code>36像素</code> 的物理像素来显示</p>
</li>
</ul>
<h3 id="14-ltspan-id-quot窗口大小quotgt-窗口大小-ltspangt"><a class="anchor" href="#14-span-id-窗口大小窗口大小span">#</a> 1.4 &lt;span id = &quot;窗口大小&quot;&gt; 窗口大小 &lt;/span&gt;</h3>
<ul>
<li><code>window.outerWidth</code> ：浏览器窗口宽度（包括...）</li>
<li><code>window.outerHeight</code> ：高度</li>
<li><code>window.innerWidth</code> ：窗口内<strong>可视</strong>页面宽度（不包括浏览器边框和工具栏）</li>
<li><code>window.innerHeight</code> ：高度</li>
</ul>
<p>调整大小</p>
<ul>
<li><code>window.resizeTo()</code> ：调整到指定宽高
<ul>
<li>参数 1：新的宽度。像素 px</li>
<li>参数 2：新的高度。</li>
</ul>
</li>
<li><code>window.resizeBy()</code> ：增加的宽度和高度
<ul>
<li>参数 1：增加的宽度。像素</li>
<li>参数 2：增加的高度。</li>
</ul>
</li>
</ul>
<p>什么是可视页面？</p>
<p>就是能看见内容的页面，简称<strong>视口</strong></p>
<p>在浏览器中，不仅不包括边框和工具栏，就连按 F12 调出调试台也会缩减可视页面大小。</p>
<p><img data-src="/2022/01/14/note/%E5%89%8D%E7%AB%AF/js%E9%AB%98%E7%BA%A7%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1/image-20220406220553167.png" alt="image-20220406220553167"></p>
<p>特别是在<strong>移动端</strong>，视口仅是页面的一小部分，如何布局视口、适配不同屏幕很关键。</p>
<p><code>document.documentElement.clientWidth</code>  和 <code>document.documentElement.clientHeight</code>  也能返回视口大小。</p>
<ul>
<li><code>document.documentElement.clientWidth</code> ：返回视口宽度</li>
<li><code>document.documentElement.clientHeight</code> ：返回视口高度</li>
</ul>
<p>在 IE 中则是 <code>document.body.clientWidth</code>  和 <code>document.body.clientHeight</code></p>
<h3 id="15-ltspan-id-quot视口位置quotgt-视口位置-ltspangt"><a class="anchor" href="#15-span-id-视口位置视口位置span">#</a> 1.5 &lt;span id = &quot;视口位置&quot;&gt; 视口位置 &lt;/span&gt;</h3>
<blockquote>
<p>浏览器窗口尺寸通常无法满足完整显示整个页面。</p>
</blockquote>
<p><strong>滚动页面</strong></p>
<ul>
<li>
<p><code>scroll()</code> ：...</p>
</li>
<li>
<p><code>scrollTo()</code> ：滚动到指定坐标</p>
<ul>
<li>参数 1：横坐标</li>
<li>参数 2：纵坐标</li>
</ul>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre>window<span class="token punctuation">.</span><span class="token function">scrollTo</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 滚动到页面左上角</span></pre></td></tr><tr><td data-num="2"></td><td><pre>window<span class="token punctuation">.</span><span class="token function">scrollTo</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 滚动到距离屏幕左边和顶边各 100 像素的位置</span></pre></td></tr></table></figure></li>
<li>
<p><code>scrollBy()</code> ：向指定方向滚动指定像素</p>
<ul>
<li>参数 1：向右滚动 n 个像素</li>
<li>参数 2：向下滚动 n 个像素</li>
</ul>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre>window<span class="token punctuation">.</span><span class="token function">scrollBy</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 向下滚动 100 像素</span></pre></td></tr><tr><td data-num="2"></td><td><pre>window<span class="token punctuation">.</span><span class="token function">scrollBy</span><span class="token punctuation">(</span><span class="token number">40</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 向右滚动 40 像素</span></pre></td></tr></table></figure></li>
</ul>
<h3 id="16-ltspan-id-quot导航与打开新窗口quotgt-导航与打开新窗口-ltspangt"><a class="anchor" href="#16-span-id-导航与打开新窗口导航与打开新窗口span">#</a> 1.6 &lt;span id = &quot;导航与打开新窗口&quot;&gt; 导航与打开新窗口 &lt;/span&gt;</h3>
<p>本节概要：</p>
<ul>
<li><code>window.open()</code> ：弹窗函数</li>
<li><code>window.opener</code> ：返回打开弹窗的窗口</li>
<li><code>window.close()</code> ：关闭窗口</li>
</ul>
<hr>
<blockquote>
<p><code>window.open()</code>  用于导航到指定 URL，也可以用于打开新浏览器窗口</p>
</blockquote>
<ul>
<li>
<p><code>window.open()</code> ：根据指定的 url 跳转页面或打开新窗口</p>
<ul>
<li>
<p>参数 1：必选，url。（完整路径， <code>http</code>  不可漏）</p>
</li>
<li>
<p>参数 2：可选，target，目标窗口。对应窗口名打开 url，如果没有，则新窗口打开，并命名为 target。</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre>window<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">'https://www.baidu.com'</span><span class="token punctuation">,</span><span class="token string">'newWindow'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 如果有窗口名叫 'newWindow'，那么这个窗口打开百度，否则新创建一个窗口打开百度，并且将其命名为 'newWindow'</span></pre></td></tr></table></figure><ul>
<li>特殊窗口名：
<ul>
<li><code>_self</code> ：指向自己</li>
<li><code>_parent</code> ：指向父窗口</li>
<li><code>_top</code> ：最顶端窗口</li>
<li><code>_blank</code> ：最低端窗口</li>
</ul>
</li>
</ul>
</li>
<li>
<p>参数 3：可选，窗口特性（工具栏、地址栏、状态栏等）</p>
<ul>
<li>height：新窗口高度</li>
<li>width：新窗口宽度</li>
<li>left：新窗口 x 轴坐标</li>
<li>top：新窗口 y 轴坐标</li>
<li>location：是否显示<strong>地址栏</strong>。bool</li>
<li>Menubar：是否显示<strong>菜单栏</strong>。bool</li>
<li>status：是否显示<strong>状态栏</strong></li>
<li>toolbar：是否显示<strong>工具栏</strong></li>
<li>fullscreen：新窗口是否最大化（仅 IE 支持），bool</li>
<li>resizable：是否可以拖动改变新窗口大小</li>
<li>scrollbars：是否可在内容过长时<strong>滚动</strong></li>
</ul>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre>window<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">'https://www.baidu.com'</span><span class="token punctuation">,</span><span class="token string">'_self'</span><span class="token punctuation">,</span><span class="token string">"height=400,width=400,top=10,left=10,resizable"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p>此外，为了限制弹窗广告，各浏览器对弹窗的特性做了一些限制，有些状态并不能使用。</p>
</li>
<li>
<p>参数 4 一般很少使用</p>
</li>
<li>
<p>返回：一个 <code>window</code>  对象，可以调用所有 <code>window</code>  函数及属性</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">let</span> wroxWin<span class="token operator">=</span>window<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">'https://www.baidu.com'</span><span class="token punctuation">,</span><span class="token string">'wroxWin'</span><span class="token punctuation">,</span><span class="token string">"height=400,width=400,top=10,left=10"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>wroxWin<span class="token punctuation">.</span><span class="token function">resizeTo</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">,</span><span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 缩放 wroxWin 窗口</span></pre></td></tr><tr><td data-num="3"></td><td><pre>wroxWin<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 关闭 wroxWin 窗口</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token comment">// 关闭后，虽然 wroxWin 这个变量还在，但只能用来访问 wroxWin.closed 属性了（关闭后为 true）</span></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
<p><code>window.open()</code>  打开新窗口后，有一个 <code>window.opener</code>  属性，指向<strong>打开它的窗口</strong></p>
<p>但窗口不会记录自己打开的窗口。（孩子知道父亲，父亲不知道孩子）</p>
<ul>
<li>
<p><code>window.opener</code> ：打开这个窗口的窗口</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">let</span> wroxWin<span class="token operator">=</span>window<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">'https://www.baidu.com'</span><span class="token punctuation">,</span><span class="token string">'wroxWin'</span><span class="token punctuation">,</span><span class="token string">"height=400,width=400,top=10,left=10"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token function">alert</span><span class="token punctuation">(</span>wroxWin<span class="token punctuation">.</span>opener<span class="token operator">===</span>window<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//true</span></pre></td></tr></table></figure><p>把 <code>window.opener</code>  设为 <code>null</code>  表示不需要和打开它的标签页通信，这样可以在<strong>独立的进程中运行</strong>。此操作不可逆</p>
</li>
</ul>
<p><strong>弹窗屏蔽</strong></p>
<p>有时候弹窗被浏览器屏蔽，那么 <code>window.open()</code>  则会返回 <code>null</code>  或者抛出异常，那么我们需要用 <code>try-catch</code>  包裹并且判断是否返回空</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">try</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token keyword">let</span> wroxWin<span class="token operator">=</span>window<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">'https://www.baidu.com'</span><span class="token punctuation">,</span><span class="token string">'wroxWin'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token keyword">if</span><span class="token punctuation">(</span>wroxWin<span class="token operator">===</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>        <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">'弹窗被屏蔽，null'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token punctuation">&#125;</span><span class="token keyword">catch</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">'弹窗被屏蔽，err'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h3 id="17-ltspan-id-quot定时器quotgt-定时器-ltspangt"><a class="anchor" href="#17-span-id-定时器定时器span">#</a> 1.7 &lt;span id = &quot;定时器&quot;&gt; 定时器 &lt;/span&gt;</h3>
<p>本节概要</p>
<ul>
<li><code>setTimeout()</code> ：指定一定时间后执行某段代码</li>
<li><code>clearTimeout()</code> ：取消 <code>setTimeout</code>  排期</li>
<li><code>setInterval()</code> ：<strong>每隔</strong>一段时间执行某段代码</li>
<li><code>clearInterval()</code> ：取消 <code>setInterval</code>  任务</li>
</ul>
<hr>
<blockquote>
<p>JavaScript 在浏览器中是单线程执行的，但允许使用定时器指定在某个时间之后或每隔一段时间就执行相应代码（仿多线程），主要由 2 个函数： <code>setTimeout</code>  和 <code>setInterval()</code>  实现</p>
</blockquote>
<ul>
<li>
<p><code>setTimeout()</code> ：指定一定时间后执行某段代码</p>
<ul>
<li>参数 1：要执行的代码，可以是个回调函数</li>
<li>参数 2：等待时间。</li>
<li>参数 3、4、5：如果参数 1 写的是回调函数，回调函数的参数</li>
<li>返回值： <code>timeout</code>  任务的 ID。</li>
</ul>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=></span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'hello world'</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//1s 后执行箭头函数</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token comment">// 或者</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token function">setTimeout</span><span class="token punctuation">(</span>console<span class="token punctuation">.</span>log<span class="token punctuation">,</span><span class="token number">1000</span><span class="token punctuation">,</span><span class="token string">'hello world'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 以上两者者等价</span></pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token comment">// 千万不能 setTimeout (console.log ('hello world'),1000); 这样写</span></pre></td></tr></table></figure><p>JavaScript 引擎维护一个任务队列，&lt;u&gt; <code>setTimeout</code>  的参数 2 告诉 JavaScript 引擎在指定毫秒数后把任务添加到队列。&lt;/u&gt; 如果代码在队列头， 则会立即执行，否则等待前面的代码执行完后执行。</p>
</li>
<li>
<p><code>clearTimeout()</code> ：取消等待中的排期（ <code>setTimeout</code> ）任务。</p>
<p><code>setTimeout</code>  会返回一个表示该超时排期的数值 ID（其实就相当于是该 <code>setTimeout</code>  的 ID）， <code>clearTimeout</code>  用于取消该任务</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">let</span> timeoutID<span class="token operator">=</span><span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=></span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'hello world'</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//1s 后执行箭头函数</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token function">clearTimeout</span><span class="token punctuation">(</span>timeoutID<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 取消延时任务</span></pre></td></tr></table></figure><p>只要在指定时间到达之前调用，就可以取消超时（延时）任务。任务执行后再调用就没有效果</p>
</li>
<li>
<p><code>setInterval()</code> ：<strong>每隔</strong>一段时间执行某段代码，用法和 <code>setTimeout</code>  相似</p>
<ul>
<li>参数...</li>
<li>返回：循环 ID</li>
</ul>
</li>
<li>
<p><code>clearInterval()</code> ：取消 <code>setInterval</code>  任务</p>
</li>
</ul>
<p>&lt;font color=red&gt; 注： <code>setTimeout</code>  不一定要记录 id，因为其到时执行后就会自动销毁，而 <code>setInterval</code>  则必须留 id，设置 <code>clearInterval</code> ，否则会一直循环执行直到页面卸载 &lt;/font&gt;</p>
<h3 id="18-ltspan-id-quot系统对话框quotgt-系统对话框-ltspangt"><a class="anchor" href="#18-span-id-系统对话框系统对话框span">#</a> 1.8 &lt;span id = &quot;系统对话框&quot;&gt; 系统对话框 &lt;/span&gt;</h3>
<p>本节概要：</p>
<ul>
<li><code>alert()</code> ：警告框</li>
<li><code>confirm()</code> ：确认框</li>
<li><code>prompt()</code> ：提示框（输入框）</li>
</ul>
<hr>
<blockquote>
<p>系统提示框，无法设置 css 等属性，外观由操作系统或浏览器决定。当他们显示时，<strong>代码会停止运行</strong></p>
</blockquote>
<ul>
<li>
<p><code>alert()</code> ：警告框。</p>
<ul>
<li>提示消息。传给 <code>alert</code>  的参数会自动以 <code>toString()</code>  转换为字符串。一般用于提示或警告</li>
</ul>
<p><img data-src="/2022/01/14/note/%E5%89%8D%E7%AB%AF/js%E9%AB%98%E7%BA%A7%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1/image-20220411163521065.png" alt="image-20220411163521065"></p>
</li>
<li>
<p><code>confirm()</code> ：确认框。</p>
<ul>
<li>参数 1：提示消息</li>
<li>返回值：如果用户点击<strong>确定</strong>，返回 <code>true</code> ；否则，返回 <code>false</code></li>
</ul>
<p><img data-src="/2022/01/14/note/%E5%89%8D%E7%AB%AF/js%E9%AB%98%E7%BA%A7%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1/image-20220411163820994.png" alt="image-20220411163820994"></p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">confirm</span><span class="token punctuation">(</span><span class="token string">'Are you sure?'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">'OK'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token punctuation">&#125;</span><span class="token keyword">else</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">'cancel'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure></li>
<li>
<p><code>prompt()</code> ：提示框（输入框）。除了<strong>确认</strong>和<strong>取消</strong>，还会有一行文本框让用户输入内容</p>
<ul>
<li>参数 1：提示消息</li>
<li>参数 2：文本框默认值</li>
<li>返回：如果用户点击确定，返回文本框内的字符串，否则返回 <code>null</code></li>
</ul>
<p><img data-src="/2022/01/14/note/%E5%89%8D%E7%AB%AF/js%E9%AB%98%E7%BA%A7%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1/image-20220411164344540.png" alt="image-20220411164344540"></p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">let</span> name<span class="token operator">=</span><span class="token function">prompt</span><span class="token punctuation">(</span><span class="token string">'你的名字?'</span><span class="token punctuation">,</span><span class="token string">'五月天'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">if</span> <span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">'你好'</span><span class="token operator">+</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token punctuation">&#125;</span><span class="token keyword">else</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">'无名侠'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure></li>
</ul>
<p>此外 JavaScript 还有另外 2 种对话框 <code>find()</code>  和 <code>print()</code> 。</p>
<ul>
<li>
<p><code>window.print()</code> ：显示打印对话框</p>
<p><img data-src="/2022/01/14/note/%E5%89%8D%E7%AB%AF/js%E9%AB%98%E7%BA%A7%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1/image-20220411165112296.png" alt="image-20220411165112296"></p>
</li>
<li>
<p><code>window.find()</code> ：显示查找对话框</p>
</li>
</ul>
<p>用的很少，略过</p>
<h2 id="2-location-对象"><a class="anchor" href="#2-location对象">#</a> 2. location 对象</h2>
<p>本章概要：</p>
<ul>
<li><code>location</code>  的各项属性，包括但不限于各种返回 / 修改 url 的属性</li>
<li><code>URLSearchParams</code> ：获取查询键值对的类</li>
<li><code>location.assign(url)</code> ：转到新的 url，同时增加一条历史记录</li>
<li><code>location.replace(url)</code> ：重定向，<strong>不增加历史记录</strong>，也不能 “后退” 回到前一页</li>
<li><code>location.reload(param)</code> ：重新加载，其实就相当于刷新。考虑到网络延迟和系统资源等问题，一般放在最后一行</li>
</ul>
<hr>
<blockquote>
<p>location 是最有用的 BOM 对象之一，提供了当前窗口中<strong>加载文档</strong>的信息，以及通常的<strong>导航功能</strong></p>
</blockquote>
<ul>
<li><code>location</code>  既是 <code>window</code>  的属性，也是 <code>document</code>  的属性。即 <code>window.location</code>  和 <code>document.location</code>  指向同一个对象</li>
<li><code>location</code>  保存着这些信息
<ul>
<li>当前加载的文档的信息</li>
<li>把 URL 解析为离散片段后能够通过属性访问的信息</li>
</ul>
</li>
</ul>
<table>
<thead>
<tr>
<th>属性</th>
<th>说明</th>
<th>示例</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>location.href</code></td>
<td>当前页面完整的 url</td>
<td><code>&quot;http://www.wrox.com:80/WileyCDA/?q=javascript#contents&quot;</code></td>
</tr>
<tr>
<td><code>location.host</code></td>
<td>服务器名及端口号</td>
<td><code>&quot;www.wrox.com:80&quot;</code></td>
</tr>
<tr>
<td><code>location.hostname</code></td>
<td>服务期名</td>
<td><code>&quot;www.wrox.com&quot;</code></td>
</tr>
<tr>
<td><code>location.port</code></td>
<td>端口号</td>
<td><code>&quot;80&quot;</code></td>
</tr>
<tr>
<td><code>location.pathname</code></td>
<td>url 中的路径（文档的相对路径）</td>
<td><code>&quot;/WileyCDA/&quot;</code></td>
</tr>
<tr>
<td><code>location.protocol</code></td>
<td>协议，一般就是 <code>http:</code>  或 <code>https:</code></td>
<td><code>&quot;http:&quot;</code></td>
</tr>
<tr>
<td><code>location.search</code></td>
<td>url 的查询字符串，以 <code>?</code>  开头</td>
<td><code>&quot;?q=javascript&quot;</code></td>
</tr>
<tr>
<td><code>location.hash</code></td>
<td>url 的哈希值，如果没有则为空字符串</td>
<td><code>&quot;#contents&quot;</code></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td><code>location.username</code></td>
<td>域名前指定的用户名</td>
<td><code>&quot;ninglidashen1996&quot;</code></td>
</tr>
<tr>
<td><code>location.password</code></td>
<td>用户密码</td>
<td><code>&quot;cjq123456789&quot;</code></td>
</tr>
<tr>
<td><code>location.origin</code></td>
<td>url 的源地址（只读）, 一般是协议 + 服务器名</td>
<td><code>&quot;http://www.wrox.com&quot;</code></td>
</tr>
</tbody>
</table>
<h3 id="21-查询字符串"><a class="anchor" href="#21-查询字符串">#</a> 2.1 查询字符串</h3>
<p><code>location.search</code>  我们获取的是一串字符串，我们通常使用如下一系列操作提取 <code>k-v</code>  值</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">let</span> <span class="token function-variable function">getQueryStringArgs</span><span class="token operator">=</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token keyword">let</span> qs<span class="token operator">=</span><span class="token punctuation">(</span>location<span class="token punctuation">.</span>search<span class="token punctuation">.</span>length<span class="token operator">></span><span class="token number">0</span><span class="token operator">?</span> location<span class="token punctuation">.</span>search<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="3"></td><td><pre>        args<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> item <span class="token keyword">of</span> qs<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">'&amp;'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">kv</span><span class="token operator">=></span>kv<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">'='</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>        <span class="token comment">// 对获取的字符串解码（url 中的汉字会被进行 encode 编码）</span></pre></td></tr><tr><td data-num="6"></td><td><pre>        <span class="token keyword">let</span> name<span class="token operator">=</span><span class="token function">decodeURIComponent</span><span class="token punctuation">(</span>item<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="7"></td><td><pre>            value<span class="token operator">=</span><span class="token function">decodeURIComponent</span><span class="token punctuation">(</span>item<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>        <span class="token keyword">if</span> <span class="token punctuation">(</span>name<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>            args<span class="token punctuation">[</span>name<span class="token punctuation">]</span><span class="token operator">=</span>value<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="12"></td><td><pre>    <span class="token keyword">return</span> args<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>但是 JavaScript 中有个 <code>URLSearchParams</code>  类提供了专门提取 <code>k-v</code>  的 API</p>
<p><strong>URLSearchParams</strong></p>
<ul>
<li>创建（初始化）： <code>new URLSearchParams(location.search);</code></li>
<li><code>has(key)</code> ：查找是否有指定的键</li>
<li><code>get(key)</code> ：通过指定键获取值。（会自动解码）</li>
<li><code>set(key,value)</code> ：添加指定的键值对。（要用字符串）</li>
<li><code>delete(key)</code> ：删除指定的键值对</li>
</ul>
<p>用法和 <code>map</code>  基本上差不多</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">let</span> qs<span class="token operator">=</span><span class="token string">"name=陈家琪&amp;age=16"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">let</span> searchParams<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">URLSearchParams</span><span class="token punctuation">(</span>qs<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>searchParams<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//name=%E9%99%88%E5%AE%B6%E7%90%AA&amp;age=16</span></pre></td></tr><tr><td data-num="4"></td><td><pre>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>searchParams<span class="token punctuation">.</span><span class="token function">has</span><span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//true</span></pre></td></tr><tr><td data-num="5"></td><td><pre>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>searchParams<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 陈家琪（会自动解码）</span></pre></td></tr><tr><td data-num="6"></td><td><pre>searchParams<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">"page"</span><span class="token punctuation">,</span><span class="token string">"3"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>searchParams<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//name=%E9%99%88%E5%AE%B6%E7%90%AA&amp;age=16&amp;page=3</span></pre></td></tr><tr><td data-num="8"></td><td><pre>searchParams<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span><span class="token string">"page"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><h3 id="22-操作地址"><a class="anchor" href="#22-操作地址">#</a> 2.2 操作地址</h3>
<p><code>location</code>  的一大用处就是<strong>修改浏览器地址</strong>（即要访问的 url 地址，也就是地址栏上的那串字符串，如下图）</p>
<p><img data-src="/2022/01/14/note/%E5%89%8D%E7%AB%AF/js%E9%AB%98%E7%BA%A7%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1/image-20220411202010739.png" alt="image-20220411202010739"></p>
<ul>
<li>
<p><code>location.assign(url)</code> ：转到新的 url，同时增加一条历史记录</p>
</li>
<li>
<p><code>location.href</code> ：调用 <code>location.assign</code> ，转到新的 url。<strong>最常用</strong></p>
</li>
<li>
<p><code>window.location</code> ：直接改 <code>location</code>  也可，也是调用 <code>assign</code></p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre>location<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span><span class="token string">"https://www.baidu.com"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>location<span class="token punctuation">.</span>href<span class="token operator">=</span><span class="token string">"https://www.baidu.com"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>location<span class="token operator">=</span><span class="token string">"https://www.baidu.com"</span><span class="token punctuation">;</span></pre></td></tr></table></figure></li>
<li>
<p>此外，修改<strong>除了 hash</strong> 的任意 ** <code>location</code>  属性 ** 都会导致页面重新加载新的 url。同时增加一条历史记录。</p>
<ul>
<li>修改 <code>hash</code>  虽然不会刷新页面，但会增加历史记录</li>
</ul>
</li>
<li>
<p><code>location.replace(url)</code> ：重定向，<strong>不增加历史记录</strong>，也不能 “后退” 回到前一页</p>
</li>
<li>
<p><code>location.reload(param)</code> ：重新加载，其实就相当于<strong>刷新</strong>。考虑到网络延迟和系统资源等问题，一般放在最后一行</p>
<ul>
<li><code>location.reload()</code> ：从缓存中加载。（如果页面自上次请求以来就没有修改过，就会从缓存中加载）</li>
<li><code>location.reload(true)</code> ：强制从服务器加载</li>
</ul>
</li>
</ul>
<h2 id="3-navigator-对象"><a class="anchor" href="#3-navigator对象">#</a> 3. navigator 对象</h2>
<p>主要关于浏览器程序的一些信息，用的不多。在第 13 章会详细介绍。</p>
<ul>
<li>检测插件</li>
<li>注册处理程序</li>
</ul>
<h2 id="4-screen-对象"><a class="anchor" href="#4-screen对象">#</a> 4. screen 对象</h2>
<p>也很少使用，主要获取客户端显示器信息。</p>
<table>
<thead>
<tr>
<th style="text-align:left">属性</th>
<th style="text-align:left">说明</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left"><span class="exturl" data-url="aHR0cHM6Ly93d3cucnVub29iLmNvbS9qc3JlZi9wcm9wLXNjcmVlbi1hdmFpbGhlaWdodC5odG1s">availHeight</span></td>
<td style="text-align:left">返回屏幕的高度（不包括 Windows 任务栏）</td>
</tr>
<tr>
<td style="text-align:left"><span class="exturl" data-url="aHR0cHM6Ly93d3cucnVub29iLmNvbS9qc3JlZi9wcm9wLXNjcmVlbi1hdmFpbHdpZHRoLmh0bWw=">availWidth</span></td>
<td style="text-align:left">返回屏幕的宽度（不包括 Windows 任务栏）</td>
</tr>
<tr>
<td style="text-align:left"><span class="exturl" data-url="aHR0cHM6Ly93d3cucnVub29iLmNvbS9qc3JlZi9wcm9wLXNjcmVlbi1jb2xvcmRlcHRoLmh0bWw=">colorDepth</span></td>
<td style="text-align:left">返回目标设备或缓冲器上的调色板的比特深度</td>
</tr>
<tr>
<td style="text-align:left"><span class="exturl" data-url="aHR0cHM6Ly93d3cucnVub29iLmNvbS9qc3JlZi9wcm9wLXNjcmVlbi1oZWlnaHQuaHRtbA==">height</span></td>
<td style="text-align:left">返回屏幕的总高度</td>
</tr>
<tr>
<td style="text-align:left"><span class="exturl" data-url="aHR0cHM6Ly93d3cucnVub29iLmNvbS9qc3JlZi9wcm9wLXNjcmVlbi1waXhlbGRlcHRoLmh0bWw=">pixelDepth</span></td>
<td style="text-align:left">返回屏幕的颜色分辨率（每象素的位数）</td>
</tr>
<tr>
<td style="text-align:left"><span class="exturl" data-url="aHR0cHM6Ly93d3cucnVub29iLmNvbS9qc3JlZi9wcm9wLXNjcmVlbi13aWR0aC5odG1s">width</span></td>
<td style="text-align:left">返回屏幕的总宽度</td>
</tr>
</tbody>
</table>
<h2 id="5-history-对象"><a class="anchor" href="#5-history对象">#</a> 5. history 对象</h2>
<p>主要保存历史记录，每个 <code>window</code>  都有一个自己的 <code>history</code>  对象。</p>
<p>出于安全考虑， <code>history</code>  其实并不会暴露用户访问过的 url，但提供前进和后退等方法可以转到访问过的 url</p>
<h3 id="51-导航"><a class="anchor" href="#51-导航">#</a> 5.1 导航</h3>
<ul>
<li>
<p><code>history.go()</code> ：沿任何方向导航</p>
<ul>
<li>
<p>参数可以是数字</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre>history<span class="token punctuation">.</span><span class="token function">go</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 前进一页</span></pre></td></tr><tr><td data-num="2"></td><td><pre>history<span class="token punctuation">.</span><span class="token function">go</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 后退一页</span></pre></td></tr><tr><td data-num="3"></td><td><pre>history<span class="token punctuation">.</span><span class="token function">go</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 前进 2 页</span></pre></td></tr></table></figure></li>
<li>
<p>也可以是字符串</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre>history<span class="token punctuation">.</span><span class="token function">go</span><span class="token punctuation">(</span><span class="token string">"wrox.com"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 导航到最近的 wrox.com 页面</span></pre></td></tr></table></figure></li>
</ul>
</li>
<li>
<p><code>history.back()</code> ：后退一页</p>
</li>
<li>
<p><code>history.forward()</code> ：前进一页（两者都是 <code>go</code>  的简化）</p>
</li>
<li>
<p><code>history.length</code> ：返回历史记录数。如果 <code>length===1</code> ，则说明这是用户窗口第一个页面。</p>
</li>
</ul>
<h3 id="52-历史状态管理看不懂"><a class="anchor" href="#52-历史状态管理看不懂">#</a> 5.2 历史状态管理（看不懂）</h3>
<h1 id="十三-客户端检测暂缓"><a class="anchor" href="#十三-客户端检测暂缓">#</a> 十三、 客户端检测（暂缓）</h1>
<p>主要是检测是什么浏览器，谷歌、火狐、还是 IE 或者别的</p>
<h1 id="十四-dom"><a class="anchor" href="#十四-dom">#</a> 十四、 DOM</h1>
<blockquote>
<p>DOM (文档对象模型)。通过 HTML DOM，可访问 JavaScript HTML 文档的所有元素。最主要的就是 2 点：</p>
<ol>
<li>设置 html 文档内容</li>
<li>设置事件</li>
</ol>
</blockquote>
<h2 id="1-节点层级"><a class="anchor" href="#1-节点层级">#</a> 1. 节点层级</h2>
<p>在 HTML DOM (Document Object Model) 中，每一个元素都是 <strong>节点</strong></p>
<p>节点关系如下图：文档树</p>
<p><img data-src="/2022/01/14/note/%E5%89%8D%E7%AB%AF/js%E9%AB%98%E7%BA%A7%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1/pic_htmltree.gif" alt="DOM HTML tree"></p>
<blockquote>
<p>每个节点都是 html 中一个组成</p>
</blockquote>
<p>对应于下面的</p>
<figure class="highlight html"><figcaption data-lang="HTML"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>en<span class="token punctuation">"</span></span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span>My title<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>文档层级.html<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>My link<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">></span></span>My header<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span></pre></td></tr></table></figure><p>每个节点（Node）都是一个标签如 <code>&lt;h1&gt;</code></p>
<p><img data-src="/2022/01/14/note/%E5%89%8D%E7%AB%AF/js%E9%AB%98%E7%BA%A7%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1/image-20220411213156751.png" alt="image-20220411213156751"> 每个红线框着的都是节点</p>
<h3 id="11-node-类型"><a class="anchor" href="#11-node类型">#</a> 1.1 Node 类型</h3>
<p><code>node</code>  是一个比较泛化的对象，上面圈的这些节点都是 <code>node</code> ，最常见的如元素节点（标签节点） <code>element</code>  是通过 <code>document.getElement</code>  得到的</p>
<p>本节概要：</p>
<ul>
<li>各种节点的属性和操作节点的方法</li>
<li><code>node.nodeType</code> ：节点类型</li>
<li><code>node.nodeName</code> ：返回节点名</li>
<li><code>node.nodeValue</code> ：同 <code>name</code></li>
<li><code>node.childNodes</code> ：返回节点的所有孩子节点。</li>
<li><code>NodeList</code> ：类数组的对象</li>
<li><a href="#%E8%8A%82%E7%82%B9%E5%85%B3%E7%B3%BB">节点层级关系</a>
<ul>
<li><code>node.parentNode</code> ：返回节点的父节点。</li>
<li><code>node.previousSibling</code> ：上一个兄弟节点。第一个返回 <code>null</code></li>
<li><code>node.nextSibling</code> ：下一个兄弟节点。最后一一个返回 <code>null</code></li>
<li><code>node.firstChild</code> ：第一个孩子节点</li>
<li><code>node.lastChild</code> ：最后一个孩子节点。如果没有孩子节点返回 <code>null</code></li>
<li><code>node.hasChildNodes()</code> ：返回是否有孩子节点</li>
</ul>
</li>
<li><a href="#%E6%93%8D%E4%BD%9C%E8%8A%82%E7%82%B9">操作节点</a>
<ul>
<li><code>node.appendChild()</code> ：在 <code>childNodes</code>  列表结尾添加一个子节点</li>
<li><code>node.insertBefore()</code> ：在特定位置插入一个<strong>子节点</strong></li>
<li><code>node.replaceChild()</code> ：替换指定节点</li>
<li><code>node.removeChild()</code> ：删除指定节点</li>
</ul>
</li>
</ul>
<hr>
<blockquote>
<p>DOM Level 1 描述了名为 Node 的接口，这个接口是所有 DOM 节点类型都必须实现的，即所有结点类型都继承 Node 类型</p>
</blockquote>
<p>每个节点都有 <code>nodeType</code>  属性，表示该节点的类型。</p>
<p>设一个 <code>node</code>  是一个节点对象实例</p>
<ul>
<li>
<p><code>node.nodeType</code> ：节点类型，如下</p>
<ol>
<li><code>Node.ELEMENT_NODE</code> ：1</li>
<li><code>Node.ATTRIBUTE_NODE</code> ：2</li>
<li><code>Node.TEXT_NODE</code> ：3</li>
<li><code>Node.CDATA_SECTION_NODE</code> ：4</li>
<li><code>Node.ENTITY_REFERENCE_NODE</code> ：5</li>
<li><code>Node.ENTITY_NODE</code> ：6</li>
<li><code>Node.PROCESSING_INSTRUCTION_NODE</code> ：7</li>
<li><code>Node.COMMENT_NODE</code> ：8</li>
<li><code>Node.DOCUMENT_NODE</code> ：9</li>
<li><code>Node.DOCUMENT_TYPE_NODE</code> ：10</li>
<li><code>Node.DOCUMENT_FRAGMENT_NODE</code> ：11</li>
<li><code>Node.DOCUMENT_NODE</code> ：12</li>
</ol>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">let</span> node<span class="token operator">=</span>document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">"id1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token function">alert</span><span class="token punctuation">(</span>node<span class="token punctuation">.</span>nodeType<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//1</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token function">alert</span><span class="token punctuation">(</span>node<span class="token punctuation">.</span>nodeType<span class="token operator">===</span>Node<span class="token punctuation">.</span><span class="token constant">ELEMENT_NODE</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//true</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token comment">// 解释一下，node 是 element 类型的节点，所以是 Node.ELEMENT_NODE，也就是 1</span></pre></td></tr></table></figure></li>
</ul>
<h4 id="111-nodename-和-nodevalue"><a class="anchor" href="#111-nodename和nodevalue">#</a> 1.1.1 nodeName 和 nodeValue</h4>
<ul>
<li><code>node.nodeName</code> ：返回节点名，每个节点类型返回可能都不一样
<ul>
<li><code>element</code>  元素节点：返回标签名（大写）</li>
<li>....</li>
</ul>
</li>
<li><code>node.nodeValue</code> ：同 <code>name</code> ，每个节点类型返回都不一样
<ul>
<li><code>element</code>  元素节点：返回 <code>null</code></li>
<li>...</li>
</ul>
</li>
</ul>
<h4 id="112-ltspan-id-quot节点关系quotgt-节点关系-ltspangt"><a class="anchor" href="#112-span-id-节点关系节点关系span">#</a> 1.1.2 &lt;span id = &quot;节点关系&quot;&gt; 节点关系 &lt;/span&gt;</h4>
<p>文档中所有节点都与其他节点有关系，可以形容为家族关系，大家都在一个族谱（文档树）上。</p>
<ul>
<li>
<p><code>node.childNodes</code> ：返回节点的所有孩子节点。他们共有一个父节点（ <code>parentNode</code> ）</p>
<ul>
<li>返回： <code>NodeList</code>  类型的实例。</li>
</ul>
<p>&lt;font color=red&gt; 注： <code>childNodes</code>  会把空白也当成文本节点算进去 &lt;/font&gt;</p>
<p><img data-src="/2022/01/14/note/%E5%89%8D%E7%AB%AF/js%E9%AB%98%E7%BA%A7%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1/image-20220411215520567.png" alt="image-20220411215520567"> 这些空白都会被当成节点</p>
<p>除非这样写成一行<img data-src="/2022/01/14/note/%E5%89%8D%E7%AB%AF/js%E9%AB%98%E7%BA%A7%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1/image-20220411215548440.png" alt="image-20220411215548440"></p>
<figure class="highlight html"><figcaption data-lang="HTML"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>123.html<span class="token punctuation">"</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>id1<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>My link<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">></span></span>My header<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript"></span></span></pre></td></tr><tr><td data-num="5"></td><td><pre>        <span class="token keyword">let</span> node<span class="token operator">=</span>document<span class="token punctuation">.</span><span class="token function">getElementsByTagName</span><span class="token punctuation">(</span><span class="token string">'body'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token keyword">of</span> node<span class="token punctuation">.</span>childNodes<span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>            <span class="token keyword">if</span> <span class="token punctuation">(</span>i<span class="token punctuation">.</span>nodeType<span class="token operator">===</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>                document<span class="token punctuation">.</span><span class="token function">writeln</span><span class="token punctuation">(</span>i<span class="token punctuation">.</span>nodeName<span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>            <span class="token punctuation">&#125;</span><span class="token keyword">else</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>                document<span class="token punctuation">.</span><span class="token function">writeln</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>            <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="12"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="13"></td><td><pre>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span></pre></td></tr></table></figure><p>如图：<img data-src="/2022/01/14/note/%E5%89%8D%E7%AB%AF/js%E9%AB%98%E7%BA%A7%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1/image-20220411215629845.png" alt="image-20220411215629845"></p>
</li>
<li>
<p><code>NodeList</code> ：类数组的对象，可以使用几乎所有 <code>Array</code>  的属性和方法（但其并不是 <code>Array</code>  是实例）</p>
<p>假设 <code>nodes</code>  是一个 <code>NodeList</code>  的实例</p>
<ul>
<li><code>nodes[0]</code> ：返回第一个节点</li>
<li><code>nodes.item(0)</code> ：返回第一个节点</li>
<li><code>nodes.length</code> ：返回节点数</li>
<li>可以通过 <code>Array.from</code>  等操作转为数组</li>
</ul>
</li>
<li>
<p><code>node.parentNode</code> ：返回节点的父节点。</p>
</li>
<li>
<p><code>node.previousSibling</code> ：上一个兄弟节点。第一个返回 <code>null</code></p>
</li>
<li>
<p><code>node.nextSibling</code> ：下一个兄弟节点。最后一一个返回 <code>null</code></p>
</li>
<li>
<p><code>node.firstChild</code> ：第一个孩子节点</p>
</li>
<li>
<p><code>node.lastChild</code> ：最后一个孩子节点。如果没有孩子节点返回 <code>null</code></p>
</li>
<li>
<p><code>node.hasChildNodes()</code> ：返回是否有孩子节点</p>
</li>
</ul>
<h4 id="113-ltspan-id-quot操作节点quotgt-操作节点-ltspangt"><a class="anchor" href="#113-span-id-操作节点操作节点span">#</a> 1.1.3 &lt;span id = &quot;操作节点&quot;&gt; 操作节点 &lt;/span&gt;</h4>
<p>其实就是类似数组的增删改</p>
<ul>
<li>
<p><code>node.appendChild()</code> ：在 <code>childNodes</code>  列表结尾添加一个子节点</p>
<ul>
<li>参数：要添加的节点</li>
<li>返回：要添加的节点</li>
</ul>
</li>
<li>
<p><code>node.insertBefore()</code> ：在特定位置插入一个<strong>子节点</strong></p>
<ul>
<li>
<p>参数 1：插入节点</p>
</li>
<li>
<p>参数 2：被插队的节点。（要通过 <code>node</code>  获取），如下</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre>node<span class="token punctuation">.</span><span class="token function">insertBefore</span><span class="token punctuation">(</span>newNode<span class="token punctuation">,</span>node<span class="token punctuation">.</span>lastChild<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 把 newNode 插入到 node 最后一个节点前</span></pre></td></tr></table></figure></li>
<li>
<p>返回：新插入的节点</p>
</li>
</ul>
</li>
<li>
<p><code>node.replaceChild()</code> ：替换指定节点</p>
<ul>
<li>参数 1：替换的节点</li>
<li>参数 2：被替换的节点（要通过 <code>node.属性</code> 获取）</li>
</ul>
</li>
<li>
<p><code>node.removeChild()</code> ：删除指定节点</p>
<ul>
<li>参数：被删除的节点（要通过 <code>node.属性</code> 获取）</li>
</ul>
</li>
<li>
<p>以上所有方法都需要先获取父节点（可通过 <code>parentNode</code>  属性获取）</p>
</li>
</ul>
<h4 id="114-其他方法"><a class="anchor" href="#114-其他方法">#</a> 1.1.4 其他方法</h4>
<h3 id="12-document-类型"><a class="anchor" href="#12-document类型">#</a> 1.2 document 类型</h3>
<p>即文档节点，代表的是当前页面。 <code>document</code>  是 <code>window</code>  的属性，是文档的全局对象，有以下特征：</p>
<ul>
<li><code>nodeType</code>  为 9；</li>
<li><code>nodeName</code>  为 <code>&quot;#document&quot;</code> ；</li>
<li><code>nodeValue</code>  为 <code>null</code> ；</li>
<li><code>parentNode</code>  为 <code>null</code> ；</li>
<li><code>ownerDocument</code>  为 <code>null</code> ；</li>
<li>子节点可以是 <code>DocumentType</code> 、 <code>Element</code> 、 <code>ProcessingInstruction</code>  或 <code>Comment</code>  类型</li>
</ul>
<h4 id="121-获取文档子节点"><a class="anchor" href="#121-获取文档子节点">#</a> 1.2.1 获取文档子节点</h4>
<p>除了 <code>node</code>  公用的访问子节点的属性 / 方法， <code>document</code>  还提供了几个访问特殊子节点的方法 / 属性</p>
<ul>
<li><code>document.documentElement</code> ：返回 <code>&lt;html&gt;</code>  元素节点的引用</li>
<li><code>document.body</code> ：返回 <code>&lt;body&gt;</code>  元素节点的引用。<strong>用的最多</strong></li>
<li><code>document.doctype</code> ：返回 <code>&lt;!doctype html&gt;</code>  元素节点的引用</li>
</ul>
<p>一般来说，不会对 <code>document</code>  进行 <code>appendChild()</code> 、 <code>removeChild()</code> 、 <code>replaceChild()</code>  等操作</p>
<h4 id="122-文档信息"><a class="anchor" href="#122-文档信息">#</a> 1.2.2 文档信息</h4>
<ul>
<li><code>document.title</code> ：取得 <code>&lt;head&gt;</code>  中的 <code>&lt;title&gt;</code>  的引用</li>
<li><code>document.URL</code> ：取得当前文档的完整 <code>url</code> （只读）</li>
<li><code>document.domain</code> ：取得当前文档的<strong>域名</strong>（只能设置 URL 中包含的值）</li>
<li><code>document.referrer</code> ：取得当前文档<strong>来源</strong>（只读，url 根地址）</li>
</ul>
<h4 id="123-定位元素获取元素节点"><a class="anchor" href="#123-定位元素获取元素节点">#</a> 1.2.3 定位元素（获取元素节点）</h4>
<ul>
<li><code>document.getElementById(id)</code> ：根据<strong> id</strong> 获取元素节点，找不到返回 <code>null</code> 。（多个相同的 id，返回第一个）
<ul>
<li><code>id</code> ：字符串，标签 id</li>
</ul>
</li>
<li><code>document.getElementsByTagName(tagName)</code> ：根据<strong>标签名</strong>返回元素节点的<strong>数组</strong>，没有匹配则是空数组。
<ul>
<li><code>tagName</code> ：字符串，标签名。可以是 <code>'*'</code> ，意为捕获所有元素节点</li>
<li><code>return</code> ： <code>HTMLCollection</code> ，html 集合，类数组对象，这里讲的<strong>数组</strong>就是他</li>
</ul>
</li>
<li><code>document.getElementsByName(name)</code> ：根据标签的<strong> name 属性</strong>返回元素节点的<strong>数组</strong></li>
<li><code>document.getElementsByClassName(className)</code> ：根据标签的<strong> class 属性</strong>返回元素节点的<strong>数组</strong></li>
</ul>
<h4 id="124-特殊集合元素节点数组"><a class="anchor" href="#124-特殊集合元素节点数组">#</a> 1.2.4 特殊集合（元素节点数组）</h4>
<ul>
<li><code>document.anchors</code> ：所有带 <code>name</code>  属性的 <code>&lt;a&gt;</code>  元素</li>
<li><code>document.forms</code> ：所有 <code>&lt;form&gt;</code>  元素</li>
<li><code>document.images</code> ：所有 <code>&lt;img&gt;</code>  元素</li>
<li><code>document.links</code> ：所有带 <code>href</code>  属性的 <code>&lt;a&gt;</code>  元素</li>
</ul>
<h4 id="125-dom-兼容性检测"><a class="anchor" href="#125-dom兼容性检测">#</a> 1.2.5 DOM 兼容性检测</h4>
<h1 id="二十三-json"><a class="anchor" href="#二十三-json">#</a> 二十三、 JSON</h1>
<p>JSON（JavaScript Object Notation）：JavaScript 对象标准（JSON 的格式借用了 JavaScript 的对象形式）</p>
<p>JSON 是一种<strong>数据格式</strong>，而不是编程语言</p>
<h2 id="1-语法"><a class="anchor" href="#1-语法-2">#</a> 1. 语法</h2>
<ul>
<li>
<p>JSON 借用了 JavaScript 的对象格式，以<strong>字符串</strong>为<strong>键</strong></p>
</li>
<li>
<p>JSON 支持 3 种类型的<strong>值</strong></p>
<ul>
<li><strong>简单值</strong>：如字符串、数值、布尔值和 null（undefined 不可）</li>
<li><strong>对象</strong></li>
<li><strong>数组</strong></li>
</ul>
</li>
</ul>
<h3 id="11-简单值"><a class="anchor" href="#11-简单值">#</a> 1.1 简单值</h3>
<p>无需多言</p>
<h3 id="12-对象"><a class="anchor" href="#12-对象">#</a> 1.2 对象</h3>
<p>和 JavaScript 有细微不同。</p>
<ul>
<li>
<p>JavaScript：键可以不用 <code>&quot;&quot;</code>  包裹</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">let</span> person<span class="token operator">=</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    name<span class="token operator">:</span> <span class="token string">'Jake'</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    age<span class="token operator">:</span> <span class="token number">16</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure></li>
<li>
<p>JSON：键必须用 <code>&quot;&quot;</code>  包裹</p>
<pre class=" language-language-json"><code class="language-language-json">&#123;
    "name": "Jake",
    "age": 16
&#125;
</code></pre>
</li>
</ul>
<h3 id="13-数组"><a class="anchor" href="#13-数组">#</a> 1.3 数组</h3>
<p>无需多言</p>
<h2 id="2-解析与序列化"><a class="anchor" href="#2-解析与序列化">#</a> 2. 解析与序列化</h2>
<p>JSON 可以直接被解析为可用的 JavaScript 对象，然后调用 <code>Object</code>  的语法</p>
<h3 id="21-json-对象"><a class="anchor" href="#21-json对象">#</a> 2.1 JSON 对象</h3>
<p>JSON 全局对象有两个方法： <code>stringify()</code>  和 <code>parse()</code></p>
<ul>
<li>
<p><code>JSON.stringify(obj)</code> ：将 JavaScript 对象转为 JSON<strong> 字符串</strong></p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">let</span> a<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token keyword">undefined</span><span class="token punctuation">,</span><span class="token number">9</span><span class="token punctuation">]</span><span class="token punctuation">]</span></pre></td></tr><tr><td data-num="2"></td><td><pre>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//"[[1,2,3],[4,5,6],[7,null,9]]</span></pre></td></tr></table></figure><ul>
<li>在 <code>Array</code>  中， <code>undefined</code>  会被转为 <code>null</code></li>
</ul>
<p>如果是 <code>object</code>  对象</p>
<ul>
<li>所有函数、原型都会被<strong>省略</strong></li>
<li>值为 <code>undefined</code>  的属性会被<strong>跳过</strong></li>
</ul>
</li>
<li>
<p><code>JSON.parse(str)</code> ：将 JSON<strong> 字符串</strong>转为 JavaScript 对象</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">let</span> b<span class="token operator">=</span><span class="token string">"[[1,2,3],[4,5,6],[7,8,9]]"</span></pre></td></tr><tr><td data-num="2"></td><td><pre>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//[ [ 1, 2, 3 ], [ 4, 5, 6 ], [ 7, 8, 9 ] ]</span></pre></td></tr><tr><td data-num="3"></td><td><pre>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span> <span class="token keyword">instanceof</span> <span class="token class-name">Array</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//true</span></pre></td></tr></table></figure></li>
</ul>
<h3 id="22-jsonstringify-补充"><a class="anchor" href="#22-jsonstringify补充">#</a> 2.2  <code>JSON.stringify</code>  补充</h3>
<p>其实 <code>JSON.stringify()</code>  还可以接受 2 个参数</p>
<ul>
<li>
<p>参数 2：过滤器</p>
<ul>
<li>
<p>如果是<strong>数组</strong>，如</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">let</span> book<span class="token operator">=</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    title<span class="token operator">:</span> <span class="token string">"宁理大神1996漂流记"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    authors<span class="token operator">:</span><span class="token punctuation">[</span></pre></td></tr><tr><td data-num="4"></td><td><pre>        <span class="token string">"宁理大神1996"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="5"></td><td><pre>        <span class="token string">"nitgod1996"</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token punctuation">]</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    edition<span class="token operator">:</span> <span class="token number">4</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    year<span class="token operator">:</span> <span class="token number">2017</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token keyword">let</span> jsonText<span class="token operator">=</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>book<span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token string">"title"</span><span class="token punctuation">,</span><span class="token string">"year"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//&#123;"title":"宁理大神 1996 漂流记","year":2017&#125;</span></pre></td></tr></table></figure></li>
<li>
<p>如果是<strong>函数</strong>，如</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">let</span> jsonText1<span class="token operator">=</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>book<span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">key<span class="token punctuation">,</span>value</span><span class="token punctuation">)</span><span class="token operator">=></span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token keyword">switch</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>            <span class="token keyword">case</span> <span class="token string">"authors"</span><span class="token operator">:</span></pre></td></tr><tr><td data-num="4"></td><td><pre>                <span class="token keyword">return</span> value<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">','</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>            <span class="token keyword">case</span> <span class="token string">"year"</span><span class="token operator">:</span></pre></td></tr><tr><td data-num="6"></td><td><pre>                <span class="token keyword">return</span> <span class="token number">5000</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>            <span class="token keyword">case</span> <span class="token string">"edition"</span><span class="token operator">:</span></pre></td></tr><tr><td data-num="8"></td><td><pre>                <span class="token keyword">return</span> <span class="token keyword">undefined</span><span class="token punctuation">;</span><span class="token comment">// 值设为 undefined 会跳过属性</span></pre></td></tr><tr><td data-num="9"></td><td><pre>            <span class="token keyword">default</span><span class="token operator">:</span></pre></td></tr><tr><td data-num="10"></td><td><pre>                <span class="token keyword">return</span> value<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//&#123;"title":"宁理大神 1996 漂流记","authors":"宁理大神 1996,nitgod1996","year":5000&#125;</span></pre></td></tr></table></figure></li>
</ul>
</li>
<li>
<p>参数 3：字符串缩进。</p>
<ul>
<li>
<p>如果是<strong>数值</strong>，则是每级的缩进的<strong>空格数</strong></p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">let</span> jsonText<span class="token operator">=</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>book<span class="token punctuation">,</span><span class="token keyword">null</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//&#123;"title":"宁理大神 1996 漂流记","year":2017&#125;</span></pre></td></tr></table></figure><p>控制台输出：<img data-src="/2022/01/14/note/%E5%89%8D%E7%AB%AF/js%E9%AB%98%E7%BA%A7%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1/image-20220427202739405.png" alt="image-20220427202739405"></p>
</li>
<li>
<p>如果是<strong>字符串</strong>。字符串缩进 <code>JSON.parse</code>  不可还原，会报错</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">let</span> jsonText<span class="token operator">=</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>book<span class="token punctuation">,</span><span class="token keyword">null</span><span class="token punctuation">,</span><span class="token string">'--'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//&#123;"title":"宁理大神 1996 漂流记","year":2017&#125;</span></pre></td></tr></table></figure><p><img data-src="/2022/01/14/note/%E5%89%8D%E7%AB%AF/js%E9%AB%98%E7%BA%A7%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1/image-20220427202854005.png" alt="image-20220427202854005"> 每级 + 1</p>
</li>
</ul>
</li>
</ul>
<h3 id="23-tojson"><a class="anchor" href="#23-tojson">#</a> 2.3  <code>toJSON()</code></h3>
<p>每个 JavaScript 对象都有一个 <code>toJSON()</code>  函数，类似 <code>toString()</code> ，在调用 <code>JSON.stringify()</code>  时返回的就是对象的 <code>toJSON()</code>  的返回值。</p>
<p>重写 <code>toJSON</code>  可以<strong>自定义</strong> <code>JSON.stringify()</code> （通过第二个参数也可以），如下</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">let</span> book<span class="token operator">=</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    title<span class="token operator">:</span> <span class="token string">"宁理大神1996漂流记"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    authors<span class="token operator">:</span><span class="token punctuation">[</span></pre></td></tr><tr><td data-num="4"></td><td><pre>        <span class="token string">"宁理大神1996"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="5"></td><td><pre>        <span class="token string">"nitgod1996"</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token punctuation">]</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    edition<span class="token operator">:</span> <span class="token number">4</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    year<span class="token operator">:</span> <span class="token number">2017</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token function-variable function">toJSON</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>title<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>        <span class="token comment">// 或者 return &#123;"title": this.title&#125;;</span></pre></td></tr><tr><td data-num="12"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><ul>
<li><code>toJSON()</code>  也可以和<strong>第 2 个参数</strong>、<strong>第三个参数</strong>混用（基于 <code>toJSON()</code>  的返回）</li>
</ul>
<h3 id="24-jsonparse-补充"><a class="anchor" href="#24-jsonparse补充">#</a> 2.4  <code>JSON.parse</code>  补充</h3>
<p><code>JSON.parse()</code>  也可以接收一个额外的参数，类似 <code>JSON.stringify</code>  的第二个参数的函数形式，为了区分，我们把 <code>stringify</code>  的称为<strong>替代函数</strong>， <code>parse</code>  的称为<strong>还原函数</strong>。</p>
<p>例</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">let</span> book<span class="token operator">=</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    title<span class="token operator">:</span> <span class="token string">"宁理大神1996漂流记"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    authors<span class="token operator">:</span><span class="token punctuation">[</span></pre></td></tr><tr><td data-num="4"></td><td><pre>        <span class="token string">"宁理大神1996"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="5"></td><td><pre>        <span class="token string">"nitgod1996"</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token punctuation">]</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    edition<span class="token operator">:</span> <span class="token number">4</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    year<span class="token operator">:</span> <span class="token number">2017</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token keyword">let</span> jsonText<span class="token operator">=</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>book<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token comment">// 下面还原</span></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token keyword">let</span> bookCopy<span class="token operator">=</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>jsonText<span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">key<span class="token punctuation">,</span>value</span><span class="token punctuation">)</span><span class="token operator">=></span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="13"></td><td><pre>    <span class="token keyword">if</span><span class="token punctuation">(</span>key<span class="token operator">===</span><span class="token string">"year"</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="14"></td><td><pre>        <span class="token keyword">return</span> <span class="token number">2022</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="15"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="16"></td><td><pre>    <span class="token keyword">return</span> value<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="18"></td><td><pre></pre></td></tr><tr><td data-num="19"></td><td><pre>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>bookCopy<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p>控制台：<img data-src="/2022/01/14/note/%E5%89%8D%E7%AB%AF/js%E9%AB%98%E7%BA%A7%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1/image-20220427204612459.png" alt="image-20220427204612459"></p>
<p>此外，对于设置了<strong>缩进</strong>的，如果缩进是<strong>空格</strong>，那么 <code>JSON.parse</code>  仍可还原，否则会报错</p>
<h1 id="二十四-网络请求与远程资源"><a class="anchor" href="#二十四-网络请求与远程资源">#</a> 二十四、 网络请求与远程资源</h1>
<blockquote>
<p>本章会全面介绍 XMLHttpRequest，但它实际上是<strong>过时</strong>的产物。</p>
<p>实际开发中，应该尽可能使用 fetch ()</p>
</blockquote>
<p>Ajax：Asynchronous JavaScript and XML，即异步 JavaScript 加 XML，或者说异步网络请求</p>
<p>最早由 XMLHttpRequest 对象（简称 XHR）实现，不过因为太复杂，现已过时</p>
<h2 id="1-xmlhttprequest-对象"><a class="anchor" href="#1-xmlhttprequest对象">#</a> 1. XMLHttpRequest 对象</h2>
<h3 id="11-xhr-使用步骤"><a class="anchor" href="#11-xhr使用步骤">#</a> 1.1 XHR 使用步骤</h3>
<ol>
<li>
<p>创建一个 XHR 对象</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">let</span> xhr<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">XMLHttpRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure></li>
<li>
<p>使用 <code>.open()</code>  定义请求参数</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre>xhr<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">"get"</span><span class="token punctuation">,</span><span class="token string">"beijing.json"</span><span class="token punctuation">,</span><span class="token string">"false"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><ul>
<li>参数 1：请求类型。get/post</li>
<li>参数 2：请求 url。
<ul>
<li><strong>只能访问同源 url。也就是域名相同、端口相同、协议相同</strong>，即发出请求的地址和响应地址属于同一个根目录。简单点说就是只能访问<strong>本地数据</strong></li>
<li>url 需要用 <code>URI</code>  编码，使用 <code>encodeURI()</code>  函数。（只有字母和数字则可以不用）</li>
</ul>
</li>
<li>参数 3：是否异步请求。同步请求会等待服务器响应后才继续执行 JavaScript 代码</li>
</ul>
</li>
<li>
<p>使用 <code>.send()</code>  发送请求</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre>xhr<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><ul>
<li>参数：必填。请求体发送的数据。如果没有则传 <code>null</code></li>
</ul>
</li>
<li>
<p>返回的所有信息都在 <code>xhr</code>  中</p>
</li>
</ol>
<h3 id="12-xhr-的属性与方法"><a class="anchor" href="#12-xhr的属性与方法">#</a> 1.2 XHR 的属性与方法</h3>
<p>上面说过，服务器返回的信息全都保存在 <code>xhr</code>  内，其实也就是保存在了 <code>xhr</code>  的各个属性上</p>
<ul>
<li>
<p><code>response</code> ：响应体返回的内容</p>
</li>
<li>
<p><code>responseText</code> ：返回的文本格式内容</p>
</li>
<li>
<p><code>responseXML</code> ：返回的 XML 格式内容</p>
</li>
<li>
<p>★ <code>status</code> ：HTTP 响应状态码</p>
<ul>
<li>1xx：指示信息–表示请求已接收，继续处理</li>
<li>2xx：成功–表示请求已被成功接收、理解、接受</li>
<li>3xx：<span class="exturl" data-url="aHR0cHM6Ly9zby5jc2RuLm5ldC9zby9zZWFyY2g/cT0lRTklODclOEQlRTUlQUUlOUElRTUlOTAlOTEmYW1wO3NwbT0xMDAxLjIxMDEuMzAwMS43MDIw">重定向</span>–信息不完整需要进一步补充
<ul>
<li>304：表示资源未修改，直接从浏览器缓存中拿取。（也表示响应有效）</li>
</ul>
</li>
<li>4xx：<strong>客户端错误</strong>–请求有语法错误或请求无法实现</li>
<li>5xx：<strong>服务器端错误</strong>–服务器未能实现合法的请求</li>
</ul>
<p>主要记这些就行了</p>
</li>
<li>
<p><code>statusText</code> ：HTTP 响应状态描述。在跨浏览器的情况下不可靠</p>
</li>
<li>
<p><code>readyState</code> ：当前 <code>xhr</code>  对象处于什么阶段</p>
<ul>
<li>0：未初始化。尚未调用 <code>open()</code>  方法</li>
<li>1：已打开。已调用 <code>open()</code>  但未调用 <code>send()</code>  方法</li>
<li>2：已发送。已调用 <code>send()</code> ，但未收到响应</li>
<li>3：接受中。已收到部分响应</li>
<li>4：完成。收到所有响应</li>
</ul>
</li>
<li>
<p><code>onreadystatechange</code> ：每当 <code>readyState</code>  变化状态，都会触发一次 <code>readystatechange</code>  事件。我们可以通过定义 <code>xhr.onreadystatechange</code>  设置每个阶段应该发生什么的函数，如下</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre>xhr<span class="token punctuation">.</span><span class="token function-variable function">onreadystatechange</span><span class="token operator">=</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token keyword">if</span><span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>readyState<span class="token operator">===</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>        </pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure></li>
<li>
<p><code>open(method,url,async,username,password)</code> ：打开请求（定义请求）。</p>
<ul>
<li><code>method</code> ：HTTP 请求方法，POST、GET 和 HEAD，大小写不敏感。</li>
<li><code>url</code> ：请求的  <code>URL</code>  字符串，仅支持<strong>同源</strong>请求。</li>
<li><code>async</code> ：是否为异步方式，默认为  <code>true</code> 。如果为 false，当状态改变时会立即调用 onreadystatechange 属性指定的回调函数。</li>
<li><code>username</code> ：（可选）如果服务器需要验证，该参数指定用户名，如果未指定，当服务器需要验证时，会弹出验证窗口。</li>
<li><code>password</code> ：（可选）验证信息中的密码部分，如果用户名为空，则该值将被忽略。</li>
</ul>
</li>
<li>
<p><code>send()</code> ：发送请求</p>
</li>
<li>
<p><code>abort()</code> ：终止异步请求</p>
</li>
</ul>
<h3 id="13-http-协议格式"><a class="anchor" href="#13-http协议格式">#</a> 1.3 HTTP 协议格式</h3>
<h4 id="131-http-协议请求格式"><a class="anchor" href="#131-http协议请求格式">#</a> 1.3.1 HTTP 协议请求格式</h4>
<ul>
<li>
<p><strong>请求行</strong>：请求方式 + 请求 url + 请求协议 / 版本。（<em>也可以算是请求头里</em>）</p>
<ul>
<li>请求方式：
<ul>
<li>GET：请求参数在请求行中，url 有长度限制</li>
<li>POST：请求参数在请求体中，url 无长度限制</li>
<li>GET /nit/hello HTTP/1.1</li>
</ul>
</li>
</ul>
</li>
<li>
<p><strong>请求头</strong>：</p>
<ul>
<li><code>Accept</code> ：浏览器可以（想）解析的格式</li>
<li><code>Accept-Encoding</code> ：浏览器可接受压缩编码类型。</li>
<li><code>Accept-Language</code> ：浏览器可接受的语言</li>
<li><code>Connection</code> ：与服务器的连接类型
<ul>
<li><code>keep-alive</code> -- 连接一直保持（不会一次传输结束就释放连接）</li>
</ul>
</li>
<li><code>Cookie</code> ：页面中设置的 Cookie</li>
<li><code>Host</code> ：发送请求的页面所在<strong>域</strong>（主机）</li>
<li><code>Referer</code> ：发送请求页面的<strong> URI</strong>。告诉服务器我从哪里来 (来源是超链接所在的 html 页面)<br>
 作用：1. 防盗链 2. 统计作用</li>
<li><code>User-Agent</code> ：用户代理（浏览器客户端）版本信息，服务器可根据不同浏览器信息...</li>
</ul>
<p>例：<em>把请求行算在请求头</em></p>
<pre class=" language-language-http"><code class="language-language-http">GET url此处太长略 HTTP/1.1
Host: static.firefoxchina.cn
User-Agent: Mozilla/5.0 (Windows NT 6.1; Win64; x64; rv:79.0) Gecko/20100101 Firefox/79.0
Accept: image/webp,*/*
Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2
Accept-Encoding: gzip, deflate, br
Connection: keep-alive
Referer: https://home.firefoxchina.cn/
Cookie:Hm_lvt_dd4738b5fb302cb062ef19107df5d2e4=1598241941;Hm_lpvt_dd4738b5fb302cb062ef19107df5d2e4=1598241941
</code></pre>
</li>
<li>
<p><strong>请求空行</strong>：空行，用于区分请求头和请求体</p>
</li>
<li>
<p><strong>请求体</strong>：</p>
</li>
</ul>
<hr>
<p>可以通过以下函数设置<strong>请求头</strong>数据：</p>
<ul>
<li><code>xhr.setRequestHeader(key,value)</code> ：设置请求头</li>
</ul>
<h4 id="132-http-协议响应格式"><a class="anchor" href="#132-http协议响应格式">#</a> 1.3.2 HTTP 协议响应格式</h4>
<ul>
<li><strong>响应行</strong>：协议 / 版本 + 响应状态码 + 状态码描述
<ul>
<li><strong>响应状态码</strong>：
<ul>
<li>100+：服务器接收消息未完成，等待一段时间后发送 1xx</li>
<li>200+：200 - 成功</li>
<li>300+：
<ul>
<li>302 - 重定向（迭代查找服→A→服务器→C）</li>
<li>304 - 访问缓存</li>
</ul>
</li>
<li>400+：请求错误
<ul>
<li>404 - 访问路径没有对应资源</li>
<li>405 - 请求方式（服务器端）没有对应 doXxx 方法</li>
</ul>
</li>
<li>500+：服务器端错误
<ul>
<li>500 - 服务器内部异常（如 1/0 异常）</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>​	如 <code>HTTP/1.1 200 OK</code></p>
<ul>
<li>
<p><strong>响应头</strong>：</p>
<ul>
<li><code>Content-Type</code> ：服务器告诉客户端本次响应体数据格式以及编码格式（解决乱码问题）</li>
<li><code>Content-disposition</code> ：服务器告诉客户端以什么形式打开响应体数据
<ul>
<li><code>in-line</code> ：在当前页面打开（默认）</li>
<li><code>attachment;filename=xxx;</code>  以附件形式打开响应体。文件下载</li>
</ul>
</li>
</ul>
<p>例：</p>
<pre class=" language-language-http"><code class="language-language-http">HTTP/1.1 200 OK
Date: Mon, 24 Aug 2020 04:05:50 GMT
Content-Type: image/jpeg
Content-Length: 30012
Connection: keep-alive
Server: AliyunOSS
x-oss-request-id: 5F432919D6D43930376801E5
Accept-Ranges: bytes
ETag: "E7D17141FED40D822B443DA50DCBFB52"
Last-Modified: Mon, 24 Aug 2020 02:42:00 GMT
x-oss-object-type: Normal
x-oss-hash-crc64ecma: 14682076664506887655
x-oss-storage-class: Standard
Content-MD5: 59FxQf7UDYIrRD2lDcv7Ug==
x-oss-server-time: 1
x-cc-via: 34_dx-jiangsu-huaian-4-cache-1[H,3]
</code></pre>
</li>
<li>
<p><strong>响应空行</strong>：</p>
</li>
<li>
<p><strong>响应体</strong>：服务器显示的 html 文档</p>
</li>
</ul>
<hr>
<p>可以通过以下函数获取<strong>响应头</strong>数据：</p>
<ul>
<li><code>xhr.getRequestHeader(key)</code> ：获取指定的响应头数据</li>
<li><code>xhr.getAllRequestHeader()</code> ：获取全部响应头数据</li>
</ul>
<h3 id="14-getpost-请求方法"><a class="anchor" href="#14-getpost请求方法">#</a> 1.4 GET/POST 请求方法</h3>
<ul>
<li>GET 请求：在 <code>xhr.open()</code>  中将第一个参数设为 <code>get</code>
<ul>
<li><code>url</code>  中的所有键 / 值都应该用 <code>encodeURIComponent()</code>  编码。（ <code>encodeURIComponent</code>  会编译 <code>httpURI</code>  的预留符号， <code>encodeURI</code>  不会）</li>
<li><code>url</code>  中的所有键值对必须以 <code>&amp;</code>  分隔</li>
<li>键值对最前面应该用 <code>?</code>  和路径分隔</li>
</ul>
</li>
<li>POST 请求：在 <code>xhr.open()</code>  中将第一个参数设为 <code>post</code>
<ul>
<li>区别于 <code>get</code>  把提交数据直接放在 <code>url</code>  中， <code>post</code>  将提交数据通过 <code>send()</code>  发送。</li>
</ul>
</li>
</ul>
<h3 id="15-xhr-level-2这些就不记了"><a class="anchor" href="#15-xhr-level-2这些就不记了">#</a> 1.5 XHR level 2（这些就不记了）</h3>
<h2 id="2-进度事件"><a class="anchor" href="#2-进度事件">#</a> 2. 进度事件</h2>
<p><code>xhr</code>  在不同的进度会触发不同的函数（类似 vue 的生命周期），主要有如下 6 个进度事件</p>
<ul>
<li><code>loadstart</code> ：在接收到响应的第一个字节时触发</li>
<li><code>progress</code> ：在接收响应期间<strong>反复</strong>触发</li>
<li><code>error</code> ：在请求出错时触发</li>
<li><code>abort</code> ：在调用 <code>abort()</code>  让请求终止时触发</li>
<li><code>load</code> ：在成功接收完响应时触发</li>
<li><code>loadend</code> ：在通信完成时，且在前三者之后，触发</li>
</ul>
<p>一般通过 <code>on+事件名</code> 的属性设置事件函数。函数接收一个 <code>event</code>  参数，其 <code>target</code>  属性是 <code>xhr</code>  的实例，可以获取 <code>xhr</code>  的所有属性和方法。但不是所有浏览器都支持这个 <code>event</code>  对象</p>
<h3 id="21-load-事件"><a class="anchor" href="#21-load事件">#</a> 2.1 load 事件</h3>
<blockquote>
<p>load 事件在响应接收完成后触发，这样就不用检查 readyState 属性了</p>
</blockquote>
<p>通过 <code>xhr.onload</code>  属性设置该事件，如下</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre>xhr<span class="token punctuation">.</span><span class="token function-variable function">onload</span><span class="token operator">=</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>status<span class="token operator">>=</span><span class="token number">200</span> <span class="token operator">&amp;&amp;</span> xhr<span class="token punctuation">.</span>status<span class="token operator">&lt;</span><span class="token number">300</span><span class="token punctuation">)</span><span class="token operator">||</span>xhr<span class="token punctuation">.</span>status<span class="token operator">===</span><span class="token number">304</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>        <span class="token comment">//...</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>只要从服务器收到响应，<strong>无论状态码是什么</strong>，都会触发 <code>load</code>  事件。所以说还得检查 <code>status</code>  属性才能确定<strong>数据是否有效</strong></p>
<h3 id="22-progress-事件"><a class="anchor" href="#22-progress事件">#</a> 2.2 progress 事件</h3>
<blockquote>
<p>在浏览器接收数据期间，这个时间会反复触发。每次触发时， <code>onprogress</code>  时间处理程序</p>
</blockquote>
<p><code>onprogress</code>  的 <code>event</code>  除了 <code>target</code>  属性，还有 3 个额外属性：</p>
<ul>
<li><code>lengthComputable</code> ：boolean，进度信息是否可用</li>
<li><code>position</code> ：目前接收到的字节数</li>
<li><code>totalSize</code> ：响应 <code>Content-Length</code>  头定义的总字节数</li>
</ul>
<p>&lt;font color=red&gt; 利用这些信息给用户提供<strong>进度条</strong> &lt;/font&gt;</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre>xhr<span class="token punctuation">.</span><span class="token function-variable function">onprogress</span><span class="token operator">=</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token keyword">let</span> progressBar<span class="token operator">=</span>document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">"status"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token keyword">if</span><span class="token punctuation">(</span>event<span class="token punctuation">.</span>lengthComputable<span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>        progressBar<span class="token operator">=</span><span class="token string">"已接收："</span><span class="token operator">+</span>event<span class="token punctuation">.</span>position<span class="token operator">+</span><span class="token string">"总共有："</span><span class="token operator">+</span>event<span class="token punctuation">.</span>totalSize<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h2 id="3-跨域资源共享"><a class="anchor" href="#3-跨域资源共享">#</a> 3. 跨域资源共享</h2>
<p>可参考：<span class="exturl" data-url="aHR0cHM6Ly9zZWdtZW50ZmF1bHQuY29tL2EvMTE5MDAwMDAxMTE0NTM2NA==">https://segmentfault.com/a/1190000011145364</span></p>
<p><strong>什么是跨域？</strong></p>
<p>浏览器从一个域名的网页去请求另一个域名的资源时，域名、端口、协议任一不同，都是跨域。</p>
<p><strong>为什么会有跨域？</strong></p>
<p>在前后端分离的模式下，前后端的域名是不一致的，此时就会发生跨域访问问题。此外，有时候也需要获取别的在线资源</p>
<p><strong>为什么 ajax 不能跨域？</strong></p>
<p>因为浏览器的<strong>同源策略（SOP）</strong>。他是浏览器最核心也最基本的安全功能，如果缺少了同源策略，浏览器很容易受到 XSS、CSFR 等攻击。所谓同源是指 &quot;协议 + 域名 + 端口&quot; 三者相同，即便两个不同的域名指向同一个 ip 地址，也非同源。</p>
<h3 id="31-cors-实现跨域"><a class="anchor" href="#31-cors实现跨域">#</a> 3.1 CORS 实现跨域</h3>
<p>跨域资源共享（CORS，Cross-Origin Resource Sharing）定义了浏览器与服务器如何实现跨域通信。其基本思路是：<em>使用自定义的 HTTP 头部允许浏览器和服务器相互了解</em>。</p>
<ul>
<li>对于简单请求，如 GET/POST，在跨域请求发送时会有一个额外的头部叫 <code>Origin</code> ，其包含发送请求的页面的源（协议 + 域名 + 端口），如 <code>Origin: http://127.0.0.1:5501</code> 。而在服务器端如果允许跨域请求，则会有一个 <code>Access-Control-Allow-Origin</code> ，包含允许响应的源。如果与请求源一致，则正常响应请求。<strong>也就是说，这种方法需要在后端设置 <code>Access-Control-Allow-Origin</code> ，且不能访问别人的在线资源</strong></li>
<li>非简单请求暂时就不说了</li>
</ul>
<p>为了区分，通常<strong>同源请求</strong> <code>url</code>  用<strong>相对 URL</strong>，<strong>跨域请求</strong>用<strong>绝对 URL</strong></p>
<p>此外，跨域请求有以下限制：</p>
<ul>
<li>不能使用 <code>setRequestHeader()</code>  设置自定义头部</li>
<li>不能发送和接受<strong> cookie</strong></li>
<li><code>getAllResponseHeaders()</code>  始终返回空字符串</li>
</ul>
<h3 id="32-jsonp-实现跨域"><a class="anchor" href="#32-jsonp实现跨域">#</a> 3.2 JSONP 实现跨域</h3>
<blockquote>
<p>跨域原理： 通常为了减轻 web 服务器的负载，我们把 js、css，img 等静态资源分离到另一台独立域名的服务器上，在 html 页面中再通过相应的标签从不同域名下加载静态资源，而被浏览器允许，基于此原理，我们可以通过动态创建 script，再请求一个带参网址实现跨域通信。</p>
</blockquote>
<h4 id="原生-javascript-实现-jsonp"><a class="anchor" href="#原生javascript实现jsonp">#</a> 原生 JavaScript 实现 jsonp</h4>
<p>他的原理是通过 <code>&lt;script&gt;</code>  的 <code>src</code>  属性获取在线资源，</p>
<p>实现如下：</p>
<figure class="highlight html"><figcaption data-lang="HTML"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript"></span></span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token keyword">let</span> script<span class="token operator">=</span>document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">"script"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    script<span class="token punctuation">.</span>src<span class="token operator">=</span><span class="token string">"https://restapi.amap.com/v3/direction/walking?origin=120.050000,30.232000&amp;destination=120.039000,30.227500&amp;extensions=all&amp;output=json&amp;key=873b8484a133897729b7cf7f388a4acc&amp;callback=handleResponse"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">insertBefore</span><span class="token punctuation">(</span>script<span class="token punctuation">,</span>document<span class="token punctuation">.</span>body<span class="token punctuation">.</span>firstChild<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token keyword">function</span> <span class="token function">handleResponse</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="9"></td><td><pre></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token comment">&lt;!-- 或者直接 --></span></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript"></span></span></pre></td></tr><tr><td data-num="12"></td><td><pre>    <span class="token keyword">function</span> <span class="token function">handleResponse</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="13"></td><td><pre>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="14"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="16"></td><td><pre></pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://restapi.amap.com/v3/direction/walking?origin=120.050000,30.232000&amp;destination=120.039000,30.227500&amp;extensions=all&amp;output=json&amp;key=873b8484a133897729b7cf7f388a4acc&amp;callback=handleResponse<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span></pre></td></tr></table></figure><p><code>callback</code>  回调函数是页面响应之后调用的函数，<strong>参数就是响应的数据</strong></p>
<p><img data-src="/2022/01/14/note/%E5%89%8D%E7%AB%AF/js%E9%AB%98%E7%BA%A7%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1/image-20220425213343895.png" alt="image-20220425213343895"></p>
<hr>
<p>实际上，所有拥有 <code>src</code>  属性的标签（如 <code>&lt;script&gt;</code> 、 <code>&lt;img&gt;</code> 、 <code>&lt;iframe&gt;</code> ）都拥有跨域功能。</p>
<p>如<strong>图片探测</strong></p>
<figure class="highlight html"><figcaption data-lang="HTML"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript"></span></span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token keyword">var</span> img <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'img'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    img<span class="token punctuation">.</span>type <span class="token operator">=</span> <span class="token string">'img/png'</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token comment">// 传参并指定回调执行函数为 onBack</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    img<span class="token punctuation">.</span>src <span class="token operator">=</span> <span class="token string">"https://www.baidu.com/img/PCtm_d9c8750bed0b3c7d089fa7d55720d6cf.png?callback=onBack"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>img<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre></pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token comment">// 回调执行函数</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    <span class="token keyword">function</span> <span class="token function">onBack</span><span class="token punctuation">(</span><span class="token parameter">response</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">1223</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="12"></td><td><pre>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>response<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="13"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span></pre></td></tr></table></figure><p>页面显示如下：<img data-src="/2022/01/14/note/%E5%89%8D%E7%AB%AF/js%E9%AB%98%E7%BA%A7%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1/image-20220425204621488.png" alt="image-20220425204621488"></p>
<p><strong>但是图片探测没有 callback 功能</strong></p>
<h4 id="使用-jquery-的-jsonp"><a class="anchor" href="#使用jquery的jsonp">#</a> 使用 jQuery 的 jsonp</h4>
<h4 id="总结"><a class="anchor" href="#总结">#</a> 总结</h4>
<p>不过<strong> JSONP</strong> 有诸多缺点：</p>
<ul>
<li>容易受到攻击。</li>
<li>不好确定请求是否失败</li>
</ul>
<p>此外，对于<strong> JSONP</strong> 的跨域请求，有可能被 CORB 所阻止，如下</p>
<p><img data-src="/2022/01/14/note/%E5%89%8D%E7%AB%AF/js%E9%AB%98%E7%BA%A7%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1/image-20220421200915934.png" alt="image-20220421200915934"></p>
<blockquote>
<p><strong>CORB</strong> 是一个新的 web 平台安全功能，阻止某些不安全的跨域响应。</p>
<p>例如：它将清除一个从 &lt;script&gt; 或者 &lt;img&gt; 标签发起的跨源 text/html 响应。将响应的内容，用空值代替。这是网站隔离 (Site Isolation) 非常重要的一部分.</p>
<p>因为在<strong>同源策略</strong>浏览器下通常会阻止一个网站读取其它源的任意网络资源。但是，在实际情况中，实施同源策略并非只是简单阻止所有的跨域资源.</p>
<p>浏览器对于有些情况是允许加载跨域资源的，例如 &lt;img&gt; , &lt;script&gt; 标签，它们可以加载跨域的资源。允许加载跨域资源，意味着存在着安全隐患.</p>
<p><strong>CORB</strong> 可以减少<strong> XSSI</strong> 攻击（它通过 <code>&lt;script&gt;</code>  指向一个不是 JavaScript 代码文件的目标资源，并且让浏览器执行.）</p>
</blockquote>
<h2 id="4-fetch-api更先进的-ajax"><a class="anchor" href="#4-fetch-api更先进的ajax">#</a> 4. Fetch API（更先进的 ajax）</h2>
<blockquote>
<p>Fetch API 能够执行 XMLHttpRequest 对象的所有任务，但更容易使用，接口也更现代化，能够在 Web 工作线程等现代 Web 工具中使用</p>
<p>XHR 可以选择异步，而 Fetch<strong> 必须是异步</strong></p>
</blockquote>
<p><img data-src="/2022/01/14/note/%E5%89%8D%E7%AB%AF/js%E9%AB%98%E7%BA%A7%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1/v2-eb392ec883659c506cbe249b8949e73c_720w.jpg" alt="img"></p>
<h3 id="41-基本用法"><a class="anchor" href="#41-基本用法">#</a> 4.1 基本用法</h3>
<ul>
<li>
<p><strong>创建</strong>：返回一个 Promise 期约</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">let</span> r<span class="token operator">=</span><span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">'./北京大学.json'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//Promise &lt;pending></span></pre></td></tr></table></figure></li>
<li>
<p><strong>获取响应</strong>：通过 <code>then()</code>  处理响应</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">'./北京大学.json'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">response</span><span class="token punctuation">)</span><span class="token operator">=></span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span>status<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 状态码</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span>redirected<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    response<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span><span class="token operator">=></span><span class="token punctuation">&#123;</span><span class="token comment">// 获取响应数据</span></pre></td></tr><tr><td data-num="5"></td><td><pre>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p>或者也可以展开</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">'./北京大学.json'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">response</span><span class="token punctuation">)</span><span class="token operator">=></span>response<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span><span class="token operator">=></span><span class="token punctuation">&#123;</span><span class="token comment">// 获取响应数据</span></pre></td></tr><tr><td data-num="4"></td><td><pre>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure></li>
<li>
<p><strong>处理失败</strong>： <code>then()</code>  的第二个参数（处理错误的函数）</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">'./北京大学.json'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">response</span><span class="token punctuation">)</span><span class="token operator">=></span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>response<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span><span class="token operator">=></span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>	<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p>违反 CORS、无网络连接、HTTPS 错配及其他浏览器 / 网络问题都会导致期约被拒绝</p>
</li>
</ul>
<hr>
<p><strong>关于 fetch 函数</strong></p>
<ul>
<li><code>fetch(url,init)</code> ：发送请求
<ul>
<li><code>url</code> ：必选，默认发送 get 请求</li>
<li><code>init</code> ：可选，请求的详细设置，以 <code>&#123;&#125;</code>  的形式
<ul>
<li><code>body</code> ：请求体</li>
<li><code>cache</code> ：缓存</li>
<li><code>method</code> ：请求方式，默认 get</li>
<li>...</li>
</ul>
</li>
<li><code>return</code> ：期约解决完后返回一个 <code>Response</code>  实例，是获取的响应数据。可以用 <code>.then((res)=&gt;&#123;&#125;)</code>  处理</li>
</ul>
</li>
</ul>
<h3 id="42-常见-fetch-请求模式"><a class="anchor" href="#42-常见fetch请求模式">#</a> 4.2 常见 Fetch 请求模式</h3>
<p>和 XHR 一样， <code>fetch()</code>  既可以发送数据，也可以接收数据。可通过 <code>init</code>  属性发送数据</p>
<ul>
<li>
<p><strong>发送 JSON 数据</strong>：放在请求体内</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">let</span> payload<span class="token operator">=</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    foo<span class="token operator">:</span> <span class="token string">'bar'</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">let</span> jsonHeaders<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Headers</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token string">'Content-Type'</span><span class="token operator">:</span> <span class="token string">'application/json'</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">'/send-me-json'</span><span class="token punctuation">,</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    method<span class="token operator">:</span> <span class="token string">'POST'</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="11"></td><td><pre>    body<span class="token operator">:</span> payload<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="12"></td><td><pre>    headers<span class="token operator">:</span> jsonHeaders</pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">)</span></pre></td></tr></table></figure></li>
<li>
<p><strong>发送参数</strong>：请求体内</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">let</span> payload<span class="token operator">=</span><span class="token string">'foo=bar&amp;baz=qux'</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">let</span> paramHeaders<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Headers</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token string">'Content-Type'</span><span class="token operator">:</span> <span class="token string">'application/x-www-form-urlencoded;charset=UTF-8'</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">'/send-me-params'</span><span class="token punctuation">,</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    method<span class="token operator">:</span> <span class="token string">'POST'</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    body<span class="token operator">:</span> payload<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    headers<span class="token operator">:</span> paramHeaders</pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">)</span></pre></td></tr></table></figure></li>
<li>
<p><strong>发送文件</strong>：请求体。通过 <code>FormData</code>  对象实现</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">let</span> imageFormData<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">FormData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">let</span> imageInput<span class="token operator">=</span>document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">"input[type='file']"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre>imageFormData<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">'image'</span><span class="token punctuation">,</span>imageInput<span class="token punctuation">.</span>files<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">'/img-upload'</span><span class="token punctuation">,</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    method<span class="token operator">:</span> <span class="token string">'POST'</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    body<span class="token operator">:</span> imageFormData</pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p>或者也可以多个文件</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">let</span> imageFormData<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">FormData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">let</span> imageInput<span class="token operator">=</span>document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">"input[type='file'][multiple]"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">let</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span>imageInput<span class="token punctuation">.</span>files<span class="token punctuation">.</span>length<span class="token punctuation">;</span><span class="token operator">++</span>i<span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    imageFormData<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">'image'</span><span class="token punctuation">,</span>imageInput<span class="token punctuation">.</span>files<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="7"></td><td><pre></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">'/img-upload'</span><span class="token punctuation">,</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    method<span class="token operator">:</span> <span class="token string">'POST'</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    body<span class="token operator">:</span> imageFormData</pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure></li>
<li>
<p><strong>加载 Blob 文件</strong></p>
</li>
<li>
<p><strong>发送跨源请求</strong>：因为同源策略，不同源的请求，要包含 CORS 头部才能保证浏览器收到响应。但如果<strong>不需要访问响应</strong>，可以发送 <code>no-cors</code> ，此时 <code>type</code>  属性为 <code>opaque</code> ，因此<strong>无法读取响应内容</strong>，一般作为探测请求或将响应缓存起来以后使用。</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">'https://www.baidu.com'</span><span class="token punctuation">,</span><span class="token punctuation">&#123;</span>mode<span class="token operator">:</span> <span class="token string">'no-cors'</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">response</span><span class="token punctuation">)</span><span class="token operator">=></span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span>type<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//opaque</span></pre></td></tr></table></figure><p>&lt;font color=red&gt;<strong> 或者像上面一样使用 jsonp</strong>&lt;/font&gt;</p>
</li>
<li>
<p><strong>中断请求</strong>：当希望停止传输大文件时，可以使用 <code>AbortController</code>  的 <code>abort</code>  方法终止传输</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">let</span> abortController<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">AbortController</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">'wikipedia.zip'</span><span class="token punctuation">,</span><span class="token punctuation">&#123;</span>signal<span class="token operator">:</span> abortController<span class="token punctuation">.</span>signal<span class="token punctuation">&#125;</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=></span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'aborted!'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 中断请求会导致期约拒绝</span></pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token comment">//10 毫秒后中断请求</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=></span>abortController<span class="token punctuation">.</span><span class="token function">abort</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p><img data-src="/2022/01/14/note/%E5%89%8D%E7%AB%AF/js%E9%AB%98%E7%BA%A7%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1/image-20220426110922900.png" alt="image-20220426110922900"></p>
</li>
</ul>
<h3 id="43-headers-对象"><a class="anchor" href="#43-headers对象">#</a> 4.3 Headers 对象</h3>
<p><code>Headers</code>  是每个 <code>Request</code>  实例都包含的对象，可以通过 <code>Request.prototype.headers</code>  访问，和 <code>map</code>  与 <code>Object</code>  均有相似之处。</p>
<p>我们发送 <code>fetch</code>  请求时通常会定义 <code>Headers</code>  属性，如下</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">let</span> jsonHeaders<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Headers</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token string">'Content-Type'</span><span class="token operator">:</span> <span class="token string">'application/json'</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">'/send-me-json'</span><span class="token punctuation">,</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    headers<span class="token operator">:</span> jsonHeaders</pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">)</span></pre></td></tr></table></figure><p>也可以直接以 <code>&#123;&#125;</code>  的形式</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">'/send-me-json'</span><span class="token punctuation">,</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    headers<span class="token operator">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>        <span class="token string">'Content-Type'</span><span class="token operator">:</span> <span class="token string">'application/json'</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">)</span></pre></td></tr></table></figure><hr>
<p>下面讲一下 Headers 对象的具体用法</p>
<ul>
<li>
<p><strong>创建</strong>：</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">let</span> headers<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Headers</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 空参</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">let</span> headers1<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Headers</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token string">'Content-Type'</span><span class="token operator">:</span> <span class="token string">'application/json'</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 以 object 实例初始化</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">let</span> headers2<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Headers</span><span class="token punctuation">(</span><span class="token punctuation">[</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token punctuation">[</span><span class="token string">'Content-Type'</span><span class="token punctuation">,</span><span class="token string">'application/json'</span><span class="token punctuation">]</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token punctuation">[</span><span class="token string">'foo'</span><span class="token punctuation">,</span><span class="token string">'bar'</span><span class="token punctuation">]</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 以二维数组初始化（和 map 一样）</span></pre></td></tr></table></figure></li>
<li>
<p><strong>设置键</strong>（新增 / 更新）</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre>headers<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">'foo'</span><span class="token punctuation">,</span><span class="token string">'bar'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 新增 / 更新</span></pre></td></tr><tr><td data-num="2"></td><td><pre>headers<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">'foo1'</span><span class="token punctuation">,</span><span class="token string">'bar1'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 新增键值对</span></pre></td></tr></table></figure></li>
<li>
<p><strong>检查键</strong></p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre>headers<span class="token punctuation">.</span><span class="token function">has</span><span class="token punctuation">(</span><span class="token string">'foo'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure></li>
<li>
<p><strong>获取值</strong></p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre>headers<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'foo'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure></li>
<li>
<p><strong>删除键值对</strong></p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre>headers<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span><span class="token string">'foo'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure></li>
<li>
<p><strong>返回键 / 值 / 键值对</strong></p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre>headers<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>headers<span class="token punctuation">.</span><span class="token function">values</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>headers<span class="token punctuation">.</span><span class="token function">entries</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure></li>
</ul>
<hr>
<p>但不是所有 HTTP 头部都可以被客户端修改，详细看 P732</p>
<h3 id="44-request-对象"><a class="anchor" href="#44-request对象">#</a> 4.4 Request 对象</h3>
<p>用来获取资源的请求的接口</p>
<p><code>Request</code>  的构造函数和 <code>fetch</code>  函数很类似</p>
<ul>
<li>
<p><code>new Request(url,init)</code> ：发送请求</p>
<ul>
<li><code>url</code> ：必选，默认发送 get 请求</li>
<li><code>init</code> ：可选，请求的详细设置，以 <code>&#123;&#125;</code>  的形式
<ul>
<li><code>body</code> ：请求体</li>
<li><code>cache</code> ：缓存</li>
<li><code>method</code> ：请求方式，默认 get</li>
<li>...</li>
</ul>
</li>
</ul>
</li>
<li>
<p><strong>创建</strong>：默认 get 请求</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">let</span> r<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Request</span><span class="token punctuation">(</span><span class="token string">'https://www.baidu.com'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p><img data-src="/2022/01/14/note/%E5%89%8D%E7%AB%AF/js%E9%AB%98%E7%BA%A7%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1/image-20220426150623168.png" alt="image-20220426150623168"></p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">let</span> r<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Request</span><span class="token punctuation">(</span><span class="token string">'https://www.baidu.com'</span><span class="token punctuation">,</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    method<span class="token operator">:</span> <span class="token string">'post'</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p><img data-src="/2022/01/14/note/%E5%89%8D%E7%AB%AF/js%E9%AB%98%E7%BA%A7%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1/image-20220426151025753.png" alt="image-20220426151025753"></p>
</li>
</ul>
<h4 id="克隆-request-实例"><a class="anchor" href="#克隆request实例">#</a> 克隆 Request 实例</h4>
<ul>
<li>
<p><strong>直接传参新建</strong>：将 Request 实例作为 input 参数传给 Request 构造函数，会得到该请求的一个<strong>副本</strong></p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">let</span> r1<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Request</span><span class="token punctuation">(</span><span class="token string">'https://www.baidu.com'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">let</span> r2<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Request</span><span class="token punctuation">(</span>r1<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p>这种方法有个问题，即如果 <code>r1</code>  有 <code>body</code> （post 才能有 body），复制 <code>r1</code>  时 <code>r2</code>  会把 <code>body</code>  也复制进去，这就导致了 <code>r1</code>  的 <code>bodyUsed</code>  属性从 <code>false</code>  变为了 <code>true</code> ，如下</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">let</span> r<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Request</span><span class="token punctuation">(</span><span class="token string">'https://www.baidu.com'</span><span class="token punctuation">,</span><span class="token punctuation">&#123;</span>method<span class="token operator">:</span><span class="token string">'post'</span><span class="token punctuation">,</span>body<span class="token operator">:</span><span class="token string">'foo'</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">let</span> r2<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Request</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span>bodyUsed<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//true</span></pre></td></tr><tr><td data-num="5"></td><td><pre>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>r2<span class="token punctuation">.</span>bodyUsed<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//fasle</span></pre></td></tr></table></figure><p>此外， <code>bodyUsed=true</code>  后就不能被复制了，会报错</p>
<p><img data-src="/2022/01/14/note/%E5%89%8D%E7%AB%AF/js%E9%AB%98%E7%BA%A7%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1/image-20220426154233653.png" alt="image-20220426154233653"></p>
</li>
<li>
<p><strong>使用 clone () 方法</strong></p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">let</span> r1<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Request</span><span class="token punctuation">(</span><span class="token string">'https://www.baidu.com'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">let</span> r2<span class="token operator">=</span>r1<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p>使用 <code>clone</code>  不会使 <code>bodyUsed</code>  变为 <code>true</code> 。</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">let</span> r<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Request</span><span class="token punctuation">(</span><span class="token string">'https://www.baidu.com'</span><span class="token punctuation">,</span><span class="token punctuation">&#123;</span>method<span class="token operator">:</span><span class="token string">'post'</span><span class="token punctuation">,</span>body<span class="token operator">:</span><span class="token string">'foo'</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">let</span> r2<span class="token operator">=</span>r<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span>bodyUsed<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//false</span></pre></td></tr><tr><td data-num="5"></td><td><pre>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>r2<span class="token punctuation">.</span>bodyUsed<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//false</span></pre></td></tr></table></figure><p>和上面一样， <code>bodyUsed=true</code>  后就不能被复制了，会报错</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">let</span> r<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Request</span><span class="token punctuation">(</span><span class="token string">'https://www.baidu.com'</span><span class="token punctuation">,</span><span class="token punctuation">&#123;</span>method<span class="token operator">:</span><span class="token string">'post'</span><span class="token punctuation">,</span>body<span class="token operator">:</span><span class="token string">'foo'</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>r<span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token operator">=></span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment">// 把 bodyUsed 变为 true</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">let</span> r2<span class="token operator">=</span>r<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 报错</span></pre></td></tr></table></figure></li>
</ul>
<h4 id="在-fetch-中使用-request"><a class="anchor" href="#在fetch中使用request">#</a> 在 fetch 中使用 Request</h4>
<p><code>fetch()</code>  和 <code>Request</code>  构造函数拥有相同的结构不是巧合，在调用 <code>fetch()</code>  时可以传入已经创建好的 <code>Request</code>  实例</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">let</span> r<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Request</span><span class="token punctuation">(</span><span class="token string">'./北京大学.json'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token function">fetch</span><span class="token punctuation">(</span>r<span class="token punctuation">,</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    headers<span class="token operator">:</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>        <span class="token string">'Content-Type'</span><span class="token operator">:</span><span class="token string">'application/json'</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token comment">// 或者直接在 request 中设置 init</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token keyword">let</span> r2<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Request</span><span class="token punctuation">(</span><span class="token string">'./北京大学.json'</span><span class="token punctuation">,</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    headers<span class="token operator">:</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>        <span class="token string">'Content-Type'</span><span class="token operator">:</span><span class="token string">'application/json'</span></pre></td></tr><tr><td data-num="11"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token function">fetch</span><span class="token punctuation">(</span>r2<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p>和<strong>克隆</strong>一样， <code>fetch</code>  不能拿<strong>已经用过</strong>的 <code>Request</code>  实例来发送请求</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">let</span> r<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Request</span><span class="token punctuation">(</span><span class="token string">'https://www.baidu.com'</span>，<span class="token punctuation">&#123;</span>method<span class="token operator">:</span><span class="token string">'post'</span><span class="token punctuation">,</span>body<span class="token operator">:</span><span class="token string">'foo'</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 只有 post 才有 body</span></pre></td></tr><tr><td data-num="2"></td><td><pre>r<span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token function">fetch</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span><span class="token operator">=</span><span class="token punctuation">;</span><span class="token comment">// 报错 Cannot construct a Request with a Request object that has already been used.</span></pre></td></tr></table></figure><p><strong> <code>fetch</code>  发送请求也算使用</strong>，所以 <code>fetch</code>  使用过 <code>Request</code>  实例后不能也克隆，<strong>克隆</strong>得在 <code>fetch</code>  使用前</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">let</span> r<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Request</span><span class="token punctuation">(</span><span class="token string">'https://www.baidu.com'</span>，<span class="token punctuation">&#123;</span>method<span class="token operator">:</span><span class="token string">'post'</span><span class="token punctuation">,</span>body<span class="token operator">:</span><span class="token string">'foo'</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 只有 post 才有 body</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token function">fetch</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span><span class="token operator">=</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>r<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 报错 Request body is already used</span></pre></td></tr></table></figure><h3 id="45-response-对象"><a class="anchor" href="#45-response对象">#</a> 4.5 Response 对象</h3>
<p>服务端用于响应请求的对象</p>
<ul>
<li>
<p><code>new Response(body,init)</code> ：响应实例</p>
<ul>
<li>
<p><code>body</code> ：可选，响应体</p>
</li>
<li>
<p><code>init</code> ：可选，请求的详细设置，以 <code>&#123;&#125;</code>  的形式</p>
</li>
</ul>
</li>
<li>
<p><strong>创建</strong></p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">let</span> r<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Response</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token comment">// 或者</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">let</span> r2<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Response</span><span class="token punctuation">(</span><span class="token string">'foo'</span><span class="token punctuation">,</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    status<span class="token operator">:</span> <span class="token number">418</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">)</span></pre></td></tr></table></figure><p><code>response</code>  实例包括响应头、响应体等各参数</p>
<p><img data-src="/2022/01/14/note/%E5%89%8D%E7%AB%AF/js%E9%AB%98%E7%BA%A7%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1/image-20220426162702113.png" alt="image-20220426162702113"></p>
</li>
</ul>
<p>大多数时候，产生 <code>Response</code>  对象的主要方式是调用 <code>fetch</code> ，他会返回一个最后会解决为 <code>Response</code>  对象的期约，这个 <code>Response</code>  对象代表实际的 HTTP 响应。</p>
<p><strong>静态方法</strong></p>
<ul>
<li><code>Response.redirect(url,status)</code> ：重定向</li>
<li><code>Response.error()</code> ：</li>
</ul>
<p><strong>克隆 Response 对象</strong></p>
<p>和 <code>Request</code>  一样，使用 <code>clone()</code>  方法</p>
<p>（感觉上面这些都没啥用，下面才是重点）</p>
<h3 id="46-request-response-的属性及方法"><a class="anchor" href="#46-request-response的属性及方法">#</a> 4.6 Request、Response 的属性及方法★</h3>
<p>前面比较乱，这里我们把 <code>req</code>  和 <code>res</code>  的属性、方法放到一起，比较方便记忆和查阅。</p>
<h4 id="461-request-属性"><a class="anchor" href="#461-request属性">#</a> 4.6.1 Request 属性</h4>
<p>就是初始化 <code>Request</code>  对象的时候 <code>init</code>  那部分，也可以通过 <code>Request</code>  对象访问</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">let</span> r<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Request</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span>init<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p>这块有点多，主要列一部分，详细看第 4 版 P725</p>
<ul>
<li>
<p><code>body</code> ：请求体（只有 <code>post</code>  请求有）。可以是 <code>Blob</code> 、 <code>BufferSource</code> 、 <code>FormData</code> 、 <code>URLSearchParams</code> 、 <code>ReadableStream</code> 、 <code>String</code>  类型。这一部分通常不能直接访问（因为使用的是 <code>ReadableStream</code>  流保存的，需要通过混入的方法，在下面讲）</p>
</li>
<li>
<p><code>cache</code> ：缓存</p>
<ul>
<li><code>Default</code> ：
<ul>
<li>如果有缓存，直接返回，不发送请求；</li>
<li>命中无效缓存（响应已改变），发送请求更新缓存，并返回该值；</li>
<li>未命中缓存，发送请求并缓存响应，返回该值</li>
</ul>
</li>
<li><code>no-store</code> ：不检查缓存，直接发送请求；不缓存响应，直接返回</li>
<li><code>reload</code> ：不检查缓存，直接发送请求；缓存响应，再返回</li>
<li><code>no-cache</code> ：无论是否命中缓存都发送请求，如果有更新则更新缓存</li>
<li><code>force-cache</code> ：只要命中缓存（无论是否有效），均返回缓存；未命中则发送请求并更新缓存</li>
<li><code>only-if-cached</code> ：...</li>
</ul>
</li>
<li>
<p><code>credentials</code> ：资格证书，指定外发请求如何包含 <code>cookie</code></p>
<ul>
<li><code>omit</code> ：省略，不发送 <code>cookie</code></li>
<li><code>same-origin</code> ：（默认）只在同源请求时发送 <code>cookie</code></li>
<li><code>include</code> ：不论同源还是跨源均发送 <code>cookie</code></li>
</ul>
</li>
<li>
<p><code>headers</code> ： <code>Headers</code>  对象，请求头</p>
</li>
<li>
<p><code>method</code> ：请求方式。get、post、put、patch...。默认 get</p>
</li>
<li>
<p><code>mode</code> ：请求模式。主要针对跨源响应</p>
<ul>
<li><code>cors</code> ：（默认）允许<strong>遵守 CORS 协议</strong>的跨源请求</li>
<li><code>no-cors</code> ：允许<strong>不需要发送预检请求</strong>的跨源请求。响应类型（ <code>response.type</code> ）是 <code>opaque</code> ，也就是不能读取响应内容</li>
<li><code>same-origin</code> ：任何跨源请求都不允许发送</li>
<li><code>navigate</code> ：...</li>
</ul>
</li>
<li>
<p><code>redirect</code> ：如何处理重定向响应</p>
<ul>
<li>...</li>
</ul>
</li>
<li>
<p><code>referrer</code> ：指定请求源。用于指定 HTTP 的 <code>Referer</code>  头部内容</p>
<ul>
<li><code>no-referred</code> ：以 <code>no-referred</code>  为值</li>
<li><code>client/about:client</code> ：（默认），就是当前 URL 或 <code>no-referred</code> （取决于来源策略 <code>referredPolicy</code> ）</li>
<li><code>url</code> ：伪造 <code>url</code> 。<strong>仅能和请求源同源的 url</strong></li>
</ul>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">let</span> r<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Request</span><span class="token punctuation">(</span><span class="token string">'https://www.baidu.com'</span><span class="token punctuation">,</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    referrer<span class="token operator">:</span> <span class="token string">'weghj'</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span>referrer<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//http://127.0.0.1:5501/js%E7%BB%83%E4%B9%A0/ajax/weghj</span></pre></td></tr></table></figure></li>
<li>
<p><code>referredPolicy</code> ：来源策略</p>
<ul>
<li>...</li>
</ul>
</li>
<li>
<p><code>signal</code> ：...</p>
</li>
</ul>
<h4 id="462-response-属性"><a class="anchor" href="#462-response属性">#</a> 4.6.2 Response 属性</h4>
<p><code>Response</code>  对象包含了一组只读属性，描述了请求完成后的状态</p>
<ul>
<li><code>headers</code> ： <code>Headers</code>  对象，返回响应头对象</li>
<li><code>ok</code> ：布尔值，200-299 的状态码返回 <code>true</code> ，其他返回 <code>false</code></li>
<li><code>redirected</code> ：布尔值，返回响应是否至少经过一次<strong>重定向</strong>。</li>
<li><code>status</code> ：整数，返回响应状态码</li>
<li><code>statusText</code> ：字符串，返回响应状态码的文字描述</li>
<li><code>type</code> ：字符串，返回响应类型
<ul>
<li><code>basic</code> ：标准的同源响应</li>
<li><code>cors</code> ：标准的跨源响应</li>
<li><code>error</code> ：表示响应对象是通过 <code>Response.error()</code>  创建的</li>
<li><code>opaque</code> ：不可访问的响应。表示 <code>no-cors</code>  的 <code>fetch()</code>  返回的跨源响应</li>
<li><code>opaqueredirect</code> ：表示对 <code>redirect</code>  设置为 <code>manual</code>  的请求的响应</li>
</ul>
</li>
<li><code>url</code> ：字符串，响应的 <code>url</code></li>
</ul>
<h4 id="463-request-response-方法"><a class="anchor" href="#463-request-response方法">#</a> 4.6.3 Request、Response 方法</h4>
<p><code>Request</code>  和 <code>Response</code>  均用了流来使用 <code>body</code> ，主要有以下 2 点原因：</p>
<ol>
<li>有效载荷（body）的大小可能会导致网络延迟</li>
<li>流 API 本身在处理有效载荷方面有优势</li>
</ol>
<p>body 提供了 5 个方法，用于将 <code>ReadableStream</code>  转存到缓冲区的内存，将缓冲区转换为某种 JavaScript 类型，以及通过期约来产生结果。此外，这些流方法<strong>只能调用一次</strong>，（ <code>body</code>  只能使用一次）</p>
<ul>
<li>
<p><code>.text()</code> ：返回一个期约，解决为（解决后的返回值）缓冲区转存得到的<strong> UTF-8 字符串</strong></p>
<ul>
<li>
<p><code>Response</code> ：</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">'./ajax.html'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">response</span><span class="token punctuation">)</span><span class="token operator">=></span>response<span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>console<span class="token punctuation">.</span>log<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p><img data-src="/2022/01/14/note/%E5%89%8D%E7%AB%AF/js%E9%AB%98%E7%BA%A7%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1/image-20220426191956717.png" alt="image-20220426191956717"></p>
</li>
<li>
<p><code>Request</code> ：</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">let</span> r<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Request</span><span class="token punctuation">(</span><span class="token string">'https://www.baidu.com'</span><span class="token punctuation">,</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    method<span class="token operator">:</span><span class="token string">'post'</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    body<span class="token operator">:</span> <span class="token string">'foo'</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>r<span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>console<span class="token punctuation">.</span>log<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//foo</span></pre></td></tr></table></figure></li>
</ul>
</li>
<li>
<p><code>.json()</code> ：转换为<strong> json 类型</strong></p>
</li>
<li>
<p><code>.formData()</code> ：转为<strong> FormData 类型</strong>（类似 Headers 的类型）</p>
</li>
<li>
<p><code>.arrayBuffer()</code> ：转为<strong> ArrayBuffer 类型</strong>（类数组类型）</p>
</li>
<li>
<p><code>.blob()</code> ：转为<strong> Blob 类型</strong></p>
</li>
</ul>
<h3 id="47-直接读取-readablestream-的-body暂缓"><a class="anchor" href="#47-直接读取readablestream的body暂缓">#</a> 4.7 直接读取 ReadableStream 的 body（暂缓）</h3>
<p>通过混入方法，我们可以很简便地读取响应数据，但他是数据全部接收完后再转换的，当数据较大时，会比较费时间。</p>
<p><code>ReadableStream</code>  支持在这些数据块到达时就<strong>实时</strong>读取和操作这些数据</p>
<p>... 下面暂时还没看，等学完流的部分吧</p>
<h3 id="48-beacon-api暂缓"><a class="anchor" href="#48-beacon-api暂缓">#</a> 4.8 Beacon API（暂缓）</h3>
<h3 id="49-web-socket"><a class="anchor" href="#49-web-socket">#</a> 4.9 Web Socket</h3>
<p>套接字，即 TCP + 端口。是通过一个长时连接实现与服务器全双工的通信。</p>
<ul>
<li>Web Socket 使用自定义协议，使用 <code>ws://</code>  和 <code>wss://</code>  代替 <code>http://</code>  和 <code>https://</code></li>
<li>优点：
<ul>
<li>不会对 HTTP 造成负担</li>
<li>更小的数据报使 Web Socket 非常适合<strong>带宽</strong>和<strong>延迟</strong>较严重的<strong>移动应用</strong></li>
</ul>
</li>
<li>缺点：定义协议的时间较长</li>
</ul>
<p>此外，<strong>同源策略</strong>不适用于 Web Socket，是否与特定源的页面通信，完全取决于服务器</p>
<h4 id="491-api"><a class="anchor" href="#491-api">#</a> 4.9.1 API</h4>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">let</span> socket<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">WebSocket</span><span class="token punctuation">(</span><span class="token string">"ws://www.example.com/server.php"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><ul>
<li><code>readyState</code> ：通过 <code>readyState</code>  属性查看状态
<ul>
<li>0：OPENING，连接正在建立</li>
<li>1：OPEN，连接已建立</li>
<li>2：CLOSING，连接正在关闭</li>
<li>3：CLOSE，连接已经关闭</li>
</ul>
</li>
<li><code>close()</code> ：通过 <code>close</code>  方法立即关闭连接。调用 <code>close()</code>  后 <code>readyState</code>  立即变为 2，关闭后变为 3</li>
</ul>
<h4 id="492-发送和接收数据"><a class="anchor" href="#492-发送和接收数据">#</a> 4.9.2 发送和接收数据</h4>
<ul>
<li>
<p><code>send()</code> ：通过 <code>send()</code>  方法发送数据</p>
<ul>
<li>参数： <code>String</code> 、 <code>ArrayBuffer</code> 、 <code>Blob</code>  类型的数据</li>
</ul>
</li>
<li>
<p><code>onmessage</code> ：通过 <code>onmessage</code>  属性事件接收数据</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre>socket<span class="token punctuation">.</span><span class="token function-variable function">onmessage</span><span class="token operator">=</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token keyword">let</span> data<span class="token operator">=</span>event<span class="token punctuation">.</span>data<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token comment">// 操作数据代码</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p><code>data</code>  的数据可能是 <code>blob</code>  或 <code>arraybuffer</code>  类型</p>
</li>
</ul>
<h4 id="493-其他事件"><a class="anchor" href="#493-其他事件">#</a> 4.9.3 其他事件</h4>
<p>WebSocket 对象在连接生命周期中有可能触发 3 个其他事件</p>
<ul>
<li><code>open</code> ：在连接成功建立时触发</li>
<li><code>error</code> ：在发生错误时触发</li>
<li><code>close</code> ：在连接关闭时触发。这个事件对象 <code>event</code>  还有 3 个额外属性
<ul>
<li><code>wasClean</code> ：布尔值，连接是否干净地关闭</li>
<li><code>code</code> ：来自服务器的数值状态码</li>
<li><code>reason</code> ：字符串，服务器发来的消息</li>
</ul>
</li>
<li><code>message</code> ：在接收到数据时触发（这个是上面讲的）</li>
</ul>
<p>例：</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre>socket<span class="token punctuation">.</span><span class="token function-variable function">onclose</span><span class="token operator">=</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'关闭连接'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>event<span class="token punctuation">.</span>WebSocket<span class="token punctuation">,</span>event<span class="token punctuation">.</span>code<span class="token punctuation">,</span>event<span class="token punctuation">.</span>reason<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>socket<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p>控制台输出：<img data-src="/2022/01/14/note/%E5%89%8D%E7%AB%AF/js%E9%AB%98%E7%BA%A7%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1/image-20220426201955135.png" alt="image-20220426201955135"></p>
<h3 id="410-安全"><a class="anchor" href="#410-安全">#</a> 4.10 安全</h3>
<p>关于 Ajax 的安全防护一般是通过<strong>验证</strong>请求发送者对资源的<strong>访问权限</strong>，如</p>
<ul>
<li>要求通过<strong> SSL</strong> 访问能够被 Ajax 访问的资源</li>
<li>要求每个请求都发送一个按约定算法计算好的<strong>令牌</strong>（token）</li>
<li>下列防护对<strong> CSRF（跨站请求伪造）攻击</strong>无效
<ul>
<li>要求 POST 而非 GET（很容易修改请求方法）</li>
<li>使用来源 URL 验证来源（很容易伪造来源 URL）</li>
<li>基于 cookie 验证（也很容易伪造）</li>
</ul>
</li>
</ul>
<h1 id="二十六-模块"><a class="anchor" href="#二十六-模块">#</a> 二十六、 模块</h1>
<p>类似 python 的 import，C++ 的 include</p>
<h2 id="1-es6-模块"><a class="anchor" href="#1-es6模块">#</a> 1. ES6 模块</h2>
<ul>
<li>ES6 模块不共享全局命名空间</li>
<li>模块中的 <code>var</code>  声明不会被添加到 <code>window</code>  对象</li>
<li>ES6 模块是<strong>异步</strong>加载和执行的</li>
<li>模块最上层的 <code>this</code>  是 <code>uindefined</code> （常规脚本是 <code>window</code> ）</li>
<li>ES6 的模块可以在浏览器中使用，在这之前是不行的</li>
</ul>
<h3 id="11-模块配置"><a class="anchor" href="#11-模块配置">#</a> 1.1 模块配置</h3>
<blockquote>
<p>同一个模块无论被引入多少次，也不管是如何加载的，都只会<strong>加载一次</strong></p>
</blockquote>
<ul>
<li>
<p>在浏览器上使用 <code>module</code>  需要在标签内引入</p>
<p>通过设置标签的 <code>type=&quot;module&quot;</code>  告诉浏览器相关代码<strong>作为模块</strong>执行</p>
<figure class="highlight html"><figcaption data-lang="HTML"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>module<span class="token punctuation">"</span></span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>./myModule.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span></pre></td></tr></table></figure></li>
<li>
<p>在 node.js 使用需要在 <code>package.json</code>  设置 <code>type: module</code> 。<span class="exturl" data-url="aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3NpbmF0XzM2NTIxNjU1L2FydGljbGUvZGV0YWlscy8xMDk4NjMzNjQ=">https://blog.csdn.net/sinat_36521655/article/details/109863364</span></p>
<p>执行 <code>npm init -y</code> ，快速生成 package.json</p>
</li>
</ul>
<h3 id="12-模块导出"><a class="anchor" href="#12-模块导出">#</a> 1.2 模块导出</h3>
<p><code>export</code>  关键字，导出语句必须在模块顶级（最外层），不能嵌套在某块中。</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">if</span><span class="token punctuation">(</span>condition<span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token keyword">export</span> <span class="token operator">...</span><span class="token comment">// 不允许</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><ul>
<li>
<p>命名导出： <code>export</code>  关键字。用于导出一些定义好的变量 / 对象 / 函数</p>
<ul>
<li>
<p>先定义，再导出</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">const</span> a<span class="token operator">=</span><span class="token string">'a'</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">const</span> <span class="token function-variable function">method</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=></span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'method'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="5"></td><td><pre></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token keyword">export</span> <span class="token punctuation">&#123;</span>a<span class="token punctuation">,</span>method<span class="token punctuation">&#125;</span><span class="token comment">// 就算只导出一个，&#123;&#125; 也不能少</span></pre></td></tr></table></figure></li>
<li>
<p>定义的同时导出</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">export</span> <span class="token keyword">const</span> a<span class="token operator">=</span><span class="token string">'a'</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">method</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=></span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'method'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure></li>
<li>
<p>命名导出 <code>as</code> （对导出的变量赋予新名字）</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">const</span> a<span class="token operator">=</span><span class="token string">'a'</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">export</span> <span class="token punctuation">&#123;</span>a <span class="token keyword">as</span> newA<span class="token punctuation">&#125;</span><span class="token comment">// 这样 a 变量就换了个名字导出</span></pre></td></tr></table></figure></li>
</ul>
</li>
<li>
<p>默认导出： <code>export default</code></p>
<blockquote>
<p><code>export default</code>  命令用于指定模块的默认输出。</p>
<p>显然，一个模块只能有一个默认输出，因此 export default 命令只能<strong>使用一次</strong>。</p>
<p>所以， <code>import</code>  命令后面才<strong>不用加大括号</strong>，因为只可能唯一对应 export default 命令。</p>
</blockquote>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">//export default 不支持定义变量的同时导出，export default foo='foo' 错误</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token comment">// 但支持定义函数的同时导出，export default function foo ()&#123;&#125; 正确</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token comment">// 但一般 export default 不需要声明，直接匿名导出即可，如下</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token string">'foo'</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token comment">// 或者</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'foo'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token comment">// 在另一个 js 文件中导入可以任意命名，也不需要 &#123;&#125; 如</span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token keyword">import</span> foo123 <span class="token keyword">from</span> <span class="token string">'./foo.js'</span></pre></td></tr></table></figure><p>默认导出可以和普通导出组合在一起</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">const</span> foo<span class="token operator">=</span><span class="token string">'foo'</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">const</span> bar<span class="token operator">=</span><span class="token string">'bar'</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">export</span> <span class="token punctuation">&#123;</span>foo <span class="token keyword">as</span> <span class="token keyword">default</span><span class="token punctuation">,</span>bar<span class="token punctuation">&#125;</span><span class="token comment">//foo as default 等价于 export default foo</span></pre></td></tr></table></figure></li>
<li>
<p>允许转移导出：A 导入 B 的 foo，A 导出该 foo</p>
</li>
</ul>
<h3 id="13-模块导入"><a class="anchor" href="#13-模块导入">#</a> 1.3 模块导入</h3>
<p><code>import</code>  关键字：和 <code>export</code>  一样，不允许嵌套在块内</p>
<p><strong>以此导出为例</strong></p>
<p><code>foo.js</code></p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">export</span> <span class="token keyword">const</span> foo<span class="token operator">=</span><span class="token string">'foo'</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">method</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=></span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'method'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'default'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><ul>
<li>
<p>按需导入</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">import</span> <span class="token punctuation">&#123;</span>foo<span class="token punctuation">,</span>method <span class="token keyword">as</span> newMethod<span class="token punctuation">,</span><span class="token keyword">default</span> <span class="token keyword">as</span> d<span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'./foo.js'</span><span class="token punctuation">;</span><span class="token comment">//import 可以使用 as 重新命名</span></pre></td></tr></table></figure></li>
<li>
<p>全部导入</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> Foo <span class="token keyword">from</span> <span class="token string">'./bar.js'</span><span class="token punctuation">;</span><span class="token comment">// 导入的是个类 object 的对象</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token comment">// 必须有 as，否则会报错</span></pre></td></tr></table></figure><p>Foo：<img data-src="/2022/01/14/note/%E5%89%8D%E7%AB%AF/js%E9%AB%98%E7%BA%A7%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1/image-20220419140745598.png" alt="image-20220419140745598"></p>
<p>也可以在全部导入的同时单独分离一些出来，如</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">import</span> foo<span class="token punctuation">,</span><span class="token operator">*</span> <span class="token keyword">as</span> Foo <span class="token keyword">from</span> <span class="token string">'./bar.js'</span><span class="token punctuation">;</span><span class="token comment">// 不过 Foo 里还是有 foo 这个属性的</span></pre></td></tr></table></figure></li>
<li>
<p>仅导入默认</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">import</span> d <span class="token keyword">from</span> <span class="token string">'./foo.js'</span><span class="token punctuation">;</span><span class="token comment">// 默认导入不用 &#123;&#125;, 但要给他一个名字</span></pre></td></tr></table></figure></li>
</ul>
<hr>
<p>导入命名后，不能对该变量重新赋值，但可以修改变量内容（如果是 object 的话）</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">import</span> foo<span class="token punctuation">,</span><span class="token operator">*</span> <span class="token keyword">as</span> Foo <span class="token keyword">from</span> <span class="token string">'./foo.js'</span></pre></td></tr><tr><td data-num="2"></td><td><pre>foo<span class="token operator">=</span><span class="token string">'foo1'</span> <span class="token comment">// 错误</span></pre></td></tr><tr><td data-num="3"></td><td><pre>Foo<span class="token punctuation">.</span>foo<span class="token operator">=</span><span class="token string">'foo1'</span> <span class="token comment">// 错误</span></pre></td></tr><tr><td data-num="4"></td><td><pre>foo<span class="token punctuation">.</span>bar<span class="token operator">=</span><span class="token string">'bar1'</span> <span class="token comment">// 允许</span></pre></td></tr></table></figure><h3 id="vue-中的-export-default"><a class="anchor" href="#vue中的export-default">#</a> Vue 中的 export default</h3>
<h2 id="2-commonjs-模块加载器es6-之前"><a class="anchor" href="#2-commonjs模块加载器es6之前">#</a> 2. CommonJS 模块加载器（ES6 之前）</h2>
<h3 id="21-导出"><a class="anchor" href="#21-导出">#</a> 2.1 导出</h3>
<p><code>module.export</code></p>
<h3 id="22-导入"><a class="anchor" href="#22-导入">#</a> 2.2 导入</h3>
<p><code>require</code></p>

  </div>

   <footer>

    <div class="meta">
  <span class="item">
    <span class="icon">
      <i class="ic i-calendar-check"></i>
    </span>
    <span class="text">更新于</span>
    <time title="修改时间：2022-08-13 10:53:15" itemprop="dateModified" datetime="2022-08-13T10:53:15+08:00">2022-08-13</time>
  </span>
</div>

      
<div class="reward">
  <button><i class="ic i-heartbeat"></i> 赞赏</button>
  <p>请我喝[茶]~(￣▽￣)~*</p>
  <div id="qr">
      
      <div>
        <img data-src="../images/wechatpay.png" alt="宁理大神1996 微信支付">
        <p>微信支付</p>
      </div>
      
      <div>
        <img data-src="../images/alipay.png" alt="宁理大神1996 支付宝">
        <p>支付宝</p>
      </div>
      
      <div>
        <img data-src="../images/paypal.png" alt="宁理大神1996 贝宝">
        <p>贝宝</p>
      </div>
  </div>
</div>

      

<div id="copyright">
<ul>
  <li class="author">
    <strong>本文作者： </strong>宁理大神1996 <i class="ic i-at"><em>@</em></i>宁理大神 1996
  </li>
  <li class="link">
    <strong>本文链接：</strong>
    <a href="../../../../../../https:/nitgod1996.com/2022/01/14/note/%E5%89%8D%E7%AB%AF/js%E9%AB%98%E7%BA%A7%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1/" title="JavaScript 高级程序设计">https://nitgod1996.com/2022/01/14/note/前端/js高级程序设计/</a>
  </li>
  <li class="license">
    <strong>版权声明： </strong>本站所有文章除特别声明外，均采用 <span class="exturl" data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC9kZWVkLnpo"><i class="ic i-creative-commons"><em>(CC)</em></i>BY-NC-SA</span> 许可协议。转载请注明出处！
  </li>
</ul>
</div>

  </footer>

</article>

  </div>
  

<div class="post-nav">
    <div class="item left">
      

  <a href="../../../../../../2021/12/24/note/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E7%AE%97%E6%B3%95/" itemprop="url" rel="prev" data-background-image="https:&#x2F;&#x2F;tva3.sinaimg.cn&#x2F;mw690&#x2F;6833939bly1gipeun65urj20zk0m81ii.jpg" title="未命名">
  <span class="type">上一篇</span>
  <span class="category"><i class="ic i-flag"></i> </span>
  <h3>未命名</h3>
  </a>

    </div>
    <div class="item right">
      

  <a href="../../../../../03/16/note/%E5%89%8D%E7%AB%AF/JavaScript%E7%9F%A5%E8%AF%86%E7%82%B9/" itemprop="url" rel="next" data-background-image="https:&#x2F;&#x2F;tva3.sinaimg.cn&#x2F;mw690&#x2F;6833939bly1gipesrnqv3j20zk0m8ava.jpg" title="未命名">
  <span class="type">下一篇</span>
  <span class="category"><i class="ic i-flag"></i> </span>
  <h3>未命名</h3>
  </a>

    </div>
</div>

  
  <div class="wrap" id="comments"></div>


        </div>
        <div id="sidebar">
          

<div class="inner">

  <div class="panels">
    <div class="inner">
      <div class="contents panel pjax" data-title="文章目录">
          <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B8%80-%E4%BB%80%E4%B9%88%E6%98%AF-javascript"><span class="toc-number">1.</span> <span class="toc-text"> 一、 什么是 JavaScript</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-javascript-%E7%9A%84%E6%9E%84%E6%88%90"><span class="toc-number">1.1.</span> <span class="toc-text"> 1. JavaScript 的构成</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#11-ecmascript"><span class="toc-number">1.1.1.</span> <span class="toc-text"> 1.1 ECMAScript</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#12-dom"><span class="toc-number">1.1.2.</span> <span class="toc-text"> 1.2 DOM</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#13-bom"><span class="toc-number">1.1.3.</span> <span class="toc-text"> 1.3 BOM</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BA%8C-html-%E4%B8%AD%E7%9A%84-javascript"><span class="toc-number">2.</span> <span class="toc-text"> 二、 HTML 中的 JavaScript</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-ltscriptgt-%E5%85%83%E7%B4%A0%E9%9D%99%E6%80%81%E5%8A%A0%E8%BD%BD%E8%84%9A%E6%9C%AC"><span class="toc-number">2.1.</span> <span class="toc-text"> 1. &lt;script&gt; 元素（静态加载脚本）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#11-%E8%84%9A%E6%9C%AC%E5%8A%A0%E8%BD%BD%E6%97%B6%E6%9C%BA"><span class="toc-number">2.1.1.</span> <span class="toc-text"> 1.1 脚本加载时机</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#12-%E5%A4%9A%E4%B8%AA-ltscriptgt"><span class="toc-number">2.1.2.</span> <span class="toc-text"> 1.2 多个 &lt;script&gt;</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-%E5%8A%A8%E6%80%81%E5%8A%A0%E8%BD%BD%E8%84%9A%E6%9C%AC"><span class="toc-number">2.2.</span> <span class="toc-text"> 2. 动态加载脚本</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-xhtml"><span class="toc-number">2.3.</span> <span class="toc-text"> 3. XHTML</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-%E8%A1%8C%E5%86%85%E4%BB%A3%E7%A0%81-or-%E5%A4%96%E9%83%A8%E5%BC%95%E5%85%A5"><span class="toc-number">2.4.</span> <span class="toc-text"> 4. 行内代码 or 外部引入</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-ltnoscriptgt-%E5%85%83%E7%B4%A0"><span class="toc-number">2.5.</span> <span class="toc-text"> 5. &lt;noscript&gt; 元素</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B8%89-%E8%AF%AD%E6%B3%95%E5%9F%BA%E7%A1%80"><span class="toc-number">3.</span> <span class="toc-text"> 三、 语法基础</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-%E8%AF%AD%E6%B3%95"><span class="toc-number">3.1.</span> <span class="toc-text"> 1. 语法</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#11-%E5%8C%BA%E5%88%86%E5%A4%A7%E5%B0%8F%E5%86%99"><span class="toc-number">3.1.1.</span> <span class="toc-text"> 1.1 区分大小写</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#12-%E6%A0%87%E8%AF%86%E7%AC%A6%E5%8F%98%E9%87%8F-%E5%87%BD%E6%95%B0%E7%9A%84%E5%90%8D%E7%A7%B0"><span class="toc-number">3.1.2.</span> <span class="toc-text"> 1.2 标识符：（变量、函数的名称）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#13-%E6%B3%A8%E9%87%8A"><span class="toc-number">3.1.3.</span> <span class="toc-text"> 1.3 注释</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#14-%E4%B8%A5%E6%A0%BC%E6%A8%A1%E5%BC%8F"><span class="toc-number">3.1.4.</span> <span class="toc-text"> 1.4 严格模式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#15-%E8%AF%AD%E5%8F%A5"><span class="toc-number">3.1.5.</span> <span class="toc-text"> 1.5 语句</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-%E5%85%B3%E9%94%AE%E5%AD%97%E4%B8%8E%E4%BF%9D%E7%95%99%E5%AD%97"><span class="toc-number">3.2.</span> <span class="toc-text"> 2. 关键字与保留字</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-%E5%8F%98%E9%87%8F"><span class="toc-number">3.3.</span> <span class="toc-text"> 3. 变量</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#31-var-%E5%85%B3%E9%94%AE%E5%AD%97"><span class="toc-number">3.3.1.</span> <span class="toc-text"> 3.1 var 关键字</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#32-let-%E5%85%B3%E9%94%AE%E5%AD%97"><span class="toc-number">3.3.2.</span> <span class="toc-text"> 3.2 let 关键字</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#33-const-%E5%85%B3%E9%94%AE%E5%AD%97"><span class="toc-number">3.3.3.</span> <span class="toc-text"> 3.3 const 关键字</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#34-%E6%9C%80%E4%BD%B3%E5%A3%B0%E6%98%8E%E8%A7%84%E5%88%99"><span class="toc-number">3.3.4.</span> <span class="toc-text"> 3.4 最佳声明规则</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B"><span class="toc-number">3.4.</span> <span class="toc-text"> 4. 数据类型</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#41-typeof-%E6%93%8D%E4%BD%9C%E7%AC%A6"><span class="toc-number">3.4.1.</span> <span class="toc-text"> 4.1 typeof 操作符</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#42-undefined-%E7%B1%BB%E5%9E%8B"><span class="toc-number">3.4.2.</span> <span class="toc-text"> 4.2 Undefined 类型</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#43-null-%E7%B1%BB%E5%9E%8B"><span class="toc-number">3.4.3.</span> <span class="toc-text"> 4.3 Null 类型</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#44-boolean-%E7%B1%BB%E5%9E%8B"><span class="toc-number">3.4.4.</span> <span class="toc-text"> 4.4 Boolean 类型</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#45-number-%E7%B1%BB%E5%9E%8B"><span class="toc-number">3.4.5.</span> <span class="toc-text"> 4.5 Number 类型</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#451-%E6%B5%AE%E7%82%B9%E6%95%B0"><span class="toc-number">3.4.5.1.</span> <span class="toc-text"> 4.5.1 浮点数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#452-%E5%8F%96%E5%80%BC%E8%8C%83%E5%9B%B4"><span class="toc-number">3.4.5.2.</span> <span class="toc-text"> 4.5.2 取值范围</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#453-nan"><span class="toc-number">3.4.5.3.</span> <span class="toc-text"> 4.5.3 NaN</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#454-%E6%95%B0%E5%80%BC%E8%BD%AC%E6%8D%A2"><span class="toc-number">3.4.5.4.</span> <span class="toc-text"> 4.5.4 数值转换</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#46-string-%E7%B1%BB%E5%9E%8B"><span class="toc-number">3.4.6.</span> <span class="toc-text"> 4.6 String 类型</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#461-%E7%89%B9%E6%AE%8A%E5%AD%97%E7%AC%A6%E8%A1%A8%E7%A4%BA"><span class="toc-number">3.4.6.1.</span> <span class="toc-text"> 4.6.1 特殊字符表示</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#462-%E5%AD%97%E7%AC%A6%E4%B8%B2%E4%B8%8D%E5%8F%AF%E5%8F%98"><span class="toc-number">3.4.6.2.</span> <span class="toc-text"> 4.6.2 字符串不可变</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#463-%E5%85%B6%E4%BB%96%E5%80%BC%E8%BD%AC%E4%B8%BA%E5%AD%97%E7%AC%A6%E4%B8%B2"><span class="toc-number">3.4.6.3.</span> <span class="toc-text"> 4.6.3 其他值转为字符串</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#464-%E6%A8%A1%E6%9D%BF%E5%AD%97%E9%9D%A2%E9%87%8Fes6-%E6%96%B0%E5%A2%9E"><span class="toc-number">3.4.6.4.</span> <span class="toc-text"> 4.6.4 模板字面量（ES6 新增）</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#4641-%E4%BF%9D%E7%95%99%E6%8D%A2%E8%A1%8C"><span class="toc-number">3.4.6.4.1.</span> <span class="toc-text"> 4.6.4.1 保留换行</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#4642-%E5%AD%97%E7%AC%A6%E4%B8%B2%E6%8F%92%E5%80%BC"><span class="toc-number">3.4.6.4.2.</span> <span class="toc-text"> 4.6.4.2 字符串插值</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#4643-%E6%A0%87%E7%AD%BE%E5%87%BD%E6%95%B0"><span class="toc-number">3.4.6.4.3.</span> <span class="toc-text"> 4.6.4.3 标签函数</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#4644-%E5%8E%9F%E5%A7%8B%E5%AD%97%E7%AC%A6%E4%B8%B2stringraw"><span class="toc-number">3.4.6.4.4.</span> <span class="toc-text"> 4.6.4.4 原始字符串（String.raw）</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#47-symbol-%E7%B1%BB%E5%9E%8Bes6-%E6%96%B0%E5%A2%9E%E6%9A%82%E7%BC%93"><span class="toc-number">3.4.7.</span> <span class="toc-text"> 4.7 Symbol 类型（ES6 新增）（暂缓）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#48-object-%E7%B1%BB%E5%9E%8B"><span class="toc-number">3.4.8.</span> <span class="toc-text"> 4.8 Object 类型</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-%E6%93%8D%E4%BD%9C%E7%AC%A6"><span class="toc-number">3.5.</span> <span class="toc-text"> 5. 操作符</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#51-%E4%B8%80%E5%85%83%E6%93%8D%E4%BD%9C%E7%AC%A6"><span class="toc-number">3.5.1.</span> <span class="toc-text"> 5.1 一元操作符</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#511-%E9%80%92%E5%A2%9E-%E9%80%92%E5%87%8F"><span class="toc-number">3.5.1.1.</span> <span class="toc-text"> 5.1.1 递增 &#x2F; 递减</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#512-%E4%B8%80%E5%85%83%E5%8A%A0%E5%87%8F"><span class="toc-number">3.5.1.2.</span> <span class="toc-text"> 5.1.2 一元加减</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#52-%E4%BD%8D%E6%93%8D%E4%BD%9C%E7%AC%A6"><span class="toc-number">3.5.2.</span> <span class="toc-text"> 5.2 位操作符</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#521-%E6%8C%89%E4%BD%8D%E9%9D%9E-~"><span class="toc-number">3.5.2.1.</span> <span class="toc-text"> 5.2.1 按位非 ~</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#522-%E6%8C%89%E4%BD%8D%E4%B8%8E-amp"><span class="toc-number">3.5.2.2.</span> <span class="toc-text"> 5.2.2 按位与 &amp;</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#523-%E6%8C%89%E4%BD%8D%E6%88%96"><span class="toc-number">3.5.2.3.</span> <span class="toc-text"> 5.2.3 按位或 |</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#524-%E6%8C%89%E4%BD%8D%E5%BC%82%E6%88%96"><span class="toc-number">3.5.2.4.</span> <span class="toc-text"> 5.2.4 按位异或 ^</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#525-%E5%B7%A6%E7%A7%BB-ltlt"><span class="toc-number">3.5.2.5.</span> <span class="toc-text"> 5.2.5 左移 &lt;&lt;</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#526-%E6%9C%89%E7%AC%A6%E5%8F%B7%E5%8F%B3%E7%A7%BB-gtgt"><span class="toc-number">3.5.2.6.</span> <span class="toc-text"> 5.2.6 有符号右移 &gt;&gt;</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#527-%E6%97%A0%E7%AC%A6%E5%8F%B7%E5%8F%B3%E7%A7%BB-gtgtgt"><span class="toc-number">3.5.2.7.</span> <span class="toc-text"> 5.2.7 无符号右移 &gt;&gt;&gt;</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#53-%E5%B8%83%E5%B0%94%E6%93%8D%E4%BD%9C%E7%AC%A6"><span class="toc-number">3.5.3.</span> <span class="toc-text"> 5.3 布尔操作符</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#531-%E9%80%BB%E8%BE%91%E9%9D%9E"><span class="toc-number">3.5.3.1.</span> <span class="toc-text"> 5.3.1 逻辑非 !</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#532-%E9%80%BB%E8%BE%91%E4%B8%8E-ampamp"><span class="toc-number">3.5.3.2.</span> <span class="toc-text"> 5.3.2 逻辑与 &amp;&amp;</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#533-%E9%80%BB%E8%BE%91%E6%88%96"><span class="toc-number">3.5.3.3.</span> <span class="toc-text"> 5.3.3 逻辑或 ||</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#54-%E4%B9%98%E9%99%A4%E6%93%8D%E4%BD%9C%E7%AC%A6"><span class="toc-number">3.5.4.</span> <span class="toc-text"> 5.4 乘除操作符</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#541-%E4%B9%98%E6%B3%95%E6%93%8D%E4%BD%9C%E7%AC%A6"><span class="toc-number">3.5.4.1.</span> <span class="toc-text"> 5.4.1 乘法操作符 *</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#542-%E9%99%A4%E6%B3%95%E6%93%8D%E4%BD%9C%E7%AC%A6"><span class="toc-number">3.5.4.2.</span> <span class="toc-text"> 5.4.2 除法操作符 &#x2F;</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#543-%E5%8F%96%E6%A8%A1%E6%93%8D%E4%BD%9C%E7%AC%A6"><span class="toc-number">3.5.4.3.</span> <span class="toc-text"> 5.4.3 取模操作符 %</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#55-%E6%8C%87%E6%95%B0%E6%93%8D%E4%BD%9C%E7%AC%A6-es6-%E6%96%B0%E5%A2%9E"><span class="toc-number">3.5.5.</span> <span class="toc-text"> 5.5 指数操作符 ** （ES6 新增）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#56-%E5%8A%A0%E5%87%8F%E6%93%8D%E4%BD%9C%E7%AC%A6"><span class="toc-number">3.5.6.</span> <span class="toc-text"> 5.6 加减操作符</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#561-%E5%8A%A0%E6%B3%95%E6%93%8D%E4%BD%9C%E7%AC%A6"><span class="toc-number">3.5.6.1.</span> <span class="toc-text"> 5.6.1 加法操作符 +</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#562-%E5%87%8F%E6%B3%95%E6%93%8D%E4%BD%9C%E7%AC%A6-"><span class="toc-number">3.5.6.2.</span> <span class="toc-text"> 5.6.2 减法操作符 -</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#57-%E5%85%B3%E7%B3%BB%E6%AF%94%E8%BE%83%E6%93%8D%E4%BD%9C%E7%AC%A6-gt"><span class="toc-number">3.5.7.</span> <span class="toc-text"> 5.7 关系（比较）操作符 &gt;</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#58-%E7%9B%B8%E7%AD%89%E6%93%8D%E4%BD%9C%E7%AC%A6"><span class="toc-number">3.5.8.</span> <span class="toc-text"> 5.8 相等操作符</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#581-%E4%B8%8D%E5%85%A8%E7%AD%89"><span class="toc-number">3.5.8.1.</span> <span class="toc-text"> 5.8.1 不全等 &#x3D;&#x3D;</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#582-%E5%85%A8%E7%AD%89"><span class="toc-number">3.5.8.2.</span> <span class="toc-text"> 5.8.2 全等 &#x3D;&#x3D;&#x3D;</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#59-%E6%9D%A1%E4%BB%B6%E6%93%8D%E4%BD%9C%E7%AC%A6%E4%B8%89%E5%85%83%E8%BF%90%E7%AE%97%E7%AC%A6"><span class="toc-number">3.5.9.</span> <span class="toc-text"> 5.9 条件操作符（三元运算符）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#510-%E8%B5%8B%E5%80%BC%E6%93%8D%E4%BD%9C%E7%AC%A6"><span class="toc-number">3.5.10.</span> <span class="toc-text"> 5.10 赋值操作符 +&#x3D;</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#511-%E9%80%97%E5%8F%B7%E6%93%8D%E4%BD%9C%E7%AC%A6"><span class="toc-number">3.5.11.</span> <span class="toc-text"> 5.11 逗号操作符 ,</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-%E8%AF%AD%E5%8F%A5"><span class="toc-number">3.6.</span> <span class="toc-text"> 6. 语句</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#61-if-%E8%AF%AD%E5%8F%A5"><span class="toc-number">3.6.1.</span> <span class="toc-text"> 6.1 if 语句</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#62-do-while-%E8%AF%AD%E5%8F%A5"><span class="toc-number">3.6.2.</span> <span class="toc-text"> 6.2 do-while 语句</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#63-while-%E8%AF%AD%E5%8F%A5"><span class="toc-number">3.6.3.</span> <span class="toc-text"> 6.3 while 语句</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#64-for-%E8%AF%AD%E5%8F%A5"><span class="toc-number">3.6.4.</span> <span class="toc-text"> 6.4 for 语句</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#65-for-in-%E8%AF%AD%E5%8F%A5"><span class="toc-number">3.6.5.</span> <span class="toc-text"> 6.5 for-in 语句</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#66-for-of-%E8%AF%AD%E5%8F%A5"><span class="toc-number">3.6.6.</span> <span class="toc-text"> 6.6 for-of 语句</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#67-%E6%A0%87%E7%AD%BE%E8%AF%AD%E5%8F%A5"><span class="toc-number">3.6.7.</span> <span class="toc-text"> 6.7 标签语句</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#68-break-%E5%92%8C-continue"><span class="toc-number">3.6.8.</span> <span class="toc-text"> 6.8 break 和 continue</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#69-with-%E8%AF%AD%E5%8F%A5%E6%9A%82%E7%BC%93"><span class="toc-number">3.6.9.</span> <span class="toc-text"> 6.9 with 语句（暂缓）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#610-switch-%E8%AF%AD%E5%8F%A5%E6%9D%A1%E4%BB%B6%E5%88%A4%E6%96%AD"><span class="toc-number">3.6.10.</span> <span class="toc-text"> 6.10 switch 语句（条件判断）</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7-%E5%87%BD%E6%95%B0%E6%B5%85%E8%B0%88"><span class="toc-number">3.7.</span> <span class="toc-text"> 7. 函数（浅谈）</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%9B%9B-%E5%8F%98%E9%87%8F-%E4%BD%9C%E7%94%A8%E5%9F%9F%E4%B8%8E%E5%86%85%E5%AD%98"><span class="toc-number">4.</span> <span class="toc-text"> 四、 变量、作用域与内存★</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-%E5%8E%9F%E5%A7%8B%E5%80%BC%E4%B8%8E%E5%BC%95%E7%94%A8%E5%80%BC"><span class="toc-number">4.1.</span> <span class="toc-text"> 1. 原始值与引用值</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#11-%E5%8A%A8%E6%80%81%E5%B1%9E%E6%80%A7"><span class="toc-number">4.1.1.</span> <span class="toc-text"> 1.1 动态属性</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#12-%E5%A4%8D%E5%88%B6%E5%80%BC"><span class="toc-number">4.1.2.</span> <span class="toc-text"> 1.2 复制值</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#13-%E4%BC%A0%E9%80%92%E5%8F%82%E6%95%B0"><span class="toc-number">4.1.3.</span> <span class="toc-text"> 1.3 传递参数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#14-%E7%A1%AE%E5%AE%9A%E7%B1%BB%E5%9E%8B"><span class="toc-number">4.1.4.</span> <span class="toc-text"> 1.4 确定类型</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-%E6%89%A7%E8%A1%8C%E4%B8%8A%E4%B8%8B%E6%96%87%E5%92%8C%E4%BD%9C%E7%94%A8%E5%9F%9F"><span class="toc-number">4.2.</span> <span class="toc-text"> 2. 执行上下文和作用域</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#21-%E4%BD%9C%E7%94%A8%E5%9F%9F%E9%93%BE%E5%A2%9E%E5%BC%BA"><span class="toc-number">4.2.1.</span> <span class="toc-text"> 2.1 作用域链增强</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#22-%E5%8F%98%E9%87%8F%E5%A3%B0%E6%98%8E"><span class="toc-number">4.2.2.</span> <span class="toc-text"> 2.2 变量声明</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#221-%E4%BD%BF%E7%94%A8-var-%E7%9A%84%E5%87%BD%E6%95%B0%E4%BD%9C%E7%94%A8%E5%9F%9F%E5%A3%B0%E6%98%8E"><span class="toc-number">4.2.2.1.</span> <span class="toc-text"> 2.2.1 使用 var 的函数作用域声明</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#222-%E4%BD%BF%E7%94%A8-let-%E7%9A%84%E5%9D%97%E7%BA%A7%E4%BD%9C%E7%94%A8%E5%9F%9F%E5%A3%B0%E6%98%8E"><span class="toc-number">4.2.2.2.</span> <span class="toc-text"> 2.2.2 使用 let 的块级作用域声明</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#223-%E4%BD%BF%E7%94%A8-const-%E7%9A%84%E5%B8%B8%E9%87%8F%E5%A3%B0%E6%98%8E"><span class="toc-number">4.2.2.3.</span> <span class="toc-text"> 2.2.3 使用 const 的常量声明</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#224-%E6%A0%87%E8%AF%86%E7%AC%A6%E6%9F%A5%E6%89%BEjavascript-%E5%BC%95%E6%93%8E"><span class="toc-number">4.2.2.4.</span> <span class="toc-text"> 2.2.4 标识符查找（JavaScript 引擎）</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6"><span class="toc-number">4.3.</span> <span class="toc-text"> 3. 垃圾回收</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#31-%E6%A0%87%E8%AE%B0%E6%B8%85%E7%90%86%E6%9C%80%E5%B8%B8%E7%94%A8"><span class="toc-number">4.3.1.</span> <span class="toc-text"> 3.1 标记清理（最常用）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#32-%E5%BC%95%E7%94%A8%E8%AE%A1%E6%95%B0"><span class="toc-number">4.3.2.</span> <span class="toc-text"> 3.2 引用计数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#33-%E6%80%A7%E8%83%BD%E5%9B%9E%E6%94%B6%E5%91%A8%E6%9C%9F"><span class="toc-number">4.3.3.</span> <span class="toc-text"> 3.3 性能（回收周期）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#34-%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86"><span class="toc-number">4.3.4.</span> <span class="toc-text"> 3.4 内存管理</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#341-%E9%80%9A%E8%BF%87-const-%E5%92%8C-let-%E5%A3%B0%E6%98%8E%E6%8F%90%E5%8D%87%E6%80%A7%E8%83%BD"><span class="toc-number">4.3.4.1.</span> <span class="toc-text"> 3.4.1 通过 const 和 let 声明提升性能</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#342-%E9%9A%90%E8%97%8F%E7%B1%BB%E5%92%8C%E5%88%A0%E9%99%A4%E6%93%8D%E4%BD%9C"><span class="toc-number">4.3.4.2.</span> <span class="toc-text"> 3.4.2 隐藏类和删除操作</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#343-%E5%86%85%E5%AD%98%E6%B3%84%E6%BC%8F"><span class="toc-number">4.3.4.3.</span> <span class="toc-text"> 3.4.3 内存泄漏</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#344-%E9%9D%99%E6%80%81%E5%88%86%E9%85%8D%E4%B8%8E%E5%AF%B9%E8%B1%A1%E6%B1%A0"><span class="toc-number">4.3.4.4.</span> <span class="toc-text"> 3.4.4 静态分配与对象池</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BA%94-%E5%9F%BA%E6%9C%AC%E5%BC%95%E7%94%A8%E7%B1%BB%E5%9E%8B"><span class="toc-number">5.</span> <span class="toc-text"> 五、 基本引用类型</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-date"><span class="toc-number">5.1.</span> <span class="toc-text"> 1. Date</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#11-%E7%BB%A7%E6%89%BF%E7%9A%84%E6%96%B9%E6%B3%95"><span class="toc-number">5.1.1.</span> <span class="toc-text"> 1.1 继承的方法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#12-%E6%97%A5%E6%9C%9F%E6%A0%BC%E5%BC%8F%E5%8C%96%E6%96%B9%E6%B3%95"><span class="toc-number">5.1.2.</span> <span class="toc-text"> 1.2 日期格式化方法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#13-%E6%97%A5%E6%9C%9F-%E6%97%B6%E9%97%B4%E7%BB%84%E4%BB%B6%E6%96%B9%E6%B3%95%E6%9A%82%E7%BC%93"><span class="toc-number">5.1.3.</span> <span class="toc-text"> 1.3 日期 &#x2F; 时间组件方法（暂缓）</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-regexp%E6%9A%82%E7%BC%93"><span class="toc-number">5.2.</span> <span class="toc-text"> 2. RegExp（暂缓）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#21-regexp-%E5%AE%9E%E4%BE%8B%E5%B1%9E%E6%80%A7"><span class="toc-number">5.2.1.</span> <span class="toc-text"> 2.1 RegExp 实例属性</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#22-regexp-%E5%AE%9E%E4%BE%8B%E6%96%B9%E6%B3%95"><span class="toc-number">5.2.2.</span> <span class="toc-text"> 2.2 RegExp 实例方法</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#221-exec-%E6%96%B9%E6%B3%95"><span class="toc-number">5.2.2.1.</span> <span class="toc-text"> 2.2.1 exec () 方法</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#222-test-%E6%96%B9%E6%B3%95"><span class="toc-number">5.2.2.2.</span> <span class="toc-text"> 2.2.2 test () 方法</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-%E5%8E%9F%E5%A7%8B%E5%80%BC%E5%8C%85%E8%A3%85%E7%B1%BB%E5%9E%8B"><span class="toc-number">5.3.</span> <span class="toc-text"> 3. 原始值包装类型</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#31-boolean%E4%B8%8D%E6%8E%A8%E8%8D%90%E4%BD%BF%E7%94%A8"><span class="toc-number">5.3.1.</span> <span class="toc-text"> 3.1 Boolean（不推荐使用）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#32-number"><span class="toc-number">5.3.2.</span> <span class="toc-text"> 3.2 Number</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#33-string"><span class="toc-number">5.3.3.</span> <span class="toc-text"> 3.3 String</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#331-javascript-%E5%AD%97%E7%AC%A6"><span class="toc-number">5.3.3.1.</span> <span class="toc-text"> 3.3.1 JavaScript 字符</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#332-normalize-%E6%96%B9%E6%B3%95%E7%9C%8B%E4%B8%8D%E6%87%82"><span class="toc-number">5.3.3.2.</span> <span class="toc-text"> 3.3.2 normalize () 方法（看不懂）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#333-%E5%AD%97%E7%AC%A6%E4%B8%B2%E6%93%8D%E4%BD%9C%E6%96%B9%E6%B3%95"><span class="toc-number">5.3.3.3.</span> <span class="toc-text"> 3.3.3 字符串操作方法</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#334-%E5%AD%97%E7%AC%A6%E4%B8%B2%E4%BD%8D%E7%BD%AE%E6%96%B9%E6%B3%95"><span class="toc-number">5.3.3.4.</span> <span class="toc-text"> 3.3.4 字符串位置方法</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#335-%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%8C%85%E5%90%AB%E6%96%B9%E6%B3%95"><span class="toc-number">5.3.3.5.</span> <span class="toc-text"> 3.3.5 字符串包含方法</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#336-trim-%E6%96%B9%E6%B3%95"><span class="toc-number">5.3.3.6.</span> <span class="toc-text"> 3.3.6 trim () 方法</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#337-repeat-%E6%96%B9%E6%B3%95"><span class="toc-number">5.3.3.7.</span> <span class="toc-text"> 3.3.7 repeat () 方法</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#338-padstart-%E5%92%8C-padend-%E6%96%B9%E6%B3%95"><span class="toc-number">5.3.3.8.</span> <span class="toc-text"> 3.3.8 padStart () 和 padEnd () 方法</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#339-%E5%AD%97%E7%AC%A6%E4%B8%B2%E8%BF%AD%E4%BB%A3%E4%B8%8E%E8%A7%A3%E6%9E%84%E8%BF%AD%E4%BB%A3%E5%99%A8%E7%9A%84%E7%94%A8%E6%B3%95"><span class="toc-number">5.3.3.9.</span> <span class="toc-text"> 3.3.9 字符串迭代与解构（迭代器的用法）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3310-%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%A4%A7%E5%B0%8F%E5%86%99%E8%BD%AC%E6%8D%A2"><span class="toc-number">5.3.3.10.</span> <span class="toc-text"> 3.3.10 字符串大小写转换</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3311-%E5%AD%97%E7%AC%A6%E4%B8%B2%E6%A8%A1%E5%BC%8F%E5%8C%B9%E9%85%8D%E6%96%B9%E6%B3%95%E6%9A%82%E7%BC%93"><span class="toc-number">5.3.3.11.</span> <span class="toc-text"> 3.3.11 字符串模式匹配方法（暂缓）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3312-localecompare-%E6%96%B9%E6%B3%95"><span class="toc-number">5.3.3.12.</span> <span class="toc-text"> 3.3.12 localeCompare () 方法</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-%E5%8D%95%E4%BE%8B%E5%86%85%E7%BD%AE%E5%AF%B9%E8%B1%A1"><span class="toc-number">5.4.</span> <span class="toc-text"> 4. 单例内置对象</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#41-global"><span class="toc-number">5.4.1.</span> <span class="toc-text"> 4.1 Global</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#411-url-%E7%BC%96%E7%A0%81%E6%96%B9%E6%B3%95"><span class="toc-number">5.4.1.1.</span> <span class="toc-text"> 4.1.1 URL 编码方法</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#412-eval-%E6%96%B9%E6%B3%95"><span class="toc-number">5.4.1.2.</span> <span class="toc-text"> 4.1.2 eval () 方法</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#413-global-%E5%AF%B9%E8%B1%A1%E5%B1%9E%E6%80%A7"><span class="toc-number">5.4.1.3.</span> <span class="toc-text"> 4.1.3 Global 对象属性</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#414-window-%E5%AF%B9%E8%B1%A1"><span class="toc-number">5.4.1.4.</span> <span class="toc-text"> 4.1.4 window 对象</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#42-math"><span class="toc-number">5.4.2.</span> <span class="toc-text"> 4.2 Math</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#421-math-%E5%AF%B9%E8%B1%A1%E5%B1%9E%E6%80%A7"><span class="toc-number">5.4.2.1.</span> <span class="toc-text"> 4.2.1 Math 对象属性</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#422-min-%E5%92%8C-max-%E6%96%B9%E6%B3%95"><span class="toc-number">5.4.2.2.</span> <span class="toc-text"> 4.2.2 min () 和 max () 方法</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#423-%E8%88%8D%E5%85%A5%E6%96%B9%E6%B3%95"><span class="toc-number">5.4.2.3.</span> <span class="toc-text"> 4.2.3 舍入方法</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#424-random-%E6%96%B9%E6%B3%95"><span class="toc-number">5.4.2.4.</span> <span class="toc-text"> 4.2.4 random () 方法</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#425-%E5%85%B6%E4%BB%96%E6%96%B9%E6%B3%95"><span class="toc-number">5.4.2.5.</span> <span class="toc-text"> 4.2.5 其他方法</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%85%AD-%E9%9B%86%E5%90%88%E5%BC%95%E7%94%A8%E7%B1%BB%E5%9E%8B"><span class="toc-number">6.</span> <span class="toc-text"> 六、 集合引用类型</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-object"><span class="toc-number">6.1.</span> <span class="toc-text"> 1. Object</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-array"><span class="toc-number">6.2.</span> <span class="toc-text"> 2. Array</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#21-%E5%88%9B%E5%BB%BA%E6%95%B0%E7%BB%84from-of"><span class="toc-number">6.2.1.</span> <span class="toc-text"> 2.1 创建数组：from、of</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#211-arrayfrom"><span class="toc-number">6.2.1.1.</span> <span class="toc-text"> 2.1.1 Array.from()</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#212-arrayof"><span class="toc-number">6.2.1.2.</span> <span class="toc-text"> 2.1.2 Array.of()</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#22-%E6%95%B0%E7%BB%84%E7%A9%BA%E4%BD%8D"><span class="toc-number">6.2.2.</span> <span class="toc-text"> 2.2 数组空位</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#23-%E6%95%B0%E7%BB%84%E7%B4%A2%E5%BC%95"><span class="toc-number">6.2.3.</span> <span class="toc-text"> 2.3 数组索引</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#24-%E6%A3%80%E6%B5%8B%E6%95%B0%E7%BB%84isarray"><span class="toc-number">6.2.4.</span> <span class="toc-text"> 2.4 检测数组：isArray</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#25-%E8%BF%AD%E4%BB%A3%E5%99%A8%E6%96%B9%E6%B3%95keys-value-entries"><span class="toc-number">6.2.5.</span> <span class="toc-text"> 2.5 迭代器方法：keys、value、entries</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#26-%E5%A4%8D%E5%88%B6%E5%92%8C%E5%A1%AB%E5%85%85%E6%96%B9%E6%B3%95fill-copywithin"><span class="toc-number">6.2.6.</span> <span class="toc-text"> 2.6 复制和填充方法：fill、copyWithin</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#27-%E8%BD%AC%E6%8D%A2%E6%96%B9%E6%B3%95tolocalestring-tostring-valueof-join"><span class="toc-number">6.2.7.</span> <span class="toc-text"> 2.7 转换方法：toLocaleString、toString、valueOf、join</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#28-%E6%A0%88%E6%96%B9%E6%B3%95push-pop"><span class="toc-number">6.2.8.</span> <span class="toc-text"> 2.8 栈方法：push、pop</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#29-%E9%98%9F%E5%88%97%E6%96%B9%E6%B3%95shift-unshift"><span class="toc-number">6.2.9.</span> <span class="toc-text"> 2.9 队列方法：shift、unshift</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#210-%E6%8E%92%E5%BA%8F%E6%96%B9%E6%B3%95sort-reverse"><span class="toc-number">6.2.10.</span> <span class="toc-text"> 2.10 排序方法：sort、reverse</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#211-%E6%93%8D%E4%BD%9C%E6%96%B9%E6%B3%95concat-slice-splice"><span class="toc-number">6.2.11.</span> <span class="toc-text"> 2.11 操作方法：concat、slice、splice</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#212-%E6%90%9C%E7%B4%A2%E5%92%8C%E4%BD%8D%E7%BD%AE%E6%96%B9%E6%B3%95indexof-lastindexof-includesfind-findindex"><span class="toc-number">6.2.12.</span> <span class="toc-text"> 2.12 搜索和位置方法：indexOf、lastIndexOf、includes|find、findIndex</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#213-%E8%BF%AD%E4%BB%A3%E6%96%B9%E6%B3%95every-filter-foreach-map-some"><span class="toc-number">6.2.13.</span> <span class="toc-text"> 2.13 迭代方法：every、filter、forEach、map、some</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#214-%E5%BD%92%E5%B9%B6%E6%96%B9%E6%B3%95reduce-reduceright"><span class="toc-number">6.2.14.</span> <span class="toc-text"> 2.14 归并方法：reduce、reduceRight</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-%E5%AE%9A%E5%9E%8B%E6%95%B0%E7%BB%84%E6%9A%82%E7%BC%93"><span class="toc-number">6.3.</span> <span class="toc-text"> 3. 定型数组（暂缓）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#31-arraybuffer"><span class="toc-number">6.3.1.</span> <span class="toc-text"> 3.1 ArrayBuffer</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-map"><span class="toc-number">6.4.</span> <span class="toc-text"> 4. Map</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#41-%E5%9F%BA%E6%9C%AC%E7%94%A8%E6%B3%95%E5%8F%8A-api"><span class="toc-number">6.4.1.</span> <span class="toc-text"> 4.1 基本用法及 API</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#42-%E9%A1%BA%E5%BA%8F%E4%B8%8E%E8%BF%AD%E4%BB%A3keys-values-entries"><span class="toc-number">6.4.2.</span> <span class="toc-text"> 4.2 顺序与迭代：keys、values、entries</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#43-%E4%B8%8E-object-%E7%9A%84%E5%8C%BA%E5%88%AB"><span class="toc-number">6.4.3.</span> <span class="toc-text"> 4.3 与 Object 的区别</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-weakmap-%E6%9A%82%E7%BC%93"><span class="toc-number">6.5.</span> <span class="toc-text"> 5. WeakMap (暂缓)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-set"><span class="toc-number">6.6.</span> <span class="toc-text"> 6. Set</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#61-%E5%9F%BA%E6%9C%AC%E7%94%A8%E6%B3%95%E5%8F%8A-api"><span class="toc-number">6.6.1.</span> <span class="toc-text"> 6.1 基本用法及 API</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#62-%E9%A1%BA%E5%BA%8F%E4%B8%8E%E8%BF%AD%E4%BB%A3keys-values-entries"><span class="toc-number">6.6.2.</span> <span class="toc-text"> 6.2 顺序与迭代：keys、values、entries</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#63-%E5%AE%9A%E4%B9%89%E7%B1%BB-set-%E7%B1%BB%E5%9E%8B%E6%9A%82%E7%BC%93"><span class="toc-number">6.6.3.</span> <span class="toc-text"> 6.3 定义类 Set 类型（暂缓）</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7-weakset%E6%9A%82%E7%BC%93"><span class="toc-number">6.7.</span> <span class="toc-text"> 7. WeakSet（暂缓）</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%85%AB-%E5%AF%B9%E8%B1%A1-%E7%B1%BB%E4%B8%8E%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%E7%BC%96%E7%A8%8B"><span class="toc-number">7.</span> <span class="toc-text"> 八、 对象、类与面向对象编程</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-%E7%90%86%E8%A7%A3%E5%AF%B9%E8%B1%A1%E5%AE%9E%E4%BE%8B"><span class="toc-number">7.1.</span> <span class="toc-text"> 1. 理解对象（实例）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#11-%E5%B1%9E%E6%80%A7%E7%9A%84%E7%B1%BB%E5%9E%8B"><span class="toc-number">7.1.1.</span> <span class="toc-text"> 1.1 属性的类型</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#111-%E6%95%B0%E6%8D%AE%E5%B1%9E%E6%80%A7"><span class="toc-number">7.1.1.1.</span> <span class="toc-text"> 1.1.1 数据属性</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#112-%E8%AE%BF%E9%97%AE%E5%99%A8%E5%B1%9E%E6%80%A7"><span class="toc-number">7.1.1.2.</span> <span class="toc-text"> 1.1.2 访问器属性</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#12-%E5%AE%9A%E4%B9%89%E5%A4%9A%E4%B8%AA%E5%B1%9E%E6%80%A7"><span class="toc-number">7.1.2.</span> <span class="toc-text"> 1.2 定义多个属性</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#13-%E8%AF%BB%E5%8F%96%E5%B1%9E%E6%80%A7%E7%9A%84%E7%89%B9%E6%80%A7"><span class="toc-number">7.1.3.</span> <span class="toc-text"> 1.3 读取属性的特性</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#14-%E5%90%88%E5%B9%B6%E5%AF%B9%E8%B1%A1"><span class="toc-number">7.1.4.</span> <span class="toc-text"> 1.4 合并对象</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#15-%E5%AF%B9%E8%B1%A1%E6%A0%87%E8%AF%86%E5%8F%8A%E7%9B%B8%E7%AD%89%E5%88%A4%E5%AE%9A"><span class="toc-number">7.1.5.</span> <span class="toc-text"> 1.5 对象标识及相等判定</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#16-%E5%A2%9E%E5%BC%BA%E7%9A%84%E5%AF%B9%E8%B1%A1%E8%AF%AD%E6%B3%95"><span class="toc-number">7.1.6.</span> <span class="toc-text"> 1.6 增强的对象语法</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#161-%E5%B1%9E%E6%80%A7%E5%80%BC%E7%AE%80%E5%86%99"><span class="toc-number">7.1.6.1.</span> <span class="toc-text"> 1.6.1 属性值简写</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#162-%E5%8F%AF%E8%AE%A1%E7%AE%97%E5%B1%9E%E6%80%A7"><span class="toc-number">7.1.6.2.</span> <span class="toc-text"> 1.6.2 可计算属性</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#163-%E7%AE%80%E5%86%99%E6%96%B9%E6%B3%95%E5%90%8D"><span class="toc-number">7.1.6.3.</span> <span class="toc-text"> 1.6.3 简写方法名</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#17-%E5%AF%B9%E8%B1%A1%E8%A7%A3%E6%9E%84"><span class="toc-number">7.1.7.</span> <span class="toc-text"> 1.7 对象解构</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#171-%E5%B5%8C%E5%A5%97%E8%A7%A3%E6%9E%84"><span class="toc-number">7.1.7.1.</span> <span class="toc-text"> 1.7.1 嵌套解构</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#172-%E9%83%A8%E5%88%86%E8%A7%A3%E6%9E%84"><span class="toc-number">7.1.7.2.</span> <span class="toc-text"> 1.7.2 部分解构</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#173-%E5%8F%82%E6%95%B0%E4%B8%8A%E4%B8%8B%E6%96%87%E5%8C%B9%E9%85%8D"><span class="toc-number">7.1.7.3.</span> <span class="toc-text"> 1.7.3 参数上下文匹配</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-%E5%88%9B%E5%BB%BA%E5%AF%B9%E8%B1%A1%E4%BC%AA%E7%B1%BB"><span class="toc-number">7.2.</span> <span class="toc-text"> 2. 创建对象（伪类）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#21-%E6%A6%82%E8%BF%B0"><span class="toc-number">7.2.1.</span> <span class="toc-text"> 2.1 概述</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#22-%E5%B7%A5%E5%8E%82%E6%A8%A1%E5%BC%8F"><span class="toc-number">7.2.2.</span> <span class="toc-text"> 2.2 工厂模式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#23-%E6%9E%84%E9%80%A0%E5%87%BD%E6%95%B0%E6%A8%A1%E5%BC%8F"><span class="toc-number">7.2.3.</span> <span class="toc-text"> 2.3 构造函数模式</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#231-%E6%9E%84%E9%80%A0%E5%87%BD%E6%95%B0%E4%B9%9F%E6%98%AF%E5%87%BD%E6%95%B0"><span class="toc-number">7.2.3.1.</span> <span class="toc-text"> 2.3.1 构造函数也是函数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#232-%E6%9E%84%E9%80%A0%E5%87%BD%E6%95%B0%E7%9A%84%E9%97%AE%E9%A2%98"><span class="toc-number">7.2.3.2.</span> <span class="toc-text"> 2.3.2 构造函数的问题</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#24-%E5%8E%9F%E5%9E%8B%E6%A8%A1%E5%BC%8F"><span class="toc-number">7.2.4.</span> <span class="toc-text"> 2.4 原型模式</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#241-%E7%90%86%E8%A7%A3%E5%8E%9F%E5%9E%8B"><span class="toc-number">7.2.4.1.</span> <span class="toc-text"> 2.4.1 理解原型</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#242-%E5%8E%9F%E5%9E%8B%E5%B1%82%E7%BA%A7"><span class="toc-number">7.2.4.2.</span> <span class="toc-text"> 2.4.2 原型层级</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#243-%E5%8E%9F%E5%9E%8B%E5%92%8C-in-%E6%93%8D%E4%BD%9C%E7%AC%A6"><span class="toc-number">7.2.4.3.</span> <span class="toc-text"> 2.4.3 原型和 in 操作符</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#244-%E5%B1%9E%E6%80%A7%E6%9E%9A%E4%B8%BE"><span class="toc-number">7.2.4.4.</span> <span class="toc-text"> 2.4.4 属性枚举</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#25-%E5%AF%B9%E8%B1%A1%E8%BF%AD%E4%BB%A3"><span class="toc-number">7.2.5.</span> <span class="toc-text"> 2.5 对象迭代</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#251-%E5%85%B6%E4%BB%96%E5%8E%9F%E5%9E%8B%E8%AF%AD%E6%B3%95"><span class="toc-number">7.2.5.1.</span> <span class="toc-text"> 2.5.1 其他原型语法</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#252-%E5%8E%9F%E5%9E%8B%E7%9A%84%E5%8A%A8%E6%80%81%E6%80%A7"><span class="toc-number">7.2.5.2.</span> <span class="toc-text"> 2.5.2 原型的动态性</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#253-%E5%8E%9F%E7%94%9F%E5%AF%B9%E8%B1%A1%E5%8E%9F%E5%9E%8B"><span class="toc-number">7.2.5.3.</span> <span class="toc-text"> 2.5.3 原生对象原型</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#254-%E5%8E%9F%E5%9E%8B%E7%9A%84%E9%97%AE%E9%A2%98"><span class="toc-number">7.2.5.4.</span> <span class="toc-text"> 2.5.4 原型的问题</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-%E7%BB%A7%E6%89%BF"><span class="toc-number">7.3.</span> <span class="toc-text"> 3. 继承</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#31-%E5%8E%9F%E5%9E%8B%E9%93%BE"><span class="toc-number">7.3.1.</span> <span class="toc-text"> 3.1 原型链</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#311-%E9%BB%98%E8%AE%A4%E5%8E%9F%E5%9E%8B"><span class="toc-number">7.3.1.1.</span> <span class="toc-text"> 3.1.1 默认原型</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#312-%E5%8E%9F%E5%9E%8B%E4%B8%8E%E7%BB%A7%E6%89%BF%E5%85%B3%E7%B3%BB"><span class="toc-number">7.3.1.2.</span> <span class="toc-text"> 3.1.2 原型与继承关系</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#313-%E5%85%B3%E4%BA%8E%E6%96%B9%E6%B3%95"><span class="toc-number">7.3.1.3.</span> <span class="toc-text"> 3.1.3 关于方法</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#314-%E5%8E%9F%E5%9E%8B%E9%93%BE%E7%9A%84%E9%97%AE%E9%A2%98"><span class="toc-number">7.3.1.4.</span> <span class="toc-text"> 3.1.4 原型链的问题</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#32-%E7%9B%97%E7%94%A8%E6%9E%84%E9%80%A0%E5%87%BD%E6%95%B0"><span class="toc-number">7.3.2.</span> <span class="toc-text"> 3.2 盗用构造函数</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#321-%E4%BC%A0%E9%80%92%E5%8F%82%E6%95%B0"><span class="toc-number">7.3.2.1.</span> <span class="toc-text"> 3.2.1 传递参数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#322-%E7%9B%97%E7%94%A8%E6%9E%84%E9%80%A0%E5%87%BD%E6%95%B0%E7%9A%84%E9%97%AE%E9%A2%98"><span class="toc-number">7.3.2.2.</span> <span class="toc-text"> 3.2.2 盗用构造函数的问题</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#33-%E7%BB%84%E5%90%88%E7%BB%A7%E6%89%BF"><span class="toc-number">7.3.3.</span> <span class="toc-text"> 3.3 组合继承</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#34-%E5%8E%9F%E5%9E%8B%E5%BC%8F%E7%BB%A7%E6%89%BF"><span class="toc-number">7.3.4.</span> <span class="toc-text"> 3.4 原型式继承</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#35-%E5%AF%84%E7%94%9F%E5%BC%8F%E7%BB%A7%E6%89%BF"><span class="toc-number">7.3.5.</span> <span class="toc-text"> 3.5 寄生式继承</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#36-%E5%AF%84%E7%94%9F%E5%BC%8F%E7%BB%84%E5%90%88%E7%BB%A7%E6%89%BF"><span class="toc-number">7.3.6.</span> <span class="toc-text"> 3.6 寄生式组合继承</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-%E7%B1%BB"><span class="toc-number">7.4.</span> <span class="toc-text"> 4. 类</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#41-%E7%B1%BB%E5%AE%9A%E4%B9%89"><span class="toc-number">7.4.1.</span> <span class="toc-text"> 4.1 类定义</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#42-%E7%B1%BB%E6%9E%84%E9%80%A0%E5%87%BD%E6%95%B0"><span class="toc-number">7.4.2.</span> <span class="toc-text"> 4.2 类构造函数</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#421-%E5%AE%9E%E4%BE%8B%E5%8C%96"><span class="toc-number">7.4.2.1.</span> <span class="toc-text"> 4.2.1 实例化</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#422-%E6%8A%8A%E7%B1%BB%E5%BD%93%E6%88%90%E7%89%B9%E6%AE%8A%E7%9A%84%E5%87%BD%E6%95%B0"><span class="toc-number">7.4.2.2.</span> <span class="toc-text"> 4.2.2 把类当成特殊的函数</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#43-%E5%AE%9E%E4%BE%8B-%E5%8E%9F%E5%9E%8B%E5%92%8C%E7%B1%BB%E6%88%90%E5%91%98"><span class="toc-number">7.4.3.</span> <span class="toc-text"> 4.3 实例、原型和类成员</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#431-%E5%AE%9E%E4%BE%8B%E6%88%90%E5%91%98"><span class="toc-number">7.4.3.1.</span> <span class="toc-text"> 4.3.1 实例成员</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#432-%E5%8E%9F%E5%9E%8B%E6%96%B9%E6%B3%95%E4%B8%8E%E8%AE%BF%E9%97%AE%E5%99%A8"><span class="toc-number">7.4.3.2.</span> <span class="toc-text"> 4.3.2 原型方法与访问器</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#433-%E9%9D%99%E6%80%81%E7%B1%BB%E6%96%B9%E6%B3%95"><span class="toc-number">7.4.3.3.</span> <span class="toc-text"> 4.3.3 静态类方法</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#434-%E9%9D%9E%E5%87%BD%E6%95%B0%E5%8E%9F%E5%9E%8B%E5%92%8C%E7%B1%BB%E6%88%90%E5%91%98"><span class="toc-number">7.4.3.4.</span> <span class="toc-text"> 4.3.4 非函数原型和类成员</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#435-%E8%BF%AD%E4%BB%A3%E5%99%A8%E4%B8%8E%E7%94%9F%E6%88%90%E5%99%A8%E7%9A%84%E6%96%B9%E6%B3%95%E6%9A%82%E7%BC%93%E8%BF%AD%E4%BB%A3%E5%99%A8%E5%92%8C%E7%94%9F%E6%88%90%E5%99%A8%E8%BF%98%E6%B2%A1%E7%9C%8B"><span class="toc-number">7.4.3.5.</span> <span class="toc-text"> 4.3.5 迭代器与生成器的方法（暂缓，迭代器和生成器还没看）</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#44-%E7%BB%A7%E6%89%BF"><span class="toc-number">7.4.4.</span> <span class="toc-text"> 4.4 继承</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#441-%E7%BB%A7%E6%89%BF%E5%9F%BA%E7%A1%80"><span class="toc-number">7.4.4.1.</span> <span class="toc-text"> 4.4.1 继承基础</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#442-%E6%9E%84%E9%80%A0%E5%87%BD%E6%95%B0-homeobject-%E5%92%8C-super"><span class="toc-number">7.4.4.2.</span> <span class="toc-text"> 4.4.2 构造函数、HomeObject 和 super ()</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#443-%E6%8A%BD%E8%B1%A1%E5%9F%BA%E7%B1%BB%E6%8A%BD%E8%B1%A1%E7%B1%BB-%E6%8E%A5%E5%8F%A3"><span class="toc-number">7.4.4.3.</span> <span class="toc-text"> 4.4.3 抽象基类（抽象类、接口）</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-%E4%B8%8D%E8%A2%AB%E5%AE%9E%E4%BE%8B%E5%8C%96"><span class="toc-number">7.4.4.3.1.</span> <span class="toc-text"> 1. 不被实例化</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-%E4%B8%80%E5%AE%9A%E8%A6%81%E8%A2%AB%E5%AE%9E%E7%8E%B0%E7%9A%84%E6%8A%BD%E8%B1%A1%E5%87%BD%E6%95%B0"><span class="toc-number">7.4.4.3.2.</span> <span class="toc-text"> 2. 一定要被实现的抽象函数</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#444-%E7%BB%A7%E6%89%BF%E5%86%85%E7%BD%AE%E7%B1%BB%E5%9E%8B"><span class="toc-number">7.4.4.4.</span> <span class="toc-text"> 4.4.4 继承内置类型</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#445-%E7%B1%BB%E6%B7%B7%E5%85%A5%E5%A4%9A%E7%BB%A7%E6%89%BF"><span class="toc-number">7.4.4.5.</span> <span class="toc-text"> 4.4.5 类混入（多继承）</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B9%9D-%E5%8F%8D%E5%B0%84%E4%B8%8E%E4%BB%A3%E7%90%86"><span class="toc-number">8.</span> <span class="toc-text"> 九、 反射与代理</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%8D%81-%E5%87%BD%E6%95%B0"><span class="toc-number">9.</span> <span class="toc-text"> 十、 函数</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-%E7%AE%AD%E5%A4%B4%E5%87%BD%E6%95%B0es6-%E6%96%B0%E5%A2%9E"><span class="toc-number">9.1.</span> <span class="toc-text"> 1. 箭头函数（ES6 新增）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-%E5%87%BD%E6%95%B0%E5%90%8D"><span class="toc-number">9.2.</span> <span class="toc-text"> 2. 函数名</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-%E7%90%86%E8%A7%A3%E5%8F%82%E6%95%B0"><span class="toc-number">9.3.</span> <span class="toc-text"> 3. 理解参数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-%E6%B2%A1%E6%9C%89%E9%87%8D%E8%BD%BD"><span class="toc-number">9.4.</span> <span class="toc-text"> 4. 没有重载</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-%E9%BB%98%E8%AE%A4%E5%8F%82%E6%95%B0%E5%80%BC"><span class="toc-number">9.5.</span> <span class="toc-text"> 5. 默认参数值</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-%E5%8F%82%E6%95%B0%E6%89%A9%E5%B1%95%E4%B8%8E%E6%94%B6%E9%9B%86"><span class="toc-number">9.6.</span> <span class="toc-text"> 6. 参数扩展与收集</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#61-%E6%89%A9%E5%B1%95%E5%8F%82%E6%95%B0"><span class="toc-number">9.6.1.</span> <span class="toc-text"> 6.1 扩展参数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#62-%E6%94%B6%E9%9B%86%E5%8F%82%E6%95%B0"><span class="toc-number">9.6.2.</span> <span class="toc-text"> 6.2 收集参数</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7-%E5%87%BD%E6%95%B0%E5%A3%B0%E6%98%8E%E4%B8%8E%E5%87%BD%E6%95%B0%E8%A1%A8%E8%BE%BE%E5%BC%8F"><span class="toc-number">9.7.</span> <span class="toc-text"> 7. 函数声明与函数表达式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8-%E5%87%BD%E6%95%B0%E4%BD%9C%E4%B8%BA%E5%80%BC"><span class="toc-number">9.8.</span> <span class="toc-text"> 8. 函数作为值</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#9-%E5%87%BD%E6%95%B0%E5%86%85%E9%83%A8"><span class="toc-number">9.9.</span> <span class="toc-text"> 9. 函数内部</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#91-arguments"><span class="toc-number">9.9.1.</span> <span class="toc-text"> 9.1 arguments</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#92-this"><span class="toc-number">9.9.2.</span> <span class="toc-text"> 9.2 this</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#93-caller"><span class="toc-number">9.9.3.</span> <span class="toc-text"> 9.3 caller</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#94-newtarget"><span class="toc-number">9.9.4.</span> <span class="toc-text"> 9.4 new.target</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#10-%E5%87%BD%E6%95%B0%E5%B1%9E%E6%80%A7%E4%B8%8E%E6%96%B9%E6%B3%95"><span class="toc-number">9.10.</span> <span class="toc-text"> 10. 函数属性与方法</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#11-%E5%87%BD%E6%95%B0%E8%A1%A8%E8%BE%BE%E5%BC%8F"><span class="toc-number">9.11.</span> <span class="toc-text"> 11. 函数表达式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#12-%E9%80%92%E5%BD%92"><span class="toc-number">9.12.</span> <span class="toc-text"> 12. 递归</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#13-%E5%B0%BE%E8%B0%83%E7%94%A8%E4%BC%98%E5%8C%96es6-%E6%96%B0%E5%A2%9E"><span class="toc-number">9.13.</span> <span class="toc-text"> 13. 尾调用优化（ES6 新增）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#14-%E9%97%AD%E5%8C%85"><span class="toc-number">9.14.</span> <span class="toc-text"> 14. 闭包</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#141-this-%E5%AF%B9%E8%B1%A1"><span class="toc-number">9.14.1.</span> <span class="toc-text"> 14.1 this 对象</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#142-%E5%86%85%E5%AD%98%E6%B3%84%E6%BC%8F"><span class="toc-number">9.14.2.</span> <span class="toc-text"> 14.2 内存泄漏</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#15-%E7%AB%8B%E5%8D%B3%E8%B0%83%E7%94%A8%E7%9A%84%E5%87%BD%E6%95%B0%E8%A1%A8%E8%BE%BE%E5%BC%8F"><span class="toc-number">9.15.</span> <span class="toc-text"> 15. 立即调用的函数表达式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#16-%E7%A7%81%E6%9C%89%E5%8F%98%E9%87%8F"><span class="toc-number">9.16.</span> <span class="toc-text"> 16. 私有变量</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#161-%E9%9D%99%E6%80%81%E7%A7%81%E6%9C%89%E5%8F%98%E9%87%8F"><span class="toc-number">9.16.1.</span> <span class="toc-text"> 16.1 静态私有变量</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#162-%E6%A8%A1%E5%9D%97%E6%A8%A1%E5%BC%8F"><span class="toc-number">9.16.2.</span> <span class="toc-text"> 16.2 模块模式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#163-%E6%A8%A1%E5%9D%97%E5%A2%9E%E5%BC%BA%E6%A8%A1%E5%BC%8F"><span class="toc-number">9.16.3.</span> <span class="toc-text"> 16.3 模块增强模式</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%8D%81%E4%B8%80-%E6%9C%9F%E7%BA%A6%E4%B8%8E%E5%BC%82%E6%AD%A5%E5%87%BD%E6%95%B0promise"><span class="toc-number">10.</span> <span class="toc-text"> 十一、 期约与异步函数（promise）</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-%E5%BC%82%E6%AD%A5%E7%BC%96%E7%A8%8Bsettimeout"><span class="toc-number">10.1.</span> <span class="toc-text"> 1. 异步编程（setTimeout）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#11-%E5%90%8C%E6%AD%A5%E4%B8%8E%E5%BC%82%E6%AD%A5"><span class="toc-number">10.1.1.</span> <span class="toc-text"> 1.1 同步与异步</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#12-settimeout-%E5%BC%82%E6%AD%A5"><span class="toc-number">10.1.2.</span> <span class="toc-text"> 1.2 setTimeout 异步</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#13-settimeout-%E8%AF%AD%E6%B3%95"><span class="toc-number">10.1.3.</span> <span class="toc-text"> 1.3 setTimeout 语法</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-%E6%9C%9F%E7%BA%A6promisees6-%E6%96%B0%E5%A2%9E"><span class="toc-number">10.2.</span> <span class="toc-text"> 2. 期约（promise）（ES6 新增）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#21-%E6%9C%9F%E7%BA%A6%E5%9F%BA%E7%A1%80"><span class="toc-number">10.2.1.</span> <span class="toc-text"> 2.1 期约基础</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#211-%E6%9C%9F%E7%BA%A6%E7%9A%84%E4%B8%89%E7%A7%8D%E7%8A%B6%E6%80%81"><span class="toc-number">10.2.1.1.</span> <span class="toc-text"> 2.1.1 期约的三种状态</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#212-promiseresolve"><span class="toc-number">10.2.1.2.</span> <span class="toc-text"> 2.1.2  Promise.resolve()</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#213-promisereject"><span class="toc-number">10.2.1.3.</span> <span class="toc-text"> 2.1.3   Promise.reject()</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#214-new-promise-%E8%AF%A6%E8%A7%A3"><span class="toc-number">10.2.1.4.</span> <span class="toc-text"> 2.1.4  new Promise()  详解</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#215-%E5%BC%82%E6%AD%A5%E7%9A%84%E9%94%99%E8%AF%AF%E5%A4%84%E7%90%86"><span class="toc-number">10.2.1.5.</span> <span class="toc-text"> 2.1.5 异步的错误处理</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#22-%E6%9C%9F%E7%BA%A6%E7%9A%84%E5%AE%9E%E4%BE%8B%E6%96%B9%E6%B3%95"><span class="toc-number">10.2.2.</span> <span class="toc-text"> 2.2 期约的实例方法</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#221-promiseprototypethen"><span class="toc-number">10.2.2.1.</span> <span class="toc-text"> 2.2.1  Promise.prototype.then()</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#222-promiseprototypecatch"><span class="toc-number">10.2.2.2.</span> <span class="toc-text"> 2.2.2  Promise.prototype.catch()</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#223-promiseprototypefinally"><span class="toc-number">10.2.2.3.</span> <span class="toc-text"> 2.2.3  Promise.prototype.finally()</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#224-%E9%9D%9E%E9%87%8D%E5%85%A5%E6%9C%9F%E7%BA%A6%E6%96%B9%E6%B3%95%E6%89%A7%E8%A1%8C%E9%A1%BA%E5%BA%8F"><span class="toc-number">10.2.2.4.</span> <span class="toc-text"> 2.2.4 非重入期约方法（执行顺序）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#225-%E9%82%BB%E8%BF%91%E5%A4%84%E7%90%86%E7%A8%8B%E5%BA%8F%E7%9A%84%E6%89%A7%E8%A1%8C%E9%A1%BA%E5%BA%8F%E6%89%A7%E8%A1%8C%E9%A1%BA%E5%BA%8F-2"><span class="toc-number">10.2.2.5.</span> <span class="toc-text"> 2.2.5 邻近处理程序的执行顺序（执行顺序 2）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#226-%E4%BC%A0%E9%80%92%E8%A7%A3%E5%86%B3%E5%80%BC%E5%92%8C%E6%8B%92%E7%BB%9D%E7%90%86%E7%94%B1"><span class="toc-number">10.2.2.6.</span> <span class="toc-text"> 2.2.6 传递解决值和拒绝理由</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#227-%E6%8B%92%E7%BB%9D%E6%9C%9F%E7%BA%A6%E4%B8%8E%E6%8B%92%E7%BB%9D%E9%94%99%E8%AF%AF%E5%A4%84%E7%90%86"><span class="toc-number">10.2.2.7.</span> <span class="toc-text"> 2.2.7 拒绝期约与拒绝错误处理</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#23-%E6%9C%9F%E7%BA%A6%E8%BF%9E%E9%94%81%E4%B8%8E%E6%9C%9F%E7%BA%A6%E5%90%88%E6%88%90"><span class="toc-number">10.2.3.</span> <span class="toc-text"> 2.3 期约连锁与期约合成</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#231-%E6%9C%9F%E7%BA%A6%E8%BF%9E%E9%94%81"><span class="toc-number">10.2.3.1.</span> <span class="toc-text"> 2.3.1 期约连锁</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#232-%E6%9C%9F%E7%BA%A6%E5%9B%BE"><span class="toc-number">10.2.3.2.</span> <span class="toc-text"> 2.3.2 期约图</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#233-promiseall-%E5%92%8C-promiserace"><span class="toc-number">10.2.3.3.</span> <span class="toc-text"> 2.3.3  Promise.all()  和 Promise.race()</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#234-%E4%B8%B2%E8%A1%8C%E6%9C%9F%E7%BA%A6%E7%9A%84%E5%90%88%E6%88%90"><span class="toc-number">10.2.3.4.</span> <span class="toc-text"> 2.3.4 串行期约的合成</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#24-%E6%9C%9F%E7%BA%A6%E6%89%A9%E5%B1%95"><span class="toc-number">10.2.4.</span> <span class="toc-text"> 2.4 期约扩展</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#241-%E6%9C%9F%E7%BA%A6%E5%8F%96%E6%B6%88%E6%9A%82%E7%BC%93"><span class="toc-number">10.2.4.1.</span> <span class="toc-text"> 2.4.1 期约取消（暂缓）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#242-%E6%9C%9F%E7%BA%A6%E8%BF%9B%E5%BA%A6%E9%80%9A%E7%9F%A5%E6%9A%82%E7%BC%93"><span class="toc-number">10.2.4.2.</span> <span class="toc-text"> 2.4.2 期约进度通知（暂缓）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#es6-%E4%B8%8D%E6%94%AF%E6%8C%81%E5%8F%96%E6%B6%88%E6%9C%9F%E7%BA%A6%E5%92%8C%E8%BF%9B%E5%BA%A6%E9%80%9A%E7%9F%A5"><span class="toc-number">10.2.4.3.</span> <span class="toc-text"> ES6 不支持取消期约和进度通知</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-%E5%BC%82%E6%AD%A5%E5%87%BD%E6%95%B0async"><span class="toc-number">10.3.</span> <span class="toc-text"> 3. 异步函数（async）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#31-%E5%BC%82%E6%AD%A5%E5%87%BD%E6%95%B0"><span class="toc-number">10.3.1.</span> <span class="toc-text"> 3.1 异步函数</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#311-async"><span class="toc-number">10.3.1.1.</span> <span class="toc-text"> 3.1.1 async</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#312-await%E7%AD%89%E5%BE%85"><span class="toc-number">10.3.1.2.</span> <span class="toc-text"> 3.1.2 await（等待）</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#32-%E5%81%9C%E6%AD%A2%E5%92%8C%E6%81%A2%E5%A4%8D%E6%89%A7%E8%A1%8C"><span class="toc-number">10.3.2.</span> <span class="toc-text"> 3.2 停止和恢复执行</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#33-%E5%BC%82%E6%AD%A5%E5%87%BD%E6%95%B0%E7%AD%96%E7%95%A5"><span class="toc-number">10.3.3.</span> <span class="toc-text"> 3.3 异步函数策略</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#331-sleep"><span class="toc-number">10.3.3.1.</span> <span class="toc-text"> 3.3.1  sleep()</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#332-%E5%88%A9%E7%94%A8%E5%B9%B3%E8%A1%8C%E6%89%A7%E8%A1%8C"><span class="toc-number">10.3.3.2.</span> <span class="toc-text"> 3.3.2 利用平行执行</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#333-%E4%B8%B2%E8%A1%8C%E6%89%A7%E8%A1%8C%E6%9C%9F%E7%BA%A6"><span class="toc-number">10.3.3.3.</span> <span class="toc-text"> 3.3.3 串行执行期约</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#334-%E6%A0%88%E8%BF%BD%E8%B8%AA%E4%B8%8E%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86"><span class="toc-number">10.3.3.4.</span> <span class="toc-text"> 3.3.4 栈追踪与内存管理</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%8D%81%E4%BA%8C-bom"><span class="toc-number">11.</span> <span class="toc-text"> 十二、 BOM</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-window-%E5%AF%B9%E8%B1%A1"><span class="toc-number">11.1.</span> <span class="toc-text"> 1. window 对象</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#11-global-%E4%BD%9C%E7%94%A8%E5%9F%9F"><span class="toc-number">11.1.1.</span> <span class="toc-text"> 1.1 Global 作用域</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#12-ltspan-id-quot%E7%AA%97%E5%8F%A3%E5%85%B3%E7%B3%BBquotgt-%E7%AA%97%E5%8F%A3%E5%85%B3%E7%B3%BB-ltspangt"><span class="toc-number">11.1.2.</span> <span class="toc-text"> 1.2 &lt;span id &#x3D; &quot;窗口关系&quot;&gt; 窗口关系 &lt;&#x2F;span&gt;</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#13-ltspan-id-quot%E7%AA%97%E5%8F%A3%E4%BD%8D%E7%BD%AE%E4%B8%8E%E5%83%8F%E7%B4%A0%E6%AF%94quotgt-%E7%AA%97%E5%8F%A3%E4%BD%8D%E7%BD%AE%E4%B8%8E%E5%83%8F%E7%B4%A0%E6%AF%94-ltspangt"><span class="toc-number">11.1.3.</span> <span class="toc-text"> 1.3 &lt;span id &#x3D; &quot;窗口位置与像素比&quot;&gt; 窗口位置与像素比 &lt;&#x2F;span&gt;</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#14-ltspan-id-quot%E7%AA%97%E5%8F%A3%E5%A4%A7%E5%B0%8Fquotgt-%E7%AA%97%E5%8F%A3%E5%A4%A7%E5%B0%8F-ltspangt"><span class="toc-number">11.1.4.</span> <span class="toc-text"> 1.4 &lt;span id &#x3D; &quot;窗口大小&quot;&gt; 窗口大小 &lt;&#x2F;span&gt;</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#15-ltspan-id-quot%E8%A7%86%E5%8F%A3%E4%BD%8D%E7%BD%AEquotgt-%E8%A7%86%E5%8F%A3%E4%BD%8D%E7%BD%AE-ltspangt"><span class="toc-number">11.1.5.</span> <span class="toc-text"> 1.5 &lt;span id &#x3D; &quot;视口位置&quot;&gt; 视口位置 &lt;&#x2F;span&gt;</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#16-ltspan-id-quot%E5%AF%BC%E8%88%AA%E4%B8%8E%E6%89%93%E5%BC%80%E6%96%B0%E7%AA%97%E5%8F%A3quotgt-%E5%AF%BC%E8%88%AA%E4%B8%8E%E6%89%93%E5%BC%80%E6%96%B0%E7%AA%97%E5%8F%A3-ltspangt"><span class="toc-number">11.1.6.</span> <span class="toc-text"> 1.6 &lt;span id &#x3D; &quot;导航与打开新窗口&quot;&gt; 导航与打开新窗口 &lt;&#x2F;span&gt;</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#17-ltspan-id-quot%E5%AE%9A%E6%97%B6%E5%99%A8quotgt-%E5%AE%9A%E6%97%B6%E5%99%A8-ltspangt"><span class="toc-number">11.1.7.</span> <span class="toc-text"> 1.7 &lt;span id &#x3D; &quot;定时器&quot;&gt; 定时器 &lt;&#x2F;span&gt;</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#18-ltspan-id-quot%E7%B3%BB%E7%BB%9F%E5%AF%B9%E8%AF%9D%E6%A1%86quotgt-%E7%B3%BB%E7%BB%9F%E5%AF%B9%E8%AF%9D%E6%A1%86-ltspangt"><span class="toc-number">11.1.8.</span> <span class="toc-text"> 1.8 &lt;span id &#x3D; &quot;系统对话框&quot;&gt; 系统对话框 &lt;&#x2F;span&gt;</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-location-%E5%AF%B9%E8%B1%A1"><span class="toc-number">11.2.</span> <span class="toc-text"> 2. location 对象</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#21-%E6%9F%A5%E8%AF%A2%E5%AD%97%E7%AC%A6%E4%B8%B2"><span class="toc-number">11.2.1.</span> <span class="toc-text"> 2.1 查询字符串</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#22-%E6%93%8D%E4%BD%9C%E5%9C%B0%E5%9D%80"><span class="toc-number">11.2.2.</span> <span class="toc-text"> 2.2 操作地址</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-navigator-%E5%AF%B9%E8%B1%A1"><span class="toc-number">11.3.</span> <span class="toc-text"> 3. navigator 对象</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-screen-%E5%AF%B9%E8%B1%A1"><span class="toc-number">11.4.</span> <span class="toc-text"> 4. screen 对象</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-history-%E5%AF%B9%E8%B1%A1"><span class="toc-number">11.5.</span> <span class="toc-text"> 5. history 对象</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#51-%E5%AF%BC%E8%88%AA"><span class="toc-number">11.5.1.</span> <span class="toc-text"> 5.1 导航</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#52-%E5%8E%86%E5%8F%B2%E7%8A%B6%E6%80%81%E7%AE%A1%E7%90%86%E7%9C%8B%E4%B8%8D%E6%87%82"><span class="toc-number">11.5.2.</span> <span class="toc-text"> 5.2 历史状态管理（看不懂）</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%8D%81%E4%B8%89-%E5%AE%A2%E6%88%B7%E7%AB%AF%E6%A3%80%E6%B5%8B%E6%9A%82%E7%BC%93"><span class="toc-number">12.</span> <span class="toc-text"> 十三、 客户端检测（暂缓）</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%8D%81%E5%9B%9B-dom"><span class="toc-number">13.</span> <span class="toc-text"> 十四、 DOM</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-%E8%8A%82%E7%82%B9%E5%B1%82%E7%BA%A7"><span class="toc-number">13.1.</span> <span class="toc-text"> 1. 节点层级</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#11-node-%E7%B1%BB%E5%9E%8B"><span class="toc-number">13.1.1.</span> <span class="toc-text"> 1.1 Node 类型</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#111-nodename-%E5%92%8C-nodevalue"><span class="toc-number">13.1.1.1.</span> <span class="toc-text"> 1.1.1 nodeName 和 nodeValue</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#112-ltspan-id-quot%E8%8A%82%E7%82%B9%E5%85%B3%E7%B3%BBquotgt-%E8%8A%82%E7%82%B9%E5%85%B3%E7%B3%BB-ltspangt"><span class="toc-number">13.1.1.2.</span> <span class="toc-text"> 1.1.2 &lt;span id &#x3D; &quot;节点关系&quot;&gt; 节点关系 &lt;&#x2F;span&gt;</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#113-ltspan-id-quot%E6%93%8D%E4%BD%9C%E8%8A%82%E7%82%B9quotgt-%E6%93%8D%E4%BD%9C%E8%8A%82%E7%82%B9-ltspangt"><span class="toc-number">13.1.1.3.</span> <span class="toc-text"> 1.1.3 &lt;span id &#x3D; &quot;操作节点&quot;&gt; 操作节点 &lt;&#x2F;span&gt;</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#114-%E5%85%B6%E4%BB%96%E6%96%B9%E6%B3%95"><span class="toc-number">13.1.1.4.</span> <span class="toc-text"> 1.1.4 其他方法</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#12-document-%E7%B1%BB%E5%9E%8B"><span class="toc-number">13.1.2.</span> <span class="toc-text"> 1.2 document 类型</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#121-%E8%8E%B7%E5%8F%96%E6%96%87%E6%A1%A3%E5%AD%90%E8%8A%82%E7%82%B9"><span class="toc-number">13.1.2.1.</span> <span class="toc-text"> 1.2.1 获取文档子节点</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#122-%E6%96%87%E6%A1%A3%E4%BF%A1%E6%81%AF"><span class="toc-number">13.1.2.2.</span> <span class="toc-text"> 1.2.2 文档信息</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#123-%E5%AE%9A%E4%BD%8D%E5%85%83%E7%B4%A0%E8%8E%B7%E5%8F%96%E5%85%83%E7%B4%A0%E8%8A%82%E7%82%B9"><span class="toc-number">13.1.2.3.</span> <span class="toc-text"> 1.2.3 定位元素（获取元素节点）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#124-%E7%89%B9%E6%AE%8A%E9%9B%86%E5%90%88%E5%85%83%E7%B4%A0%E8%8A%82%E7%82%B9%E6%95%B0%E7%BB%84"><span class="toc-number">13.1.2.4.</span> <span class="toc-text"> 1.2.4 特殊集合（元素节点数组）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#125-dom-%E5%85%BC%E5%AE%B9%E6%80%A7%E6%A3%80%E6%B5%8B"><span class="toc-number">13.1.2.5.</span> <span class="toc-text"> 1.2.5 DOM 兼容性检测</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BA%8C%E5%8D%81%E4%B8%89-json"><span class="toc-number">14.</span> <span class="toc-text"> 二十三、 JSON</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-%E8%AF%AD%E6%B3%95"><span class="toc-number">14.1.</span> <span class="toc-text"> 1. 语法</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#11-%E7%AE%80%E5%8D%95%E5%80%BC"><span class="toc-number">14.1.1.</span> <span class="toc-text"> 1.1 简单值</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#12-%E5%AF%B9%E8%B1%A1"><span class="toc-number">14.1.2.</span> <span class="toc-text"> 1.2 对象</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#13-%E6%95%B0%E7%BB%84"><span class="toc-number">14.1.3.</span> <span class="toc-text"> 1.3 数组</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-%E8%A7%A3%E6%9E%90%E4%B8%8E%E5%BA%8F%E5%88%97%E5%8C%96"><span class="toc-number">14.2.</span> <span class="toc-text"> 2. 解析与序列化</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#21-json-%E5%AF%B9%E8%B1%A1"><span class="toc-number">14.2.1.</span> <span class="toc-text"> 2.1 JSON 对象</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#22-jsonstringify-%E8%A1%A5%E5%85%85"><span class="toc-number">14.2.2.</span> <span class="toc-text"> 2.2  JSON.stringify  补充</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#23-tojson"><span class="toc-number">14.2.3.</span> <span class="toc-text"> 2.3  toJSON()</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#24-jsonparse-%E8%A1%A5%E5%85%85"><span class="toc-number">14.2.4.</span> <span class="toc-text"> 2.4  JSON.parse  补充</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BA%8C%E5%8D%81%E5%9B%9B-%E7%BD%91%E7%BB%9C%E8%AF%B7%E6%B1%82%E4%B8%8E%E8%BF%9C%E7%A8%8B%E8%B5%84%E6%BA%90"><span class="toc-number">15.</span> <span class="toc-text"> 二十四、 网络请求与远程资源</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-xmlhttprequest-%E5%AF%B9%E8%B1%A1"><span class="toc-number">15.1.</span> <span class="toc-text"> 1. XMLHttpRequest 对象</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#11-xhr-%E4%BD%BF%E7%94%A8%E6%AD%A5%E9%AA%A4"><span class="toc-number">15.1.1.</span> <span class="toc-text"> 1.1 XHR 使用步骤</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#12-xhr-%E7%9A%84%E5%B1%9E%E6%80%A7%E4%B8%8E%E6%96%B9%E6%B3%95"><span class="toc-number">15.1.2.</span> <span class="toc-text"> 1.2 XHR 的属性与方法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#13-http-%E5%8D%8F%E8%AE%AE%E6%A0%BC%E5%BC%8F"><span class="toc-number">15.1.3.</span> <span class="toc-text"> 1.3 HTTP 协议格式</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#131-http-%E5%8D%8F%E8%AE%AE%E8%AF%B7%E6%B1%82%E6%A0%BC%E5%BC%8F"><span class="toc-number">15.1.3.1.</span> <span class="toc-text"> 1.3.1 HTTP 协议请求格式</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#132-http-%E5%8D%8F%E8%AE%AE%E5%93%8D%E5%BA%94%E6%A0%BC%E5%BC%8F"><span class="toc-number">15.1.3.2.</span> <span class="toc-text"> 1.3.2 HTTP 协议响应格式</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#14-getpost-%E8%AF%B7%E6%B1%82%E6%96%B9%E6%B3%95"><span class="toc-number">15.1.4.</span> <span class="toc-text"> 1.4 GET&#x2F;POST 请求方法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#15-xhr-level-2%E8%BF%99%E4%BA%9B%E5%B0%B1%E4%B8%8D%E8%AE%B0%E4%BA%86"><span class="toc-number">15.1.5.</span> <span class="toc-text"> 1.5 XHR level 2（这些就不记了）</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-%E8%BF%9B%E5%BA%A6%E4%BA%8B%E4%BB%B6"><span class="toc-number">15.2.</span> <span class="toc-text"> 2. 进度事件</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#21-load-%E4%BA%8B%E4%BB%B6"><span class="toc-number">15.2.1.</span> <span class="toc-text"> 2.1 load 事件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#22-progress-%E4%BA%8B%E4%BB%B6"><span class="toc-number">15.2.2.</span> <span class="toc-text"> 2.2 progress 事件</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-%E8%B7%A8%E5%9F%9F%E8%B5%84%E6%BA%90%E5%85%B1%E4%BA%AB"><span class="toc-number">15.3.</span> <span class="toc-text"> 3. 跨域资源共享</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#31-cors-%E5%AE%9E%E7%8E%B0%E8%B7%A8%E5%9F%9F"><span class="toc-number">15.3.1.</span> <span class="toc-text"> 3.1 CORS 实现跨域</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#32-jsonp-%E5%AE%9E%E7%8E%B0%E8%B7%A8%E5%9F%9F"><span class="toc-number">15.3.2.</span> <span class="toc-text"> 3.2 JSONP 实现跨域</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8E%9F%E7%94%9F-javascript-%E5%AE%9E%E7%8E%B0-jsonp"><span class="toc-number">15.3.2.1.</span> <span class="toc-text"> 原生 JavaScript 实现 jsonp</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8-jquery-%E7%9A%84-jsonp"><span class="toc-number">15.3.2.2.</span> <span class="toc-text"> 使用 jQuery 的 jsonp</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%80%BB%E7%BB%93"><span class="toc-number">15.3.2.3.</span> <span class="toc-text"> 总结</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-fetch-api%E6%9B%B4%E5%85%88%E8%BF%9B%E7%9A%84-ajax"><span class="toc-number">15.4.</span> <span class="toc-text"> 4. Fetch API（更先进的 ajax）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#41-%E5%9F%BA%E6%9C%AC%E7%94%A8%E6%B3%95"><span class="toc-number">15.4.1.</span> <span class="toc-text"> 4.1 基本用法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#42-%E5%B8%B8%E8%A7%81-fetch-%E8%AF%B7%E6%B1%82%E6%A8%A1%E5%BC%8F"><span class="toc-number">15.4.2.</span> <span class="toc-text"> 4.2 常见 Fetch 请求模式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#43-headers-%E5%AF%B9%E8%B1%A1"><span class="toc-number">15.4.3.</span> <span class="toc-text"> 4.3 Headers 对象</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#44-request-%E5%AF%B9%E8%B1%A1"><span class="toc-number">15.4.4.</span> <span class="toc-text"> 4.4 Request 对象</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%85%8B%E9%9A%86-request-%E5%AE%9E%E4%BE%8B"><span class="toc-number">15.4.4.1.</span> <span class="toc-text"> 克隆 Request 实例</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9C%A8-fetch-%E4%B8%AD%E4%BD%BF%E7%94%A8-request"><span class="toc-number">15.4.4.2.</span> <span class="toc-text"> 在 fetch 中使用 Request</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#45-response-%E5%AF%B9%E8%B1%A1"><span class="toc-number">15.4.5.</span> <span class="toc-text"> 4.5 Response 对象</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#46-request-response-%E7%9A%84%E5%B1%9E%E6%80%A7%E5%8F%8A%E6%96%B9%E6%B3%95"><span class="toc-number">15.4.6.</span> <span class="toc-text"> 4.6 Request、Response 的属性及方法★</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#461-request-%E5%B1%9E%E6%80%A7"><span class="toc-number">15.4.6.1.</span> <span class="toc-text"> 4.6.1 Request 属性</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#462-response-%E5%B1%9E%E6%80%A7"><span class="toc-number">15.4.6.2.</span> <span class="toc-text"> 4.6.2 Response 属性</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#463-request-response-%E6%96%B9%E6%B3%95"><span class="toc-number">15.4.6.3.</span> <span class="toc-text"> 4.6.3 Request、Response 方法</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#47-%E7%9B%B4%E6%8E%A5%E8%AF%BB%E5%8F%96-readablestream-%E7%9A%84-body%E6%9A%82%E7%BC%93"><span class="toc-number">15.4.7.</span> <span class="toc-text"> 4.7 直接读取 ReadableStream 的 body（暂缓）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#48-beacon-api%E6%9A%82%E7%BC%93"><span class="toc-number">15.4.8.</span> <span class="toc-text"> 4.8 Beacon API（暂缓）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#49-web-socket"><span class="toc-number">15.4.9.</span> <span class="toc-text"> 4.9 Web Socket</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#491-api"><span class="toc-number">15.4.9.1.</span> <span class="toc-text"> 4.9.1 API</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#492-%E5%8F%91%E9%80%81%E5%92%8C%E6%8E%A5%E6%94%B6%E6%95%B0%E6%8D%AE"><span class="toc-number">15.4.9.2.</span> <span class="toc-text"> 4.9.2 发送和接收数据</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#493-%E5%85%B6%E4%BB%96%E4%BA%8B%E4%BB%B6"><span class="toc-number">15.4.9.3.</span> <span class="toc-text"> 4.9.3 其他事件</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#410-%E5%AE%89%E5%85%A8"><span class="toc-number">15.4.10.</span> <span class="toc-text"> 4.10 安全</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BA%8C%E5%8D%81%E5%85%AD-%E6%A8%A1%E5%9D%97"><span class="toc-number">16.</span> <span class="toc-text"> 二十六、 模块</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-es6-%E6%A8%A1%E5%9D%97"><span class="toc-number">16.1.</span> <span class="toc-text"> 1. ES6 模块</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#11-%E6%A8%A1%E5%9D%97%E9%85%8D%E7%BD%AE"><span class="toc-number">16.1.1.</span> <span class="toc-text"> 1.1 模块配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#12-%E6%A8%A1%E5%9D%97%E5%AF%BC%E5%87%BA"><span class="toc-number">16.1.2.</span> <span class="toc-text"> 1.2 模块导出</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#13-%E6%A8%A1%E5%9D%97%E5%AF%BC%E5%85%A5"><span class="toc-number">16.1.3.</span> <span class="toc-text"> 1.3 模块导入</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#vue-%E4%B8%AD%E7%9A%84-export-default"><span class="toc-number">16.1.4.</span> <span class="toc-text"> Vue 中的 export default</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-commonjs-%E6%A8%A1%E5%9D%97%E5%8A%A0%E8%BD%BD%E5%99%A8es6-%E4%B9%8B%E5%89%8D"><span class="toc-number">16.2.</span> <span class="toc-text"> 2. CommonJS 模块加载器（ES6 之前）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#21-%E5%AF%BC%E5%87%BA"><span class="toc-number">16.2.1.</span> <span class="toc-text"> 2.1 导出</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#22-%E5%AF%BC%E5%85%A5"><span class="toc-number">16.2.2.</span> <span class="toc-text"> 2.2 导入</span></a></li></ol></li></ol></li></ol>
      </div>
      <div class="related panel pjax" data-title="系列文章">
      </div>
      <div class="overview panel" data-title="站点概览">
        <div class="author" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <img class="image" itemprop="image" alt="宁理大神1996"
      data-src="../images/avatar.jpg">
  <p class="name" itemprop="name">宁理大神1996</p>
  <div class="description" itemprop="description">宁理大神的个人博客</div>
</div>

<nav class="state">
    <div class="item posts">
      <a href="">
        <span class="count">140</span>
        <span class="name">文章</span>
      </a>
    </div>
    <div class="item categories">
      <a href="../categories/">
        <span class="count">14</span>
        <span class="name">分类</span>
      </a>
    </div>
    <div class="item tags">
      <a href="../tags/">
        <span class="count">22</span>
        <span class="name">标签</span>
      </a>
    </div>
</nav>

<div class="social">
      <span class="exturl item github" data-url="aHR0cHM6Ly9naXRodWIuY29tL3lvdXJuYW1l" title="https:&#x2F;&#x2F;github.com&#x2F;yourname"><i class="ic i-github"></i></span>
      <span class="exturl item twitter" data-url="aHR0cHM6Ly90d2l0dGVyLmNvbS95b3VybmFtZQ==" title="https:&#x2F;&#x2F;twitter.com&#x2F;yourname"><i class="ic i-twitter"></i></span>
      <span class="exturl item zhihu" data-url="aHR0cHM6Ly93d3cuemhpaHUuY29tL3Blb3BsZS95b3VybmFtZQ==" title="https:&#x2F;&#x2F;www.zhihu.com&#x2F;people&#x2F;yourname"><i class="ic i-zhihu"></i></span>
      <span class="exturl item music" data-url="aHR0cHM6Ly9tdXNpYy4xNjMuY29tLyMvdXNlci9ob21lP2lkPXlvdXJpZA==" title="https:&#x2F;&#x2F;music.163.com&#x2F;#&#x2F;user&#x2F;home?id&#x3D;yourid"><i class="ic i-cloud-music"></i></span>
      <span class="exturl item weibo" data-url="aHR0cHM6Ly93ZWliby5jb20veW91cm5hbWU=" title="https:&#x2F;&#x2F;weibo.com&#x2F;yourname"><i class="ic i-weibo"></i></span>
      <span class="exturl item about" data-url="aHR0cHM6Ly9hYm91dC5tZS95b3VybmFtZQ==" title="https:&#x2F;&#x2F;about.me&#x2F;yourname"><i class="ic i-address-card"></i></span>
</div>

<ul class="menu">
  
    
  <li class="item">
    <a href="../index.html" rel="section"><i class="ic i-home"></i>首页</a>
  </li>

    
  <li class="item">
    <a href="../about/" rel="section"><i class="ic i-user"></i>关于</a>
  </li>

    
  <li class="item">
    <a href="../archives/" rel="section"><i class="ic i-archive"></i>归档</a>
  </li>

    
  <li class="item">
    <a href="../categories/" rel="section"><i class="ic i-th"></i>分类</a>
  </li>

    
  <li class="item">
    <a href="../tags/" rel="section"><i class="ic i-tags"></i>标签</a>
  </li>


</ul>

      </div>
    </div>
  </div>

  <ul id="quick">
    <li class="prev pjax">
        <a href="../../../../../../2021/12/24/note/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E7%AE%97%E6%B3%95/" rel="prev" title="上一篇"><i class="ic i-chevron-left"></i></a>
    </li>
    <li class="up"><i class="ic i-arrow-up"></i></li>
    <li class="down"><i class="ic i-arrow-down"></i></li>
    <li class="next pjax">
        <a href="../../../../../03/16/note/%E5%89%8D%E7%AB%AF/JavaScript%E7%9F%A5%E8%AF%86%E7%82%B9/" rel="next" title="下一篇"><i class="ic i-chevron-right"></i></a>
    </li>
    <li class="percent"></li>
  </ul>
</div>


        </div>
        <div class="dimmer"></div>
      </div>
    </main>
    <footer id="footer">
      <div class="inner">
        <div class="widgets">
          
<div class="rpost pjax">
  <h2>随机文章</h2>
  <ul>
      
  <li class="item">
    
<div class="breadcrumb">
<a href="../../../../../../categories/note/" title="分类于 笔记">笔记</a>
<i class="ic i-angle-right"></i>
<a href="../../../../../../categories/note/%E5%89%8D%E7%AB%AF/" title="分类于 前端">前端</a>
</div>

    <span><a href="../../../../../../2021/05/23/note/%E5%89%8D%E7%AB%AF/CSS%EF%BC%88%E5%BC%83%E7%94%A8%EF%BC%89/" title="CSS笔记及参考手册">CSS笔记及参考手册</a></span>
  </li>

      
  <li class="item">
    
<div class="breadcrumb">
</div>

    <span><a href="../../../../../07/28/note/%E5%89%8D%E7%AB%AF/%E7%BB%83%E4%B9%A0%E4%BB%A3%E7%A0%81/%E7%BB%83%E4%B9%A0/%E9%98%B2%E6%8A%96%E8%8A%82%E6%B5%81/" title="未命名">未命名</a></span>
  </li>

      
  <li class="item">
    
<div class="breadcrumb">
<a href="../../../../../../categories/note/" title="分类于 笔记">笔记</a>
</div>

    <span><a href="../../../../../../2021/05/10/note/hexo/Hexo%E6%90%AD%E5%BB%BAGitHub%E9%9D%99%E6%80%81%E5%8D%9A%E5%AE%A2/" title="Hexo搭建GitHub静态博客">Hexo搭建GitHub静态博客</a></span>
  </li>

      
  <li class="item">
    
<div class="breadcrumb">
</div>

    <span><a href="../../../../../08/05/note/%E5%89%8D%E7%AB%AF/%E7%BB%83%E4%B9%A0%E4%BB%A3%E7%A0%81/%E7%AE%97%E6%B3%95%E7%BB%83%E4%B9%A0/%E6%A0%88%E5%92%8C%E9%98%9F%E5%88%97/150.%20%E9%80%86%E6%B3%A2%E5%85%B0%E8%A1%A8%E8%BE%BE%E5%BC%8F%E6%B1%82%E5%80%BC/" title="未命名">未命名</a></span>
  </li>

      
  <li class="item">
    
<div class="breadcrumb">
</div>

    <span><a href="../../../../../08/04/note/%E5%89%8D%E7%AB%AF/%E7%BB%83%E4%B9%A0%E4%BB%A3%E7%A0%81/%E7%AE%97%E6%B3%95%E7%BB%83%E4%B9%A0/%E5%AD%97%E7%AC%A6%E4%B8%B2/28.%20%E5%AE%9E%E7%8E%B0%20strStr()/" title="未命名">未命名</a></span>
  </li>

      
  <li class="item">
    
<div class="breadcrumb">
</div>

    <span><a href="../../../../../08/02/note/%E5%89%8D%E7%AB%AF/%E7%BB%83%E4%B9%A0%E4%BB%A3%E7%A0%81/%E7%AE%97%E6%B3%95%E7%BB%83%E4%B9%A0/%E6%95%B0%E7%BB%84/%E8%9E%BA%E6%97%8B%E7%9F%A9%E9%98%B5/59.%20%E8%9E%BA%E6%97%8B%E7%9F%A9%E9%98%B5%20II/" title="未命名">未命名</a></span>
  </li>

      
  <li class="item">
    
<div class="breadcrumb">
</div>

    <span><a href="../../../../../08/02/note/%E5%89%8D%E7%AB%AF/%E7%BB%83%E4%B9%A0%E4%BB%A3%E7%A0%81/%E7%AE%97%E6%B3%95%E7%BB%83%E4%B9%A0/%E9%93%BE%E8%A1%A8/203.%20%E7%A7%BB%E9%99%A4%E9%93%BE%E8%A1%A8%E5%85%83%E7%B4%A0/" title="未命名">未命名</a></span>
  </li>

      
  <li class="item">
    
<div class="breadcrumb">
<a href="../../../../../../categories/note/" title="分类于 笔记">笔记</a>
<i class="ic i-angle-right"></i>
<a href="../../../../../../categories/note/%E5%89%8D%E7%AB%AF/" title="分类于 前端">前端</a>
</div>

    <span><a href="../../../../../../2021/05/27/note/%E5%89%8D%E7%AB%AF/JavaScript/" title="JavaScript基础语法">JavaScript基础语法</a></span>
  </li>

      
  <li class="item">
    
<div class="breadcrumb">
</div>

    <span><a href="../../../../../07/28/note/%E5%89%8D%E7%AB%AF/%E7%BB%83%E4%B9%A0%E4%BB%A3%E7%A0%81/%E7%BB%83%E4%B9%A0/%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%93%88%E5%B8%8C/" title="未命名">未命名</a></span>
  </li>

      
  <li class="item">
    
<div class="breadcrumb">
</div>

    <span><a href="../../../../../08/02/note/%E5%89%8D%E7%AB%AF/%E7%BB%83%E4%B9%A0%E4%BB%A3%E7%A0%81/%E7%AE%97%E6%B3%95%E7%BB%83%E4%B9%A0/%E9%93%BE%E8%A1%A8/206.%20%E5%8F%8D%E8%BD%AC%E9%93%BE%E8%A1%A8/" title="未命名">未命名</a></span>
  </li>

  </ul>
</div>
<div>
  <h2>最新评论</h2>
  <ul class="leancloud-recent-comment"></ul>
</div>

        </div>
        <div class="status">
  <div class="copyright">
    
    &copy; 2010 – 
    <span itemprop="copyrightYear">2022</span>
    <span class="with-love">
      <i class="ic i-sakura rotate"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">宁理大神1996 @ nitgod1996</span>
  </div>
  <div class="count">
    <span class="post-meta-item-icon">
      <i class="ic i-chart-area"></i>
    </span>
    <span title="站点总字数">537k 字</span>

    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="ic i-coffee"></i>
    </span>
    <span title="站点阅读时长">8:09</span>
  </div>
  <div class="powered-by">
    基于 <span class="exturl" data-url="aHR0cHM6Ly9oZXhvLmlv">Hexo</span> & Theme.<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2FtZWhpbWUvaGV4by10aGVtZS1zaG9rYQ==">Shoka</span>
  </div>
</div>

      </div>
    </footer>
  </div>
<script data-config type="text/javascript">
  var LOCAL = {
    path: '2022/01/14/note/前端/js高级程序设计/',
    favicon: {
      show: "（●´3｀●）やれやれだぜ",
      hide: "(´Д｀)大変だ！"
    },
    search : {
      placeholder: "文章搜索",
      empty: "关于 「 ${query} 」，什么也没搜到",
      stats: "${time} ms 内找到 ${hits} 条结果"
    },
    valine: true,fancybox: true,copyright: '复制成功，转载请遵守 <i class="ic i-creative-commons"></i>BY-NC-SA 协议。',
    ignores : [
      function(uri) {
        return uri.includes('#');
      },
      function(uri) {
        return new RegExp(LOCAL.path+"$").test(uri);
      }
    ]
  };
</script>


<script src="https://cdn.polyfill.io/v2/polyfill.js"></script>


<script src="//cdn.jsdelivr.net/combine/npm/pace-js@1.0.2/pace.min.js,npm/pjax@0.2.8/pjax.min.js,npm/whatwg-fetch@3.4.0/dist/fetch.umd.min.js,npm/animejs@3.2.0/lib/anime.min.js,npm/algoliasearch@4/dist/algoliasearch-lite.umd.js,npm/instantsearch.js@4/dist/instantsearch.production.min.js,npm/lozad@1/dist/lozad.min.js,npm/quicklink@2/dist/quicklink.umd.js"></script>

<script src="../../../../../../js/app.js?v=0.2.5"></script>




<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"model":{"jsonPath":"/live2dw/assets/hijiki.model.json"},"display":{"position":"left","width":150,"height":300},"mobile":{"show":false},"log":false,"pluginJsPath":"lib/","pluginModelPath":"assets/","pluginRootPath":"live2dw/","tagMode":false});</script></body>
</html>
